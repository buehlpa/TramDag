<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>tramdag API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="tramdag/TramDagConfig.html">TramDagConfig</a></li>
                    <li><a href="tramdag/TramDagDataset.html">TramDagDataset</a></li>
                    <li><a href="tramdag/TramDagModel.html">TramDagModel</a></li>
            </ul>

            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#TramDagConfig">TramDagConfig</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TramDagConfig.__init__">TramDagConfig</a>
                        </li>
                        <li>
                                <a class="variable" href="#TramDagConfig.debug">debug</a>
                        </li>
                        <li>
                                <a class="variable" href="#TramDagConfig.verbose">verbose</a>
                        </li>
                        <li>
                                <a class="variable" href="#TramDagConfig.conf_dict">conf_dict</a>
                        </li>
                        <li>
                                <a class="variable" href="#TramDagConfig.CONF_DICT_PATH">CONF_DICT_PATH</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagConfig.load_json">load_json</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagConfig.update">update</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagConfig.save">save</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagConfig.compute_levels">compute_levels</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagConfig.plot_dag">plot_dag</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagConfig.setup_configuration">setup_configuration</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagConfig.set_data_type">set_data_type</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagConfig.set_meta_adj_matrix">set_meta_adj_matrix</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagConfig.set_tramdag_nn_models">set_tramdag_nn_models</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TramDagDataset">TramDagDataset</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TramDagDataset.__init__">TramDagDataset</a>
                        </li>
                        <li>
                                <a class="variable" href="#TramDagDataset.DEFAULTS">DEFAULTS</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagDataset.from_dataframe">from_dataframe</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagDataset.compute_scaling">compute_scaling</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagDataset.summary">summary</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TramDagModel">TramDagModel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TramDagModel.__init__">TramDagModel</a>
                        </li>
                        <li>
                                <a class="variable" href="#TramDagModel.DEFAULTS_CONFIG">DEFAULTS_CONFIG</a>
                        </li>
                        <li>
                                <a class="variable" href="#TramDagModel.DEFAULTS_FIT">DEFAULTS_FIT</a>
                        </li>
                        <li>
                                <a class="variable" href="#TramDagModel.debug">debug</a>
                        </li>
                        <li>
                                <a class="variable" href="#TramDagModel.verbose">verbose</a>
                        </li>
                        <li>
                                <a class="variable" href="#TramDagModel.device">device</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.get_device">get_device</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.from_config">from_config</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.from_directory">from_directory</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.load_or_compute_minmax">load_or_compute_minmax</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.fit">fit</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.loss_history">loss_history</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.linear_shift_history">linear_shift_history</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.simple_intercept_history">simple_intercept_history</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.get_latent">get_latent</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.plot_loss_history">plot_loss_history</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.plot_linear_shift_history">plot_linear_shift_history</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.plot_simple_intercepts_history">plot_simple_intercepts_history</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.plot_latents">plot_latents</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.plot_hdag">plot_hdag</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.sample">sample</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.load_sampled_and_latents">load_sampled_and_latents</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.plot_samples_vs_true">plot_samples_vs_true</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.nll">nll</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.get_train_val_nll">get_train_val_nll</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.get_thetas">get_thetas</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.get_linear_shifts">get_linear_shifts</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.get_linear_shifts_dict">get_linear_shifts_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.get_simple_intercepts_dict">get_simple_intercepts_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#TramDagModel.summary">summary</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
tramdag    </h1>

                
                        <input id="mod-tramdag-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-tramdag-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="c1"># tramdag/__init__.py</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.TramDagConfig</span><span class="w"> </span><span class="kn">import</span> <span class="n">TramDagConfig</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.TramDagDataset</span><span class="w"> </span><span class="kn">import</span> <span class="n">TramDagDataset</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.TramDagModel</span><span class="w"> </span><span class="kn">import</span> <span class="n">TramDagModel</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">importlib.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span><span class="p">,</span> <span class="n">PackageNotFoundError</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;TramDagConfig&quot;</span><span class="p">,</span> <span class="s2">&quot;TramDagDataset&quot;</span><span class="p">,</span> <span class="s2">&quot;TramDagModel&quot;</span><span class="p">]</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="k">try</span><span class="p">:</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a>    <span class="n">__version__</span> <span class="o">=</span> <span class="n">version</span><span class="p">(</span><span class="s2">&quot;tramdag&quot;</span><span class="p">)</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="k">except</span> <span class="n">PackageNotFoundError</span><span class="p">:</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>    <span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.0.0&quot;</span>
</span></pre></div>


            </section>
                <section id="TramDagConfig">
                            <input id="TramDagConfig-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TramDagConfig</span>:

                <label class="view-source-button" for="TramDagConfig-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagConfig"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagConfig-30"><a href="#TramDagConfig-30"><span class="linenos"> 30</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TramDagConfig</span><span class="p">:</span>
</span><span id="TramDagConfig-31"><a href="#TramDagConfig-31"><span class="linenos"> 31</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig-32"><a href="#TramDagConfig-32"><span class="linenos"> 32</span></a><span class="sd">    Configuration manager for TRAM-DAG experiments.</span>
</span><span id="TramDagConfig-33"><a href="#TramDagConfig-33"><span class="linenos"> 33</span></a>
</span><span id="TramDagConfig-34"><a href="#TramDagConfig-34"><span class="linenos"> 34</span></a><span class="sd">    This class encapsulates:</span>
</span><span id="TramDagConfig-35"><a href="#TramDagConfig-35"><span class="linenos"> 35</span></a>
</span><span id="TramDagConfig-36"><a href="#TramDagConfig-36"><span class="linenos"> 36</span></a><span class="sd">    - The experiment configuration dictionary (`conf_dict`).</span>
</span><span id="TramDagConfig-37"><a href="#TramDagConfig-37"><span class="linenos"> 37</span></a><span class="sd">    - Its backing file path (`CONF_DICT_PATH`).</span>
</span><span id="TramDagConfig-38"><a href="#TramDagConfig-38"><span class="linenos"> 38</span></a><span class="sd">    - Utilities to load, validate, modify, and persist configuration.</span>
</span><span id="TramDagConfig-39"><a href="#TramDagConfig-39"><span class="linenos"> 39</span></a><span class="sd">    - DAG visualization and interactive editing helpers.</span>
</span><span id="TramDagConfig-40"><a href="#TramDagConfig-40"><span class="linenos"> 40</span></a>
</span><span id="TramDagConfig-41"><a href="#TramDagConfig-41"><span class="linenos"> 41</span></a><span class="sd">    Typical usage</span>
</span><span id="TramDagConfig-42"><a href="#TramDagConfig-42"><span class="linenos"> 42</span></a><span class="sd">    -------------</span>
</span><span id="TramDagConfig-43"><a href="#TramDagConfig-43"><span class="linenos"> 43</span></a><span class="sd">    - Load existing configuration from disk via `TramDagConfig.load_json`.</span>
</span><span id="TramDagConfig-44"><a href="#TramDagConfig-44"><span class="linenos"> 44</span></a><span class="sd">    - Or create/reuse experiment setup via `TramDagConfig().setup_configuration`.</span>
</span><span id="TramDagConfig-45"><a href="#TramDagConfig-45"><span class="linenos"> 45</span></a><span class="sd">    - Update sections such as `data_type`, adjacency matrix, and neural network</span>
</span><span id="TramDagConfig-46"><a href="#TramDagConfig-46"><span class="linenos"> 46</span></a><span class="sd">    model names using the provided methods.</span>
</span><span id="TramDagConfig-47"><a href="#TramDagConfig-47"><span class="linenos"> 47</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TramDagConfig-48"><a href="#TramDagConfig-48"><span class="linenos"> 48</span></a>        
</span><span id="TramDagConfig-49"><a href="#TramDagConfig-49"><span class="linenos"> 49</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="n">_verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TramDagConfig-50"><a href="#TramDagConfig-50"><span class="linenos"> 50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig-51"><a href="#TramDagConfig-51"><span class="linenos"> 51</span></a><span class="sd">        Initialize a TramDagConfig instance.</span>
</span><span id="TramDagConfig-52"><a href="#TramDagConfig-52"><span class="linenos"> 52</span></a>
</span><span id="TramDagConfig-53"><a href="#TramDagConfig-53"><span class="linenos"> 53</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig-54"><a href="#TramDagConfig-54"><span class="linenos"> 54</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig-55"><a href="#TramDagConfig-55"><span class="linenos"> 55</span></a><span class="sd">        conf_dict : dict or None, optional</span>
</span><span id="TramDagConfig-56"><a href="#TramDagConfig-56"><span class="linenos"> 56</span></a><span class="sd">            Configuration dictionary. If None, an empty dict is used and can</span>
</span><span id="TramDagConfig-57"><a href="#TramDagConfig-57"><span class="linenos"> 57</span></a><span class="sd">            be populated later. Default is None.</span>
</span><span id="TramDagConfig-58"><a href="#TramDagConfig-58"><span class="linenos"> 58</span></a><span class="sd">        CONF_DICT_PATH : str or None, optional</span>
</span><span id="TramDagConfig-59"><a href="#TramDagConfig-59"><span class="linenos"> 59</span></a><span class="sd">            Path to the configuration file on disk. Default is None.</span>
</span><span id="TramDagConfig-60"><a href="#TramDagConfig-60"><span class="linenos"> 60</span></a><span class="sd">        _verify : bool, optional</span>
</span><span id="TramDagConfig-61"><a href="#TramDagConfig-61"><span class="linenos"> 61</span></a><span class="sd">            If True, run `_verify_completeness()` after initialization.</span>
</span><span id="TramDagConfig-62"><a href="#TramDagConfig-62"><span class="linenos"> 62</span></a><span class="sd">            Default is False.</span>
</span><span id="TramDagConfig-63"><a href="#TramDagConfig-63"><span class="linenos"> 63</span></a><span class="sd">        **kwargs</span>
</span><span id="TramDagConfig-64"><a href="#TramDagConfig-64"><span class="linenos"> 64</span></a><span class="sd">            Additional attributes to be set on the instance. Keys &quot;conf_dict&quot;</span>
</span><span id="TramDagConfig-65"><a href="#TramDagConfig-65"><span class="linenos"> 65</span></a><span class="sd">            and &quot;CONF_DICT_PATH&quot; are forbidden and raise a ValueError.</span>
</span><span id="TramDagConfig-66"><a href="#TramDagConfig-66"><span class="linenos"> 66</span></a>
</span><span id="TramDagConfig-67"><a href="#TramDagConfig-67"><span class="linenos"> 67</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig-68"><a href="#TramDagConfig-68"><span class="linenos"> 68</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig-69"><a href="#TramDagConfig-69"><span class="linenos"> 69</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagConfig-70"><a href="#TramDagConfig-70"><span class="linenos"> 70</span></a><span class="sd">            If any key in `kwargs` is &quot;conf_dict&quot; or &quot;CONF_DICT_PATH&quot;.</span>
</span><span id="TramDagConfig-71"><a href="#TramDagConfig-71"><span class="linenos"> 71</span></a>
</span><span id="TramDagConfig-72"><a href="#TramDagConfig-72"><span class="linenos"> 72</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig-73"><a href="#TramDagConfig-73"><span class="linenos"> 73</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig-74"><a href="#TramDagConfig-74"><span class="linenos"> 74</span></a><span class="sd">        By default, `debug` and `verbose` are set to False. They can be</span>
</span><span id="TramDagConfig-75"><a href="#TramDagConfig-75"><span class="linenos"> 75</span></a><span class="sd">        overridden via `kwargs`.</span>
</span><span id="TramDagConfig-76"><a href="#TramDagConfig-76"><span class="linenos"> 76</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig-77"><a href="#TramDagConfig-77"><span class="linenos"> 77</span></a>
</span><span id="TramDagConfig-78"><a href="#TramDagConfig-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="TramDagConfig-79"><a href="#TramDagConfig-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="TramDagConfig-80"><a href="#TramDagConfig-80"><span class="linenos"> 80</span></a>        
</span><span id="TramDagConfig-81"><a href="#TramDagConfig-81"><span class="linenos"> 81</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagConfig-82"><a href="#TramDagConfig-82"><span class="linenos"> 82</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;conf_dict&#39;</span><span class="p">,</span> <span class="s1">&#39;CONF_DICT_PATH&#39;</span><span class="p">]:</span>
</span><span id="TramDagConfig-83"><a href="#TramDagConfig-83"><span class="linenos"> 83</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot override &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; via kwargs.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-84"><a href="#TramDagConfig-84"><span class="linenos"> 84</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="TramDagConfig-85"><a href="#TramDagConfig-85"><span class="linenos"> 85</span></a>        
</span><span id="TramDagConfig-86"><a href="#TramDagConfig-86"><span class="linenos"> 86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span> <span class="o">=</span> <span class="n">conf_dict</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="TramDagConfig-87"><a href="#TramDagConfig-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="n">CONF_DICT_PATH</span>
</span><span id="TramDagConfig-88"><a href="#TramDagConfig-88"><span class="linenos"> 88</span></a>        
</span><span id="TramDagConfig-89"><a href="#TramDagConfig-89"><span class="linenos"> 89</span></a>        <span class="c1"># verification </span>
</span><span id="TramDagConfig-90"><a href="#TramDagConfig-90"><span class="linenos"> 90</span></a>        <span class="k">if</span> <span class="n">_verify</span><span class="p">:</span>
</span><span id="TramDagConfig-91"><a href="#TramDagConfig-91"><span class="linenos"> 91</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_verify_completeness</span><span class="p">()</span>
</span><span id="TramDagConfig-92"><a href="#TramDagConfig-92"><span class="linenos"> 92</span></a>
</span><span id="TramDagConfig-93"><a href="#TramDagConfig-93"><span class="linenos"> 93</span></a>    <span class="nd">@classmethod</span>
</span><span id="TramDagConfig-94"><a href="#TramDagConfig-94"><span class="linenos"> 94</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span><span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagConfig-95"><a href="#TramDagConfig-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig-96"><a href="#TramDagConfig-96"><span class="linenos"> 96</span></a><span class="sd">        Load a configuration from a JSON file and construct a TramDagConfig.</span>
</span><span id="TramDagConfig-97"><a href="#TramDagConfig-97"><span class="linenos"> 97</span></a>
</span><span id="TramDagConfig-98"><a href="#TramDagConfig-98"><span class="linenos"> 98</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig-99"><a href="#TramDagConfig-99"><span class="linenos"> 99</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig-100"><a href="#TramDagConfig-100"><span class="linenos">100</span></a><span class="sd">        CONF_DICT_PATH : str</span>
</span><span id="TramDagConfig-101"><a href="#TramDagConfig-101"><span class="linenos">101</span></a><span class="sd">            Path to the configuration JSON file.</span>
</span><span id="TramDagConfig-102"><a href="#TramDagConfig-102"><span class="linenos">102</span></a><span class="sd">        debug : bool, optional</span>
</span><span id="TramDagConfig-103"><a href="#TramDagConfig-103"><span class="linenos">103</span></a><span class="sd">            If True, initialize the instance with `debug=True`. Default is False.</span>
</span><span id="TramDagConfig-104"><a href="#TramDagConfig-104"><span class="linenos">104</span></a>
</span><span id="TramDagConfig-105"><a href="#TramDagConfig-105"><span class="linenos">105</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig-106"><a href="#TramDagConfig-106"><span class="linenos">106</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig-107"><a href="#TramDagConfig-107"><span class="linenos">107</span></a><span class="sd">        TramDagConfig</span>
</span><span id="TramDagConfig-108"><a href="#TramDagConfig-108"><span class="linenos">108</span></a><span class="sd">            Newly created configuration instance with `conf_dict` loaded from</span>
</span><span id="TramDagConfig-109"><a href="#TramDagConfig-109"><span class="linenos">109</span></a><span class="sd">            `CONF_DICT_PATH` and `_verify_completeness()` executed.</span>
</span><span id="TramDagConfig-110"><a href="#TramDagConfig-110"><span class="linenos">110</span></a>
</span><span id="TramDagConfig-111"><a href="#TramDagConfig-111"><span class="linenos">111</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig-112"><a href="#TramDagConfig-112"><span class="linenos">112</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig-113"><a href="#TramDagConfig-113"><span class="linenos">113</span></a><span class="sd">        FileNotFoundError</span>
</span><span id="TramDagConfig-114"><a href="#TramDagConfig-114"><span class="linenos">114</span></a><span class="sd">            If the configuration file cannot be found (propagated by</span>
</span><span id="TramDagConfig-115"><a href="#TramDagConfig-115"><span class="linenos">115</span></a><span class="sd">            `load_configuration_dict`).</span>
</span><span id="TramDagConfig-116"><a href="#TramDagConfig-116"><span class="linenos">116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig-117"><a href="#TramDagConfig-117"><span class="linenos">117</span></a>
</span><span id="TramDagConfig-118"><a href="#TramDagConfig-118"><span class="linenos">118</span></a>        <span class="n">conf</span> <span class="o">=</span> <span class="n">load_configuration_dict</span><span class="p">(</span><span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig-119"><a href="#TramDagConfig-119"><span class="linenos">119</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="o">=</span><span class="n">CONF_DICT_PATH</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="n">_verify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TramDagConfig-120"><a href="#TramDagConfig-120"><span class="linenos">120</span></a>
</span><span id="TramDagConfig-121"><a href="#TramDagConfig-121"><span class="linenos">121</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagConfig-122"><a href="#TramDagConfig-122"><span class="linenos">122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig-123"><a href="#TramDagConfig-123"><span class="linenos">123</span></a><span class="sd">        Reload the latest configuration from disk into this instance.</span>
</span><span id="TramDagConfig-124"><a href="#TramDagConfig-124"><span class="linenos">124</span></a>
</span><span id="TramDagConfig-125"><a href="#TramDagConfig-125"><span class="linenos">125</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig-126"><a href="#TramDagConfig-126"><span class="linenos">126</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig-127"><a href="#TramDagConfig-127"><span class="linenos">127</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig-128"><a href="#TramDagConfig-128"><span class="linenos">128</span></a>
</span><span id="TramDagConfig-129"><a href="#TramDagConfig-129"><span class="linenos">129</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig-130"><a href="#TramDagConfig-130"><span class="linenos">130</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig-131"><a href="#TramDagConfig-131"><span class="linenos">131</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig-132"><a href="#TramDagConfig-132"><span class="linenos">132</span></a>
</span><span id="TramDagConfig-133"><a href="#TramDagConfig-133"><span class="linenos">133</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig-134"><a href="#TramDagConfig-134"><span class="linenos">134</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig-135"><a href="#TramDagConfig-135"><span class="linenos">135</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagConfig-136"><a href="#TramDagConfig-136"><span class="linenos">136</span></a><span class="sd">            If `CONF_DICT_PATH` is not set on the instance.</span>
</span><span id="TramDagConfig-137"><a href="#TramDagConfig-137"><span class="linenos">137</span></a>
</span><span id="TramDagConfig-138"><a href="#TramDagConfig-138"><span class="linenos">138</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig-139"><a href="#TramDagConfig-139"><span class="linenos">139</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig-140"><a href="#TramDagConfig-140"><span class="linenos">140</span></a><span class="sd">        The current in-memory `conf_dict` is overwritten by the contents</span>
</span><span id="TramDagConfig-141"><a href="#TramDagConfig-141"><span class="linenos">141</span></a><span class="sd">        loaded from `CONF_DICT_PATH`.</span>
</span><span id="TramDagConfig-142"><a href="#TramDagConfig-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig-143"><a href="#TramDagConfig-143"><span class="linenos">143</span></a>
</span><span id="TramDagConfig-144"><a href="#TramDagConfig-144"><span class="linenos">144</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;CONF_DICT_PATH&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig-145"><a href="#TramDagConfig-145"><span class="linenos">145</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CONF_DICT_PATH not set  cannot update configuration.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-146"><a href="#TramDagConfig-146"><span class="linenos">146</span></a>        
</span><span id="TramDagConfig-147"><a href="#TramDagConfig-147"><span class="linenos">147</span></a>        
</span><span id="TramDagConfig-148"><a href="#TramDagConfig-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span> <span class="o">=</span> <span class="n">load_configuration_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig-149"><a href="#TramDagConfig-149"><span class="linenos">149</span></a>
</span><span id="TramDagConfig-150"><a href="#TramDagConfig-150"><span class="linenos">150</span></a>
</span><span id="TramDagConfig-151"><a href="#TramDagConfig-151"><span class="linenos">151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagConfig-152"><a href="#TramDagConfig-152"><span class="linenos">152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig-153"><a href="#TramDagConfig-153"><span class="linenos">153</span></a><span class="sd">        Persist the current configuration dictionary to disk.</span>
</span><span id="TramDagConfig-154"><a href="#TramDagConfig-154"><span class="linenos">154</span></a>
</span><span id="TramDagConfig-155"><a href="#TramDagConfig-155"><span class="linenos">155</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig-156"><a href="#TramDagConfig-156"><span class="linenos">156</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig-157"><a href="#TramDagConfig-157"><span class="linenos">157</span></a><span class="sd">        CONF_DICT_PATH : str or None, optional</span>
</span><span id="TramDagConfig-158"><a href="#TramDagConfig-158"><span class="linenos">158</span></a><span class="sd">            Target path for the configuration file. If None, uses</span>
</span><span id="TramDagConfig-159"><a href="#TramDagConfig-159"><span class="linenos">159</span></a><span class="sd">            `self.CONF_DICT_PATH`. Default is None.</span>
</span><span id="TramDagConfig-160"><a href="#TramDagConfig-160"><span class="linenos">160</span></a>
</span><span id="TramDagConfig-161"><a href="#TramDagConfig-161"><span class="linenos">161</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig-162"><a href="#TramDagConfig-162"><span class="linenos">162</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig-163"><a href="#TramDagConfig-163"><span class="linenos">163</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig-164"><a href="#TramDagConfig-164"><span class="linenos">164</span></a>
</span><span id="TramDagConfig-165"><a href="#TramDagConfig-165"><span class="linenos">165</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig-166"><a href="#TramDagConfig-166"><span class="linenos">166</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig-167"><a href="#TramDagConfig-167"><span class="linenos">167</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagConfig-168"><a href="#TramDagConfig-168"><span class="linenos">168</span></a><span class="sd">            If neither the function argument nor `self.CONF_DICT_PATH`</span>
</span><span id="TramDagConfig-169"><a href="#TramDagConfig-169"><span class="linenos">169</span></a><span class="sd">            provides a valid path.</span>
</span><span id="TramDagConfig-170"><a href="#TramDagConfig-170"><span class="linenos">170</span></a>
</span><span id="TramDagConfig-171"><a href="#TramDagConfig-171"><span class="linenos">171</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig-172"><a href="#TramDagConfig-172"><span class="linenos">172</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig-173"><a href="#TramDagConfig-173"><span class="linenos">173</span></a><span class="sd">        The resulting file is written via `write_configuration_dict`.</span>
</span><span id="TramDagConfig-174"><a href="#TramDagConfig-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig-175"><a href="#TramDagConfig-175"><span class="linenos">175</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">CONF_DICT_PATH</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span>
</span><span id="TramDagConfig-176"><a href="#TramDagConfig-176"><span class="linenos">176</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig-177"><a href="#TramDagConfig-177"><span class="linenos">177</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No CONF_DICT_PATH provided to save config.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-178"><a href="#TramDagConfig-178"><span class="linenos">178</span></a>        <span class="n">write_configuration_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="TramDagConfig-179"><a href="#TramDagConfig-179"><span class="linenos">179</span></a>
</span><span id="TramDagConfig-180"><a href="#TramDagConfig-180"><span class="linenos">180</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_verify_completeness</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagConfig-181"><a href="#TramDagConfig-181"><span class="linenos">181</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig-182"><a href="#TramDagConfig-182"><span class="linenos">182</span></a><span class="sd">        Check that the configuration is structurally complete and consistent.</span>
</span><span id="TramDagConfig-183"><a href="#TramDagConfig-183"><span class="linenos">183</span></a>
</span><span id="TramDagConfig-184"><a href="#TramDagConfig-184"><span class="linenos">184</span></a><span class="sd">        The following checks are performed:</span>
</span><span id="TramDagConfig-185"><a href="#TramDagConfig-185"><span class="linenos">185</span></a>
</span><span id="TramDagConfig-186"><a href="#TramDagConfig-186"><span class="linenos">186</span></a><span class="sd">        1. Top-level mandatory keys:</span>
</span><span id="TramDagConfig-187"><a href="#TramDagConfig-187"><span class="linenos">187</span></a><span class="sd">        - &quot;experiment_name&quot;</span>
</span><span id="TramDagConfig-188"><a href="#TramDagConfig-188"><span class="linenos">188</span></a><span class="sd">        - &quot;PATHS&quot;</span>
</span><span id="TramDagConfig-189"><a href="#TramDagConfig-189"><span class="linenos">189</span></a><span class="sd">        - &quot;nodes&quot;</span>
</span><span id="TramDagConfig-190"><a href="#TramDagConfig-190"><span class="linenos">190</span></a><span class="sd">        - &quot;data_type&quot;</span>
</span><span id="TramDagConfig-191"><a href="#TramDagConfig-191"><span class="linenos">191</span></a><span class="sd">        - &quot;adj_matrix&quot;</span>
</span><span id="TramDagConfig-192"><a href="#TramDagConfig-192"><span class="linenos">192</span></a><span class="sd">        - &quot;model_names&quot;</span>
</span><span id="TramDagConfig-193"><a href="#TramDagConfig-193"><span class="linenos">193</span></a>
</span><span id="TramDagConfig-194"><a href="#TramDagConfig-194"><span class="linenos">194</span></a><span class="sd">        2. Per-node mandatory keys:</span>
</span><span id="TramDagConfig-195"><a href="#TramDagConfig-195"><span class="linenos">195</span></a><span class="sd">        - &quot;data_type&quot;</span>
</span><span id="TramDagConfig-196"><a href="#TramDagConfig-196"><span class="linenos">196</span></a><span class="sd">        - &quot;node_type&quot;</span>
</span><span id="TramDagConfig-197"><a href="#TramDagConfig-197"><span class="linenos">197</span></a><span class="sd">        - &quot;parents&quot;</span>
</span><span id="TramDagConfig-198"><a href="#TramDagConfig-198"><span class="linenos">198</span></a><span class="sd">        - &quot;parents_datatype&quot;</span>
</span><span id="TramDagConfig-199"><a href="#TramDagConfig-199"><span class="linenos">199</span></a><span class="sd">        - &quot;transformation_terms_in_h()&quot;</span>
</span><span id="TramDagConfig-200"><a href="#TramDagConfig-200"><span class="linenos">200</span></a><span class="sd">        - &quot;transformation_term_nn_models_in_h()&quot;</span>
</span><span id="TramDagConfig-201"><a href="#TramDagConfig-201"><span class="linenos">201</span></a>
</span><span id="TramDagConfig-202"><a href="#TramDagConfig-202"><span class="linenos">202</span></a><span class="sd">        3. Ordinal / categorical levels:</span>
</span><span id="TramDagConfig-203"><a href="#TramDagConfig-203"><span class="linenos">203</span></a><span class="sd">        - All ordinal variables must have a corresponding &quot;levels&quot; entry</span>
</span><span id="TramDagConfig-204"><a href="#TramDagConfig-204"><span class="linenos">204</span></a><span class="sd">            under `conf_dict[&quot;nodes&quot;][var]`.</span>
</span><span id="TramDagConfig-205"><a href="#TramDagConfig-205"><span class="linenos">205</span></a>
</span><span id="TramDagConfig-206"><a href="#TramDagConfig-206"><span class="linenos">206</span></a><span class="sd">        4. Experiment name:</span>
</span><span id="TramDagConfig-207"><a href="#TramDagConfig-207"><span class="linenos">207</span></a><span class="sd">        - Must be non-empty.</span>
</span><span id="TramDagConfig-208"><a href="#TramDagConfig-208"><span class="linenos">208</span></a>
</span><span id="TramDagConfig-209"><a href="#TramDagConfig-209"><span class="linenos">209</span></a><span class="sd">        5. Adjacency matrix:</span>
</span><span id="TramDagConfig-210"><a href="#TramDagConfig-210"><span class="linenos">210</span></a><span class="sd">        - Must be valid under `validate_adj_matrix`.</span>
</span><span id="TramDagConfig-211"><a href="#TramDagConfig-211"><span class="linenos">211</span></a>
</span><span id="TramDagConfig-212"><a href="#TramDagConfig-212"><span class="linenos">212</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig-213"><a href="#TramDagConfig-213"><span class="linenos">213</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig-214"><a href="#TramDagConfig-214"><span class="linenos">214</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig-215"><a href="#TramDagConfig-215"><span class="linenos">215</span></a>
</span><span id="TramDagConfig-216"><a href="#TramDagConfig-216"><span class="linenos">216</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig-217"><a href="#TramDagConfig-217"><span class="linenos">217</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig-218"><a href="#TramDagConfig-218"><span class="linenos">218</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig-219"><a href="#TramDagConfig-219"><span class="linenos">219</span></a>
</span><span id="TramDagConfig-220"><a href="#TramDagConfig-220"><span class="linenos">220</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig-221"><a href="#TramDagConfig-221"><span class="linenos">221</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig-222"><a href="#TramDagConfig-222"><span class="linenos">222</span></a><span class="sd">        - Missing or invalid components are reported via printed warnings.</span>
</span><span id="TramDagConfig-223"><a href="#TramDagConfig-223"><span class="linenos">223</span></a><span class="sd">        - Detailed debug messages are printed when `self.debug=True`.</span>
</span><span id="TramDagConfig-224"><a href="#TramDagConfig-224"><span class="linenos">224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig-225"><a href="#TramDagConfig-225"><span class="linenos">225</span></a>        <span class="n">mandatory_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;experiment_name&quot;</span><span class="p">,</span><span class="s2">&quot;PATHS&quot;</span><span class="p">,</span> <span class="s2">&quot;nodes&quot;</span><span class="p">,</span> <span class="s2">&quot;data_type&quot;</span><span class="p">,</span> <span class="s2">&quot;adj_matrix&quot;</span><span class="p">,</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span><span class="s2">&quot;model_names&quot;</span><span class="p">]</span>
</span><span id="TramDagConfig-226"><a href="#TramDagConfig-226"><span class="linenos">226</span></a>        <span class="n">optional_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;date_of_creation&quot;</span><span class="p">,</span> <span class="s2">&quot;seed&quot;</span><span class="p">]</span>
</span><span id="TramDagConfig-227"><a href="#TramDagConfig-227"><span class="linenos">227</span></a>
</span><span id="TramDagConfig-228"><a href="#TramDagConfig-228"><span class="linenos">228</span></a>        <span class="c1"># ---- 1. Check mandatory keys exist</span>
</span><span id="TramDagConfig-229"><a href="#TramDagConfig-229"><span class="linenos">229</span></a>        <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mandatory_keys</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">]</span>
</span><span id="TramDagConfig-230"><a href="#TramDagConfig-230"><span class="linenos">230</span></a>        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
</span><span id="TramDagConfig-231"><a href="#TramDagConfig-231"><span class="linenos">231</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Missing mandatory keys in configuration: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="TramDagConfig-232"><a href="#TramDagConfig-232"><span class="linenos">232</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Please add them to the configuration dict and reload.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-233"><a href="#TramDagConfig-233"><span class="linenos">233</span></a>            
</span><span id="TramDagConfig-234"><a href="#TramDagConfig-234"><span class="linenos">234</span></a>        <span class="c1"># --- 2. Check  if mandatory keys in nodesdict are present</span>
</span><span id="TramDagConfig-235"><a href="#TramDagConfig-235"><span class="linenos">235</span></a>        <span class="n">mandatory_keys_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">,</span> <span class="s1">&#39;node_type&#39;</span><span class="p">,</span><span class="s1">&#39;parents&#39;</span><span class="p">,</span><span class="s1">&#39;parents_datatype&#39;</span><span class="p">,</span><span class="s1">&#39;transformation_terms_in_h()&#39;</span><span class="p">,</span><span class="s1">&#39;transformation_term_nn_models_in_h()&#39;</span><span class="p">]</span>
</span><span id="TramDagConfig-236"><a href="#TramDagConfig-236"><span class="linenos">236</span></a>        <span class="n">optional_keys_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;levels&quot;</span><span class="p">]</span>
</span><span id="TramDagConfig-237"><a href="#TramDagConfig-237"><span class="linenos">237</span></a>        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">node_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagConfig-238"><a href="#TramDagConfig-238"><span class="linenos">238</span></a>            <span class="c1"># check missing mandatory keys</span>
</span><span id="TramDagConfig-239"><a href="#TramDagConfig-239"><span class="linenos">239</span></a>            <span class="n">missing_node_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mandatory_keys_nodes</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_dict</span><span class="p">]</span>
</span><span id="TramDagConfig-240"><a href="#TramDagConfig-240"><span class="linenos">240</span></a>            <span class="k">if</span> <span class="n">missing_node_keys</span><span class="p">:</span>
</span><span id="TramDagConfig-241"><a href="#TramDagConfig-241"><span class="linenos">241</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; is missing mandatory keys: </span><span class="si">{</span><span class="n">missing_node_keys</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-242"><a href="#TramDagConfig-242"><span class="linenos">242</span></a>                
</span><span id="TramDagConfig-243"><a href="#TramDagConfig-243"><span class="linenos">243</span></a>
</span><span id="TramDagConfig-244"><a href="#TramDagConfig-244"><span class="linenos">244</span></a>        
</span><span id="TramDagConfig-245"><a href="#TramDagConfig-245"><span class="linenos">245</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verify_levels_dict</span><span class="p">():</span>
</span><span id="TramDagConfig-246"><a href="#TramDagConfig-246"><span class="linenos">246</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagConfig-247"><a href="#TramDagConfig-247"><span class="linenos">247</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] levels are present for all ordinal variables in configuration dict.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-248"><a href="#TramDagConfig-248"><span class="linenos">248</span></a>            <span class="k">pass</span>
</span><span id="TramDagConfig-249"><a href="#TramDagConfig-249"><span class="linenos">249</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig-250"><a href="#TramDagConfig-250"><span class="linenos">250</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING]  levels are missing for some ordinal variables in configuration dict. THIS will FAIL in model training later!</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="TramDagConfig-251"><a href="#TramDagConfig-251"><span class="linenos">251</span></a>                <span class="s2">&quot; Please provide levels manually to config and reload or compute levels from data using the method compute_levels().</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="TramDagConfig-252"><a href="#TramDagConfig-252"><span class="linenos">252</span></a>                <span class="s2">&quot; e.g. cfg.compute_levels(train_df) # computes levels from training data and writes to cfg&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-253"><a href="#TramDagConfig-253"><span class="linenos">253</span></a>
</span><span id="TramDagConfig-254"><a href="#TramDagConfig-254"><span class="linenos">254</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verify_experiment_name</span><span class="p">():</span>
</span><span id="TramDagConfig-255"><a href="#TramDagConfig-255"><span class="linenos">255</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagConfig-256"><a href="#TramDagConfig-256"><span class="linenos">256</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] experiment_name is valid in configuration dict.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-257"><a href="#TramDagConfig-257"><span class="linenos">257</span></a>            <span class="k">pass</span>
</span><span id="TramDagConfig-258"><a href="#TramDagConfig-258"><span class="linenos">258</span></a>        
</span><span id="TramDagConfig-259"><a href="#TramDagConfig-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verify_adj_matrix</span><span class="p">():</span>
</span><span id="TramDagConfig-260"><a href="#TramDagConfig-260"><span class="linenos">260</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagConfig-261"><a href="#TramDagConfig-261"><span class="linenos">261</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] adj_matrix is valid in configuration dict.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-262"><a href="#TramDagConfig-262"><span class="linenos">262</span></a>            <span class="k">pass</span>
</span><span id="TramDagConfig-263"><a href="#TramDagConfig-263"><span class="linenos">263</span></a>
</span><span id="TramDagConfig-264"><a href="#TramDagConfig-264"><span class="linenos">264</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_verify_levels_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagConfig-265"><a href="#TramDagConfig-265"><span class="linenos">265</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig-266"><a href="#TramDagConfig-266"><span class="linenos">266</span></a><span class="sd">        Verify that all ordinal variables have levels specified in the config.</span>
</span><span id="TramDagConfig-267"><a href="#TramDagConfig-267"><span class="linenos">267</span></a>
</span><span id="TramDagConfig-268"><a href="#TramDagConfig-268"><span class="linenos">268</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig-269"><a href="#TramDagConfig-269"><span class="linenos">269</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig-270"><a href="#TramDagConfig-270"><span class="linenos">270</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig-271"><a href="#TramDagConfig-271"><span class="linenos">271</span></a>
</span><span id="TramDagConfig-272"><a href="#TramDagConfig-272"><span class="linenos">272</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig-273"><a href="#TramDagConfig-273"><span class="linenos">273</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig-274"><a href="#TramDagConfig-274"><span class="linenos">274</span></a><span class="sd">        bool</span>
</span><span id="TramDagConfig-275"><a href="#TramDagConfig-275"><span class="linenos">275</span></a><span class="sd">            True if all variables declared as ordinal in ``conf_dict[&quot;data_type&quot;]``</span>
</span><span id="TramDagConfig-276"><a href="#TramDagConfig-276"><span class="linenos">276</span></a><span class="sd">            have a &quot;levels&quot; entry in ``conf_dict[&quot;nodes&quot;][var]``.</span>
</span><span id="TramDagConfig-277"><a href="#TramDagConfig-277"><span class="linenos">277</span></a><span class="sd">            False otherwise.</span>
</span><span id="TramDagConfig-278"><a href="#TramDagConfig-278"><span class="linenos">278</span></a>
</span><span id="TramDagConfig-279"><a href="#TramDagConfig-279"><span class="linenos">279</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig-280"><a href="#TramDagConfig-280"><span class="linenos">280</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig-281"><a href="#TramDagConfig-281"><span class="linenos">281</span></a><span class="sd">        This method does not modify the configuration; it only checks presence</span>
</span><span id="TramDagConfig-282"><a href="#TramDagConfig-282"><span class="linenos">282</span></a><span class="sd">        of level information.</span>
</span><span id="TramDagConfig-283"><a href="#TramDagConfig-283"><span class="linenos">283</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig-284"><a href="#TramDagConfig-284"><span class="linenos">284</span></a>        <span class="n">data_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_type&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="TramDagConfig-285"><a href="#TramDagConfig-285"><span class="linenos">285</span></a>        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nodes&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="TramDagConfig-286"><a href="#TramDagConfig-286"><span class="linenos">286</span></a>        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">data_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagConfig-287"><a href="#TramDagConfig-287"><span class="linenos">287</span></a>            <span class="k">if</span> <span class="s1">&#39;ordinal&#39;</span> <span class="ow">in</span> <span class="n">dtype</span><span class="p">:</span>
</span><span id="TramDagConfig-288"><a href="#TramDagConfig-288"><span class="linenos">288</span></a>                <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="ow">or</span> <span class="s1">&#39;levels&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">[</span><span class="n">var</span><span class="p">]:</span>
</span><span id="TramDagConfig-289"><a href="#TramDagConfig-289"><span class="linenos">289</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="TramDagConfig-290"><a href="#TramDagConfig-290"><span class="linenos">290</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="TramDagConfig-291"><a href="#TramDagConfig-291"><span class="linenos">291</span></a>
</span><span id="TramDagConfig-292"><a href="#TramDagConfig-292"><span class="linenos">292</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_verify_experiment_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagConfig-293"><a href="#TramDagConfig-293"><span class="linenos">293</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig-294"><a href="#TramDagConfig-294"><span class="linenos">294</span></a><span class="sd">        Check whether the experiment name in the configuration is valid.</span>
</span><span id="TramDagConfig-295"><a href="#TramDagConfig-295"><span class="linenos">295</span></a>
</span><span id="TramDagConfig-296"><a href="#TramDagConfig-296"><span class="linenos">296</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig-297"><a href="#TramDagConfig-297"><span class="linenos">297</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig-298"><a href="#TramDagConfig-298"><span class="linenos">298</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig-299"><a href="#TramDagConfig-299"><span class="linenos">299</span></a>
</span><span id="TramDagConfig-300"><a href="#TramDagConfig-300"><span class="linenos">300</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig-301"><a href="#TramDagConfig-301"><span class="linenos">301</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig-302"><a href="#TramDagConfig-302"><span class="linenos">302</span></a><span class="sd">        bool</span>
</span><span id="TramDagConfig-303"><a href="#TramDagConfig-303"><span class="linenos">303</span></a><span class="sd">            True if ``conf_dict[&quot;experiment_name&quot;]`` exists and is non-empty</span>
</span><span id="TramDagConfig-304"><a href="#TramDagConfig-304"><span class="linenos">304</span></a><span class="sd">            after stripping whitespace. False otherwise.</span>
</span><span id="TramDagConfig-305"><a href="#TramDagConfig-305"><span class="linenos">305</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig-306"><a href="#TramDagConfig-306"><span class="linenos">306</span></a>        <span class="n">experiment_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;experiment_name&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-307"><a href="#TramDagConfig-307"><span class="linenos">307</span></a>        <span class="k">if</span> <span class="n">experiment_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="TramDagConfig-308"><a href="#TramDagConfig-308"><span class="linenos">308</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TramDagConfig-309"><a href="#TramDagConfig-309"><span class="linenos">309</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="TramDagConfig-310"><a href="#TramDagConfig-310"><span class="linenos">310</span></a>        
</span><span id="TramDagConfig-311"><a href="#TramDagConfig-311"><span class="linenos">311</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_verify_adj_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagConfig-312"><a href="#TramDagConfig-312"><span class="linenos">312</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig-313"><a href="#TramDagConfig-313"><span class="linenos">313</span></a><span class="sd">        Validate the adjacency matrix stored in the configuration.</span>
</span><span id="TramDagConfig-314"><a href="#TramDagConfig-314"><span class="linenos">314</span></a>
</span><span id="TramDagConfig-315"><a href="#TramDagConfig-315"><span class="linenos">315</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig-316"><a href="#TramDagConfig-316"><span class="linenos">316</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig-317"><a href="#TramDagConfig-317"><span class="linenos">317</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig-318"><a href="#TramDagConfig-318"><span class="linenos">318</span></a>
</span><span id="TramDagConfig-319"><a href="#TramDagConfig-319"><span class="linenos">319</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig-320"><a href="#TramDagConfig-320"><span class="linenos">320</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig-321"><a href="#TramDagConfig-321"><span class="linenos">321</span></a><span class="sd">        bool</span>
</span><span id="TramDagConfig-322"><a href="#TramDagConfig-322"><span class="linenos">322</span></a><span class="sd">            True if the adjacency matrix passes `validate_adj_matrix`, False otherwise.</span>
</span><span id="TramDagConfig-323"><a href="#TramDagConfig-323"><span class="linenos">323</span></a>
</span><span id="TramDagConfig-324"><a href="#TramDagConfig-324"><span class="linenos">324</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig-325"><a href="#TramDagConfig-325"><span class="linenos">325</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig-326"><a href="#TramDagConfig-326"><span class="linenos">326</span></a><span class="sd">        If the adjacency matrix is stored as a list, it is converted to a</span>
</span><span id="TramDagConfig-327"><a href="#TramDagConfig-327"><span class="linenos">327</span></a><span class="sd">        NumPy array before validation.</span>
</span><span id="TramDagConfig-328"><a href="#TramDagConfig-328"><span class="linenos">328</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig-329"><a href="#TramDagConfig-329"><span class="linenos">329</span></a>        <span class="n">adj_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s1">&#39;adj_matrix&#39;</span><span class="p">]</span>
</span><span id="TramDagConfig-330"><a href="#TramDagConfig-330"><span class="linenos">330</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="TramDagConfig-331"><a href="#TramDagConfig-331"><span class="linenos">331</span></a>            <span class="n">adj_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s1">&#39;adj_matrix&#39;</span><span class="p">])</span>
</span><span id="TramDagConfig-332"><a href="#TramDagConfig-332"><span class="linenos">332</span></a>        <span class="k">if</span> <span class="n">validate_adj_matrix</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">):</span>
</span><span id="TramDagConfig-333"><a href="#TramDagConfig-333"><span class="linenos">333</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="TramDagConfig-334"><a href="#TramDagConfig-334"><span class="linenos">334</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig-335"><a href="#TramDagConfig-335"><span class="linenos">335</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TramDagConfig-336"><a href="#TramDagConfig-336"><span class="linenos">336</span></a>        
</span><span id="TramDagConfig-337"><a href="#TramDagConfig-337"><span class="linenos">337</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">write</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="TramDagConfig-338"><a href="#TramDagConfig-338"><span class="linenos">338</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig-339"><a href="#TramDagConfig-339"><span class="linenos">339</span></a><span class="sd">        Infer and update ordinal/categorical levels from data.</span>
</span><span id="TramDagConfig-340"><a href="#TramDagConfig-340"><span class="linenos">340</span></a>
</span><span id="TramDagConfig-341"><a href="#TramDagConfig-341"><span class="linenos">341</span></a><span class="sd">        For each variable in the configuration&#39;s `data_type` section, this</span>
</span><span id="TramDagConfig-342"><a href="#TramDagConfig-342"><span class="linenos">342</span></a><span class="sd">        method uses the provided DataFrame to construct a levels dictionary</span>
</span><span id="TramDagConfig-343"><a href="#TramDagConfig-343"><span class="linenos">343</span></a><span class="sd">        and injects the corresponding &quot;levels&quot; entry into `conf_dict[&quot;nodes&quot;]`.</span>
</span><span id="TramDagConfig-344"><a href="#TramDagConfig-344"><span class="linenos">344</span></a>
</span><span id="TramDagConfig-345"><a href="#TramDagConfig-345"><span class="linenos">345</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig-346"><a href="#TramDagConfig-346"><span class="linenos">346</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig-347"><a href="#TramDagConfig-347"><span class="linenos">347</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="TramDagConfig-348"><a href="#TramDagConfig-348"><span class="linenos">348</span></a><span class="sd">            DataFrame used to infer levels for configured variables.</span>
</span><span id="TramDagConfig-349"><a href="#TramDagConfig-349"><span class="linenos">349</span></a><span class="sd">        write : bool, optional</span>
</span><span id="TramDagConfig-350"><a href="#TramDagConfig-350"><span class="linenos">350</span></a><span class="sd">            If True and `CONF_DICT_PATH` is set, the updated configuration is</span>
</span><span id="TramDagConfig-351"><a href="#TramDagConfig-351"><span class="linenos">351</span></a><span class="sd">            written back to disk. Default is True.</span>
</span><span id="TramDagConfig-352"><a href="#TramDagConfig-352"><span class="linenos">352</span></a>
</span><span id="TramDagConfig-353"><a href="#TramDagConfig-353"><span class="linenos">353</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig-354"><a href="#TramDagConfig-354"><span class="linenos">354</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig-355"><a href="#TramDagConfig-355"><span class="linenos">355</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig-356"><a href="#TramDagConfig-356"><span class="linenos">356</span></a>
</span><span id="TramDagConfig-357"><a href="#TramDagConfig-357"><span class="linenos">357</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig-358"><a href="#TramDagConfig-358"><span class="linenos">358</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig-359"><a href="#TramDagConfig-359"><span class="linenos">359</span></a><span class="sd">        Exception</span>
</span><span id="TramDagConfig-360"><a href="#TramDagConfig-360"><span class="linenos">360</span></a><span class="sd">            If saving the configuration fails when `write=True`.</span>
</span><span id="TramDagConfig-361"><a href="#TramDagConfig-361"><span class="linenos">361</span></a>
</span><span id="TramDagConfig-362"><a href="#TramDagConfig-362"><span class="linenos">362</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig-363"><a href="#TramDagConfig-363"><span class="linenos">363</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig-364"><a href="#TramDagConfig-364"><span class="linenos">364</span></a><span class="sd">        - Variables present in `levels_dict` but not in `conf_dict[&quot;nodes&quot;]`</span>
</span><span id="TramDagConfig-365"><a href="#TramDagConfig-365"><span class="linenos">365</span></a><span class="sd">        trigger a warning and are skipped.</span>
</span><span id="TramDagConfig-366"><a href="#TramDagConfig-366"><span class="linenos">366</span></a><span class="sd">        - If `self.verbose` or `self.debug` is True, a success message is printed</span>
</span><span id="TramDagConfig-367"><a href="#TramDagConfig-367"><span class="linenos">367</span></a><span class="sd">        when the configuration is saved.</span>
</span><span id="TramDagConfig-368"><a href="#TramDagConfig-368"><span class="linenos">368</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig-369"><a href="#TramDagConfig-369"><span class="linenos">369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="TramDagConfig-370"><a href="#TramDagConfig-370"><span class="linenos">370</span></a>        <span class="n">levels_dict</span> <span class="o">=</span> <span class="n">create_levels_dict</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">])</span>
</span><span id="TramDagConfig-371"><a href="#TramDagConfig-371"><span class="linenos">371</span></a>        
</span><span id="TramDagConfig-372"><a href="#TramDagConfig-372"><span class="linenos">372</span></a>        <span class="c1"># update nodes dict with levels</span>
</span><span id="TramDagConfig-373"><a href="#TramDagConfig-373"><span class="linenos">373</span></a>        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">levels</span> <span class="ow">in</span> <span class="n">levels_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagConfig-374"><a href="#TramDagConfig-374"><span class="linenos">374</span></a>            <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]:</span>
</span><span id="TramDagConfig-375"><a href="#TramDagConfig-375"><span class="linenos">375</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">var</span><span class="p">][</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">levels</span>
</span><span id="TramDagConfig-376"><a href="#TramDagConfig-376"><span class="linenos">376</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig-377"><a href="#TramDagConfig-377"><span class="linenos">377</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Variable &#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">&#39; not found in nodes dict. Cannot add levels.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-378"><a href="#TramDagConfig-378"><span class="linenos">378</span></a>        
</span><span id="TramDagConfig-379"><a href="#TramDagConfig-379"><span class="linenos">379</span></a>        <span class="k">if</span> <span class="n">write</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig-380"><a href="#TramDagConfig-380"><span class="linenos">380</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagConfig-381"><a href="#TramDagConfig-381"><span class="linenos">381</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig-382"><a href="#TramDagConfig-382"><span class="linenos">382</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagConfig-383"><a href="#TramDagConfig-383"><span class="linenos">383</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[INFO] Configuration with updated levels saved to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="TramDagConfig-384"><a href="#TramDagConfig-384"><span class="linenos">384</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagConfig-385"><a href="#TramDagConfig-385"><span class="linenos">385</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[ERROR] Failed to save configuration: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="TramDagConfig-386"><a href="#TramDagConfig-386"><span class="linenos">386</span></a>
</span><span id="TramDagConfig-387"><a href="#TramDagConfig-387"><span class="linenos">387</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_dag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span> <span class="n">causal_order</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagConfig-388"><a href="#TramDagConfig-388"><span class="linenos">388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig-389"><a href="#TramDagConfig-389"><span class="linenos">389</span></a><span class="sd">        Visualize the DAG defined by the configuration.</span>
</span><span id="TramDagConfig-390"><a href="#TramDagConfig-390"><span class="linenos">390</span></a>
</span><span id="TramDagConfig-391"><a href="#TramDagConfig-391"><span class="linenos">391</span></a><span class="sd">        Nodes are categorized and colored as:</span>
</span><span id="TramDagConfig-392"><a href="#TramDagConfig-392"><span class="linenos">392</span></a><span class="sd">        - Source nodes (no incoming edges): green.</span>
</span><span id="TramDagConfig-393"><a href="#TramDagConfig-393"><span class="linenos">393</span></a><span class="sd">        - Sink nodes (no outgoing edges): red.</span>
</span><span id="TramDagConfig-394"><a href="#TramDagConfig-394"><span class="linenos">394</span></a><span class="sd">        - Intermediate nodes: light blue.</span>
</span><span id="TramDagConfig-395"><a href="#TramDagConfig-395"><span class="linenos">395</span></a>
</span><span id="TramDagConfig-396"><a href="#TramDagConfig-396"><span class="linenos">396</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig-397"><a href="#TramDagConfig-397"><span class="linenos">397</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig-398"><a href="#TramDagConfig-398"><span class="linenos">398</span></a><span class="sd">        seed : int, optional</span>
</span><span id="TramDagConfig-399"><a href="#TramDagConfig-399"><span class="linenos">399</span></a><span class="sd">            Random seed for layout stability in the spring layout fallback.</span>
</span><span id="TramDagConfig-400"><a href="#TramDagConfig-400"><span class="linenos">400</span></a><span class="sd">            Default is 42.</span>
</span><span id="TramDagConfig-401"><a href="#TramDagConfig-401"><span class="linenos">401</span></a><span class="sd">        causal_order : bool, optional</span>
</span><span id="TramDagConfig-402"><a href="#TramDagConfig-402"><span class="linenos">402</span></a><span class="sd">            If True, attempt to use Graphviz &#39;dot&#39; layout via</span>
</span><span id="TramDagConfig-403"><a href="#TramDagConfig-403"><span class="linenos">403</span></a><span class="sd">            `networkx.nx_agraph.graphviz_layout` to preserve causal ordering.</span>
</span><span id="TramDagConfig-404"><a href="#TramDagConfig-404"><span class="linenos">404</span></a><span class="sd">            If False or if Graphviz is unavailable, use `spring_layout`.</span>
</span><span id="TramDagConfig-405"><a href="#TramDagConfig-405"><span class="linenos">405</span></a><span class="sd">            Default is False.</span>
</span><span id="TramDagConfig-406"><a href="#TramDagConfig-406"><span class="linenos">406</span></a>
</span><span id="TramDagConfig-407"><a href="#TramDagConfig-407"><span class="linenos">407</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig-408"><a href="#TramDagConfig-408"><span class="linenos">408</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig-409"><a href="#TramDagConfig-409"><span class="linenos">409</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig-410"><a href="#TramDagConfig-410"><span class="linenos">410</span></a>
</span><span id="TramDagConfig-411"><a href="#TramDagConfig-411"><span class="linenos">411</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig-412"><a href="#TramDagConfig-412"><span class="linenos">412</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig-413"><a href="#TramDagConfig-413"><span class="linenos">413</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagConfig-414"><a href="#TramDagConfig-414"><span class="linenos">414</span></a><span class="sd">            If `adj_matrix` or `data_type` is missing or inconsistent with each other,</span>
</span><span id="TramDagConfig-415"><a href="#TramDagConfig-415"><span class="linenos">415</span></a><span class="sd">            or if the adjacency matrix fails validation.</span>
</span><span id="TramDagConfig-416"><a href="#TramDagConfig-416"><span class="linenos">416</span></a>
</span><span id="TramDagConfig-417"><a href="#TramDagConfig-417"><span class="linenos">417</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig-418"><a href="#TramDagConfig-418"><span class="linenos">418</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig-419"><a href="#TramDagConfig-419"><span class="linenos">419</span></a><span class="sd">        Edge labels are colored by prefix:</span>
</span><span id="TramDagConfig-420"><a href="#TramDagConfig-420"><span class="linenos">420</span></a><span class="sd">        - &quot;ci&quot;: blue</span>
</span><span id="TramDagConfig-421"><a href="#TramDagConfig-421"><span class="linenos">421</span></a><span class="sd">        - &quot;ls&quot;: red</span>
</span><span id="TramDagConfig-422"><a href="#TramDagConfig-422"><span class="linenos">422</span></a><span class="sd">        - &quot;cs&quot;: green</span>
</span><span id="TramDagConfig-423"><a href="#TramDagConfig-423"><span class="linenos">423</span></a><span class="sd">        - other: black</span>
</span><span id="TramDagConfig-424"><a href="#TramDagConfig-424"><span class="linenos">424</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig-425"><a href="#TramDagConfig-425"><span class="linenos">425</span></a>        <span class="n">adj_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;adj_matrix&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-426"><a href="#TramDagConfig-426"><span class="linenos">426</span></a>        <span class="n">data_type</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_type&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-427"><a href="#TramDagConfig-427"><span class="linenos">427</span></a>
</span><span id="TramDagConfig-428"><a href="#TramDagConfig-428"><span class="linenos">428</span></a>        <span class="k">if</span> <span class="n">adj_matrix</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig-429"><a href="#TramDagConfig-429"><span class="linenos">429</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Configuration must include &#39;adj_matrix&#39; and &#39;data_type&#39;.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-430"><a href="#TramDagConfig-430"><span class="linenos">430</span></a>
</span><span id="TramDagConfig-431"><a href="#TramDagConfig-431"><span class="linenos">431</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="TramDagConfig-432"><a href="#TramDagConfig-432"><span class="linenos">432</span></a>            <span class="n">adj_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">)</span>
</span><span id="TramDagConfig-433"><a href="#TramDagConfig-433"><span class="linenos">433</span></a>
</span><span id="TramDagConfig-434"><a href="#TramDagConfig-434"><span class="linenos">434</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_adj_matrix</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">):</span>
</span><span id="TramDagConfig-435"><a href="#TramDagConfig-435"><span class="linenos">435</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid adjacency matrix.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-436"><a href="#TramDagConfig-436"><span class="linenos">436</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span> <span class="o">!=</span> <span class="n">adj_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="TramDagConfig-437"><a href="#TramDagConfig-437"><span class="linenos">437</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;data_type must match adjacency matrix size.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-438"><a href="#TramDagConfig-438"><span class="linenos">438</span></a>
</span><span id="TramDagConfig-439"><a href="#TramDagConfig-439"><span class="linenos">439</span></a>        <span class="n">node_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_type</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagConfig-440"><a href="#TramDagConfig-440"><span class="linenos">440</span></a>        <span class="n">G</span><span class="p">,</span> <span class="n">edge_labels</span> <span class="o">=</span> <span class="n">create_nx_graph</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">node_labels</span><span class="p">)</span>
</span><span id="TramDagConfig-441"><a href="#TramDagConfig-441"><span class="linenos">441</span></a>
</span><span id="TramDagConfig-442"><a href="#TramDagConfig-442"><span class="linenos">442</span></a>        <span class="n">sources</span>       <span class="o">=</span> <span class="p">{</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">in_degree</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="TramDagConfig-443"><a href="#TramDagConfig-443"><span class="linenos">443</span></a>        <span class="n">sinks</span>         <span class="o">=</span> <span class="p">{</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">out_degree</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="TramDagConfig-444"><a href="#TramDagConfig-444"><span class="linenos">444</span></a>        <span class="n">intermediates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">-</span> <span class="n">sources</span> <span class="o">-</span> <span class="n">sinks</span>
</span><span id="TramDagConfig-445"><a href="#TramDagConfig-445"><span class="linenos">445</span></a>
</span><span id="TramDagConfig-446"><a href="#TramDagConfig-446"><span class="linenos">446</span></a>        <span class="n">node_colors</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="TramDagConfig-447"><a href="#TramDagConfig-447"><span class="linenos">447</span></a>            <span class="s2">&quot;green&quot;</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">sources</span>
</span><span id="TramDagConfig-448"><a href="#TramDagConfig-448"><span class="linenos">448</span></a>            <span class="k">else</span> <span class="s2">&quot;red&quot;</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">sinks</span>
</span><span id="TramDagConfig-449"><a href="#TramDagConfig-449"><span class="linenos">449</span></a>            <span class="k">else</span> <span class="s2">&quot;lightblue&quot;</span>
</span><span id="TramDagConfig-450"><a href="#TramDagConfig-450"><span class="linenos">450</span></a>            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span>
</span><span id="TramDagConfig-451"><a href="#TramDagConfig-451"><span class="linenos">451</span></a>        <span class="p">]</span>
</span><span id="TramDagConfig-452"><a href="#TramDagConfig-452"><span class="linenos">452</span></a>
</span><span id="TramDagConfig-453"><a href="#TramDagConfig-453"><span class="linenos">453</span></a>        <span class="k">if</span> <span class="n">causal_order</span><span class="p">:</span>
</span><span id="TramDagConfig-454"><a href="#TramDagConfig-454"><span class="linenos">454</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagConfig-455"><a href="#TramDagConfig-455"><span class="linenos">455</span></a>                <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">nx_agraph</span><span class="o">.</span><span class="n">graphviz_layout</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="s2">&quot;dot&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-456"><a href="#TramDagConfig-456"><span class="linenos">456</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="n">nx</span><span class="o">.</span><span class="n">NetworkXException</span><span class="p">):</span>
</span><span id="TramDagConfig-457"><a href="#TramDagConfig-457"><span class="linenos">457</span></a>                <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span><span id="TramDagConfig-458"><a href="#TramDagConfig-458"><span class="linenos">458</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig-459"><a href="#TramDagConfig-459"><span class="linenos">459</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span><span id="TramDagConfig-460"><a href="#TramDagConfig-460"><span class="linenos">460</span></a>
</span><span id="TramDagConfig-461"><a href="#TramDagConfig-461"><span class="linenos">461</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="TramDagConfig-462"><a href="#TramDagConfig-462"><span class="linenos">462</span></a>        <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span>
</span><span id="TramDagConfig-463"><a href="#TramDagConfig-463"><span class="linenos">463</span></a>            <span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span>
</span><span id="TramDagConfig-464"><a href="#TramDagConfig-464"><span class="linenos">464</span></a>            <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TramDagConfig-465"><a href="#TramDagConfig-465"><span class="linenos">465</span></a>            <span class="n">node_color</span><span class="o">=</span><span class="n">node_colors</span><span class="p">,</span>
</span><span id="TramDagConfig-466"><a href="#TramDagConfig-466"><span class="linenos">466</span></a>            <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
</span><span id="TramDagConfig-467"><a href="#TramDagConfig-467"><span class="linenos">467</span></a>            <span class="n">node_size</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span>
</span><span id="TramDagConfig-468"><a href="#TramDagConfig-468"><span class="linenos">468</span></a>            <span class="n">arrowsize</span><span class="o">=</span><span class="mi">20</span>
</span><span id="TramDagConfig-469"><a href="#TramDagConfig-469"><span class="linenos">469</span></a>        <span class="p">)</span>
</span><span id="TramDagConfig-470"><a href="#TramDagConfig-470"><span class="linenos">470</span></a>
</span><span id="TramDagConfig-471"><a href="#TramDagConfig-471"><span class="linenos">471</span></a>        <span class="k">for</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">edge_labels</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagConfig-472"><a href="#TramDagConfig-472"><span class="linenos">472</span></a>            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="TramDagConfig-473"><a href="#TramDagConfig-473"><span class="linenos">473</span></a>                <span class="s2">&quot;blue&quot;</span>  <span class="k">if</span> <span class="n">lbl</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ci&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-474"><a href="#TramDagConfig-474"><span class="linenos">474</span></a>                <span class="k">else</span> <span class="s2">&quot;red&quot;</span>   <span class="k">if</span> <span class="n">lbl</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ls&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-475"><a href="#TramDagConfig-475"><span class="linenos">475</span></a>                <span class="k">else</span> <span class="s2">&quot;green&quot;</span> <span class="k">if</span> <span class="n">lbl</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;cs&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-476"><a href="#TramDagConfig-476"><span class="linenos">476</span></a>                <span class="k">else</span> <span class="s2">&quot;black&quot;</span>
</span><span id="TramDagConfig-477"><a href="#TramDagConfig-477"><span class="linenos">477</span></a>            <span class="p">)</span>
</span><span id="TramDagConfig-478"><a href="#TramDagConfig-478"><span class="linenos">478</span></a>            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edge_labels</span><span class="p">(</span>
</span><span id="TramDagConfig-479"><a href="#TramDagConfig-479"><span class="linenos">479</span></a>                <span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span>
</span><span id="TramDagConfig-480"><a href="#TramDagConfig-480"><span class="linenos">480</span></a>                <span class="n">edge_labels</span><span class="o">=</span><span class="p">{(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span> <span class="n">lbl</span><span class="p">},</span>
</span><span id="TramDagConfig-481"><a href="#TramDagConfig-481"><span class="linenos">481</span></a>                <span class="n">font_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="TramDagConfig-482"><a href="#TramDagConfig-482"><span class="linenos">482</span></a>                <span class="n">font_size</span><span class="o">=</span><span class="mi">12</span>
</span><span id="TramDagConfig-483"><a href="#TramDagConfig-483"><span class="linenos">483</span></a>            <span class="p">)</span>
</span><span id="TramDagConfig-484"><a href="#TramDagConfig-484"><span class="linenos">484</span></a>
</span><span id="TramDagConfig-485"><a href="#TramDagConfig-485"><span class="linenos">485</span></a>        <span class="n">legend_items</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="TramDagConfig-486"><a href="#TramDagConfig-486"><span class="linenos">486</span></a>            <span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>     <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Source&quot;</span><span class="p">),</span>
</span><span id="TramDagConfig-487"><a href="#TramDagConfig-487"><span class="linenos">487</span></a>            <span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>       <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sink&quot;</span><span class="p">),</span>
</span><span id="TramDagConfig-488"><a href="#TramDagConfig-488"><span class="linenos">488</span></a>            <span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightblue&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Intermediate&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-489"><a href="#TramDagConfig-489"><span class="linenos">489</span></a>        <span class="p">]</span>
</span><span id="TramDagConfig-490"><a href="#TramDagConfig-490"><span class="linenos">490</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend_items</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TramDagConfig-491"><a href="#TramDagConfig-491"><span class="linenos">491</span></a>
</span><span id="TramDagConfig-492"><a href="#TramDagConfig-492"><span class="linenos">492</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TRAM DAG&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-493"><a href="#TramDagConfig-493"><span class="linenos">493</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-494"><a href="#TramDagConfig-494"><span class="linenos">494</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="TramDagConfig-495"><a href="#TramDagConfig-495"><span class="linenos">495</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="TramDagConfig-496"><a href="#TramDagConfig-496"><span class="linenos">496</span></a>
</span><span id="TramDagConfig-497"><a href="#TramDagConfig-497"><span class="linenos">497</span></a>  
</span><span id="TramDagConfig-498"><a href="#TramDagConfig-498"><span class="linenos">498</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">EXPERIMENT_DIR</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">_verify</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagConfig-499"><a href="#TramDagConfig-499"><span class="linenos">499</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig-500"><a href="#TramDagConfig-500"><span class="linenos">500</span></a><span class="sd">        Create or reuse a configuration for an experiment.</span>
</span><span id="TramDagConfig-501"><a href="#TramDagConfig-501"><span class="linenos">501</span></a>
</span><span id="TramDagConfig-502"><a href="#TramDagConfig-502"><span class="linenos">502</span></a><span class="sd">        This method behaves differently depending on how it is called:</span>
</span><span id="TramDagConfig-503"><a href="#TramDagConfig-503"><span class="linenos">503</span></a>
</span><span id="TramDagConfig-504"><a href="#TramDagConfig-504"><span class="linenos">504</span></a><span class="sd">        1. Class call (e.g. `TramDagConfig.setup_configuration(...)`):</span>
</span><span id="TramDagConfig-505"><a href="#TramDagConfig-505"><span class="linenos">505</span></a><span class="sd">        - Creates or loads a configuration at the resolved path.</span>
</span><span id="TramDagConfig-506"><a href="#TramDagConfig-506"><span class="linenos">506</span></a><span class="sd">        - Returns a new `TramDagConfig` instance.</span>
</span><span id="TramDagConfig-507"><a href="#TramDagConfig-507"><span class="linenos">507</span></a>
</span><span id="TramDagConfig-508"><a href="#TramDagConfig-508"><span class="linenos">508</span></a><span class="sd">        2. Instance call (e.g. `cfg.setup_configuration(...)`):</span>
</span><span id="TramDagConfig-509"><a href="#TramDagConfig-509"><span class="linenos">509</span></a><span class="sd">        - Updates `self.conf_dict` and `self.CONF_DICT_PATH` in place.</span>
</span><span id="TramDagConfig-510"><a href="#TramDagConfig-510"><span class="linenos">510</span></a><span class="sd">        - Optionally verifies completeness.</span>
</span><span id="TramDagConfig-511"><a href="#TramDagConfig-511"><span class="linenos">511</span></a><span class="sd">        - Returns None.</span>
</span><span id="TramDagConfig-512"><a href="#TramDagConfig-512"><span class="linenos">512</span></a>
</span><span id="TramDagConfig-513"><a href="#TramDagConfig-513"><span class="linenos">513</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig-514"><a href="#TramDagConfig-514"><span class="linenos">514</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig-515"><a href="#TramDagConfig-515"><span class="linenos">515</span></a><span class="sd">        experiment_name : str or None, optional</span>
</span><span id="TramDagConfig-516"><a href="#TramDagConfig-516"><span class="linenos">516</span></a><span class="sd">            Name of the experiment. If None, defaults to &quot;experiment_1&quot;.</span>
</span><span id="TramDagConfig-517"><a href="#TramDagConfig-517"><span class="linenos">517</span></a><span class="sd">        EXPERIMENT_DIR : str or None, optional</span>
</span><span id="TramDagConfig-518"><a href="#TramDagConfig-518"><span class="linenos">518</span></a><span class="sd">            Directory for the experiment. If None, defaults to</span>
</span><span id="TramDagConfig-519"><a href="#TramDagConfig-519"><span class="linenos">519</span></a><span class="sd">            `&lt;cwd&gt;/&lt;experiment_name&gt;`.</span>
</span><span id="TramDagConfig-520"><a href="#TramDagConfig-520"><span class="linenos">520</span></a><span class="sd">        debug : bool, optional</span>
</span><span id="TramDagConfig-521"><a href="#TramDagConfig-521"><span class="linenos">521</span></a><span class="sd">            If True, initialize / update with `debug=True`. Default is False.</span>
</span><span id="TramDagConfig-522"><a href="#TramDagConfig-522"><span class="linenos">522</span></a><span class="sd">        _verify : bool, optional</span>
</span><span id="TramDagConfig-523"><a href="#TramDagConfig-523"><span class="linenos">523</span></a><span class="sd">            If True, call `_verify_completeness()` after loading. Default is False.</span>
</span><span id="TramDagConfig-524"><a href="#TramDagConfig-524"><span class="linenos">524</span></a>
</span><span id="TramDagConfig-525"><a href="#TramDagConfig-525"><span class="linenos">525</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig-526"><a href="#TramDagConfig-526"><span class="linenos">526</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig-527"><a href="#TramDagConfig-527"><span class="linenos">527</span></a><span class="sd">        TramDagConfig or None</span>
</span><span id="TramDagConfig-528"><a href="#TramDagConfig-528"><span class="linenos">528</span></a><span class="sd">            - A new instance when called on the class.</span>
</span><span id="TramDagConfig-529"><a href="#TramDagConfig-529"><span class="linenos">529</span></a><span class="sd">            - None when called on an existing instance.</span>
</span><span id="TramDagConfig-530"><a href="#TramDagConfig-530"><span class="linenos">530</span></a>
</span><span id="TramDagConfig-531"><a href="#TramDagConfig-531"><span class="linenos">531</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig-532"><a href="#TramDagConfig-532"><span class="linenos">532</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig-533"><a href="#TramDagConfig-533"><span class="linenos">533</span></a><span class="sd">        - A configuration file named &quot;configuration.json&quot; is created if it does</span>
</span><span id="TramDagConfig-534"><a href="#TramDagConfig-534"><span class="linenos">534</span></a><span class="sd">        not exist yet.</span>
</span><span id="TramDagConfig-535"><a href="#TramDagConfig-535"><span class="linenos">535</span></a><span class="sd">        - Underlying creation uses `create_and_write_new_configuration_dict`</span>
</span><span id="TramDagConfig-536"><a href="#TramDagConfig-536"><span class="linenos">536</span></a><span class="sd">        and `load_configuration_dict`.</span>
</span><span id="TramDagConfig-537"><a href="#TramDagConfig-537"><span class="linenos">537</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig-538"><a href="#TramDagConfig-538"><span class="linenos">538</span></a>        <span class="n">is_class_call</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</span><span id="TramDagConfig-539"><a href="#TramDagConfig-539"><span class="linenos">539</span></a>        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">is_class_call</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
</span><span id="TramDagConfig-540"><a href="#TramDagConfig-540"><span class="linenos">540</span></a>
</span><span id="TramDagConfig-541"><a href="#TramDagConfig-541"><span class="linenos">541</span></a>        <span class="k">if</span> <span class="n">experiment_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig-542"><a href="#TramDagConfig-542"><span class="linenos">542</span></a>            <span class="n">experiment_name</span> <span class="o">=</span> <span class="s2">&quot;experiment_1&quot;</span>
</span><span id="TramDagConfig-543"><a href="#TramDagConfig-543"><span class="linenos">543</span></a>        <span class="k">if</span> <span class="n">EXPERIMENT_DIR</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig-544"><a href="#TramDagConfig-544"><span class="linenos">544</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">experiment_name</span><span class="p">)</span>
</span><span id="TramDagConfig-545"><a href="#TramDagConfig-545"><span class="linenos">545</span></a>
</span><span id="TramDagConfig-546"><a href="#TramDagConfig-546"><span class="linenos">546</span></a>        <span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="s2">&quot;configuration.json&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-547"><a href="#TramDagConfig-547"><span class="linenos">547</span></a>        <span class="n">DATA_PATH</span> <span class="o">=</span> <span class="n">EXPERIMENT_DIR</span>
</span><span id="TramDagConfig-548"><a href="#TramDagConfig-548"><span class="linenos">548</span></a>
</span><span id="TramDagConfig-549"><a href="#TramDagConfig-549"><span class="linenos">549</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TramDagConfig-550"><a href="#TramDagConfig-550"><span class="linenos">550</span></a>
</span><span id="TramDagConfig-551"><a href="#TramDagConfig-551"><span class="linenos">551</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">CONF_DICT_PATH</span><span class="p">):</span>
</span><span id="TramDagConfig-552"><a href="#TramDagConfig-552"><span class="linenos">552</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration already exists: </span><span class="si">{</span><span class="n">CONF_DICT_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-553"><a href="#TramDagConfig-553"><span class="linenos">553</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig-554"><a href="#TramDagConfig-554"><span class="linenos">554</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">create_and_write_new_configuration_dict</span><span class="p">(</span>
</span><span id="TramDagConfig-555"><a href="#TramDagConfig-555"><span class="linenos">555</span></a>                <span class="n">experiment_name</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="p">,</span> <span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">DATA_PATH</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="TramDagConfig-556"><a href="#TramDagConfig-556"><span class="linenos">556</span></a>            <span class="p">)</span>
</span><span id="TramDagConfig-557"><a href="#TramDagConfig-557"><span class="linenos">557</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created new configuration file at </span><span class="si">{</span><span class="n">CONF_DICT_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-558"><a href="#TramDagConfig-558"><span class="linenos">558</span></a>
</span><span id="TramDagConfig-559"><a href="#TramDagConfig-559"><span class="linenos">559</span></a>        <span class="n">conf</span> <span class="o">=</span> <span class="n">load_configuration_dict</span><span class="p">(</span><span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig-560"><a href="#TramDagConfig-560"><span class="linenos">560</span></a>
</span><span id="TramDagConfig-561"><a href="#TramDagConfig-561"><span class="linenos">561</span></a>        <span class="k">if</span> <span class="n">is_class_call</span><span class="p">:</span>
</span><span id="TramDagConfig-562"><a href="#TramDagConfig-562"><span class="linenos">562</span></a>            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="o">=</span><span class="n">CONF_DICT_PATH</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="n">_verify</span><span class="o">=</span><span class="n">_verify</span><span class="p">)</span>
</span><span id="TramDagConfig-563"><a href="#TramDagConfig-563"><span class="linenos">563</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig-564"><a href="#TramDagConfig-564"><span class="linenos">564</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span> <span class="o">=</span> <span class="n">conf</span>
</span><span id="TramDagConfig-565"><a href="#TramDagConfig-565"><span class="linenos">565</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="n">CONF_DICT_PATH</span>
</span><span id="TramDagConfig-566"><a href="#TramDagConfig-566"><span class="linenos">566</span></a>            <span class="k">if</span> <span class="n">_verify</span><span class="p">:</span>
</span><span id="TramDagConfig-567"><a href="#TramDagConfig-567"><span class="linenos">567</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_verify_completeness</span><span class="p">()</span>
</span><span id="TramDagConfig-568"><a href="#TramDagConfig-568"><span class="linenos">568</span></a>                
</span><span id="TramDagConfig-569"><a href="#TramDagConfig-569"><span class="linenos">569</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_data_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig-570"><a href="#TramDagConfig-570"><span class="linenos">570</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig-571"><a href="#TramDagConfig-571"><span class="linenos">571</span></a><span class="sd">        Update or write the `data_type` section of a configuration file.</span>
</span><span id="TramDagConfig-572"><a href="#TramDagConfig-572"><span class="linenos">572</span></a>
</span><span id="TramDagConfig-573"><a href="#TramDagConfig-573"><span class="linenos">573</span></a><span class="sd">        Supports both class-level and instance-level usage:</span>
</span><span id="TramDagConfig-574"><a href="#TramDagConfig-574"><span class="linenos">574</span></a>
</span><span id="TramDagConfig-575"><a href="#TramDagConfig-575"><span class="linenos">575</span></a><span class="sd">        - Class call:</span>
</span><span id="TramDagConfig-576"><a href="#TramDagConfig-576"><span class="linenos">576</span></a><span class="sd">        - Requires `CONF_DICT_PATH` argument.</span>
</span><span id="TramDagConfig-577"><a href="#TramDagConfig-577"><span class="linenos">577</span></a><span class="sd">        - Reads the file if it exists, or starts from an empty dict.</span>
</span><span id="TramDagConfig-578"><a href="#TramDagConfig-578"><span class="linenos">578</span></a><span class="sd">        - Writes updated configuration to `CONF_DICT_PATH`.</span>
</span><span id="TramDagConfig-579"><a href="#TramDagConfig-579"><span class="linenos">579</span></a>
</span><span id="TramDagConfig-580"><a href="#TramDagConfig-580"><span class="linenos">580</span></a><span class="sd">        - Instance call:</span>
</span><span id="TramDagConfig-581"><a href="#TramDagConfig-581"><span class="linenos">581</span></a><span class="sd">        - Uses `self.CONF_DICT_PATH` if available, otherwise defaults to</span>
</span><span id="TramDagConfig-582"><a href="#TramDagConfig-582"><span class="linenos">582</span></a><span class="sd">            `&lt;cwd&gt;/configuration.json` if no path is provided.</span>
</span><span id="TramDagConfig-583"><a href="#TramDagConfig-583"><span class="linenos">583</span></a><span class="sd">        - Updates `self.conf_dict` and `self.CONF_DICT_PATH` after writing.</span>
</span><span id="TramDagConfig-584"><a href="#TramDagConfig-584"><span class="linenos">584</span></a>
</span><span id="TramDagConfig-585"><a href="#TramDagConfig-585"><span class="linenos">585</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig-586"><a href="#TramDagConfig-586"><span class="linenos">586</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig-587"><a href="#TramDagConfig-587"><span class="linenos">587</span></a><span class="sd">        data_type : dict</span>
</span><span id="TramDagConfig-588"><a href="#TramDagConfig-588"><span class="linenos">588</span></a><span class="sd">            Mapping `{variable_name: type_spec}`, where `type_spec` encodes</span>
</span><span id="TramDagConfig-589"><a href="#TramDagConfig-589"><span class="linenos">589</span></a><span class="sd">            modeling types (e.g. continuous, ordinal, etc.).</span>
</span><span id="TramDagConfig-590"><a href="#TramDagConfig-590"><span class="linenos">590</span></a><span class="sd">        CONF_DICT_PATH : str or None, optional</span>
</span><span id="TramDagConfig-591"><a href="#TramDagConfig-591"><span class="linenos">591</span></a><span class="sd">            Path to the configuration file. Must be provided for class calls.</span>
</span><span id="TramDagConfig-592"><a href="#TramDagConfig-592"><span class="linenos">592</span></a><span class="sd">            For instance calls, defaults as described above.</span>
</span><span id="TramDagConfig-593"><a href="#TramDagConfig-593"><span class="linenos">593</span></a>
</span><span id="TramDagConfig-594"><a href="#TramDagConfig-594"><span class="linenos">594</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig-595"><a href="#TramDagConfig-595"><span class="linenos">595</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig-596"><a href="#TramDagConfig-596"><span class="linenos">596</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig-597"><a href="#TramDagConfig-597"><span class="linenos">597</span></a>
</span><span id="TramDagConfig-598"><a href="#TramDagConfig-598"><span class="linenos">598</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig-599"><a href="#TramDagConfig-599"><span class="linenos">599</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig-600"><a href="#TramDagConfig-600"><span class="linenos">600</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagConfig-601"><a href="#TramDagConfig-601"><span class="linenos">601</span></a><span class="sd">            If `CONF_DICT_PATH` is missing when called on the class, or if</span>
</span><span id="TramDagConfig-602"><a href="#TramDagConfig-602"><span class="linenos">602</span></a><span class="sd">            validation of data types fails.</span>
</span><span id="TramDagConfig-603"><a href="#TramDagConfig-603"><span class="linenos">603</span></a>
</span><span id="TramDagConfig-604"><a href="#TramDagConfig-604"><span class="linenos">604</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig-605"><a href="#TramDagConfig-605"><span class="linenos">605</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig-606"><a href="#TramDagConfig-606"><span class="linenos">606</span></a><span class="sd">        - Variable names are validated via `validate_variable_names`.</span>
</span><span id="TramDagConfig-607"><a href="#TramDagConfig-607"><span class="linenos">607</span></a><span class="sd">        - Data type values are validated via `validate_data_types`.</span>
</span><span id="TramDagConfig-608"><a href="#TramDagConfig-608"><span class="linenos">608</span></a><span class="sd">        - A textual summary of modeling settings is printed via</span>
</span><span id="TramDagConfig-609"><a href="#TramDagConfig-609"><span class="linenos">609</span></a><span class="sd">        `print_data_type_modeling_setting`, if possible.</span>
</span><span id="TramDagConfig-610"><a href="#TramDagConfig-610"><span class="linenos">610</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig-611"><a href="#TramDagConfig-611"><span class="linenos">611</span></a>        <span class="n">is_class_call</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</span><span id="TramDagConfig-612"><a href="#TramDagConfig-612"><span class="linenos">612</span></a>        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">is_class_call</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
</span><span id="TramDagConfig-613"><a href="#TramDagConfig-613"><span class="linenos">613</span></a>
</span><span id="TramDagConfig-614"><a href="#TramDagConfig-614"><span class="linenos">614</span></a>        <span class="c1"># resolve path</span>
</span><span id="TramDagConfig-615"><a href="#TramDagConfig-615"><span class="linenos">615</span></a>        <span class="k">if</span> <span class="n">CONF_DICT_PATH</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig-616"><a href="#TramDagConfig-616"><span class="linenos">616</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_class_call</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;CONF_DICT_PATH&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagConfig-617"><a href="#TramDagConfig-617"><span class="linenos">617</span></a>                <span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span>
</span><span id="TramDagConfig-618"><a href="#TramDagConfig-618"><span class="linenos">618</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_class_call</span><span class="p">:</span>
</span><span id="TramDagConfig-619"><a href="#TramDagConfig-619"><span class="linenos">619</span></a>                <span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;configuration.json&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-620"><a href="#TramDagConfig-620"><span class="linenos">620</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig-621"><a href="#TramDagConfig-621"><span class="linenos">621</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CONF_DICT_PATH must be provided when called on the class.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-622"><a href="#TramDagConfig-622"><span class="linenos">622</span></a>
</span><span id="TramDagConfig-623"><a href="#TramDagConfig-623"><span class="linenos">623</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagConfig-624"><a href="#TramDagConfig-624"><span class="linenos">624</span></a>            <span class="c1"># load existing or create empty configuration</span>
</span><span id="TramDagConfig-625"><a href="#TramDagConfig-625"><span class="linenos">625</span></a>            <span class="n">configuration_dict</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="TramDagConfig-626"><a href="#TramDagConfig-626"><span class="linenos">626</span></a>                <span class="n">load_configuration_dict</span><span class="p">(</span><span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig-627"><a href="#TramDagConfig-627"><span class="linenos">627</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig-628"><a href="#TramDagConfig-628"><span class="linenos">628</span></a>                <span class="k">else</span> <span class="p">{}</span>
</span><span id="TramDagConfig-629"><a href="#TramDagConfig-629"><span class="linenos">629</span></a>            <span class="p">)</span>
</span><span id="TramDagConfig-630"><a href="#TramDagConfig-630"><span class="linenos">630</span></a>
</span><span id="TramDagConfig-631"><a href="#TramDagConfig-631"><span class="linenos">631</span></a>            <span class="n">validate_variable_names</span><span class="p">(</span><span class="n">data_type</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagConfig-632"><a href="#TramDagConfig-632"><span class="linenos">632</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_data_types</span><span class="p">(</span><span class="n">data_type</span><span class="p">):</span>
</span><span id="TramDagConfig-633"><a href="#TramDagConfig-633"><span class="linenos">633</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid data types in the provided dictionary.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-634"><a href="#TramDagConfig-634"><span class="linenos">634</span></a>
</span><span id="TramDagConfig-635"><a href="#TramDagConfig-635"><span class="linenos">635</span></a>            <span class="n">configuration_dict</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_type</span>
</span><span id="TramDagConfig-636"><a href="#TramDagConfig-636"><span class="linenos">636</span></a>            <span class="n">write_configuration_dict</span><span class="p">(</span><span class="n">configuration_dict</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig-637"><a href="#TramDagConfig-637"><span class="linenos">637</span></a>
</span><span id="TramDagConfig-638"><a href="#TramDagConfig-638"><span class="linenos">638</span></a>            <span class="c1"># safe printing</span>
</span><span id="TramDagConfig-639"><a href="#TramDagConfig-639"><span class="linenos">639</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagConfig-640"><a href="#TramDagConfig-640"><span class="linenos">640</span></a>                <span class="n">print_data_type_modeling_setting</span><span class="p">(</span><span class="n">data_type</span> <span class="ow">or</span> <span class="p">{})</span>
</span><span id="TramDagConfig-641"><a href="#TramDagConfig-641"><span class="linenos">641</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagConfig-642"><a href="#TramDagConfig-642"><span class="linenos">642</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Could not print data type modeling settings: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-643"><a href="#TramDagConfig-643"><span class="linenos">643</span></a>
</span><span id="TramDagConfig-644"><a href="#TramDagConfig-644"><span class="linenos">644</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_class_call</span><span class="p">:</span>
</span><span id="TramDagConfig-645"><a href="#TramDagConfig-645"><span class="linenos">645</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span> <span class="o">=</span> <span class="n">configuration_dict</span>
</span><span id="TramDagConfig-646"><a href="#TramDagConfig-646"><span class="linenos">646</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="n">CONF_DICT_PATH</span>
</span><span id="TramDagConfig-647"><a href="#TramDagConfig-647"><span class="linenos">647</span></a>
</span><span id="TramDagConfig-648"><a href="#TramDagConfig-648"><span class="linenos">648</span></a>
</span><span id="TramDagConfig-649"><a href="#TramDagConfig-649"><span class="linenos">649</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagConfig-650"><a href="#TramDagConfig-650"><span class="linenos">650</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update configuration: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-651"><a href="#TramDagConfig-651"><span class="linenos">651</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig-652"><a href="#TramDagConfig-652"><span class="linenos">652</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration updated successfully at </span><span class="si">{</span><span class="n">CONF_DICT_PATH</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-653"><a href="#TramDagConfig-653"><span class="linenos">653</span></a>            
</span><span id="TramDagConfig-654"><a href="#TramDagConfig-654"><span class="linenos">654</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_meta_adj_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
</span><span id="TramDagConfig-655"><a href="#TramDagConfig-655"><span class="linenos">655</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig-656"><a href="#TramDagConfig-656"><span class="linenos">656</span></a><span class="sd">        Launch the interactive editor to set or modify the adjacency matrix.</span>
</span><span id="TramDagConfig-657"><a href="#TramDagConfig-657"><span class="linenos">657</span></a>
</span><span id="TramDagConfig-658"><a href="#TramDagConfig-658"><span class="linenos">658</span></a><span class="sd">        This method:</span>
</span><span id="TramDagConfig-659"><a href="#TramDagConfig-659"><span class="linenos">659</span></a>
</span><span id="TramDagConfig-660"><a href="#TramDagConfig-660"><span class="linenos">660</span></a><span class="sd">        1. Resolves the configuration path either from the argument or, for</span>
</span><span id="TramDagConfig-661"><a href="#TramDagConfig-661"><span class="linenos">661</span></a><span class="sd">        instances, from `self.CONF_DICT_PATH`.</span>
</span><span id="TramDagConfig-662"><a href="#TramDagConfig-662"><span class="linenos">662</span></a><span class="sd">        2. Invokes `interactive_adj_matrix` to edit the adjacency matrix.</span>
</span><span id="TramDagConfig-663"><a href="#TramDagConfig-663"><span class="linenos">663</span></a><span class="sd">        3. For instances, reloads the updated configuration into `self.conf_dict`.</span>
</span><span id="TramDagConfig-664"><a href="#TramDagConfig-664"><span class="linenos">664</span></a>
</span><span id="TramDagConfig-665"><a href="#TramDagConfig-665"><span class="linenos">665</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig-666"><a href="#TramDagConfig-666"><span class="linenos">666</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig-667"><a href="#TramDagConfig-667"><span class="linenos">667</span></a><span class="sd">        CONF_DICT_PATH : str or None, optional</span>
</span><span id="TramDagConfig-668"><a href="#TramDagConfig-668"><span class="linenos">668</span></a><span class="sd">            Path to the configuration file. Must be provided when called</span>
</span><span id="TramDagConfig-669"><a href="#TramDagConfig-669"><span class="linenos">669</span></a><span class="sd">            on the class. For instance calls, defaults to `self.CONF_DICT_PATH`.</span>
</span><span id="TramDagConfig-670"><a href="#TramDagConfig-670"><span class="linenos">670</span></a><span class="sd">        seed : int, optional</span>
</span><span id="TramDagConfig-671"><a href="#TramDagConfig-671"><span class="linenos">671</span></a><span class="sd">            Random seed for any layout or stochastic behavior in the interactive</span>
</span><span id="TramDagConfig-672"><a href="#TramDagConfig-672"><span class="linenos">672</span></a><span class="sd">            editor. Default is 5.</span>
</span><span id="TramDagConfig-673"><a href="#TramDagConfig-673"><span class="linenos">673</span></a>
</span><span id="TramDagConfig-674"><a href="#TramDagConfig-674"><span class="linenos">674</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig-675"><a href="#TramDagConfig-675"><span class="linenos">675</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig-676"><a href="#TramDagConfig-676"><span class="linenos">676</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig-677"><a href="#TramDagConfig-677"><span class="linenos">677</span></a>
</span><span id="TramDagConfig-678"><a href="#TramDagConfig-678"><span class="linenos">678</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig-679"><a href="#TramDagConfig-679"><span class="linenos">679</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig-680"><a href="#TramDagConfig-680"><span class="linenos">680</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagConfig-681"><a href="#TramDagConfig-681"><span class="linenos">681</span></a><span class="sd">            If `CONF_DICT_PATH` is not provided and cannot be inferred</span>
</span><span id="TramDagConfig-682"><a href="#TramDagConfig-682"><span class="linenos">682</span></a><span class="sd">            (e.g. in a class call without path).</span>
</span><span id="TramDagConfig-683"><a href="#TramDagConfig-683"><span class="linenos">683</span></a>
</span><span id="TramDagConfig-684"><a href="#TramDagConfig-684"><span class="linenos">684</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig-685"><a href="#TramDagConfig-685"><span class="linenos">685</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig-686"><a href="#TramDagConfig-686"><span class="linenos">686</span></a><span class="sd">        `self.update()` is called at the start to ensure the in-memory config</span>
</span><span id="TramDagConfig-687"><a href="#TramDagConfig-687"><span class="linenos">687</span></a><span class="sd">        is in sync with the file before launching the editor.</span>
</span><span id="TramDagConfig-688"><a href="#TramDagConfig-688"><span class="linenos">688</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig-689"><a href="#TramDagConfig-689"><span class="linenos">689</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="TramDagConfig-690"><a href="#TramDagConfig-690"><span class="linenos">690</span></a>        <span class="n">is_class_call</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</span><span id="TramDagConfig-691"><a href="#TramDagConfig-691"><span class="linenos">691</span></a>
</span><span id="TramDagConfig-692"><a href="#TramDagConfig-692"><span class="linenos">692</span></a>        <span class="c1"># resolve path</span>
</span><span id="TramDagConfig-693"><a href="#TramDagConfig-693"><span class="linenos">693</span></a>        <span class="k">if</span> <span class="n">CONF_DICT_PATH</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig-694"><a href="#TramDagConfig-694"><span class="linenos">694</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_class_call</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;CONF_DICT_PATH&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagConfig-695"><a href="#TramDagConfig-695"><span class="linenos">695</span></a>                <span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span>
</span><span id="TramDagConfig-696"><a href="#TramDagConfig-696"><span class="linenos">696</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig-697"><a href="#TramDagConfig-697"><span class="linenos">697</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CONF_DICT_PATH must be provided when called on the class.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-698"><a href="#TramDagConfig-698"><span class="linenos">698</span></a>
</span><span id="TramDagConfig-699"><a href="#TramDagConfig-699"><span class="linenos">699</span></a>        <span class="c1"># launch interactive editor</span>
</span><span id="TramDagConfig-700"><a href="#TramDagConfig-700"><span class="linenos">700</span></a>        <span class="n">interactive_adj_matrix</span><span class="p">(</span><span class="n">CONF_DICT_PATH</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
</span><span id="TramDagConfig-701"><a href="#TramDagConfig-701"><span class="linenos">701</span></a>
</span><span id="TramDagConfig-702"><a href="#TramDagConfig-702"><span class="linenos">702</span></a>        <span class="c1"># reload config if instance</span>
</span><span id="TramDagConfig-703"><a href="#TramDagConfig-703"><span class="linenos">703</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_class_call</span><span class="p">:</span>
</span><span id="TramDagConfig-704"><a href="#TramDagConfig-704"><span class="linenos">704</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span> <span class="o">=</span> <span class="n">load_configuration_dict</span><span class="p">(</span><span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig-705"><a href="#TramDagConfig-705"><span class="linenos">705</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="n">CONF_DICT_PATH</span>
</span><span id="TramDagConfig-706"><a href="#TramDagConfig-706"><span class="linenos">706</span></a>
</span><span id="TramDagConfig-707"><a href="#TramDagConfig-707"><span class="linenos">707</span></a>
</span><span id="TramDagConfig-708"><a href="#TramDagConfig-708"><span class="linenos">708</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_tramdag_nn_models</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagConfig-709"><a href="#TramDagConfig-709"><span class="linenos">709</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig-710"><a href="#TramDagConfig-710"><span class="linenos">710</span></a><span class="sd">        Launch the interactive editor to set TRAM-DAG neural network model names.</span>
</span><span id="TramDagConfig-711"><a href="#TramDagConfig-711"><span class="linenos">711</span></a>
</span><span id="TramDagConfig-712"><a href="#TramDagConfig-712"><span class="linenos">712</span></a><span class="sd">        Depending on call context:</span>
</span><span id="TramDagConfig-713"><a href="#TramDagConfig-713"><span class="linenos">713</span></a>
</span><span id="TramDagConfig-714"><a href="#TramDagConfig-714"><span class="linenos">714</span></a><span class="sd">        - Class call:</span>
</span><span id="TramDagConfig-715"><a href="#TramDagConfig-715"><span class="linenos">715</span></a><span class="sd">        - Requires `CONF_DICT_PATH` argument.</span>
</span><span id="TramDagConfig-716"><a href="#TramDagConfig-716"><span class="linenos">716</span></a><span class="sd">        - Returns nothing and does not modify a specific instance.</span>
</span><span id="TramDagConfig-717"><a href="#TramDagConfig-717"><span class="linenos">717</span></a>
</span><span id="TramDagConfig-718"><a href="#TramDagConfig-718"><span class="linenos">718</span></a><span class="sd">        - Instance call:</span>
</span><span id="TramDagConfig-719"><a href="#TramDagConfig-719"><span class="linenos">719</span></a><span class="sd">        - Resolves `CONF_DICT_PATH` from the argument or `self.CONF_DICT_PATH`.</span>
</span><span id="TramDagConfig-720"><a href="#TramDagConfig-720"><span class="linenos">720</span></a><span class="sd">        - Updates `self.conf_dict` and `self.CONF_DICT_PATH` if the editor</span>
</span><span id="TramDagConfig-721"><a href="#TramDagConfig-721"><span class="linenos">721</span></a><span class="sd">            returns an updated configuration.</span>
</span><span id="TramDagConfig-722"><a href="#TramDagConfig-722"><span class="linenos">722</span></a>
</span><span id="TramDagConfig-723"><a href="#TramDagConfig-723"><span class="linenos">723</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig-724"><a href="#TramDagConfig-724"><span class="linenos">724</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig-725"><a href="#TramDagConfig-725"><span class="linenos">725</span></a><span class="sd">        CONF_DICT_PATH : str or None, optional</span>
</span><span id="TramDagConfig-726"><a href="#TramDagConfig-726"><span class="linenos">726</span></a><span class="sd">            Path to the configuration file. Must be provided when called on</span>
</span><span id="TramDagConfig-727"><a href="#TramDagConfig-727"><span class="linenos">727</span></a><span class="sd">            the class. For instance calls, defaults to `self.CONF_DICT_PATH`.</span>
</span><span id="TramDagConfig-728"><a href="#TramDagConfig-728"><span class="linenos">728</span></a>
</span><span id="TramDagConfig-729"><a href="#TramDagConfig-729"><span class="linenos">729</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig-730"><a href="#TramDagConfig-730"><span class="linenos">730</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig-731"><a href="#TramDagConfig-731"><span class="linenos">731</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig-732"><a href="#TramDagConfig-732"><span class="linenos">732</span></a>
</span><span id="TramDagConfig-733"><a href="#TramDagConfig-733"><span class="linenos">733</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig-734"><a href="#TramDagConfig-734"><span class="linenos">734</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig-735"><a href="#TramDagConfig-735"><span class="linenos">735</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagConfig-736"><a href="#TramDagConfig-736"><span class="linenos">736</span></a><span class="sd">            If `CONF_DICT_PATH` is not provided and cannot be inferred</span>
</span><span id="TramDagConfig-737"><a href="#TramDagConfig-737"><span class="linenos">737</span></a><span class="sd">            (e.g. in a class call without path).</span>
</span><span id="TramDagConfig-738"><a href="#TramDagConfig-738"><span class="linenos">738</span></a>
</span><span id="TramDagConfig-739"><a href="#TramDagConfig-739"><span class="linenos">739</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig-740"><a href="#TramDagConfig-740"><span class="linenos">740</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig-741"><a href="#TramDagConfig-741"><span class="linenos">741</span></a><span class="sd">        The interactive editor is invoked via `interactive_nn_names_matrix`.</span>
</span><span id="TramDagConfig-742"><a href="#TramDagConfig-742"><span class="linenos">742</span></a><span class="sd">        If it returns `None`, the instance configuration is left unchanged.</span>
</span><span id="TramDagConfig-743"><a href="#TramDagConfig-743"><span class="linenos">743</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig-744"><a href="#TramDagConfig-744"><span class="linenos">744</span></a>        <span class="n">is_class_call</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</span><span id="TramDagConfig-745"><a href="#TramDagConfig-745"><span class="linenos">745</span></a>        <span class="k">if</span> <span class="n">CONF_DICT_PATH</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig-746"><a href="#TramDagConfig-746"><span class="linenos">746</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_class_call</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;CONF_DICT_PATH&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagConfig-747"><a href="#TramDagConfig-747"><span class="linenos">747</span></a>                <span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span>
</span><span id="TramDagConfig-748"><a href="#TramDagConfig-748"><span class="linenos">748</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig-749"><a href="#TramDagConfig-749"><span class="linenos">749</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CONF_DICT_PATH must be provided when called on the class.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig-750"><a href="#TramDagConfig-750"><span class="linenos">750</span></a>
</span><span id="TramDagConfig-751"><a href="#TramDagConfig-751"><span class="linenos">751</span></a>        <span class="n">updated_conf</span> <span class="o">=</span> <span class="n">interactive_nn_names_matrix</span><span class="p">(</span><span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig-752"><a href="#TramDagConfig-752"><span class="linenos">752</span></a>        <span class="k">if</span> <span class="n">updated_conf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_class_call</span><span class="p">:</span>
</span><span id="TramDagConfig-753"><a href="#TramDagConfig-753"><span class="linenos">753</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span> <span class="o">=</span> <span class="n">updated_conf</span>
</span><span id="TramDagConfig-754"><a href="#TramDagConfig-754"><span class="linenos">754</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="n">CONF_DICT_PATH</span>
</span></pre></div>


            <div class="docstring"><p>Configuration manager for TRAM-DAG experiments.</p>

<p>This class encapsulates:</p>

<ul>
<li>The experiment configuration dictionary (<code><a href="#TramDagConfig.conf_dict">conf_dict</a></code>).</li>
<li>Its backing file path (<code><a href="#TramDagConfig.CONF_DICT_PATH">CONF_DICT_PATH</a></code>).</li>
<li>Utilities to load, validate, modify, and persist configuration.</li>
<li>DAG visualization and interactive editing helpers.</li>
</ul>

<h2 id="typical-usage">Typical usage</h2>

<ul>
<li>Load existing configuration from disk via <code><a href="#TramDagConfig.load_json">TramDagConfig.load_json</a></code>.</li>
<li>Or create/reuse experiment setup via <code>TramDagConfig().setup_configuration</code>.</li>
<li>Update sections such as <code>data_type</code>, adjacency matrix, and neural network
model names using the provided methods.</li>
</ul>
</div>


                            <div id="TramDagConfig.__init__" class="classattr">
                                        <input id="TramDagConfig.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TramDagConfig</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">conf_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">_verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="TramDagConfig.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagConfig.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagConfig.__init__-49"><a href="#TramDagConfig.__init__-49"><span class="linenos">49</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="n">_verify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TramDagConfig.__init__-50"><a href="#TramDagConfig.__init__-50"><span class="linenos">50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig.__init__-51"><a href="#TramDagConfig.__init__-51"><span class="linenos">51</span></a><span class="sd">        Initialize a TramDagConfig instance.</span>
</span><span id="TramDagConfig.__init__-52"><a href="#TramDagConfig.__init__-52"><span class="linenos">52</span></a>
</span><span id="TramDagConfig.__init__-53"><a href="#TramDagConfig.__init__-53"><span class="linenos">53</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig.__init__-54"><a href="#TramDagConfig.__init__-54"><span class="linenos">54</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig.__init__-55"><a href="#TramDagConfig.__init__-55"><span class="linenos">55</span></a><span class="sd">        conf_dict : dict or None, optional</span>
</span><span id="TramDagConfig.__init__-56"><a href="#TramDagConfig.__init__-56"><span class="linenos">56</span></a><span class="sd">            Configuration dictionary. If None, an empty dict is used and can</span>
</span><span id="TramDagConfig.__init__-57"><a href="#TramDagConfig.__init__-57"><span class="linenos">57</span></a><span class="sd">            be populated later. Default is None.</span>
</span><span id="TramDagConfig.__init__-58"><a href="#TramDagConfig.__init__-58"><span class="linenos">58</span></a><span class="sd">        CONF_DICT_PATH : str or None, optional</span>
</span><span id="TramDagConfig.__init__-59"><a href="#TramDagConfig.__init__-59"><span class="linenos">59</span></a><span class="sd">            Path to the configuration file on disk. Default is None.</span>
</span><span id="TramDagConfig.__init__-60"><a href="#TramDagConfig.__init__-60"><span class="linenos">60</span></a><span class="sd">        _verify : bool, optional</span>
</span><span id="TramDagConfig.__init__-61"><a href="#TramDagConfig.__init__-61"><span class="linenos">61</span></a><span class="sd">            If True, run `_verify_completeness()` after initialization.</span>
</span><span id="TramDagConfig.__init__-62"><a href="#TramDagConfig.__init__-62"><span class="linenos">62</span></a><span class="sd">            Default is False.</span>
</span><span id="TramDagConfig.__init__-63"><a href="#TramDagConfig.__init__-63"><span class="linenos">63</span></a><span class="sd">        **kwargs</span>
</span><span id="TramDagConfig.__init__-64"><a href="#TramDagConfig.__init__-64"><span class="linenos">64</span></a><span class="sd">            Additional attributes to be set on the instance. Keys &quot;conf_dict&quot;</span>
</span><span id="TramDagConfig.__init__-65"><a href="#TramDagConfig.__init__-65"><span class="linenos">65</span></a><span class="sd">            and &quot;CONF_DICT_PATH&quot; are forbidden and raise a ValueError.</span>
</span><span id="TramDagConfig.__init__-66"><a href="#TramDagConfig.__init__-66"><span class="linenos">66</span></a>
</span><span id="TramDagConfig.__init__-67"><a href="#TramDagConfig.__init__-67"><span class="linenos">67</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig.__init__-68"><a href="#TramDagConfig.__init__-68"><span class="linenos">68</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig.__init__-69"><a href="#TramDagConfig.__init__-69"><span class="linenos">69</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagConfig.__init__-70"><a href="#TramDagConfig.__init__-70"><span class="linenos">70</span></a><span class="sd">            If any key in `kwargs` is &quot;conf_dict&quot; or &quot;CONF_DICT_PATH&quot;.</span>
</span><span id="TramDagConfig.__init__-71"><a href="#TramDagConfig.__init__-71"><span class="linenos">71</span></a>
</span><span id="TramDagConfig.__init__-72"><a href="#TramDagConfig.__init__-72"><span class="linenos">72</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig.__init__-73"><a href="#TramDagConfig.__init__-73"><span class="linenos">73</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig.__init__-74"><a href="#TramDagConfig.__init__-74"><span class="linenos">74</span></a><span class="sd">        By default, `debug` and `verbose` are set to False. They can be</span>
</span><span id="TramDagConfig.__init__-75"><a href="#TramDagConfig.__init__-75"><span class="linenos">75</span></a><span class="sd">        overridden via `kwargs`.</span>
</span><span id="TramDagConfig.__init__-76"><a href="#TramDagConfig.__init__-76"><span class="linenos">76</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig.__init__-77"><a href="#TramDagConfig.__init__-77"><span class="linenos">77</span></a>
</span><span id="TramDagConfig.__init__-78"><a href="#TramDagConfig.__init__-78"><span class="linenos">78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="TramDagConfig.__init__-79"><a href="#TramDagConfig.__init__-79"><span class="linenos">79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="TramDagConfig.__init__-80"><a href="#TramDagConfig.__init__-80"><span class="linenos">80</span></a>        
</span><span id="TramDagConfig.__init__-81"><a href="#TramDagConfig.__init__-81"><span class="linenos">81</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagConfig.__init__-82"><a href="#TramDagConfig.__init__-82"><span class="linenos">82</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;conf_dict&#39;</span><span class="p">,</span> <span class="s1">&#39;CONF_DICT_PATH&#39;</span><span class="p">]:</span>
</span><span id="TramDagConfig.__init__-83"><a href="#TramDagConfig.__init__-83"><span class="linenos">83</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot override &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; via kwargs.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.__init__-84"><a href="#TramDagConfig.__init__-84"><span class="linenos">84</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="TramDagConfig.__init__-85"><a href="#TramDagConfig.__init__-85"><span class="linenos">85</span></a>        
</span><span id="TramDagConfig.__init__-86"><a href="#TramDagConfig.__init__-86"><span class="linenos">86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span> <span class="o">=</span> <span class="n">conf_dict</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="TramDagConfig.__init__-87"><a href="#TramDagConfig.__init__-87"><span class="linenos">87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="n">CONF_DICT_PATH</span>
</span><span id="TramDagConfig.__init__-88"><a href="#TramDagConfig.__init__-88"><span class="linenos">88</span></a>        
</span><span id="TramDagConfig.__init__-89"><a href="#TramDagConfig.__init__-89"><span class="linenos">89</span></a>        <span class="c1"># verification </span>
</span><span id="TramDagConfig.__init__-90"><a href="#TramDagConfig.__init__-90"><span class="linenos">90</span></a>        <span class="k">if</span> <span class="n">_verify</span><span class="p">:</span>
</span><span id="TramDagConfig.__init__-91"><a href="#TramDagConfig.__init__-91"><span class="linenos">91</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_verify_completeness</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a TramDagConfig instance.</p>

<h2 id="parameters">Parameters</h2>

<p>conf_dict : dict or None, optional
    Configuration dictionary. If None, an empty dict is used and can
    be populated later. Default is None.
CONF_DICT_PATH : str or None, optional
    Path to the configuration file on disk. Default is None.
_verify : bool, optional
    If True, run <code>_verify_completeness()</code> after initialization.
    Default is False.
**kwargs
    Additional attributes to be set on the instance. Keys "conf_dict"
    and "CONF_DICT_PATH" are forbidden and raise a ValueError.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If any key in <code>kwargs</code> is "conf_dict" or "CONF_DICT_PATH".</p>

<h2 id="notes">Notes</h2>

<p>By default, <code><a href="#TramDagConfig.debug">debug</a></code> and <code><a href="#TramDagConfig.verbose">verbose</a></code> are set to False. They can be
overridden via <code>kwargs</code>.</p>
</div>


                            </div>
                            <div id="TramDagConfig.debug" class="classattr">
                                <div class="attr variable">
            <span class="name">debug</span>

        
    </div>
    <a class="headerlink" href="#TramDagConfig.debug"></a>
    
    

                            </div>
                            <div id="TramDagConfig.verbose" class="classattr">
                                <div class="attr variable">
            <span class="name">verbose</span>

        
    </div>
    <a class="headerlink" href="#TramDagConfig.verbose"></a>
    
    

                            </div>
                            <div id="TramDagConfig.conf_dict" class="classattr">
                                <div class="attr variable">
            <span class="name">conf_dict</span>

        
    </div>
    <a class="headerlink" href="#TramDagConfig.conf_dict"></a>
    
    

                            </div>
                            <div id="TramDagConfig.CONF_DICT_PATH" class="classattr">
                                <div class="attr variable">
            <span class="name">CONF_DICT_PATH</span>

        
    </div>
    <a class="headerlink" href="#TramDagConfig.CONF_DICT_PATH"></a>
    
    

                            </div>
                            <div id="TramDagConfig.load_json" class="classattr">
                                        <input id="TramDagConfig.load_json-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">load_json</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagConfig.load_json-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagConfig.load_json"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagConfig.load_json-93"><a href="#TramDagConfig.load_json-93"><span class="linenos"> 93</span></a>    <span class="nd">@classmethod</span>
</span><span id="TramDagConfig.load_json-94"><a href="#TramDagConfig.load_json-94"><span class="linenos"> 94</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span><span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagConfig.load_json-95"><a href="#TramDagConfig.load_json-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig.load_json-96"><a href="#TramDagConfig.load_json-96"><span class="linenos"> 96</span></a><span class="sd">        Load a configuration from a JSON file and construct a TramDagConfig.</span>
</span><span id="TramDagConfig.load_json-97"><a href="#TramDagConfig.load_json-97"><span class="linenos"> 97</span></a>
</span><span id="TramDagConfig.load_json-98"><a href="#TramDagConfig.load_json-98"><span class="linenos"> 98</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig.load_json-99"><a href="#TramDagConfig.load_json-99"><span class="linenos"> 99</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig.load_json-100"><a href="#TramDagConfig.load_json-100"><span class="linenos">100</span></a><span class="sd">        CONF_DICT_PATH : str</span>
</span><span id="TramDagConfig.load_json-101"><a href="#TramDagConfig.load_json-101"><span class="linenos">101</span></a><span class="sd">            Path to the configuration JSON file.</span>
</span><span id="TramDagConfig.load_json-102"><a href="#TramDagConfig.load_json-102"><span class="linenos">102</span></a><span class="sd">        debug : bool, optional</span>
</span><span id="TramDagConfig.load_json-103"><a href="#TramDagConfig.load_json-103"><span class="linenos">103</span></a><span class="sd">            If True, initialize the instance with `debug=True`. Default is False.</span>
</span><span id="TramDagConfig.load_json-104"><a href="#TramDagConfig.load_json-104"><span class="linenos">104</span></a>
</span><span id="TramDagConfig.load_json-105"><a href="#TramDagConfig.load_json-105"><span class="linenos">105</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig.load_json-106"><a href="#TramDagConfig.load_json-106"><span class="linenos">106</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig.load_json-107"><a href="#TramDagConfig.load_json-107"><span class="linenos">107</span></a><span class="sd">        TramDagConfig</span>
</span><span id="TramDagConfig.load_json-108"><a href="#TramDagConfig.load_json-108"><span class="linenos">108</span></a><span class="sd">            Newly created configuration instance with `conf_dict` loaded from</span>
</span><span id="TramDagConfig.load_json-109"><a href="#TramDagConfig.load_json-109"><span class="linenos">109</span></a><span class="sd">            `CONF_DICT_PATH` and `_verify_completeness()` executed.</span>
</span><span id="TramDagConfig.load_json-110"><a href="#TramDagConfig.load_json-110"><span class="linenos">110</span></a>
</span><span id="TramDagConfig.load_json-111"><a href="#TramDagConfig.load_json-111"><span class="linenos">111</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig.load_json-112"><a href="#TramDagConfig.load_json-112"><span class="linenos">112</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig.load_json-113"><a href="#TramDagConfig.load_json-113"><span class="linenos">113</span></a><span class="sd">        FileNotFoundError</span>
</span><span id="TramDagConfig.load_json-114"><a href="#TramDagConfig.load_json-114"><span class="linenos">114</span></a><span class="sd">            If the configuration file cannot be found (propagated by</span>
</span><span id="TramDagConfig.load_json-115"><a href="#TramDagConfig.load_json-115"><span class="linenos">115</span></a><span class="sd">            `load_configuration_dict`).</span>
</span><span id="TramDagConfig.load_json-116"><a href="#TramDagConfig.load_json-116"><span class="linenos">116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig.load_json-117"><a href="#TramDagConfig.load_json-117"><span class="linenos">117</span></a>
</span><span id="TramDagConfig.load_json-118"><a href="#TramDagConfig.load_json-118"><span class="linenos">118</span></a>        <span class="n">conf</span> <span class="o">=</span> <span class="n">load_configuration_dict</span><span class="p">(</span><span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig.load_json-119"><a href="#TramDagConfig.load_json-119"><span class="linenos">119</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="o">=</span><span class="n">CONF_DICT_PATH</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="n">_verify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Load a configuration from a JSON file and construct a TramDagConfig.</p>

<h2 id="parameters">Parameters</h2>

<p>CONF_DICT_PATH : str
    Path to the configuration JSON file.
debug : bool, optional
    If True, initialize the instance with <code>debug=True</code>. Default is False.</p>

<h2 id="returns">Returns</h2>

<p>TramDagConfig
    Newly created configuration instance with <code><a href="#TramDagConfig.conf_dict">conf_dict</a></code> loaded from
    <code><a href="#TramDagConfig.CONF_DICT_PATH">CONF_DICT_PATH</a></code> and <code>_verify_completeness()</code> executed.</p>

<h2 id="raises">Raises</h2>

<p>FileNotFoundError
    If the configuration file cannot be found (propagated by
    <code>load_configuration_dict</code>).</p>
</div>


                            </div>
                            <div id="TramDagConfig.update" class="classattr">
                                        <input id="TramDagConfig.update-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagConfig.update-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagConfig.update"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagConfig.update-121"><a href="#TramDagConfig.update-121"><span class="linenos">121</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagConfig.update-122"><a href="#TramDagConfig.update-122"><span class="linenos">122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig.update-123"><a href="#TramDagConfig.update-123"><span class="linenos">123</span></a><span class="sd">        Reload the latest configuration from disk into this instance.</span>
</span><span id="TramDagConfig.update-124"><a href="#TramDagConfig.update-124"><span class="linenos">124</span></a>
</span><span id="TramDagConfig.update-125"><a href="#TramDagConfig.update-125"><span class="linenos">125</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig.update-126"><a href="#TramDagConfig.update-126"><span class="linenos">126</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig.update-127"><a href="#TramDagConfig.update-127"><span class="linenos">127</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig.update-128"><a href="#TramDagConfig.update-128"><span class="linenos">128</span></a>
</span><span id="TramDagConfig.update-129"><a href="#TramDagConfig.update-129"><span class="linenos">129</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig.update-130"><a href="#TramDagConfig.update-130"><span class="linenos">130</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig.update-131"><a href="#TramDagConfig.update-131"><span class="linenos">131</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig.update-132"><a href="#TramDagConfig.update-132"><span class="linenos">132</span></a>
</span><span id="TramDagConfig.update-133"><a href="#TramDagConfig.update-133"><span class="linenos">133</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig.update-134"><a href="#TramDagConfig.update-134"><span class="linenos">134</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig.update-135"><a href="#TramDagConfig.update-135"><span class="linenos">135</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagConfig.update-136"><a href="#TramDagConfig.update-136"><span class="linenos">136</span></a><span class="sd">            If `CONF_DICT_PATH` is not set on the instance.</span>
</span><span id="TramDagConfig.update-137"><a href="#TramDagConfig.update-137"><span class="linenos">137</span></a>
</span><span id="TramDagConfig.update-138"><a href="#TramDagConfig.update-138"><span class="linenos">138</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig.update-139"><a href="#TramDagConfig.update-139"><span class="linenos">139</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig.update-140"><a href="#TramDagConfig.update-140"><span class="linenos">140</span></a><span class="sd">        The current in-memory `conf_dict` is overwritten by the contents</span>
</span><span id="TramDagConfig.update-141"><a href="#TramDagConfig.update-141"><span class="linenos">141</span></a><span class="sd">        loaded from `CONF_DICT_PATH`.</span>
</span><span id="TramDagConfig.update-142"><a href="#TramDagConfig.update-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig.update-143"><a href="#TramDagConfig.update-143"><span class="linenos">143</span></a>
</span><span id="TramDagConfig.update-144"><a href="#TramDagConfig.update-144"><span class="linenos">144</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;CONF_DICT_PATH&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig.update-145"><a href="#TramDagConfig.update-145"><span class="linenos">145</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CONF_DICT_PATH not set  cannot update configuration.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.update-146"><a href="#TramDagConfig.update-146"><span class="linenos">146</span></a>        
</span><span id="TramDagConfig.update-147"><a href="#TramDagConfig.update-147"><span class="linenos">147</span></a>        
</span><span id="TramDagConfig.update-148"><a href="#TramDagConfig.update-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span> <span class="o">=</span> <span class="n">load_configuration_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Reload the latest configuration from disk into this instance.</p>

<h2 id="parameters">Parameters</h2>

<p>None</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If <code><a href="#TramDagConfig.CONF_DICT_PATH">CONF_DICT_PATH</a></code> is not set on the instance.</p>

<h2 id="notes">Notes</h2>

<p>The current in-memory <code><a href="#TramDagConfig.conf_dict">conf_dict</a></code> is overwritten by the contents
loaded from <code><a href="#TramDagConfig.CONF_DICT_PATH">CONF_DICT_PATH</a></code>.</p>
</div>


                            </div>
                            <div id="TramDagConfig.save" class="classattr">
                                        <input id="TramDagConfig.save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagConfig.save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagConfig.save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagConfig.save-151"><a href="#TramDagConfig.save-151"><span class="linenos">151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagConfig.save-152"><a href="#TramDagConfig.save-152"><span class="linenos">152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig.save-153"><a href="#TramDagConfig.save-153"><span class="linenos">153</span></a><span class="sd">        Persist the current configuration dictionary to disk.</span>
</span><span id="TramDagConfig.save-154"><a href="#TramDagConfig.save-154"><span class="linenos">154</span></a>
</span><span id="TramDagConfig.save-155"><a href="#TramDagConfig.save-155"><span class="linenos">155</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig.save-156"><a href="#TramDagConfig.save-156"><span class="linenos">156</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig.save-157"><a href="#TramDagConfig.save-157"><span class="linenos">157</span></a><span class="sd">        CONF_DICT_PATH : str or None, optional</span>
</span><span id="TramDagConfig.save-158"><a href="#TramDagConfig.save-158"><span class="linenos">158</span></a><span class="sd">            Target path for the configuration file. If None, uses</span>
</span><span id="TramDagConfig.save-159"><a href="#TramDagConfig.save-159"><span class="linenos">159</span></a><span class="sd">            `self.CONF_DICT_PATH`. Default is None.</span>
</span><span id="TramDagConfig.save-160"><a href="#TramDagConfig.save-160"><span class="linenos">160</span></a>
</span><span id="TramDagConfig.save-161"><a href="#TramDagConfig.save-161"><span class="linenos">161</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig.save-162"><a href="#TramDagConfig.save-162"><span class="linenos">162</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig.save-163"><a href="#TramDagConfig.save-163"><span class="linenos">163</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig.save-164"><a href="#TramDagConfig.save-164"><span class="linenos">164</span></a>
</span><span id="TramDagConfig.save-165"><a href="#TramDagConfig.save-165"><span class="linenos">165</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig.save-166"><a href="#TramDagConfig.save-166"><span class="linenos">166</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig.save-167"><a href="#TramDagConfig.save-167"><span class="linenos">167</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagConfig.save-168"><a href="#TramDagConfig.save-168"><span class="linenos">168</span></a><span class="sd">            If neither the function argument nor `self.CONF_DICT_PATH`</span>
</span><span id="TramDagConfig.save-169"><a href="#TramDagConfig.save-169"><span class="linenos">169</span></a><span class="sd">            provides a valid path.</span>
</span><span id="TramDagConfig.save-170"><a href="#TramDagConfig.save-170"><span class="linenos">170</span></a>
</span><span id="TramDagConfig.save-171"><a href="#TramDagConfig.save-171"><span class="linenos">171</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig.save-172"><a href="#TramDagConfig.save-172"><span class="linenos">172</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig.save-173"><a href="#TramDagConfig.save-173"><span class="linenos">173</span></a><span class="sd">        The resulting file is written via `write_configuration_dict`.</span>
</span><span id="TramDagConfig.save-174"><a href="#TramDagConfig.save-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig.save-175"><a href="#TramDagConfig.save-175"><span class="linenos">175</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">CONF_DICT_PATH</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span>
</span><span id="TramDagConfig.save-176"><a href="#TramDagConfig.save-176"><span class="linenos">176</span></a>        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig.save-177"><a href="#TramDagConfig.save-177"><span class="linenos">177</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No CONF_DICT_PATH provided to save config.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.save-178"><a href="#TramDagConfig.save-178"><span class="linenos">178</span></a>        <span class="n">write_configuration_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Persist the current configuration dictionary to disk.</p>

<h2 id="parameters">Parameters</h2>

<p>CONF_DICT_PATH : str or None, optional
    Target path for the configuration file. If None, uses
    <code>self.CONF_DICT_PATH</code>. Default is None.</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If neither the function argument nor <code>self.CONF_DICT_PATH</code>
    provides a valid path.</p>

<h2 id="notes">Notes</h2>

<p>The resulting file is written via <code>write_configuration_dict</code>.</p>
</div>


                            </div>
                            <div id="TramDagConfig.compute_levels" class="classattr">
                                        <input id="TramDagConfig.compute_levels-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_levels</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>, </span><span class="param"><span class="n">write</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagConfig.compute_levels-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagConfig.compute_levels"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagConfig.compute_levels-337"><a href="#TramDagConfig.compute_levels-337"><span class="linenos">337</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">write</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="TramDagConfig.compute_levels-338"><a href="#TramDagConfig.compute_levels-338"><span class="linenos">338</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig.compute_levels-339"><a href="#TramDagConfig.compute_levels-339"><span class="linenos">339</span></a><span class="sd">        Infer and update ordinal/categorical levels from data.</span>
</span><span id="TramDagConfig.compute_levels-340"><a href="#TramDagConfig.compute_levels-340"><span class="linenos">340</span></a>
</span><span id="TramDagConfig.compute_levels-341"><a href="#TramDagConfig.compute_levels-341"><span class="linenos">341</span></a><span class="sd">        For each variable in the configuration&#39;s `data_type` section, this</span>
</span><span id="TramDagConfig.compute_levels-342"><a href="#TramDagConfig.compute_levels-342"><span class="linenos">342</span></a><span class="sd">        method uses the provided DataFrame to construct a levels dictionary</span>
</span><span id="TramDagConfig.compute_levels-343"><a href="#TramDagConfig.compute_levels-343"><span class="linenos">343</span></a><span class="sd">        and injects the corresponding &quot;levels&quot; entry into `conf_dict[&quot;nodes&quot;]`.</span>
</span><span id="TramDagConfig.compute_levels-344"><a href="#TramDagConfig.compute_levels-344"><span class="linenos">344</span></a>
</span><span id="TramDagConfig.compute_levels-345"><a href="#TramDagConfig.compute_levels-345"><span class="linenos">345</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig.compute_levels-346"><a href="#TramDagConfig.compute_levels-346"><span class="linenos">346</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig.compute_levels-347"><a href="#TramDagConfig.compute_levels-347"><span class="linenos">347</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="TramDagConfig.compute_levels-348"><a href="#TramDagConfig.compute_levels-348"><span class="linenos">348</span></a><span class="sd">            DataFrame used to infer levels for configured variables.</span>
</span><span id="TramDagConfig.compute_levels-349"><a href="#TramDagConfig.compute_levels-349"><span class="linenos">349</span></a><span class="sd">        write : bool, optional</span>
</span><span id="TramDagConfig.compute_levels-350"><a href="#TramDagConfig.compute_levels-350"><span class="linenos">350</span></a><span class="sd">            If True and `CONF_DICT_PATH` is set, the updated configuration is</span>
</span><span id="TramDagConfig.compute_levels-351"><a href="#TramDagConfig.compute_levels-351"><span class="linenos">351</span></a><span class="sd">            written back to disk. Default is True.</span>
</span><span id="TramDagConfig.compute_levels-352"><a href="#TramDagConfig.compute_levels-352"><span class="linenos">352</span></a>
</span><span id="TramDagConfig.compute_levels-353"><a href="#TramDagConfig.compute_levels-353"><span class="linenos">353</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig.compute_levels-354"><a href="#TramDagConfig.compute_levels-354"><span class="linenos">354</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig.compute_levels-355"><a href="#TramDagConfig.compute_levels-355"><span class="linenos">355</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig.compute_levels-356"><a href="#TramDagConfig.compute_levels-356"><span class="linenos">356</span></a>
</span><span id="TramDagConfig.compute_levels-357"><a href="#TramDagConfig.compute_levels-357"><span class="linenos">357</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig.compute_levels-358"><a href="#TramDagConfig.compute_levels-358"><span class="linenos">358</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig.compute_levels-359"><a href="#TramDagConfig.compute_levels-359"><span class="linenos">359</span></a><span class="sd">        Exception</span>
</span><span id="TramDagConfig.compute_levels-360"><a href="#TramDagConfig.compute_levels-360"><span class="linenos">360</span></a><span class="sd">            If saving the configuration fails when `write=True`.</span>
</span><span id="TramDagConfig.compute_levels-361"><a href="#TramDagConfig.compute_levels-361"><span class="linenos">361</span></a>
</span><span id="TramDagConfig.compute_levels-362"><a href="#TramDagConfig.compute_levels-362"><span class="linenos">362</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig.compute_levels-363"><a href="#TramDagConfig.compute_levels-363"><span class="linenos">363</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig.compute_levels-364"><a href="#TramDagConfig.compute_levels-364"><span class="linenos">364</span></a><span class="sd">        - Variables present in `levels_dict` but not in `conf_dict[&quot;nodes&quot;]`</span>
</span><span id="TramDagConfig.compute_levels-365"><a href="#TramDagConfig.compute_levels-365"><span class="linenos">365</span></a><span class="sd">        trigger a warning and are skipped.</span>
</span><span id="TramDagConfig.compute_levels-366"><a href="#TramDagConfig.compute_levels-366"><span class="linenos">366</span></a><span class="sd">        - If `self.verbose` or `self.debug` is True, a success message is printed</span>
</span><span id="TramDagConfig.compute_levels-367"><a href="#TramDagConfig.compute_levels-367"><span class="linenos">367</span></a><span class="sd">        when the configuration is saved.</span>
</span><span id="TramDagConfig.compute_levels-368"><a href="#TramDagConfig.compute_levels-368"><span class="linenos">368</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig.compute_levels-369"><a href="#TramDagConfig.compute_levels-369"><span class="linenos">369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="TramDagConfig.compute_levels-370"><a href="#TramDagConfig.compute_levels-370"><span class="linenos">370</span></a>        <span class="n">levels_dict</span> <span class="o">=</span> <span class="n">create_levels_dict</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">])</span>
</span><span id="TramDagConfig.compute_levels-371"><a href="#TramDagConfig.compute_levels-371"><span class="linenos">371</span></a>        
</span><span id="TramDagConfig.compute_levels-372"><a href="#TramDagConfig.compute_levels-372"><span class="linenos">372</span></a>        <span class="c1"># update nodes dict with levels</span>
</span><span id="TramDagConfig.compute_levels-373"><a href="#TramDagConfig.compute_levels-373"><span class="linenos">373</span></a>        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">levels</span> <span class="ow">in</span> <span class="n">levels_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagConfig.compute_levels-374"><a href="#TramDagConfig.compute_levels-374"><span class="linenos">374</span></a>            <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]:</span>
</span><span id="TramDagConfig.compute_levels-375"><a href="#TramDagConfig.compute_levels-375"><span class="linenos">375</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">var</span><span class="p">][</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">levels</span>
</span><span id="TramDagConfig.compute_levels-376"><a href="#TramDagConfig.compute_levels-376"><span class="linenos">376</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig.compute_levels-377"><a href="#TramDagConfig.compute_levels-377"><span class="linenos">377</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Variable &#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">&#39; not found in nodes dict. Cannot add levels.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.compute_levels-378"><a href="#TramDagConfig.compute_levels-378"><span class="linenos">378</span></a>        
</span><span id="TramDagConfig.compute_levels-379"><a href="#TramDagConfig.compute_levels-379"><span class="linenos">379</span></a>        <span class="k">if</span> <span class="n">write</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig.compute_levels-380"><a href="#TramDagConfig.compute_levels-380"><span class="linenos">380</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagConfig.compute_levels-381"><a href="#TramDagConfig.compute_levels-381"><span class="linenos">381</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig.compute_levels-382"><a href="#TramDagConfig.compute_levels-382"><span class="linenos">382</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagConfig.compute_levels-383"><a href="#TramDagConfig.compute_levels-383"><span class="linenos">383</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[INFO] Configuration with updated levels saved to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="TramDagConfig.compute_levels-384"><a href="#TramDagConfig.compute_levels-384"><span class="linenos">384</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagConfig.compute_levels-385"><a href="#TramDagConfig.compute_levels-385"><span class="linenos">385</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[ERROR] Failed to save configuration: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Infer and update ordinal/categorical levels from data.</p>

<p>For each variable in the configuration's <code>data_type</code> section, this
method uses the provided DataFrame to construct a levels dictionary
and injects the corresponding "levels" entry into <code>conf_dict["nodes"]</code>.</p>

<h2 id="parameters">Parameters</h2>

<p>df : pandas.DataFrame
    DataFrame used to infer levels for configured variables.
write : bool, optional
    If True and <code><a href="#TramDagConfig.CONF_DICT_PATH">CONF_DICT_PATH</a></code> is set, the updated configuration is
    written back to disk. Default is True.</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="raises">Raises</h2>

<p>Exception
    If saving the configuration fails when <code>write=True</code>.</p>

<h2 id="notes">Notes</h2>

<ul>
<li>Variables present in <code>levels_dict</code> but not in <code>conf_dict["nodes"]</code>
trigger a warning and are skipped.</li>
<li>If <code>self.verbose</code> or <code>self.debug</code> is True, a success message is printed
when the configuration is saved.</li>
</ul>
</div>


                            </div>
                            <div id="TramDagConfig.plot_dag" class="classattr">
                                        <input id="TramDagConfig.plot_dag-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_dag</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span>, </span><span class="param"><span class="n">causal_order</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagConfig.plot_dag-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagConfig.plot_dag"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagConfig.plot_dag-387"><a href="#TramDagConfig.plot_dag-387"><span class="linenos">387</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_dag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span> <span class="n">causal_order</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagConfig.plot_dag-388"><a href="#TramDagConfig.plot_dag-388"><span class="linenos">388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig.plot_dag-389"><a href="#TramDagConfig.plot_dag-389"><span class="linenos">389</span></a><span class="sd">        Visualize the DAG defined by the configuration.</span>
</span><span id="TramDagConfig.plot_dag-390"><a href="#TramDagConfig.plot_dag-390"><span class="linenos">390</span></a>
</span><span id="TramDagConfig.plot_dag-391"><a href="#TramDagConfig.plot_dag-391"><span class="linenos">391</span></a><span class="sd">        Nodes are categorized and colored as:</span>
</span><span id="TramDagConfig.plot_dag-392"><a href="#TramDagConfig.plot_dag-392"><span class="linenos">392</span></a><span class="sd">        - Source nodes (no incoming edges): green.</span>
</span><span id="TramDagConfig.plot_dag-393"><a href="#TramDagConfig.plot_dag-393"><span class="linenos">393</span></a><span class="sd">        - Sink nodes (no outgoing edges): red.</span>
</span><span id="TramDagConfig.plot_dag-394"><a href="#TramDagConfig.plot_dag-394"><span class="linenos">394</span></a><span class="sd">        - Intermediate nodes: light blue.</span>
</span><span id="TramDagConfig.plot_dag-395"><a href="#TramDagConfig.plot_dag-395"><span class="linenos">395</span></a>
</span><span id="TramDagConfig.plot_dag-396"><a href="#TramDagConfig.plot_dag-396"><span class="linenos">396</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig.plot_dag-397"><a href="#TramDagConfig.plot_dag-397"><span class="linenos">397</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig.plot_dag-398"><a href="#TramDagConfig.plot_dag-398"><span class="linenos">398</span></a><span class="sd">        seed : int, optional</span>
</span><span id="TramDagConfig.plot_dag-399"><a href="#TramDagConfig.plot_dag-399"><span class="linenos">399</span></a><span class="sd">            Random seed for layout stability in the spring layout fallback.</span>
</span><span id="TramDagConfig.plot_dag-400"><a href="#TramDagConfig.plot_dag-400"><span class="linenos">400</span></a><span class="sd">            Default is 42.</span>
</span><span id="TramDagConfig.plot_dag-401"><a href="#TramDagConfig.plot_dag-401"><span class="linenos">401</span></a><span class="sd">        causal_order : bool, optional</span>
</span><span id="TramDagConfig.plot_dag-402"><a href="#TramDagConfig.plot_dag-402"><span class="linenos">402</span></a><span class="sd">            If True, attempt to use Graphviz &#39;dot&#39; layout via</span>
</span><span id="TramDagConfig.plot_dag-403"><a href="#TramDagConfig.plot_dag-403"><span class="linenos">403</span></a><span class="sd">            `networkx.nx_agraph.graphviz_layout` to preserve causal ordering.</span>
</span><span id="TramDagConfig.plot_dag-404"><a href="#TramDagConfig.plot_dag-404"><span class="linenos">404</span></a><span class="sd">            If False or if Graphviz is unavailable, use `spring_layout`.</span>
</span><span id="TramDagConfig.plot_dag-405"><a href="#TramDagConfig.plot_dag-405"><span class="linenos">405</span></a><span class="sd">            Default is False.</span>
</span><span id="TramDagConfig.plot_dag-406"><a href="#TramDagConfig.plot_dag-406"><span class="linenos">406</span></a>
</span><span id="TramDagConfig.plot_dag-407"><a href="#TramDagConfig.plot_dag-407"><span class="linenos">407</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig.plot_dag-408"><a href="#TramDagConfig.plot_dag-408"><span class="linenos">408</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig.plot_dag-409"><a href="#TramDagConfig.plot_dag-409"><span class="linenos">409</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig.plot_dag-410"><a href="#TramDagConfig.plot_dag-410"><span class="linenos">410</span></a>
</span><span id="TramDagConfig.plot_dag-411"><a href="#TramDagConfig.plot_dag-411"><span class="linenos">411</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig.plot_dag-412"><a href="#TramDagConfig.plot_dag-412"><span class="linenos">412</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig.plot_dag-413"><a href="#TramDagConfig.plot_dag-413"><span class="linenos">413</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagConfig.plot_dag-414"><a href="#TramDagConfig.plot_dag-414"><span class="linenos">414</span></a><span class="sd">            If `adj_matrix` or `data_type` is missing or inconsistent with each other,</span>
</span><span id="TramDagConfig.plot_dag-415"><a href="#TramDagConfig.plot_dag-415"><span class="linenos">415</span></a><span class="sd">            or if the adjacency matrix fails validation.</span>
</span><span id="TramDagConfig.plot_dag-416"><a href="#TramDagConfig.plot_dag-416"><span class="linenos">416</span></a>
</span><span id="TramDagConfig.plot_dag-417"><a href="#TramDagConfig.plot_dag-417"><span class="linenos">417</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig.plot_dag-418"><a href="#TramDagConfig.plot_dag-418"><span class="linenos">418</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig.plot_dag-419"><a href="#TramDagConfig.plot_dag-419"><span class="linenos">419</span></a><span class="sd">        Edge labels are colored by prefix:</span>
</span><span id="TramDagConfig.plot_dag-420"><a href="#TramDagConfig.plot_dag-420"><span class="linenos">420</span></a><span class="sd">        - &quot;ci&quot;: blue</span>
</span><span id="TramDagConfig.plot_dag-421"><a href="#TramDagConfig.plot_dag-421"><span class="linenos">421</span></a><span class="sd">        - &quot;ls&quot;: red</span>
</span><span id="TramDagConfig.plot_dag-422"><a href="#TramDagConfig.plot_dag-422"><span class="linenos">422</span></a><span class="sd">        - &quot;cs&quot;: green</span>
</span><span id="TramDagConfig.plot_dag-423"><a href="#TramDagConfig.plot_dag-423"><span class="linenos">423</span></a><span class="sd">        - other: black</span>
</span><span id="TramDagConfig.plot_dag-424"><a href="#TramDagConfig.plot_dag-424"><span class="linenos">424</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig.plot_dag-425"><a href="#TramDagConfig.plot_dag-425"><span class="linenos">425</span></a>        <span class="n">adj_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;adj_matrix&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-426"><a href="#TramDagConfig.plot_dag-426"><span class="linenos">426</span></a>        <span class="n">data_type</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_type&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-427"><a href="#TramDagConfig.plot_dag-427"><span class="linenos">427</span></a>
</span><span id="TramDagConfig.plot_dag-428"><a href="#TramDagConfig.plot_dag-428"><span class="linenos">428</span></a>        <span class="k">if</span> <span class="n">adj_matrix</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig.plot_dag-429"><a href="#TramDagConfig.plot_dag-429"><span class="linenos">429</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Configuration must include &#39;adj_matrix&#39; and &#39;data_type&#39;.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-430"><a href="#TramDagConfig.plot_dag-430"><span class="linenos">430</span></a>
</span><span id="TramDagConfig.plot_dag-431"><a href="#TramDagConfig.plot_dag-431"><span class="linenos">431</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="TramDagConfig.plot_dag-432"><a href="#TramDagConfig.plot_dag-432"><span class="linenos">432</span></a>            <span class="n">adj_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-433"><a href="#TramDagConfig.plot_dag-433"><span class="linenos">433</span></a>
</span><span id="TramDagConfig.plot_dag-434"><a href="#TramDagConfig.plot_dag-434"><span class="linenos">434</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_adj_matrix</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">):</span>
</span><span id="TramDagConfig.plot_dag-435"><a href="#TramDagConfig.plot_dag-435"><span class="linenos">435</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid adjacency matrix.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-436"><a href="#TramDagConfig.plot_dag-436"><span class="linenos">436</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span> <span class="o">!=</span> <span class="n">adj_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="TramDagConfig.plot_dag-437"><a href="#TramDagConfig.plot_dag-437"><span class="linenos">437</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;data_type must match adjacency matrix size.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-438"><a href="#TramDagConfig.plot_dag-438"><span class="linenos">438</span></a>
</span><span id="TramDagConfig.plot_dag-439"><a href="#TramDagConfig.plot_dag-439"><span class="linenos">439</span></a>        <span class="n">node_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_type</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagConfig.plot_dag-440"><a href="#TramDagConfig.plot_dag-440"><span class="linenos">440</span></a>        <span class="n">G</span><span class="p">,</span> <span class="n">edge_labels</span> <span class="o">=</span> <span class="n">create_nx_graph</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">node_labels</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-441"><a href="#TramDagConfig.plot_dag-441"><span class="linenos">441</span></a>
</span><span id="TramDagConfig.plot_dag-442"><a href="#TramDagConfig.plot_dag-442"><span class="linenos">442</span></a>        <span class="n">sources</span>       <span class="o">=</span> <span class="p">{</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">in_degree</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="TramDagConfig.plot_dag-443"><a href="#TramDagConfig.plot_dag-443"><span class="linenos">443</span></a>        <span class="n">sinks</span>         <span class="o">=</span> <span class="p">{</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">out_degree</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="TramDagConfig.plot_dag-444"><a href="#TramDagConfig.plot_dag-444"><span class="linenos">444</span></a>        <span class="n">intermediates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">-</span> <span class="n">sources</span> <span class="o">-</span> <span class="n">sinks</span>
</span><span id="TramDagConfig.plot_dag-445"><a href="#TramDagConfig.plot_dag-445"><span class="linenos">445</span></a>
</span><span id="TramDagConfig.plot_dag-446"><a href="#TramDagConfig.plot_dag-446"><span class="linenos">446</span></a>        <span class="n">node_colors</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="TramDagConfig.plot_dag-447"><a href="#TramDagConfig.plot_dag-447"><span class="linenos">447</span></a>            <span class="s2">&quot;green&quot;</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">sources</span>
</span><span id="TramDagConfig.plot_dag-448"><a href="#TramDagConfig.plot_dag-448"><span class="linenos">448</span></a>            <span class="k">else</span> <span class="s2">&quot;red&quot;</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">sinks</span>
</span><span id="TramDagConfig.plot_dag-449"><a href="#TramDagConfig.plot_dag-449"><span class="linenos">449</span></a>            <span class="k">else</span> <span class="s2">&quot;lightblue&quot;</span>
</span><span id="TramDagConfig.plot_dag-450"><a href="#TramDagConfig.plot_dag-450"><span class="linenos">450</span></a>            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span>
</span><span id="TramDagConfig.plot_dag-451"><a href="#TramDagConfig.plot_dag-451"><span class="linenos">451</span></a>        <span class="p">]</span>
</span><span id="TramDagConfig.plot_dag-452"><a href="#TramDagConfig.plot_dag-452"><span class="linenos">452</span></a>
</span><span id="TramDagConfig.plot_dag-453"><a href="#TramDagConfig.plot_dag-453"><span class="linenos">453</span></a>        <span class="k">if</span> <span class="n">causal_order</span><span class="p">:</span>
</span><span id="TramDagConfig.plot_dag-454"><a href="#TramDagConfig.plot_dag-454"><span class="linenos">454</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagConfig.plot_dag-455"><a href="#TramDagConfig.plot_dag-455"><span class="linenos">455</span></a>                <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">nx_agraph</span><span class="o">.</span><span class="n">graphviz_layout</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="s2">&quot;dot&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-456"><a href="#TramDagConfig.plot_dag-456"><span class="linenos">456</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="n">nx</span><span class="o">.</span><span class="n">NetworkXException</span><span class="p">):</span>
</span><span id="TramDagConfig.plot_dag-457"><a href="#TramDagConfig.plot_dag-457"><span class="linenos">457</span></a>                <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-458"><a href="#TramDagConfig.plot_dag-458"><span class="linenos">458</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig.plot_dag-459"><a href="#TramDagConfig.plot_dag-459"><span class="linenos">459</span></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-460"><a href="#TramDagConfig.plot_dag-460"><span class="linenos">460</span></a>
</span><span id="TramDagConfig.plot_dag-461"><a href="#TramDagConfig.plot_dag-461"><span class="linenos">461</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="TramDagConfig.plot_dag-462"><a href="#TramDagConfig.plot_dag-462"><span class="linenos">462</span></a>        <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span>
</span><span id="TramDagConfig.plot_dag-463"><a href="#TramDagConfig.plot_dag-463"><span class="linenos">463</span></a>            <span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span>
</span><span id="TramDagConfig.plot_dag-464"><a href="#TramDagConfig.plot_dag-464"><span class="linenos">464</span></a>            <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="TramDagConfig.plot_dag-465"><a href="#TramDagConfig.plot_dag-465"><span class="linenos">465</span></a>            <span class="n">node_color</span><span class="o">=</span><span class="n">node_colors</span><span class="p">,</span>
</span><span id="TramDagConfig.plot_dag-466"><a href="#TramDagConfig.plot_dag-466"><span class="linenos">466</span></a>            <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
</span><span id="TramDagConfig.plot_dag-467"><a href="#TramDagConfig.plot_dag-467"><span class="linenos">467</span></a>            <span class="n">node_size</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span>
</span><span id="TramDagConfig.plot_dag-468"><a href="#TramDagConfig.plot_dag-468"><span class="linenos">468</span></a>            <span class="n">arrowsize</span><span class="o">=</span><span class="mi">20</span>
</span><span id="TramDagConfig.plot_dag-469"><a href="#TramDagConfig.plot_dag-469"><span class="linenos">469</span></a>        <span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-470"><a href="#TramDagConfig.plot_dag-470"><span class="linenos">470</span></a>
</span><span id="TramDagConfig.plot_dag-471"><a href="#TramDagConfig.plot_dag-471"><span class="linenos">471</span></a>        <span class="k">for</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">edge_labels</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagConfig.plot_dag-472"><a href="#TramDagConfig.plot_dag-472"><span class="linenos">472</span></a>            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="TramDagConfig.plot_dag-473"><a href="#TramDagConfig.plot_dag-473"><span class="linenos">473</span></a>                <span class="s2">&quot;blue&quot;</span>  <span class="k">if</span> <span class="n">lbl</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ci&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-474"><a href="#TramDagConfig.plot_dag-474"><span class="linenos">474</span></a>                <span class="k">else</span> <span class="s2">&quot;red&quot;</span>   <span class="k">if</span> <span class="n">lbl</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ls&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-475"><a href="#TramDagConfig.plot_dag-475"><span class="linenos">475</span></a>                <span class="k">else</span> <span class="s2">&quot;green&quot;</span> <span class="k">if</span> <span class="n">lbl</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;cs&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-476"><a href="#TramDagConfig.plot_dag-476"><span class="linenos">476</span></a>                <span class="k">else</span> <span class="s2">&quot;black&quot;</span>
</span><span id="TramDagConfig.plot_dag-477"><a href="#TramDagConfig.plot_dag-477"><span class="linenos">477</span></a>            <span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-478"><a href="#TramDagConfig.plot_dag-478"><span class="linenos">478</span></a>            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edge_labels</span><span class="p">(</span>
</span><span id="TramDagConfig.plot_dag-479"><a href="#TramDagConfig.plot_dag-479"><span class="linenos">479</span></a>                <span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span>
</span><span id="TramDagConfig.plot_dag-480"><a href="#TramDagConfig.plot_dag-480"><span class="linenos">480</span></a>                <span class="n">edge_labels</span><span class="o">=</span><span class="p">{(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span> <span class="n">lbl</span><span class="p">},</span>
</span><span id="TramDagConfig.plot_dag-481"><a href="#TramDagConfig.plot_dag-481"><span class="linenos">481</span></a>                <span class="n">font_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="TramDagConfig.plot_dag-482"><a href="#TramDagConfig.plot_dag-482"><span class="linenos">482</span></a>                <span class="n">font_size</span><span class="o">=</span><span class="mi">12</span>
</span><span id="TramDagConfig.plot_dag-483"><a href="#TramDagConfig.plot_dag-483"><span class="linenos">483</span></a>            <span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-484"><a href="#TramDagConfig.plot_dag-484"><span class="linenos">484</span></a>
</span><span id="TramDagConfig.plot_dag-485"><a href="#TramDagConfig.plot_dag-485"><span class="linenos">485</span></a>        <span class="n">legend_items</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="TramDagConfig.plot_dag-486"><a href="#TramDagConfig.plot_dag-486"><span class="linenos">486</span></a>            <span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>     <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Source&quot;</span><span class="p">),</span>
</span><span id="TramDagConfig.plot_dag-487"><a href="#TramDagConfig.plot_dag-487"><span class="linenos">487</span></a>            <span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>       <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sink&quot;</span><span class="p">),</span>
</span><span id="TramDagConfig.plot_dag-488"><a href="#TramDagConfig.plot_dag-488"><span class="linenos">488</span></a>            <span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightblue&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Intermediate&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-489"><a href="#TramDagConfig.plot_dag-489"><span class="linenos">489</span></a>        <span class="p">]</span>
</span><span id="TramDagConfig.plot_dag-490"><a href="#TramDagConfig.plot_dag-490"><span class="linenos">490</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend_items</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-491"><a href="#TramDagConfig.plot_dag-491"><span class="linenos">491</span></a>
</span><span id="TramDagConfig.plot_dag-492"><a href="#TramDagConfig.plot_dag-492"><span class="linenos">492</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TRAM DAG&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-493"><a href="#TramDagConfig.plot_dag-493"><span class="linenos">493</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.plot_dag-494"><a href="#TramDagConfig.plot_dag-494"><span class="linenos">494</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="TramDagConfig.plot_dag-495"><a href="#TramDagConfig.plot_dag-495"><span class="linenos">495</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Visualize the DAG defined by the configuration.</p>

<p>Nodes are categorized and colored as:</p>

<ul>
<li>Source nodes (no incoming edges): green.</li>
<li>Sink nodes (no outgoing edges): red.</li>
<li>Intermediate nodes: light blue.</li>
</ul>

<h2 id="parameters">Parameters</h2>

<p>seed : int, optional
    Random seed for layout stability in the spring layout fallback.
    Default is 42.
causal_order : bool, optional
    If True, attempt to use Graphviz 'dot' layout via
    <code>networkx.nx_agraph.graphviz_layout</code> to preserve causal ordering.
    If False or if Graphviz is unavailable, use <code>spring_layout</code>.
    Default is False.</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If <code>adj_matrix</code> or <code>data_type</code> is missing or inconsistent with each other,
    or if the adjacency matrix fails validation.</p>

<h2 id="notes">Notes</h2>

<p>Edge labels are colored by prefix:</p>

<ul>
<li>"ci": blue</li>
<li>"ls": red</li>
<li>"cs": green</li>
<li>other: black</li>
</ul>
</div>


                            </div>
                            <div id="TramDagConfig.setup_configuration" class="classattr">
                                        <input id="TramDagConfig.setup_configuration-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">setup_configuration</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">experiment_name</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">EXPERIMENT_DIR</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">debug</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">_verify</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagConfig.setup_configuration-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagConfig.setup_configuration"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagConfig.setup_configuration-498"><a href="#TramDagConfig.setup_configuration-498"><span class="linenos">498</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setup_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experiment_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">EXPERIMENT_DIR</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">_verify</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagConfig.setup_configuration-499"><a href="#TramDagConfig.setup_configuration-499"><span class="linenos">499</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig.setup_configuration-500"><a href="#TramDagConfig.setup_configuration-500"><span class="linenos">500</span></a><span class="sd">        Create or reuse a configuration for an experiment.</span>
</span><span id="TramDagConfig.setup_configuration-501"><a href="#TramDagConfig.setup_configuration-501"><span class="linenos">501</span></a>
</span><span id="TramDagConfig.setup_configuration-502"><a href="#TramDagConfig.setup_configuration-502"><span class="linenos">502</span></a><span class="sd">        This method behaves differently depending on how it is called:</span>
</span><span id="TramDagConfig.setup_configuration-503"><a href="#TramDagConfig.setup_configuration-503"><span class="linenos">503</span></a>
</span><span id="TramDagConfig.setup_configuration-504"><a href="#TramDagConfig.setup_configuration-504"><span class="linenos">504</span></a><span class="sd">        1. Class call (e.g. `TramDagConfig.setup_configuration(...)`):</span>
</span><span id="TramDagConfig.setup_configuration-505"><a href="#TramDagConfig.setup_configuration-505"><span class="linenos">505</span></a><span class="sd">        - Creates or loads a configuration at the resolved path.</span>
</span><span id="TramDagConfig.setup_configuration-506"><a href="#TramDagConfig.setup_configuration-506"><span class="linenos">506</span></a><span class="sd">        - Returns a new `TramDagConfig` instance.</span>
</span><span id="TramDagConfig.setup_configuration-507"><a href="#TramDagConfig.setup_configuration-507"><span class="linenos">507</span></a>
</span><span id="TramDagConfig.setup_configuration-508"><a href="#TramDagConfig.setup_configuration-508"><span class="linenos">508</span></a><span class="sd">        2. Instance call (e.g. `cfg.setup_configuration(...)`):</span>
</span><span id="TramDagConfig.setup_configuration-509"><a href="#TramDagConfig.setup_configuration-509"><span class="linenos">509</span></a><span class="sd">        - Updates `self.conf_dict` and `self.CONF_DICT_PATH` in place.</span>
</span><span id="TramDagConfig.setup_configuration-510"><a href="#TramDagConfig.setup_configuration-510"><span class="linenos">510</span></a><span class="sd">        - Optionally verifies completeness.</span>
</span><span id="TramDagConfig.setup_configuration-511"><a href="#TramDagConfig.setup_configuration-511"><span class="linenos">511</span></a><span class="sd">        - Returns None.</span>
</span><span id="TramDagConfig.setup_configuration-512"><a href="#TramDagConfig.setup_configuration-512"><span class="linenos">512</span></a>
</span><span id="TramDagConfig.setup_configuration-513"><a href="#TramDagConfig.setup_configuration-513"><span class="linenos">513</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig.setup_configuration-514"><a href="#TramDagConfig.setup_configuration-514"><span class="linenos">514</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig.setup_configuration-515"><a href="#TramDagConfig.setup_configuration-515"><span class="linenos">515</span></a><span class="sd">        experiment_name : str or None, optional</span>
</span><span id="TramDagConfig.setup_configuration-516"><a href="#TramDagConfig.setup_configuration-516"><span class="linenos">516</span></a><span class="sd">            Name of the experiment. If None, defaults to &quot;experiment_1&quot;.</span>
</span><span id="TramDagConfig.setup_configuration-517"><a href="#TramDagConfig.setup_configuration-517"><span class="linenos">517</span></a><span class="sd">        EXPERIMENT_DIR : str or None, optional</span>
</span><span id="TramDagConfig.setup_configuration-518"><a href="#TramDagConfig.setup_configuration-518"><span class="linenos">518</span></a><span class="sd">            Directory for the experiment. If None, defaults to</span>
</span><span id="TramDagConfig.setup_configuration-519"><a href="#TramDagConfig.setup_configuration-519"><span class="linenos">519</span></a><span class="sd">            `&lt;cwd&gt;/&lt;experiment_name&gt;`.</span>
</span><span id="TramDagConfig.setup_configuration-520"><a href="#TramDagConfig.setup_configuration-520"><span class="linenos">520</span></a><span class="sd">        debug : bool, optional</span>
</span><span id="TramDagConfig.setup_configuration-521"><a href="#TramDagConfig.setup_configuration-521"><span class="linenos">521</span></a><span class="sd">            If True, initialize / update with `debug=True`. Default is False.</span>
</span><span id="TramDagConfig.setup_configuration-522"><a href="#TramDagConfig.setup_configuration-522"><span class="linenos">522</span></a><span class="sd">        _verify : bool, optional</span>
</span><span id="TramDagConfig.setup_configuration-523"><a href="#TramDagConfig.setup_configuration-523"><span class="linenos">523</span></a><span class="sd">            If True, call `_verify_completeness()` after loading. Default is False.</span>
</span><span id="TramDagConfig.setup_configuration-524"><a href="#TramDagConfig.setup_configuration-524"><span class="linenos">524</span></a>
</span><span id="TramDagConfig.setup_configuration-525"><a href="#TramDagConfig.setup_configuration-525"><span class="linenos">525</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig.setup_configuration-526"><a href="#TramDagConfig.setup_configuration-526"><span class="linenos">526</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig.setup_configuration-527"><a href="#TramDagConfig.setup_configuration-527"><span class="linenos">527</span></a><span class="sd">        TramDagConfig or None</span>
</span><span id="TramDagConfig.setup_configuration-528"><a href="#TramDagConfig.setup_configuration-528"><span class="linenos">528</span></a><span class="sd">            - A new instance when called on the class.</span>
</span><span id="TramDagConfig.setup_configuration-529"><a href="#TramDagConfig.setup_configuration-529"><span class="linenos">529</span></a><span class="sd">            - None when called on an existing instance.</span>
</span><span id="TramDagConfig.setup_configuration-530"><a href="#TramDagConfig.setup_configuration-530"><span class="linenos">530</span></a>
</span><span id="TramDagConfig.setup_configuration-531"><a href="#TramDagConfig.setup_configuration-531"><span class="linenos">531</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig.setup_configuration-532"><a href="#TramDagConfig.setup_configuration-532"><span class="linenos">532</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig.setup_configuration-533"><a href="#TramDagConfig.setup_configuration-533"><span class="linenos">533</span></a><span class="sd">        - A configuration file named &quot;configuration.json&quot; is created if it does</span>
</span><span id="TramDagConfig.setup_configuration-534"><a href="#TramDagConfig.setup_configuration-534"><span class="linenos">534</span></a><span class="sd">        not exist yet.</span>
</span><span id="TramDagConfig.setup_configuration-535"><a href="#TramDagConfig.setup_configuration-535"><span class="linenos">535</span></a><span class="sd">        - Underlying creation uses `create_and_write_new_configuration_dict`</span>
</span><span id="TramDagConfig.setup_configuration-536"><a href="#TramDagConfig.setup_configuration-536"><span class="linenos">536</span></a><span class="sd">        and `load_configuration_dict`.</span>
</span><span id="TramDagConfig.setup_configuration-537"><a href="#TramDagConfig.setup_configuration-537"><span class="linenos">537</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig.setup_configuration-538"><a href="#TramDagConfig.setup_configuration-538"><span class="linenos">538</span></a>        <span class="n">is_class_call</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</span><span id="TramDagConfig.setup_configuration-539"><a href="#TramDagConfig.setup_configuration-539"><span class="linenos">539</span></a>        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">is_class_call</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
</span><span id="TramDagConfig.setup_configuration-540"><a href="#TramDagConfig.setup_configuration-540"><span class="linenos">540</span></a>
</span><span id="TramDagConfig.setup_configuration-541"><a href="#TramDagConfig.setup_configuration-541"><span class="linenos">541</span></a>        <span class="k">if</span> <span class="n">experiment_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig.setup_configuration-542"><a href="#TramDagConfig.setup_configuration-542"><span class="linenos">542</span></a>            <span class="n">experiment_name</span> <span class="o">=</span> <span class="s2">&quot;experiment_1&quot;</span>
</span><span id="TramDagConfig.setup_configuration-543"><a href="#TramDagConfig.setup_configuration-543"><span class="linenos">543</span></a>        <span class="k">if</span> <span class="n">EXPERIMENT_DIR</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig.setup_configuration-544"><a href="#TramDagConfig.setup_configuration-544"><span class="linenos">544</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">experiment_name</span><span class="p">)</span>
</span><span id="TramDagConfig.setup_configuration-545"><a href="#TramDagConfig.setup_configuration-545"><span class="linenos">545</span></a>
</span><span id="TramDagConfig.setup_configuration-546"><a href="#TramDagConfig.setup_configuration-546"><span class="linenos">546</span></a>        <span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="s2">&quot;configuration.json&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.setup_configuration-547"><a href="#TramDagConfig.setup_configuration-547"><span class="linenos">547</span></a>        <span class="n">DATA_PATH</span> <span class="o">=</span> <span class="n">EXPERIMENT_DIR</span>
</span><span id="TramDagConfig.setup_configuration-548"><a href="#TramDagConfig.setup_configuration-548"><span class="linenos">548</span></a>
</span><span id="TramDagConfig.setup_configuration-549"><a href="#TramDagConfig.setup_configuration-549"><span class="linenos">549</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TramDagConfig.setup_configuration-550"><a href="#TramDagConfig.setup_configuration-550"><span class="linenos">550</span></a>
</span><span id="TramDagConfig.setup_configuration-551"><a href="#TramDagConfig.setup_configuration-551"><span class="linenos">551</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">CONF_DICT_PATH</span><span class="p">):</span>
</span><span id="TramDagConfig.setup_configuration-552"><a href="#TramDagConfig.setup_configuration-552"><span class="linenos">552</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration already exists: </span><span class="si">{</span><span class="n">CONF_DICT_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.setup_configuration-553"><a href="#TramDagConfig.setup_configuration-553"><span class="linenos">553</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig.setup_configuration-554"><a href="#TramDagConfig.setup_configuration-554"><span class="linenos">554</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="n">create_and_write_new_configuration_dict</span><span class="p">(</span>
</span><span id="TramDagConfig.setup_configuration-555"><a href="#TramDagConfig.setup_configuration-555"><span class="linenos">555</span></a>                <span class="n">experiment_name</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="p">,</span> <span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">DATA_PATH</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="TramDagConfig.setup_configuration-556"><a href="#TramDagConfig.setup_configuration-556"><span class="linenos">556</span></a>            <span class="p">)</span>
</span><span id="TramDagConfig.setup_configuration-557"><a href="#TramDagConfig.setup_configuration-557"><span class="linenos">557</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created new configuration file at </span><span class="si">{</span><span class="n">CONF_DICT_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.setup_configuration-558"><a href="#TramDagConfig.setup_configuration-558"><span class="linenos">558</span></a>
</span><span id="TramDagConfig.setup_configuration-559"><a href="#TramDagConfig.setup_configuration-559"><span class="linenos">559</span></a>        <span class="n">conf</span> <span class="o">=</span> <span class="n">load_configuration_dict</span><span class="p">(</span><span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig.setup_configuration-560"><a href="#TramDagConfig.setup_configuration-560"><span class="linenos">560</span></a>
</span><span id="TramDagConfig.setup_configuration-561"><a href="#TramDagConfig.setup_configuration-561"><span class="linenos">561</span></a>        <span class="k">if</span> <span class="n">is_class_call</span><span class="p">:</span>
</span><span id="TramDagConfig.setup_configuration-562"><a href="#TramDagConfig.setup_configuration-562"><span class="linenos">562</span></a>            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="o">=</span><span class="n">CONF_DICT_PATH</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="n">_verify</span><span class="o">=</span><span class="n">_verify</span><span class="p">)</span>
</span><span id="TramDagConfig.setup_configuration-563"><a href="#TramDagConfig.setup_configuration-563"><span class="linenos">563</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig.setup_configuration-564"><a href="#TramDagConfig.setup_configuration-564"><span class="linenos">564</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span> <span class="o">=</span> <span class="n">conf</span>
</span><span id="TramDagConfig.setup_configuration-565"><a href="#TramDagConfig.setup_configuration-565"><span class="linenos">565</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="n">CONF_DICT_PATH</span>
</span><span id="TramDagConfig.setup_configuration-566"><a href="#TramDagConfig.setup_configuration-566"><span class="linenos">566</span></a>            <span class="k">if</span> <span class="n">_verify</span><span class="p">:</span>
</span><span id="TramDagConfig.setup_configuration-567"><a href="#TramDagConfig.setup_configuration-567"><span class="linenos">567</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_verify_completeness</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Create or reuse a configuration for an experiment.</p>

<p>This method behaves differently depending on how it is called:</p>

<ol>
<li>Class call (e.g. <code><a href="#TramDagConfig.setup_configuration">TramDagConfig.setup_configuration</a>(...)</code>):</li>
</ol>

<ul>
<li>Creates or loads a configuration at the resolved path.</li>
<li>Returns a new <code><a href="#TramDagConfig">TramDagConfig</a></code> instance.</li>
</ul>

<ol start="2">
<li>Instance call (e.g. <code>cfg.setup_configuration(...)</code>):</li>
</ol>

<ul>
<li>Updates <code>self.conf_dict</code> and <code>self.CONF_DICT_PATH</code> in place.</li>
<li>Optionally verifies completeness.</li>
<li>Returns None.</li>
</ul>

<h2 id="parameters">Parameters</h2>

<p>experiment_name : str or None, optional
    Name of the experiment. If None, defaults to "experiment_1".
EXPERIMENT_DIR : str or None, optional
    Directory for the experiment. If None, defaults to
    <code>&lt;cwd&gt;/&lt;experiment_name&gt;</code>.
debug : bool, optional
    If True, initialize / update with <code>debug=True</code>. Default is False.
_verify : bool, optional
    If True, call <code>_verify_completeness()</code> after loading. Default is False.</p>

<h2 id="returns">Returns</h2>

<p>TramDagConfig or None
    - A new instance when called on the class.
    - None when called on an existing instance.</p>

<h2 id="notes">Notes</h2>

<ul>
<li>A configuration file named "configuration.json" is created if it does
not exist yet.</li>
<li>Underlying creation uses <code>create_and_write_new_configuration_dict</code>
and <code>load_configuration_dict</code>.</li>
</ul>
</div>


                            </div>
                            <div id="TramDagConfig.set_data_type" class="classattr">
                                        <input id="TramDagConfig.set_data_type-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_data_type</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data_type</span><span class="p">:</span> <span class="nb">dict</span>, </span><span class="param"><span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="TramDagConfig.set_data_type-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagConfig.set_data_type"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagConfig.set_data_type-569"><a href="#TramDagConfig.set_data_type-569"><span class="linenos">569</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_data_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig.set_data_type-570"><a href="#TramDagConfig.set_data_type-570"><span class="linenos">570</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig.set_data_type-571"><a href="#TramDagConfig.set_data_type-571"><span class="linenos">571</span></a><span class="sd">        Update or write the `data_type` section of a configuration file.</span>
</span><span id="TramDagConfig.set_data_type-572"><a href="#TramDagConfig.set_data_type-572"><span class="linenos">572</span></a>
</span><span id="TramDagConfig.set_data_type-573"><a href="#TramDagConfig.set_data_type-573"><span class="linenos">573</span></a><span class="sd">        Supports both class-level and instance-level usage:</span>
</span><span id="TramDagConfig.set_data_type-574"><a href="#TramDagConfig.set_data_type-574"><span class="linenos">574</span></a>
</span><span id="TramDagConfig.set_data_type-575"><a href="#TramDagConfig.set_data_type-575"><span class="linenos">575</span></a><span class="sd">        - Class call:</span>
</span><span id="TramDagConfig.set_data_type-576"><a href="#TramDagConfig.set_data_type-576"><span class="linenos">576</span></a><span class="sd">        - Requires `CONF_DICT_PATH` argument.</span>
</span><span id="TramDagConfig.set_data_type-577"><a href="#TramDagConfig.set_data_type-577"><span class="linenos">577</span></a><span class="sd">        - Reads the file if it exists, or starts from an empty dict.</span>
</span><span id="TramDagConfig.set_data_type-578"><a href="#TramDagConfig.set_data_type-578"><span class="linenos">578</span></a><span class="sd">        - Writes updated configuration to `CONF_DICT_PATH`.</span>
</span><span id="TramDagConfig.set_data_type-579"><a href="#TramDagConfig.set_data_type-579"><span class="linenos">579</span></a>
</span><span id="TramDagConfig.set_data_type-580"><a href="#TramDagConfig.set_data_type-580"><span class="linenos">580</span></a><span class="sd">        - Instance call:</span>
</span><span id="TramDagConfig.set_data_type-581"><a href="#TramDagConfig.set_data_type-581"><span class="linenos">581</span></a><span class="sd">        - Uses `self.CONF_DICT_PATH` if available, otherwise defaults to</span>
</span><span id="TramDagConfig.set_data_type-582"><a href="#TramDagConfig.set_data_type-582"><span class="linenos">582</span></a><span class="sd">            `&lt;cwd&gt;/configuration.json` if no path is provided.</span>
</span><span id="TramDagConfig.set_data_type-583"><a href="#TramDagConfig.set_data_type-583"><span class="linenos">583</span></a><span class="sd">        - Updates `self.conf_dict` and `self.CONF_DICT_PATH` after writing.</span>
</span><span id="TramDagConfig.set_data_type-584"><a href="#TramDagConfig.set_data_type-584"><span class="linenos">584</span></a>
</span><span id="TramDagConfig.set_data_type-585"><a href="#TramDagConfig.set_data_type-585"><span class="linenos">585</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig.set_data_type-586"><a href="#TramDagConfig.set_data_type-586"><span class="linenos">586</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig.set_data_type-587"><a href="#TramDagConfig.set_data_type-587"><span class="linenos">587</span></a><span class="sd">        data_type : dict</span>
</span><span id="TramDagConfig.set_data_type-588"><a href="#TramDagConfig.set_data_type-588"><span class="linenos">588</span></a><span class="sd">            Mapping `{variable_name: type_spec}`, where `type_spec` encodes</span>
</span><span id="TramDagConfig.set_data_type-589"><a href="#TramDagConfig.set_data_type-589"><span class="linenos">589</span></a><span class="sd">            modeling types (e.g. continuous, ordinal, etc.).</span>
</span><span id="TramDagConfig.set_data_type-590"><a href="#TramDagConfig.set_data_type-590"><span class="linenos">590</span></a><span class="sd">        CONF_DICT_PATH : str or None, optional</span>
</span><span id="TramDagConfig.set_data_type-591"><a href="#TramDagConfig.set_data_type-591"><span class="linenos">591</span></a><span class="sd">            Path to the configuration file. Must be provided for class calls.</span>
</span><span id="TramDagConfig.set_data_type-592"><a href="#TramDagConfig.set_data_type-592"><span class="linenos">592</span></a><span class="sd">            For instance calls, defaults as described above.</span>
</span><span id="TramDagConfig.set_data_type-593"><a href="#TramDagConfig.set_data_type-593"><span class="linenos">593</span></a>
</span><span id="TramDagConfig.set_data_type-594"><a href="#TramDagConfig.set_data_type-594"><span class="linenos">594</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig.set_data_type-595"><a href="#TramDagConfig.set_data_type-595"><span class="linenos">595</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig.set_data_type-596"><a href="#TramDagConfig.set_data_type-596"><span class="linenos">596</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig.set_data_type-597"><a href="#TramDagConfig.set_data_type-597"><span class="linenos">597</span></a>
</span><span id="TramDagConfig.set_data_type-598"><a href="#TramDagConfig.set_data_type-598"><span class="linenos">598</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig.set_data_type-599"><a href="#TramDagConfig.set_data_type-599"><span class="linenos">599</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig.set_data_type-600"><a href="#TramDagConfig.set_data_type-600"><span class="linenos">600</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagConfig.set_data_type-601"><a href="#TramDagConfig.set_data_type-601"><span class="linenos">601</span></a><span class="sd">            If `CONF_DICT_PATH` is missing when called on the class, or if</span>
</span><span id="TramDagConfig.set_data_type-602"><a href="#TramDagConfig.set_data_type-602"><span class="linenos">602</span></a><span class="sd">            validation of data types fails.</span>
</span><span id="TramDagConfig.set_data_type-603"><a href="#TramDagConfig.set_data_type-603"><span class="linenos">603</span></a>
</span><span id="TramDagConfig.set_data_type-604"><a href="#TramDagConfig.set_data_type-604"><span class="linenos">604</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig.set_data_type-605"><a href="#TramDagConfig.set_data_type-605"><span class="linenos">605</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig.set_data_type-606"><a href="#TramDagConfig.set_data_type-606"><span class="linenos">606</span></a><span class="sd">        - Variable names are validated via `validate_variable_names`.</span>
</span><span id="TramDagConfig.set_data_type-607"><a href="#TramDagConfig.set_data_type-607"><span class="linenos">607</span></a><span class="sd">        - Data type values are validated via `validate_data_types`.</span>
</span><span id="TramDagConfig.set_data_type-608"><a href="#TramDagConfig.set_data_type-608"><span class="linenos">608</span></a><span class="sd">        - A textual summary of modeling settings is printed via</span>
</span><span id="TramDagConfig.set_data_type-609"><a href="#TramDagConfig.set_data_type-609"><span class="linenos">609</span></a><span class="sd">        `print_data_type_modeling_setting`, if possible.</span>
</span><span id="TramDagConfig.set_data_type-610"><a href="#TramDagConfig.set_data_type-610"><span class="linenos">610</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig.set_data_type-611"><a href="#TramDagConfig.set_data_type-611"><span class="linenos">611</span></a>        <span class="n">is_class_call</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</span><span id="TramDagConfig.set_data_type-612"><a href="#TramDagConfig.set_data_type-612"><span class="linenos">612</span></a>        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">is_class_call</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
</span><span id="TramDagConfig.set_data_type-613"><a href="#TramDagConfig.set_data_type-613"><span class="linenos">613</span></a>
</span><span id="TramDagConfig.set_data_type-614"><a href="#TramDagConfig.set_data_type-614"><span class="linenos">614</span></a>        <span class="c1"># resolve path</span>
</span><span id="TramDagConfig.set_data_type-615"><a href="#TramDagConfig.set_data_type-615"><span class="linenos">615</span></a>        <span class="k">if</span> <span class="n">CONF_DICT_PATH</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig.set_data_type-616"><a href="#TramDagConfig.set_data_type-616"><span class="linenos">616</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_class_call</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;CONF_DICT_PATH&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagConfig.set_data_type-617"><a href="#TramDagConfig.set_data_type-617"><span class="linenos">617</span></a>                <span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span>
</span><span id="TramDagConfig.set_data_type-618"><a href="#TramDagConfig.set_data_type-618"><span class="linenos">618</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_class_call</span><span class="p">:</span>
</span><span id="TramDagConfig.set_data_type-619"><a href="#TramDagConfig.set_data_type-619"><span class="linenos">619</span></a>                <span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;configuration.json&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.set_data_type-620"><a href="#TramDagConfig.set_data_type-620"><span class="linenos">620</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig.set_data_type-621"><a href="#TramDagConfig.set_data_type-621"><span class="linenos">621</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CONF_DICT_PATH must be provided when called on the class.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.set_data_type-622"><a href="#TramDagConfig.set_data_type-622"><span class="linenos">622</span></a>
</span><span id="TramDagConfig.set_data_type-623"><a href="#TramDagConfig.set_data_type-623"><span class="linenos">623</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagConfig.set_data_type-624"><a href="#TramDagConfig.set_data_type-624"><span class="linenos">624</span></a>            <span class="c1"># load existing or create empty configuration</span>
</span><span id="TramDagConfig.set_data_type-625"><a href="#TramDagConfig.set_data_type-625"><span class="linenos">625</span></a>            <span class="n">configuration_dict</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="TramDagConfig.set_data_type-626"><a href="#TramDagConfig.set_data_type-626"><span class="linenos">626</span></a>                <span class="n">load_configuration_dict</span><span class="p">(</span><span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig.set_data_type-627"><a href="#TramDagConfig.set_data_type-627"><span class="linenos">627</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig.set_data_type-628"><a href="#TramDagConfig.set_data_type-628"><span class="linenos">628</span></a>                <span class="k">else</span> <span class="p">{}</span>
</span><span id="TramDagConfig.set_data_type-629"><a href="#TramDagConfig.set_data_type-629"><span class="linenos">629</span></a>            <span class="p">)</span>
</span><span id="TramDagConfig.set_data_type-630"><a href="#TramDagConfig.set_data_type-630"><span class="linenos">630</span></a>
</span><span id="TramDagConfig.set_data_type-631"><a href="#TramDagConfig.set_data_type-631"><span class="linenos">631</span></a>            <span class="n">validate_variable_names</span><span class="p">(</span><span class="n">data_type</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagConfig.set_data_type-632"><a href="#TramDagConfig.set_data_type-632"><span class="linenos">632</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_data_types</span><span class="p">(</span><span class="n">data_type</span><span class="p">):</span>
</span><span id="TramDagConfig.set_data_type-633"><a href="#TramDagConfig.set_data_type-633"><span class="linenos">633</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid data types in the provided dictionary.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.set_data_type-634"><a href="#TramDagConfig.set_data_type-634"><span class="linenos">634</span></a>
</span><span id="TramDagConfig.set_data_type-635"><a href="#TramDagConfig.set_data_type-635"><span class="linenos">635</span></a>            <span class="n">configuration_dict</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_type</span>
</span><span id="TramDagConfig.set_data_type-636"><a href="#TramDagConfig.set_data_type-636"><span class="linenos">636</span></a>            <span class="n">write_configuration_dict</span><span class="p">(</span><span class="n">configuration_dict</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig.set_data_type-637"><a href="#TramDagConfig.set_data_type-637"><span class="linenos">637</span></a>
</span><span id="TramDagConfig.set_data_type-638"><a href="#TramDagConfig.set_data_type-638"><span class="linenos">638</span></a>            <span class="c1"># safe printing</span>
</span><span id="TramDagConfig.set_data_type-639"><a href="#TramDagConfig.set_data_type-639"><span class="linenos">639</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagConfig.set_data_type-640"><a href="#TramDagConfig.set_data_type-640"><span class="linenos">640</span></a>                <span class="n">print_data_type_modeling_setting</span><span class="p">(</span><span class="n">data_type</span> <span class="ow">or</span> <span class="p">{})</span>
</span><span id="TramDagConfig.set_data_type-641"><a href="#TramDagConfig.set_data_type-641"><span class="linenos">641</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagConfig.set_data_type-642"><a href="#TramDagConfig.set_data_type-642"><span class="linenos">642</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Could not print data type modeling settings: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.set_data_type-643"><a href="#TramDagConfig.set_data_type-643"><span class="linenos">643</span></a>
</span><span id="TramDagConfig.set_data_type-644"><a href="#TramDagConfig.set_data_type-644"><span class="linenos">644</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_class_call</span><span class="p">:</span>
</span><span id="TramDagConfig.set_data_type-645"><a href="#TramDagConfig.set_data_type-645"><span class="linenos">645</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span> <span class="o">=</span> <span class="n">configuration_dict</span>
</span><span id="TramDagConfig.set_data_type-646"><a href="#TramDagConfig.set_data_type-646"><span class="linenos">646</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="n">CONF_DICT_PATH</span>
</span><span id="TramDagConfig.set_data_type-647"><a href="#TramDagConfig.set_data_type-647"><span class="linenos">647</span></a>
</span><span id="TramDagConfig.set_data_type-648"><a href="#TramDagConfig.set_data_type-648"><span class="linenos">648</span></a>
</span><span id="TramDagConfig.set_data_type-649"><a href="#TramDagConfig.set_data_type-649"><span class="linenos">649</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagConfig.set_data_type-650"><a href="#TramDagConfig.set_data_type-650"><span class="linenos">650</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update configuration: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.set_data_type-651"><a href="#TramDagConfig.set_data_type-651"><span class="linenos">651</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig.set_data_type-652"><a href="#TramDagConfig.set_data_type-652"><span class="linenos">652</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration updated successfully at </span><span class="si">{</span><span class="n">CONF_DICT_PATH</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Update or write the <code>data_type</code> section of a configuration file.</p>

<p>Supports both class-level and instance-level usage:</p>

<ul>
<li>Class call:</li>
<li>Requires <code><a href="#TramDagConfig.CONF_DICT_PATH">CONF_DICT_PATH</a></code> argument.</li>
<li>Reads the file if it exists, or starts from an empty dict.</li>
<li><p>Writes updated configuration to <code><a href="#TramDagConfig.CONF_DICT_PATH">CONF_DICT_PATH</a></code>.</p></li>
<li><p>Instance call:</p></li>
<li>Uses <code>self.CONF_DICT_PATH</code> if available, otherwise defaults to
<code>&lt;cwd&gt;/configuration.json</code> if no path is provided.</li>
<li>Updates <code>self.conf_dict</code> and <code>self.CONF_DICT_PATH</code> after writing.</li>
</ul>

<h2 id="parameters">Parameters</h2>

<p>data_type : dict
    Mapping <code>{variable_name: type_spec}</code>, where <code>type_spec</code> encodes
    modeling types (e.g. continuous, ordinal, etc.).
CONF_DICT_PATH : str or None, optional
    Path to the configuration file. Must be provided for class calls.
    For instance calls, defaults as described above.</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If <code><a href="#TramDagConfig.CONF_DICT_PATH">CONF_DICT_PATH</a></code> is missing when called on the class, or if
    validation of data types fails.</p>

<h2 id="notes">Notes</h2>

<ul>
<li>Variable names are validated via <code>validate_variable_names</code>.</li>
<li>Data type values are validated via <code>validate_data_types</code>.</li>
<li>A textual summary of modeling settings is printed via
<code>print_data_type_modeling_setting</code>, if possible.</li>
</ul>
</div>


                            </div>
                            <div id="TramDagConfig.set_meta_adj_matrix" class="classattr">
                                        <input id="TramDagConfig.set_meta_adj_matrix-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_meta_adj_matrix</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagConfig.set_meta_adj_matrix-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagConfig.set_meta_adj_matrix"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagConfig.set_meta_adj_matrix-654"><a href="#TramDagConfig.set_meta_adj_matrix-654"><span class="linenos">654</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_meta_adj_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-655"><a href="#TramDagConfig.set_meta_adj_matrix-655"><span class="linenos">655</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-656"><a href="#TramDagConfig.set_meta_adj_matrix-656"><span class="linenos">656</span></a><span class="sd">        Launch the interactive editor to set or modify the adjacency matrix.</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-657"><a href="#TramDagConfig.set_meta_adj_matrix-657"><span class="linenos">657</span></a>
</span><span id="TramDagConfig.set_meta_adj_matrix-658"><a href="#TramDagConfig.set_meta_adj_matrix-658"><span class="linenos">658</span></a><span class="sd">        This method:</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-659"><a href="#TramDagConfig.set_meta_adj_matrix-659"><span class="linenos">659</span></a>
</span><span id="TramDagConfig.set_meta_adj_matrix-660"><a href="#TramDagConfig.set_meta_adj_matrix-660"><span class="linenos">660</span></a><span class="sd">        1. Resolves the configuration path either from the argument or, for</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-661"><a href="#TramDagConfig.set_meta_adj_matrix-661"><span class="linenos">661</span></a><span class="sd">        instances, from `self.CONF_DICT_PATH`.</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-662"><a href="#TramDagConfig.set_meta_adj_matrix-662"><span class="linenos">662</span></a><span class="sd">        2. Invokes `interactive_adj_matrix` to edit the adjacency matrix.</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-663"><a href="#TramDagConfig.set_meta_adj_matrix-663"><span class="linenos">663</span></a><span class="sd">        3. For instances, reloads the updated configuration into `self.conf_dict`.</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-664"><a href="#TramDagConfig.set_meta_adj_matrix-664"><span class="linenos">664</span></a>
</span><span id="TramDagConfig.set_meta_adj_matrix-665"><a href="#TramDagConfig.set_meta_adj_matrix-665"><span class="linenos">665</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-666"><a href="#TramDagConfig.set_meta_adj_matrix-666"><span class="linenos">666</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-667"><a href="#TramDagConfig.set_meta_adj_matrix-667"><span class="linenos">667</span></a><span class="sd">        CONF_DICT_PATH : str or None, optional</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-668"><a href="#TramDagConfig.set_meta_adj_matrix-668"><span class="linenos">668</span></a><span class="sd">            Path to the configuration file. Must be provided when called</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-669"><a href="#TramDagConfig.set_meta_adj_matrix-669"><span class="linenos">669</span></a><span class="sd">            on the class. For instance calls, defaults to `self.CONF_DICT_PATH`.</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-670"><a href="#TramDagConfig.set_meta_adj_matrix-670"><span class="linenos">670</span></a><span class="sd">        seed : int, optional</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-671"><a href="#TramDagConfig.set_meta_adj_matrix-671"><span class="linenos">671</span></a><span class="sd">            Random seed for any layout or stochastic behavior in the interactive</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-672"><a href="#TramDagConfig.set_meta_adj_matrix-672"><span class="linenos">672</span></a><span class="sd">            editor. Default is 5.</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-673"><a href="#TramDagConfig.set_meta_adj_matrix-673"><span class="linenos">673</span></a>
</span><span id="TramDagConfig.set_meta_adj_matrix-674"><a href="#TramDagConfig.set_meta_adj_matrix-674"><span class="linenos">674</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-675"><a href="#TramDagConfig.set_meta_adj_matrix-675"><span class="linenos">675</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-676"><a href="#TramDagConfig.set_meta_adj_matrix-676"><span class="linenos">676</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-677"><a href="#TramDagConfig.set_meta_adj_matrix-677"><span class="linenos">677</span></a>
</span><span id="TramDagConfig.set_meta_adj_matrix-678"><a href="#TramDagConfig.set_meta_adj_matrix-678"><span class="linenos">678</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-679"><a href="#TramDagConfig.set_meta_adj_matrix-679"><span class="linenos">679</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-680"><a href="#TramDagConfig.set_meta_adj_matrix-680"><span class="linenos">680</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-681"><a href="#TramDagConfig.set_meta_adj_matrix-681"><span class="linenos">681</span></a><span class="sd">            If `CONF_DICT_PATH` is not provided and cannot be inferred</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-682"><a href="#TramDagConfig.set_meta_adj_matrix-682"><span class="linenos">682</span></a><span class="sd">            (e.g. in a class call without path).</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-683"><a href="#TramDagConfig.set_meta_adj_matrix-683"><span class="linenos">683</span></a>
</span><span id="TramDagConfig.set_meta_adj_matrix-684"><a href="#TramDagConfig.set_meta_adj_matrix-684"><span class="linenos">684</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-685"><a href="#TramDagConfig.set_meta_adj_matrix-685"><span class="linenos">685</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-686"><a href="#TramDagConfig.set_meta_adj_matrix-686"><span class="linenos">686</span></a><span class="sd">        `self.update()` is called at the start to ensure the in-memory config</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-687"><a href="#TramDagConfig.set_meta_adj_matrix-687"><span class="linenos">687</span></a><span class="sd">        is in sync with the file before launching the editor.</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-688"><a href="#TramDagConfig.set_meta_adj_matrix-688"><span class="linenos">688</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-689"><a href="#TramDagConfig.set_meta_adj_matrix-689"><span class="linenos">689</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-690"><a href="#TramDagConfig.set_meta_adj_matrix-690"><span class="linenos">690</span></a>        <span class="n">is_class_call</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-691"><a href="#TramDagConfig.set_meta_adj_matrix-691"><span class="linenos">691</span></a>
</span><span id="TramDagConfig.set_meta_adj_matrix-692"><a href="#TramDagConfig.set_meta_adj_matrix-692"><span class="linenos">692</span></a>        <span class="c1"># resolve path</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-693"><a href="#TramDagConfig.set_meta_adj_matrix-693"><span class="linenos">693</span></a>        <span class="k">if</span> <span class="n">CONF_DICT_PATH</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-694"><a href="#TramDagConfig.set_meta_adj_matrix-694"><span class="linenos">694</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_class_call</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;CONF_DICT_PATH&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-695"><a href="#TramDagConfig.set_meta_adj_matrix-695"><span class="linenos">695</span></a>                <span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-696"><a href="#TramDagConfig.set_meta_adj_matrix-696"><span class="linenos">696</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-697"><a href="#TramDagConfig.set_meta_adj_matrix-697"><span class="linenos">697</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CONF_DICT_PATH must be provided when called on the class.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-698"><a href="#TramDagConfig.set_meta_adj_matrix-698"><span class="linenos">698</span></a>
</span><span id="TramDagConfig.set_meta_adj_matrix-699"><a href="#TramDagConfig.set_meta_adj_matrix-699"><span class="linenos">699</span></a>        <span class="c1"># launch interactive editor</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-700"><a href="#TramDagConfig.set_meta_adj_matrix-700"><span class="linenos">700</span></a>        <span class="n">interactive_adj_matrix</span><span class="p">(</span><span class="n">CONF_DICT_PATH</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-701"><a href="#TramDagConfig.set_meta_adj_matrix-701"><span class="linenos">701</span></a>
</span><span id="TramDagConfig.set_meta_adj_matrix-702"><a href="#TramDagConfig.set_meta_adj_matrix-702"><span class="linenos">702</span></a>        <span class="c1"># reload config if instance</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-703"><a href="#TramDagConfig.set_meta_adj_matrix-703"><span class="linenos">703</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_class_call</span><span class="p">:</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-704"><a href="#TramDagConfig.set_meta_adj_matrix-704"><span class="linenos">704</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span> <span class="o">=</span> <span class="n">load_configuration_dict</span><span class="p">(</span><span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig.set_meta_adj_matrix-705"><a href="#TramDagConfig.set_meta_adj_matrix-705"><span class="linenos">705</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="n">CONF_DICT_PATH</span>
</span></pre></div>


            <div class="docstring"><p>Launch the interactive editor to set or modify the adjacency matrix.</p>

<p>This method:</p>

<ol>
<li>Resolves the configuration path either from the argument or, for
instances, from <code>self.CONF_DICT_PATH</code>.</li>
<li>Invokes <code>interactive_adj_matrix</code> to edit the adjacency matrix.</li>
<li>For instances, reloads the updated configuration into <code>self.conf_dict</code>.</li>
</ol>

<h2 id="parameters">Parameters</h2>

<p>CONF_DICT_PATH : str or None, optional
    Path to the configuration file. Must be provided when called
    on the class. For instance calls, defaults to <code>self.CONF_DICT_PATH</code>.
seed : int, optional
    Random seed for any layout or stochastic behavior in the interactive
    editor. Default is 5.</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If <code><a href="#TramDagConfig.CONF_DICT_PATH">CONF_DICT_PATH</a></code> is not provided and cannot be inferred
    (e.g. in a class call without path).</p>

<h2 id="notes">Notes</h2>

<p><code>self.update()</code> is called at the start to ensure the in-memory config
is in sync with the file before launching the editor.</p>
</div>


                            </div>
                            <div id="TramDagConfig.set_tramdag_nn_models" class="classattr">
                                        <input id="TramDagConfig.set_tramdag_nn_models-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_tramdag_nn_models</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagConfig.set_tramdag_nn_models-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagConfig.set_tramdag_nn_models"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagConfig.set_tramdag_nn_models-708"><a href="#TramDagConfig.set_tramdag_nn_models-708"><span class="linenos">708</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_tramdag_nn_models</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-709"><a href="#TramDagConfig.set_tramdag_nn_models-709"><span class="linenos">709</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-710"><a href="#TramDagConfig.set_tramdag_nn_models-710"><span class="linenos">710</span></a><span class="sd">        Launch the interactive editor to set TRAM-DAG neural network model names.</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-711"><a href="#TramDagConfig.set_tramdag_nn_models-711"><span class="linenos">711</span></a>
</span><span id="TramDagConfig.set_tramdag_nn_models-712"><a href="#TramDagConfig.set_tramdag_nn_models-712"><span class="linenos">712</span></a><span class="sd">        Depending on call context:</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-713"><a href="#TramDagConfig.set_tramdag_nn_models-713"><span class="linenos">713</span></a>
</span><span id="TramDagConfig.set_tramdag_nn_models-714"><a href="#TramDagConfig.set_tramdag_nn_models-714"><span class="linenos">714</span></a><span class="sd">        - Class call:</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-715"><a href="#TramDagConfig.set_tramdag_nn_models-715"><span class="linenos">715</span></a><span class="sd">        - Requires `CONF_DICT_PATH` argument.</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-716"><a href="#TramDagConfig.set_tramdag_nn_models-716"><span class="linenos">716</span></a><span class="sd">        - Returns nothing and does not modify a specific instance.</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-717"><a href="#TramDagConfig.set_tramdag_nn_models-717"><span class="linenos">717</span></a>
</span><span id="TramDagConfig.set_tramdag_nn_models-718"><a href="#TramDagConfig.set_tramdag_nn_models-718"><span class="linenos">718</span></a><span class="sd">        - Instance call:</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-719"><a href="#TramDagConfig.set_tramdag_nn_models-719"><span class="linenos">719</span></a><span class="sd">        - Resolves `CONF_DICT_PATH` from the argument or `self.CONF_DICT_PATH`.</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-720"><a href="#TramDagConfig.set_tramdag_nn_models-720"><span class="linenos">720</span></a><span class="sd">        - Updates `self.conf_dict` and `self.CONF_DICT_PATH` if the editor</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-721"><a href="#TramDagConfig.set_tramdag_nn_models-721"><span class="linenos">721</span></a><span class="sd">            returns an updated configuration.</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-722"><a href="#TramDagConfig.set_tramdag_nn_models-722"><span class="linenos">722</span></a>
</span><span id="TramDagConfig.set_tramdag_nn_models-723"><a href="#TramDagConfig.set_tramdag_nn_models-723"><span class="linenos">723</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-724"><a href="#TramDagConfig.set_tramdag_nn_models-724"><span class="linenos">724</span></a><span class="sd">        ----------</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-725"><a href="#TramDagConfig.set_tramdag_nn_models-725"><span class="linenos">725</span></a><span class="sd">        CONF_DICT_PATH : str or None, optional</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-726"><a href="#TramDagConfig.set_tramdag_nn_models-726"><span class="linenos">726</span></a><span class="sd">            Path to the configuration file. Must be provided when called on</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-727"><a href="#TramDagConfig.set_tramdag_nn_models-727"><span class="linenos">727</span></a><span class="sd">            the class. For instance calls, defaults to `self.CONF_DICT_PATH`.</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-728"><a href="#TramDagConfig.set_tramdag_nn_models-728"><span class="linenos">728</span></a>
</span><span id="TramDagConfig.set_tramdag_nn_models-729"><a href="#TramDagConfig.set_tramdag_nn_models-729"><span class="linenos">729</span></a><span class="sd">        Returns</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-730"><a href="#TramDagConfig.set_tramdag_nn_models-730"><span class="linenos">730</span></a><span class="sd">        -------</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-731"><a href="#TramDagConfig.set_tramdag_nn_models-731"><span class="linenos">731</span></a><span class="sd">        None</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-732"><a href="#TramDagConfig.set_tramdag_nn_models-732"><span class="linenos">732</span></a>
</span><span id="TramDagConfig.set_tramdag_nn_models-733"><a href="#TramDagConfig.set_tramdag_nn_models-733"><span class="linenos">733</span></a><span class="sd">        Raises</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-734"><a href="#TramDagConfig.set_tramdag_nn_models-734"><span class="linenos">734</span></a><span class="sd">        ------</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-735"><a href="#TramDagConfig.set_tramdag_nn_models-735"><span class="linenos">735</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-736"><a href="#TramDagConfig.set_tramdag_nn_models-736"><span class="linenos">736</span></a><span class="sd">            If `CONF_DICT_PATH` is not provided and cannot be inferred</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-737"><a href="#TramDagConfig.set_tramdag_nn_models-737"><span class="linenos">737</span></a><span class="sd">            (e.g. in a class call without path).</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-738"><a href="#TramDagConfig.set_tramdag_nn_models-738"><span class="linenos">738</span></a>
</span><span id="TramDagConfig.set_tramdag_nn_models-739"><a href="#TramDagConfig.set_tramdag_nn_models-739"><span class="linenos">739</span></a><span class="sd">        Notes</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-740"><a href="#TramDagConfig.set_tramdag_nn_models-740"><span class="linenos">740</span></a><span class="sd">        -----</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-741"><a href="#TramDagConfig.set_tramdag_nn_models-741"><span class="linenos">741</span></a><span class="sd">        The interactive editor is invoked via `interactive_nn_names_matrix`.</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-742"><a href="#TramDagConfig.set_tramdag_nn_models-742"><span class="linenos">742</span></a><span class="sd">        If it returns `None`, the instance configuration is left unchanged.</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-743"><a href="#TramDagConfig.set_tramdag_nn_models-743"><span class="linenos">743</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-744"><a href="#TramDagConfig.set_tramdag_nn_models-744"><span class="linenos">744</span></a>        <span class="n">is_class_call</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-745"><a href="#TramDagConfig.set_tramdag_nn_models-745"><span class="linenos">745</span></a>        <span class="k">if</span> <span class="n">CONF_DICT_PATH</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-746"><a href="#TramDagConfig.set_tramdag_nn_models-746"><span class="linenos">746</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_class_call</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;CONF_DICT_PATH&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-747"><a href="#TramDagConfig.set_tramdag_nn_models-747"><span class="linenos">747</span></a>                <span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-748"><a href="#TramDagConfig.set_tramdag_nn_models-748"><span class="linenos">748</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-749"><a href="#TramDagConfig.set_tramdag_nn_models-749"><span class="linenos">749</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CONF_DICT_PATH must be provided when called on the class.&quot;</span><span class="p">)</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-750"><a href="#TramDagConfig.set_tramdag_nn_models-750"><span class="linenos">750</span></a>
</span><span id="TramDagConfig.set_tramdag_nn_models-751"><a href="#TramDagConfig.set_tramdag_nn_models-751"><span class="linenos">751</span></a>        <span class="n">updated_conf</span> <span class="o">=</span> <span class="n">interactive_nn_names_matrix</span><span class="p">(</span><span class="n">CONF_DICT_PATH</span><span class="p">)</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-752"><a href="#TramDagConfig.set_tramdag_nn_models-752"><span class="linenos">752</span></a>        <span class="k">if</span> <span class="n">updated_conf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_class_call</span><span class="p">:</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-753"><a href="#TramDagConfig.set_tramdag_nn_models-753"><span class="linenos">753</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">conf_dict</span> <span class="o">=</span> <span class="n">updated_conf</span>
</span><span id="TramDagConfig.set_tramdag_nn_models-754"><a href="#TramDagConfig.set_tramdag_nn_models-754"><span class="linenos">754</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">CONF_DICT_PATH</span> <span class="o">=</span> <span class="n">CONF_DICT_PATH</span>
</span></pre></div>


            <div class="docstring"><p>Launch the interactive editor to set TRAM-DAG neural network model names.</p>

<p>Depending on call context:</p>

<ul>
<li>Class call:</li>
<li>Requires <code><a href="#TramDagConfig.CONF_DICT_PATH">CONF_DICT_PATH</a></code> argument.</li>
<li><p>Returns nothing and does not modify a specific instance.</p></li>
<li><p>Instance call:</p></li>
<li>Resolves <code><a href="#TramDagConfig.CONF_DICT_PATH">CONF_DICT_PATH</a></code> from the argument or <code>self.CONF_DICT_PATH</code>.</li>
<li>Updates <code>self.conf_dict</code> and <code>self.CONF_DICT_PATH</code> if the editor
returns an updated configuration.</li>
</ul>

<h2 id="parameters">Parameters</h2>

<p>CONF_DICT_PATH : str or None, optional
    Path to the configuration file. Must be provided when called on
    the class. For instance calls, defaults to <code>self.CONF_DICT_PATH</code>.</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If <code><a href="#TramDagConfig.CONF_DICT_PATH">CONF_DICT_PATH</a></code> is not provided and cannot be inferred
    (e.g. in a class call without path).</p>

<h2 id="notes">Notes</h2>

<p>The interactive editor is invoked via <code>interactive_nn_names_matrix</code>.
If it returns <code>None</code>, the instance configuration is left unchanged.</p>
</div>


                            </div>
                </section>
                <section id="TramDagDataset">
                            <input id="TramDagDataset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TramDagDataset</span><wbr>(<span class="base">typing.Generic[+_T_co]</span>):

                <label class="view-source-button" for="TramDagDataset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagDataset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagDataset-29"><a href="#TramDagDataset-29"><span class="linenos"> 29</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TramDagDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
</span><span id="TramDagDataset-30"><a href="#TramDagDataset-30"><span class="linenos"> 30</span></a><span class="w">    </span>
</span><span id="TramDagDataset-31"><a href="#TramDagDataset-31"><span class="linenos"> 31</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagDataset-32"><a href="#TramDagDataset-32"><span class="linenos"> 32</span></a><span class="sd">    TramDagDataset</span>
</span><span id="TramDagDataset-33"><a href="#TramDagDataset-33"><span class="linenos"> 33</span></a><span class="sd">    ==============</span>
</span><span id="TramDagDataset-34"><a href="#TramDagDataset-34"><span class="linenos"> 34</span></a>
</span><span id="TramDagDataset-35"><a href="#TramDagDataset-35"><span class="linenos"> 35</span></a><span class="sd">    The `TramDagDataset` class handles structured data preparation for TRAM-DAG</span>
</span><span id="TramDagDataset-36"><a href="#TramDagDataset-36"><span class="linenos"> 36</span></a><span class="sd">    models. It wraps a pandas DataFrame together with its configuration and provides</span>
</span><span id="TramDagDataset-37"><a href="#TramDagDataset-37"><span class="linenos"> 37</span></a><span class="sd">    utilities for scaling, transformation, and efficient DataLoader construction</span>
</span><span id="TramDagDataset-38"><a href="#TramDagDataset-38"><span class="linenos"> 38</span></a><span class="sd">    for each node in a DAG-based configuration.</span>
</span><span id="TramDagDataset-39"><a href="#TramDagDataset-39"><span class="linenos"> 39</span></a>
</span><span id="TramDagDataset-40"><a href="#TramDagDataset-40"><span class="linenos"> 40</span></a><span class="sd">    ---------------------------------------------------------------------</span>
</span><span id="TramDagDataset-41"><a href="#TramDagDataset-41"><span class="linenos"> 41</span></a><span class="sd">    Core Responsibilities</span>
</span><span id="TramDagDataset-42"><a href="#TramDagDataset-42"><span class="linenos"> 42</span></a><span class="sd">    ---------------------------------------------------------------------</span>
</span><span id="TramDagDataset-43"><a href="#TramDagDataset-43"><span class="linenos"> 43</span></a><span class="sd">    - Validate and store configuration metadata (`TramDagConfig`).</span>
</span><span id="TramDagDataset-44"><a href="#TramDagDataset-44"><span class="linenos"> 44</span></a><span class="sd">    - Manage per-node settings for DataLoader creation (batch size, shuffling, workers).</span>
</span><span id="TramDagDataset-45"><a href="#TramDagDataset-45"><span class="linenos"> 45</span></a><span class="sd">    - Compute scaling information (quantile-based min/max).</span>
</span><span id="TramDagDataset-46"><a href="#TramDagDataset-46"><span class="linenos"> 46</span></a><span class="sd">    - Optionally precompute and cache dataset representations.</span>
</span><span id="TramDagDataset-47"><a href="#TramDagDataset-47"><span class="linenos"> 47</span></a><span class="sd">    - Expose PyTorch Dataset and DataLoader interfaces for model training.</span>
</span><span id="TramDagDataset-48"><a href="#TramDagDataset-48"><span class="linenos"> 48</span></a>
</span><span id="TramDagDataset-49"><a href="#TramDagDataset-49"><span class="linenos"> 49</span></a><span class="sd">    ---------------------------------------------------------------------</span>
</span><span id="TramDagDataset-50"><a href="#TramDagDataset-50"><span class="linenos"> 50</span></a><span class="sd">    Key Attributes</span>
</span><span id="TramDagDataset-51"><a href="#TramDagDataset-51"><span class="linenos"> 51</span></a><span class="sd">    ---------------------------------------------------------------------</span>
</span><span id="TramDagDataset-52"><a href="#TramDagDataset-52"><span class="linenos"> 52</span></a><span class="sd">    - **df** : pandas.DataFrame  </span>
</span><span id="TramDagDataset-53"><a href="#TramDagDataset-53"><span class="linenos"> 53</span></a><span class="sd">      The dataset content used for building loaders and computing scaling.</span>
</span><span id="TramDagDataset-54"><a href="#TramDagDataset-54"><span class="linenos"> 54</span></a>
</span><span id="TramDagDataset-55"><a href="#TramDagDataset-55"><span class="linenos"> 55</span></a><span class="sd">    - **cfg** : TramDagConfig  </span>
</span><span id="TramDagDataset-56"><a href="#TramDagDataset-56"><span class="linenos"> 56</span></a><span class="sd">      Configuration object defining nodes and variable metadata.</span>
</span><span id="TramDagDataset-57"><a href="#TramDagDataset-57"><span class="linenos"> 57</span></a>
</span><span id="TramDagDataset-58"><a href="#TramDagDataset-58"><span class="linenos"> 58</span></a><span class="sd">    - **nodes_dict** : dict  </span>
</span><span id="TramDagDataset-59"><a href="#TramDagDataset-59"><span class="linenos"> 59</span></a><span class="sd">      Mapping of variable names to node specifications from the configuration.</span>
</span><span id="TramDagDataset-60"><a href="#TramDagDataset-60"><span class="linenos"> 60</span></a>
</span><span id="TramDagDataset-61"><a href="#TramDagDataset-61"><span class="linenos"> 61</span></a><span class="sd">    - **loaders** : dict  </span>
</span><span id="TramDagDataset-62"><a href="#TramDagDataset-62"><span class="linenos"> 62</span></a><span class="sd">      Mapping of node names to `torch.utils.data.DataLoader` instances or `GenericDataset` objects.</span>
</span><span id="TramDagDataset-63"><a href="#TramDagDataset-63"><span class="linenos"> 63</span></a>
</span><span id="TramDagDataset-64"><a href="#TramDagDataset-64"><span class="linenos"> 64</span></a><span class="sd">    - **DEFAULTS** : dict  </span>
</span><span id="TramDagDataset-65"><a href="#TramDagDataset-65"><span class="linenos"> 65</span></a><span class="sd">      Default DataLoader and dataset-related settings (e.g., batch_size, shuffle, num_workers, etc.).</span>
</span><span id="TramDagDataset-66"><a href="#TramDagDataset-66"><span class="linenos"> 66</span></a>
</span><span id="TramDagDataset-67"><a href="#TramDagDataset-67"><span class="linenos"> 67</span></a><span class="sd">    ---------------------------------------------------------------------</span>
</span><span id="TramDagDataset-68"><a href="#TramDagDataset-68"><span class="linenos"> 68</span></a><span class="sd">    Main Methods</span>
</span><span id="TramDagDataset-69"><a href="#TramDagDataset-69"><span class="linenos"> 69</span></a><span class="sd">    ---------------------------------------------------------------------</span>
</span><span id="TramDagDataset-70"><a href="#TramDagDataset-70"><span class="linenos"> 70</span></a><span class="sd">    - **from_dataframe(df, cfg, **kwargs)**  </span>
</span><span id="TramDagDataset-71"><a href="#TramDagDataset-71"><span class="linenos"> 71</span></a><span class="sd">      Construct the dataset directly from a pandas DataFrame.</span>
</span><span id="TramDagDataset-72"><a href="#TramDagDataset-72"><span class="linenos"> 72</span></a>
</span><span id="TramDagDataset-73"><a href="#TramDagDataset-73"><span class="linenos"> 73</span></a><span class="sd">    - **compute_scaling(df=None, write=True)**  </span>
</span><span id="TramDagDataset-74"><a href="#TramDagDataset-74"><span class="linenos"> 74</span></a><span class="sd">      Compute per-variable min/max scaling values from data.</span>
</span><span id="TramDagDataset-75"><a href="#TramDagDataset-75"><span class="linenos"> 75</span></a>
</span><span id="TramDagDataset-76"><a href="#TramDagDataset-76"><span class="linenos"> 76</span></a><span class="sd">    - **summary()**  </span>
</span><span id="TramDagDataset-77"><a href="#TramDagDataset-77"><span class="linenos"> 77</span></a><span class="sd">      Print dataset overview including shape, dtypes, statistics, and node settings.</span>
</span><span id="TramDagDataset-78"><a href="#TramDagDataset-78"><span class="linenos"> 78</span></a>
</span><span id="TramDagDataset-79"><a href="#TramDagDataset-79"><span class="linenos"> 79</span></a><span class="sd">    ---------------------------------------------------------------------</span>
</span><span id="TramDagDataset-80"><a href="#TramDagDataset-80"><span class="linenos"> 80</span></a><span class="sd">    Notes</span>
</span><span id="TramDagDataset-81"><a href="#TramDagDataset-81"><span class="linenos"> 81</span></a><span class="sd">    ---------------------------------------------------------------------</span>
</span><span id="TramDagDataset-82"><a href="#TramDagDataset-82"><span class="linenos"> 82</span></a><span class="sd">    - Intended for training data; `compute_scaling()` should use only training subsets.</span>
</span><span id="TramDagDataset-83"><a href="#TramDagDataset-83"><span class="linenos"> 83</span></a><span class="sd">    - Compatible with both CPU and GPU DataLoader options.</span>
</span><span id="TramDagDataset-84"><a href="#TramDagDataset-84"><span class="linenos"> 84</span></a><span class="sd">    - Strict validation of keyword arguments against `DEFAULTS` prevents silent misconfiguration.</span>
</span><span id="TramDagDataset-85"><a href="#TramDagDataset-85"><span class="linenos"> 85</span></a>
</span><span id="TramDagDataset-86"><a href="#TramDagDataset-86"><span class="linenos"> 86</span></a><span class="sd">    ---------------------------------------------------------------------</span>
</span><span id="TramDagDataset-87"><a href="#TramDagDataset-87"><span class="linenos"> 87</span></a><span class="sd">    Example</span>
</span><span id="TramDagDataset-88"><a href="#TramDagDataset-88"><span class="linenos"> 88</span></a><span class="sd">    ---------------------------------------------------------------------</span>
</span><span id="TramDagDataset-89"><a href="#TramDagDataset-89"><span class="linenos"> 89</span></a><span class="sd">    &gt;&gt;&gt; cfg = TramDagConfig.from_json(&quot;config.json&quot;)</span>
</span><span id="TramDagDataset-90"><a href="#TramDagDataset-90"><span class="linenos"> 90</span></a><span class="sd">    &gt;&gt;&gt; dataset = TramDagDataset.from_dataframe(train_df, cfg, batch_size=1024, debug=True)</span>
</span><span id="TramDagDataset-91"><a href="#TramDagDataset-91"><span class="linenos"> 91</span></a><span class="sd">    &gt;&gt;&gt; dataset.summary()</span>
</span><span id="TramDagDataset-92"><a href="#TramDagDataset-92"><span class="linenos"> 92</span></a><span class="sd">    &gt;&gt;&gt; minmax = dataset.compute_scaling(train_df)</span>
</span><span id="TramDagDataset-93"><a href="#TramDagDataset-93"><span class="linenos"> 93</span></a><span class="sd">    &gt;&gt;&gt; loader = dataset.loaders[&quot;variable_x&quot;]</span>
</span><span id="TramDagDataset-94"><a href="#TramDagDataset-94"><span class="linenos"> 94</span></a><span class="sd">    &gt;&gt;&gt; next(iter(loader))</span>
</span><span id="TramDagDataset-95"><a href="#TramDagDataset-95"><span class="linenos"> 95</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TramDagDataset-96"><a href="#TramDagDataset-96"><span class="linenos"> 96</span></a>
</span><span id="TramDagDataset-97"><a href="#TramDagDataset-97"><span class="linenos"> 97</span></a>    <span class="n">DEFAULTS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TramDagDataset-98"><a href="#TramDagDataset-98"><span class="linenos"> 98</span></a>        <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">32_000</span><span class="p">,</span>
</span><span id="TramDagDataset-99"><a href="#TramDagDataset-99"><span class="linenos"> 99</span></a>        <span class="s2">&quot;shuffle&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TramDagDataset-100"><a href="#TramDagDataset-100"><span class="linenos">100</span></a>        <span class="s2">&quot;num_workers&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="TramDagDataset-101"><a href="#TramDagDataset-101"><span class="linenos">101</span></a>        <span class="s2">&quot;pin_memory&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TramDagDataset-102"><a href="#TramDagDataset-102"><span class="linenos">102</span></a>        <span class="s2">&quot;return_intercept_shift&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TramDagDataset-103"><a href="#TramDagDataset-103"><span class="linenos">103</span></a>        <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TramDagDataset-104"><a href="#TramDagDataset-104"><span class="linenos">104</span></a>        <span class="s2">&quot;transform&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagDataset-105"><a href="#TramDagDataset-105"><span class="linenos">105</span></a>        <span class="s2">&quot;use_dataloader&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TramDagDataset-106"><a href="#TramDagDataset-106"><span class="linenos">106</span></a>        <span class="s2">&quot;use_precomputed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> 
</span><span id="TramDagDataset-107"><a href="#TramDagDataset-107"><span class="linenos">107</span></a>        <span class="c1"># DataLoader extras</span>
</span><span id="TramDagDataset-108"><a href="#TramDagDataset-108"><span class="linenos">108</span></a>        <span class="s2">&quot;sampler&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagDataset-109"><a href="#TramDagDataset-109"><span class="linenos">109</span></a>        <span class="s2">&quot;batch_sampler&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagDataset-110"><a href="#TramDagDataset-110"><span class="linenos">110</span></a>        <span class="s2">&quot;collate_fn&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagDataset-111"><a href="#TramDagDataset-111"><span class="linenos">111</span></a>        <span class="s2">&quot;drop_last&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TramDagDataset-112"><a href="#TramDagDataset-112"><span class="linenos">112</span></a>        <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="TramDagDataset-113"><a href="#TramDagDataset-113"><span class="linenos">113</span></a>        <span class="s2">&quot;worker_init_fn&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagDataset-114"><a href="#TramDagDataset-114"><span class="linenos">114</span></a>        <span class="s2">&quot;multiprocessing_context&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagDataset-115"><a href="#TramDagDataset-115"><span class="linenos">115</span></a>        <span class="s2">&quot;generator&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagDataset-116"><a href="#TramDagDataset-116"><span class="linenos">116</span></a>        <span class="s2">&quot;prefetch_factor&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="TramDagDataset-117"><a href="#TramDagDataset-117"><span class="linenos">117</span></a>        <span class="s2">&quot;persistent_workers&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TramDagDataset-118"><a href="#TramDagDataset-118"><span class="linenos">118</span></a>        <span class="s2">&quot;pin_memory_device&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="TramDagDataset-119"><a href="#TramDagDataset-119"><span class="linenos">119</span></a>    <span class="p">}</span>
</span><span id="TramDagDataset-120"><a href="#TramDagDataset-120"><span class="linenos">120</span></a>
</span><span id="TramDagDataset-121"><a href="#TramDagDataset-121"><span class="linenos">121</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagDataset-122"><a href="#TramDagDataset-122"><span class="linenos">122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagDataset-123"><a href="#TramDagDataset-123"><span class="linenos">123</span></a><span class="sd">        Initialize an empty TramDagDataset shell.</span>
</span><span id="TramDagDataset-124"><a href="#TramDagDataset-124"><span class="linenos">124</span></a>
</span><span id="TramDagDataset-125"><a href="#TramDagDataset-125"><span class="linenos">125</span></a><span class="sd">        Notes</span>
</span><span id="TramDagDataset-126"><a href="#TramDagDataset-126"><span class="linenos">126</span></a><span class="sd">        -----</span>
</span><span id="TramDagDataset-127"><a href="#TramDagDataset-127"><span class="linenos">127</span></a><span class="sd">        This constructor does not attach data or configuration. Use</span>
</span><span id="TramDagDataset-128"><a href="#TramDagDataset-128"><span class="linenos">128</span></a><span class="sd">        `TramDagDataset.from_dataframe` to obtain a ready-to-use instance.</span>
</span><span id="TramDagDataset-129"><a href="#TramDagDataset-129"><span class="linenos">129</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagDataset-130"><a href="#TramDagDataset-130"><span class="linenos">130</span></a>        <span class="k">pass</span>
</span><span id="TramDagDataset-131"><a href="#TramDagDataset-131"><span class="linenos">131</span></a>
</span><span id="TramDagDataset-132"><a href="#TramDagDataset-132"><span class="linenos">132</span></a>    <span class="nd">@classmethod</span>
</span><span id="TramDagDataset-133"><a href="#TramDagDataset-133"><span class="linenos">133</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_dataframe</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TramDagDataset-134"><a href="#TramDagDataset-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagDataset-135"><a href="#TramDagDataset-135"><span class="linenos">135</span></a><span class="sd">        Create a TramDagDataset instance directly from a pandas DataFrame.</span>
</span><span id="TramDagDataset-136"><a href="#TramDagDataset-136"><span class="linenos">136</span></a>
</span><span id="TramDagDataset-137"><a href="#TramDagDataset-137"><span class="linenos">137</span></a><span class="sd">        This classmethod:</span>
</span><span id="TramDagDataset-138"><a href="#TramDagDataset-138"><span class="linenos">138</span></a>
</span><span id="TramDagDataset-139"><a href="#TramDagDataset-139"><span class="linenos">139</span></a><span class="sd">        1. Validates keyword arguments against `DEFAULTS`.</span>
</span><span id="TramDagDataset-140"><a href="#TramDagDataset-140"><span class="linenos">140</span></a><span class="sd">        2. Merges user overrides with defaults into a resolved settings dict.</span>
</span><span id="TramDagDataset-141"><a href="#TramDagDataset-141"><span class="linenos">141</span></a><span class="sd">        3. Stores the configuration and verifies its completeness.</span>
</span><span id="TramDagDataset-142"><a href="#TramDagDataset-142"><span class="linenos">142</span></a><span class="sd">        4. Applies settings to the instance.</span>
</span><span id="TramDagDataset-143"><a href="#TramDagDataset-143"><span class="linenos">143</span></a><span class="sd">        5. Builds per-node datasets and DataLoaders.</span>
</span><span id="TramDagDataset-144"><a href="#TramDagDataset-144"><span class="linenos">144</span></a>
</span><span id="TramDagDataset-145"><a href="#TramDagDataset-145"><span class="linenos">145</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagDataset-146"><a href="#TramDagDataset-146"><span class="linenos">146</span></a><span class="sd">        ----------</span>
</span><span id="TramDagDataset-147"><a href="#TramDagDataset-147"><span class="linenos">147</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="TramDagDataset-148"><a href="#TramDagDataset-148"><span class="linenos">148</span></a><span class="sd">            Input DataFrame containing the dataset.</span>
</span><span id="TramDagDataset-149"><a href="#TramDagDataset-149"><span class="linenos">149</span></a><span class="sd">        cfg : TramDagConfig</span>
</span><span id="TramDagDataset-150"><a href="#TramDagDataset-150"><span class="linenos">150</span></a><span class="sd">            Configuration object defining nodes and variable metadata.</span>
</span><span id="TramDagDataset-151"><a href="#TramDagDataset-151"><span class="linenos">151</span></a><span class="sd">        **kwargs</span>
</span><span id="TramDagDataset-152"><a href="#TramDagDataset-152"><span class="linenos">152</span></a><span class="sd">            Optional overrides for `DEFAULTS`. All keys must exist in</span>
</span><span id="TramDagDataset-153"><a href="#TramDagDataset-153"><span class="linenos">153</span></a><span class="sd">            `TramDagDataset.DEFAULTS`. Common keys include:</span>
</span><span id="TramDagDataset-154"><a href="#TramDagDataset-154"><span class="linenos">154</span></a>
</span><span id="TramDagDataset-155"><a href="#TramDagDataset-155"><span class="linenos">155</span></a><span class="sd">            batch_size : int</span>
</span><span id="TramDagDataset-156"><a href="#TramDagDataset-156"><span class="linenos">156</span></a><span class="sd">                Batch size for DataLoaders.</span>
</span><span id="TramDagDataset-157"><a href="#TramDagDataset-157"><span class="linenos">157</span></a><span class="sd">            shuffle : bool</span>
</span><span id="TramDagDataset-158"><a href="#TramDagDataset-158"><span class="linenos">158</span></a><span class="sd">                Whether to shuffle samples per epoch.</span>
</span><span id="TramDagDataset-159"><a href="#TramDagDataset-159"><span class="linenos">159</span></a><span class="sd">            num_workers : int</span>
</span><span id="TramDagDataset-160"><a href="#TramDagDataset-160"><span class="linenos">160</span></a><span class="sd">                Number of DataLoader workers.</span>
</span><span id="TramDagDataset-161"><a href="#TramDagDataset-161"><span class="linenos">161</span></a><span class="sd">            pin_memory : bool</span>
</span><span id="TramDagDataset-162"><a href="#TramDagDataset-162"><span class="linenos">162</span></a><span class="sd">                Whether to pin memory for faster host-to-device transfers.</span>
</span><span id="TramDagDataset-163"><a href="#TramDagDataset-163"><span class="linenos">163</span></a><span class="sd">            return_intercept_shift : bool</span>
</span><span id="TramDagDataset-164"><a href="#TramDagDataset-164"><span class="linenos">164</span></a><span class="sd">                Whether datasets should return intercept/shift information.</span>
</span><span id="TramDagDataset-165"><a href="#TramDagDataset-165"><span class="linenos">165</span></a><span class="sd">            debug : bool</span>
</span><span id="TramDagDataset-166"><a href="#TramDagDataset-166"><span class="linenos">166</span></a><span class="sd">                Enable debug printing.</span>
</span><span id="TramDagDataset-167"><a href="#TramDagDataset-167"><span class="linenos">167</span></a><span class="sd">            transform : callable or dict or None</span>
</span><span id="TramDagDataset-168"><a href="#TramDagDataset-168"><span class="linenos">168</span></a><span class="sd">                Optional transform(s) applied to samples.</span>
</span><span id="TramDagDataset-169"><a href="#TramDagDataset-169"><span class="linenos">169</span></a><span class="sd">            use_dataloader : bool</span>
</span><span id="TramDagDataset-170"><a href="#TramDagDataset-170"><span class="linenos">170</span></a><span class="sd">                If True, construct DataLoaders; else store raw Dataset objects.</span>
</span><span id="TramDagDataset-171"><a href="#TramDagDataset-171"><span class="linenos">171</span></a><span class="sd">            use_precomputed : bool</span>
</span><span id="TramDagDataset-172"><a href="#TramDagDataset-172"><span class="linenos">172</span></a><span class="sd">                If True, precompute dataset representation to disk and reload it.</span>
</span><span id="TramDagDataset-173"><a href="#TramDagDataset-173"><span class="linenos">173</span></a>
</span><span id="TramDagDataset-174"><a href="#TramDagDataset-174"><span class="linenos">174</span></a><span class="sd">        Returns</span>
</span><span id="TramDagDataset-175"><a href="#TramDagDataset-175"><span class="linenos">175</span></a><span class="sd">        -------</span>
</span><span id="TramDagDataset-176"><a href="#TramDagDataset-176"><span class="linenos">176</span></a><span class="sd">        TramDagDataset</span>
</span><span id="TramDagDataset-177"><a href="#TramDagDataset-177"><span class="linenos">177</span></a><span class="sd">            Initialized dataset instance.</span>
</span><span id="TramDagDataset-178"><a href="#TramDagDataset-178"><span class="linenos">178</span></a>
</span><span id="TramDagDataset-179"><a href="#TramDagDataset-179"><span class="linenos">179</span></a><span class="sd">        Raises</span>
</span><span id="TramDagDataset-180"><a href="#TramDagDataset-180"><span class="linenos">180</span></a><span class="sd">        ------</span>
</span><span id="TramDagDataset-181"><a href="#TramDagDataset-181"><span class="linenos">181</span></a><span class="sd">        TypeError</span>
</span><span id="TramDagDataset-182"><a href="#TramDagDataset-182"><span class="linenos">182</span></a><span class="sd">            If `df` is not a pandas DataFrame.</span>
</span><span id="TramDagDataset-183"><a href="#TramDagDataset-183"><span class="linenos">183</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagDataset-184"><a href="#TramDagDataset-184"><span class="linenos">184</span></a><span class="sd">            If unknown keyword arguments are provided (when validation is enabled).</span>
</span><span id="TramDagDataset-185"><a href="#TramDagDataset-185"><span class="linenos">185</span></a>
</span><span id="TramDagDataset-186"><a href="#TramDagDataset-186"><span class="linenos">186</span></a><span class="sd">        Notes</span>
</span><span id="TramDagDataset-187"><a href="#TramDagDataset-187"><span class="linenos">187</span></a><span class="sd">        -----</span>
</span><span id="TramDagDataset-188"><a href="#TramDagDataset-188"><span class="linenos">188</span></a><span class="sd">        If `shuffle=True` and the inferred variable name of `df` suggests</span>
</span><span id="TramDagDataset-189"><a href="#TramDagDataset-189"><span class="linenos">189</span></a><span class="sd">        validation/test data (e.g. &quot;val&quot;, &quot;test&quot;), a warning is printed.</span>
</span><span id="TramDagDataset-190"><a href="#TramDagDataset-190"><span class="linenos">190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagDataset-191"><a href="#TramDagDataset-191"><span class="linenos">191</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span><span id="TramDagDataset-192"><a href="#TramDagDataset-192"><span class="linenos">192</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="TramDagDataset-193"><a href="#TramDagDataset-193"><span class="linenos">193</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] df must be a pandas DataFrame, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-194"><a href="#TramDagDataset-194"><span class="linenos">194</span></a>
</span><span id="TramDagDataset-195"><a href="#TramDagDataset-195"><span class="linenos">195</span></a>        <span class="c1"># validate kwargs</span>
</span><span id="TramDagDataset-196"><a href="#TramDagDataset-196"><span class="linenos">196</span></a>        <span class="c1"># TODO adjust validation such thath it works when called from tramdagmodel</span>
</span><span id="TramDagDataset-197"><a href="#TramDagDataset-197"><span class="linenos">197</span></a>        <span class="c1">#self._validate_kwargs(kwargs, context=&quot;from_dataframe&quot;)</span>
</span><span id="TramDagDataset-198"><a href="#TramDagDataset-198"><span class="linenos">198</span></a>        
</span><span id="TramDagDataset-199"><a href="#TramDagDataset-199"><span class="linenos">199</span></a>        <span class="c1"># merge defaults with overrides</span>
</span><span id="TramDagDataset-200"><a href="#TramDagDataset-200"><span class="linenos">200</span></a>        <span class="n">settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">DEFAULTS</span><span class="p">)</span>
</span><span id="TramDagDataset-201"><a href="#TramDagDataset-201"><span class="linenos">201</span></a>        <span class="n">settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TramDagDataset-202"><a href="#TramDagDataset-202"><span class="linenos">202</span></a>
</span><span id="TramDagDataset-203"><a href="#TramDagDataset-203"><span class="linenos">203</span></a>        <span class="c1"># store config and verify</span>
</span><span id="TramDagDataset-204"><a href="#TramDagDataset-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span>
</span><span id="TramDagDataset-205"><a href="#TramDagDataset-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">_verify_completeness</span><span class="p">()</span>
</span><span id="TramDagDataset-206"><a href="#TramDagDataset-206"><span class="linenos">206</span></a>
</span><span id="TramDagDataset-207"><a href="#TramDagDataset-207"><span class="linenos">207</span></a>        <span class="c1"># ouptu all setttings if debug</span>
</span><span id="TramDagDataset-208"><a href="#TramDagDataset-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagDataset-209"><a href="#TramDagDataset-209"><span class="linenos">209</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] TramDagDataset.from_dataframe() settings (after defaults + overrides):&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-210"><a href="#TramDagDataset-210"><span class="linenos">210</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagDataset-211"><a href="#TramDagDataset-211"><span class="linenos">211</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-212"><a href="#TramDagDataset-212"><span class="linenos">212</span></a>
</span><span id="TramDagDataset-213"><a href="#TramDagDataset-213"><span class="linenos">213</span></a>        <span class="c1"># infer variable name automatically</span>
</span><span id="TramDagDataset-214"><a href="#TramDagDataset-214"><span class="linenos">214</span></a>        <span class="n">callers_locals</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_locals</span>
</span><span id="TramDagDataset-215"><a href="#TramDagDataset-215"><span class="linenos">215</span></a>        <span class="n">inferred</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagDataset-216"><a href="#TramDagDataset-216"><span class="linenos">216</span></a>        <span class="k">for</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">var_val</span> <span class="ow">in</span> <span class="n">callers_locals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagDataset-217"><a href="#TramDagDataset-217"><span class="linenos">217</span></a>            <span class="k">if</span> <span class="n">var_val</span> <span class="ow">is</span> <span class="n">df</span><span class="p">:</span>
</span><span id="TramDagDataset-218"><a href="#TramDagDataset-218"><span class="linenos">218</span></a>                <span class="n">inferred</span> <span class="o">=</span> <span class="n">var_name</span>
</span><span id="TramDagDataset-219"><a href="#TramDagDataset-219"><span class="linenos">219</span></a>                <span class="k">break</span>
</span><span id="TramDagDataset-220"><a href="#TramDagDataset-220"><span class="linenos">220</span></a>        <span class="n">df_name</span> <span class="o">=</span> <span class="n">inferred</span> <span class="ow">or</span> <span class="s2">&quot;dataframe&quot;</span>
</span><span id="TramDagDataset-221"><a href="#TramDagDataset-221"><span class="linenos">221</span></a>
</span><span id="TramDagDataset-222"><a href="#TramDagDataset-222"><span class="linenos">222</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;shuffle&quot;</span><span class="p">]:</span>
</span><span id="TramDagDataset-223"><a href="#TramDagDataset-223"><span class="linenos">223</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">df_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="s2">&quot;validation&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">]):</span>
</span><span id="TramDagDataset-224"><a href="#TramDagDataset-224"><span class="linenos">224</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] DataFrame &#39;</span><span class="si">{</span><span class="n">df_name</span><span class="si">}</span><span class="s2">&#39; looks like a validation/test set  shuffle=True. Are you sure?&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-225"><a href="#TramDagDataset-225"><span class="linenos">225</span></a>
</span><span id="TramDagDataset-226"><a href="#TramDagDataset-226"><span class="linenos">226</span></a>        <span class="c1"># call again to ensure Warning messages if ordinal vars have missing levels</span>
</span><span id="TramDagDataset-227"><a href="#TramDagDataset-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TramDagDataset-228"><a href="#TramDagDataset-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="TramDagDataset-229"><a href="#TramDagDataset-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_build_dataloaders</span><span class="p">()</span>
</span><span id="TramDagDataset-230"><a href="#TramDagDataset-230"><span class="linenos">230</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="TramDagDataset-231"><a href="#TramDagDataset-231"><span class="linenos">231</span></a>
</span><span id="TramDagDataset-232"><a href="#TramDagDataset-232"><span class="linenos">232</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">write</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="TramDagDataset-233"><a href="#TramDagDataset-233"><span class="linenos">233</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagDataset-234"><a href="#TramDagDataset-234"><span class="linenos">234</span></a><span class="sd">        Compute variable-wise scaling parameters from data.</span>
</span><span id="TramDagDataset-235"><a href="#TramDagDataset-235"><span class="linenos">235</span></a>
</span><span id="TramDagDataset-236"><a href="#TramDagDataset-236"><span class="linenos">236</span></a><span class="sd">        Per variable, this method computes approximate minimum and maximum</span>
</span><span id="TramDagDataset-237"><a href="#TramDagDataset-237"><span class="linenos">237</span></a><span class="sd">        values using the 5th and 95th percentiles. This is typically used</span>
</span><span id="TramDagDataset-238"><a href="#TramDagDataset-238"><span class="linenos">238</span></a><span class="sd">        to derive robust normalization/clipping ranges from training data.</span>
</span><span id="TramDagDataset-239"><a href="#TramDagDataset-239"><span class="linenos">239</span></a>
</span><span id="TramDagDataset-240"><a href="#TramDagDataset-240"><span class="linenos">240</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagDataset-241"><a href="#TramDagDataset-241"><span class="linenos">241</span></a><span class="sd">        ----------</span>
</span><span id="TramDagDataset-242"><a href="#TramDagDataset-242"><span class="linenos">242</span></a><span class="sd">        df : pandas.DataFrame or None, optional</span>
</span><span id="TramDagDataset-243"><a href="#TramDagDataset-243"><span class="linenos">243</span></a><span class="sd">            DataFrame used to compute scaling. If None, `self.df` is used.</span>
</span><span id="TramDagDataset-244"><a href="#TramDagDataset-244"><span class="linenos">244</span></a><span class="sd">        write : bool, optional</span>
</span><span id="TramDagDataset-245"><a href="#TramDagDataset-245"><span class="linenos">245</span></a><span class="sd">            Unused placeholder for interface compatibility with other components.</span>
</span><span id="TramDagDataset-246"><a href="#TramDagDataset-246"><span class="linenos">246</span></a><span class="sd">            Kept for potential future extensions. Default is True.</span>
</span><span id="TramDagDataset-247"><a href="#TramDagDataset-247"><span class="linenos">247</span></a>
</span><span id="TramDagDataset-248"><a href="#TramDagDataset-248"><span class="linenos">248</span></a><span class="sd">        Returns</span>
</span><span id="TramDagDataset-249"><a href="#TramDagDataset-249"><span class="linenos">249</span></a><span class="sd">        -------</span>
</span><span id="TramDagDataset-250"><a href="#TramDagDataset-250"><span class="linenos">250</span></a><span class="sd">        dict</span>
</span><span id="TramDagDataset-251"><a href="#TramDagDataset-251"><span class="linenos">251</span></a><span class="sd">            Mapping `{column_name: [min_value, max_value]}`, where values</span>
</span><span id="TramDagDataset-252"><a href="#TramDagDataset-252"><span class="linenos">252</span></a><span class="sd">            are derived from the 0.05 and 0.95 quantiles.</span>
</span><span id="TramDagDataset-253"><a href="#TramDagDataset-253"><span class="linenos">253</span></a>
</span><span id="TramDagDataset-254"><a href="#TramDagDataset-254"><span class="linenos">254</span></a><span class="sd">        Notes</span>
</span><span id="TramDagDataset-255"><a href="#TramDagDataset-255"><span class="linenos">255</span></a><span class="sd">        -----</span>
</span><span id="TramDagDataset-256"><a href="#TramDagDataset-256"><span class="linenos">256</span></a><span class="sd">        If `self.debug` is True, the method emits debug messages about the</span>
</span><span id="TramDagDataset-257"><a href="#TramDagDataset-257"><span class="linenos">257</span></a><span class="sd">        data source. Only training data should be used to avoid leakage.</span>
</span><span id="TramDagDataset-258"><a href="#TramDagDataset-258"><span class="linenos">258</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagDataset-259"><a href="#TramDagDataset-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagDataset-260"><a href="#TramDagDataset-260"><span class="linenos">260</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Make sure to provide only training data to compute_scaling!&quot;</span><span class="p">)</span>     
</span><span id="TramDagDataset-261"><a href="#TramDagDataset-261"><span class="linenos">261</span></a>        <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagDataset-262"><a href="#TramDagDataset-262"><span class="linenos">262</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>
</span><span id="TramDagDataset-263"><a href="#TramDagDataset-263"><span class="linenos">263</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagDataset-264"><a href="#TramDagDataset-264"><span class="linenos">264</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] No DataFrame provided, using internal df.&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-265"><a href="#TramDagDataset-265"><span class="linenos">265</span></a>        <span class="n">quantiles</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">quantile</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>
</span><span id="TramDagDataset-266"><a href="#TramDagDataset-266"><span class="linenos">266</span></a>        <span class="n">min_vals</span> <span class="o">=</span> <span class="n">quantiles</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">0.05</span><span class="p">]</span>
</span><span id="TramDagDataset-267"><a href="#TramDagDataset-267"><span class="linenos">267</span></a>        <span class="n">max_vals</span> <span class="o">=</span> <span class="n">quantiles</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">0.95</span><span class="p">]</span>
</span><span id="TramDagDataset-268"><a href="#TramDagDataset-268"><span class="linenos">268</span></a>        <span class="n">minmax_dict</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">min_vals</span><span class="p">,</span> <span class="n">max_vals</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">)</span>
</span><span id="TramDagDataset-269"><a href="#TramDagDataset-269"><span class="linenos">269</span></a>        <span class="k">return</span> <span class="n">minmax_dict</span>
</span><span id="TramDagDataset-270"><a href="#TramDagDataset-270"><span class="linenos">270</span></a>
</span><span id="TramDagDataset-271"><a href="#TramDagDataset-271"><span class="linenos">271</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagDataset-272"><a href="#TramDagDataset-272"><span class="linenos">272</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagDataset-273"><a href="#TramDagDataset-273"><span class="linenos">273</span></a><span class="sd">        Print a structured overview of the dataset and configuration.</span>
</span><span id="TramDagDataset-274"><a href="#TramDagDataset-274"><span class="linenos">274</span></a>
</span><span id="TramDagDataset-275"><a href="#TramDagDataset-275"><span class="linenos">275</span></a><span class="sd">        The summary includes:</span>
</span><span id="TramDagDataset-276"><a href="#TramDagDataset-276"><span class="linenos">276</span></a>
</span><span id="TramDagDataset-277"><a href="#TramDagDataset-277"><span class="linenos">277</span></a><span class="sd">        1. DataFrame information:</span>
</span><span id="TramDagDataset-278"><a href="#TramDagDataset-278"><span class="linenos">278</span></a><span class="sd">        - Shape</span>
</span><span id="TramDagDataset-279"><a href="#TramDagDataset-279"><span class="linenos">279</span></a><span class="sd">        - Columns</span>
</span><span id="TramDagDataset-280"><a href="#TramDagDataset-280"><span class="linenos">280</span></a><span class="sd">        - Head (first rows)</span>
</span><span id="TramDagDataset-281"><a href="#TramDagDataset-281"><span class="linenos">281</span></a><span class="sd">        - Dtypes</span>
</span><span id="TramDagDataset-282"><a href="#TramDagDataset-282"><span class="linenos">282</span></a><span class="sd">        - Descriptive statistics</span>
</span><span id="TramDagDataset-283"><a href="#TramDagDataset-283"><span class="linenos">283</span></a>
</span><span id="TramDagDataset-284"><a href="#TramDagDataset-284"><span class="linenos">284</span></a><span class="sd">        2. Configuration overview:</span>
</span><span id="TramDagDataset-285"><a href="#TramDagDataset-285"><span class="linenos">285</span></a><span class="sd">        - Number of nodes</span>
</span><span id="TramDagDataset-286"><a href="#TramDagDataset-286"><span class="linenos">286</span></a><span class="sd">        - Loader mode (DataLoader vs. raw Dataset)</span>
</span><span id="TramDagDataset-287"><a href="#TramDagDataset-287"><span class="linenos">287</span></a><span class="sd">        - Precomputation status</span>
</span><span id="TramDagDataset-288"><a href="#TramDagDataset-288"><span class="linenos">288</span></a>
</span><span id="TramDagDataset-289"><a href="#TramDagDataset-289"><span class="linenos">289</span></a><span class="sd">        3. Node settings:</span>
</span><span id="TramDagDataset-290"><a href="#TramDagDataset-290"><span class="linenos">290</span></a><span class="sd">        - Batch size</span>
</span><span id="TramDagDataset-291"><a href="#TramDagDataset-291"><span class="linenos">291</span></a><span class="sd">        - Shuffle flag</span>
</span><span id="TramDagDataset-292"><a href="#TramDagDataset-292"><span class="linenos">292</span></a><span class="sd">        - num_workers</span>
</span><span id="TramDagDataset-293"><a href="#TramDagDataset-293"><span class="linenos">293</span></a><span class="sd">        - pin_memory</span>
</span><span id="TramDagDataset-294"><a href="#TramDagDataset-294"><span class="linenos">294</span></a><span class="sd">        - return_intercept_shift</span>
</span><span id="TramDagDataset-295"><a href="#TramDagDataset-295"><span class="linenos">295</span></a><span class="sd">        - debug</span>
</span><span id="TramDagDataset-296"><a href="#TramDagDataset-296"><span class="linenos">296</span></a><span class="sd">        - transform</span>
</span><span id="TramDagDataset-297"><a href="#TramDagDataset-297"><span class="linenos">297</span></a>
</span><span id="TramDagDataset-298"><a href="#TramDagDataset-298"><span class="linenos">298</span></a><span class="sd">        4. DataLoader overview:</span>
</span><span id="TramDagDataset-299"><a href="#TramDagDataset-299"><span class="linenos">299</span></a><span class="sd">        - Type and length of each loader.</span>
</span><span id="TramDagDataset-300"><a href="#TramDagDataset-300"><span class="linenos">300</span></a>
</span><span id="TramDagDataset-301"><a href="#TramDagDataset-301"><span class="linenos">301</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagDataset-302"><a href="#TramDagDataset-302"><span class="linenos">302</span></a><span class="sd">        ----------</span>
</span><span id="TramDagDataset-303"><a href="#TramDagDataset-303"><span class="linenos">303</span></a><span class="sd">        None</span>
</span><span id="TramDagDataset-304"><a href="#TramDagDataset-304"><span class="linenos">304</span></a>
</span><span id="TramDagDataset-305"><a href="#TramDagDataset-305"><span class="linenos">305</span></a><span class="sd">        Returns</span>
</span><span id="TramDagDataset-306"><a href="#TramDagDataset-306"><span class="linenos">306</span></a><span class="sd">        -------</span>
</span><span id="TramDagDataset-307"><a href="#TramDagDataset-307"><span class="linenos">307</span></a><span class="sd">        None</span>
</span><span id="TramDagDataset-308"><a href="#TramDagDataset-308"><span class="linenos">308</span></a>
</span><span id="TramDagDataset-309"><a href="#TramDagDataset-309"><span class="linenos">309</span></a><span class="sd">        Notes</span>
</span><span id="TramDagDataset-310"><a href="#TramDagDataset-310"><span class="linenos">310</span></a><span class="sd">        -----</span>
</span><span id="TramDagDataset-311"><a href="#TramDagDataset-311"><span class="linenos">311</span></a><span class="sd">        Intended for quick inspection and debugging. Uses `print` statements</span>
</span><span id="TramDagDataset-312"><a href="#TramDagDataset-312"><span class="linenos">312</span></a><span class="sd">        and does not return structured metadata.</span>
</span><span id="TramDagDataset-313"><a href="#TramDagDataset-313"><span class="linenos">313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagDataset-314"><a href="#TramDagDataset-314"><span class="linenos">314</span></a>        
</span><span id="TramDagDataset-315"><a href="#TramDagDataset-315"><span class="linenos">315</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[TramDagDataset Summary]&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-316"><a href="#TramDagDataset-316"><span class="linenos">316</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="TramDagDataset-317"><a href="#TramDagDataset-317"><span class="linenos">317</span></a>
</span><span id="TramDagDataset-318"><a href="#TramDagDataset-318"><span class="linenos">318</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[DataFrame]&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-319"><a href="#TramDagDataset-319"><span class="linenos">319</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shape:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="TramDagDataset-320"><a href="#TramDagDataset-320"><span class="linenos">320</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Columns:&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
</span><span id="TramDagDataset-321"><a href="#TramDagDataset-321"><span class="linenos">321</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Head:&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-322"><a href="#TramDagDataset-322"><span class="linenos">322</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span><span id="TramDagDataset-323"><a href="#TramDagDataset-323"><span class="linenos">323</span></a>
</span><span id="TramDagDataset-324"><a href="#TramDagDataset-324"><span class="linenos">324</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Dtypes:&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-325"><a href="#TramDagDataset-325"><span class="linenos">325</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</span><span id="TramDagDataset-326"><a href="#TramDagDataset-326"><span class="linenos">326</span></a>
</span><span id="TramDagDataset-327"><a href="#TramDagDataset-327"><span class="linenos">327</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Describe:&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-328"><a href="#TramDagDataset-328"><span class="linenos">328</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">))</span>
</span><span id="TramDagDataset-329"><a href="#TramDagDataset-329"><span class="linenos">329</span></a>
</span><span id="TramDagDataset-330"><a href="#TramDagDataset-330"><span class="linenos">330</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Configuration]&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-331"><a href="#TramDagDataset-331"><span class="linenos">331</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nodes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-332"><a href="#TramDagDataset-332"><span class="linenos">332</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loader mode: </span><span class="si">{</span><span class="s1">&#39;DataLoader&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">use_dataloader</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Direct dataset&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-333"><a href="#TramDagDataset-333"><span class="linenos">333</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Precomputed: </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;use_precomputed&#39;</span><span class="p">,</span><span class="w"> </span><span class="kc">False</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-334"><a href="#TramDagDataset-334"><span class="linenos">334</span></a>
</span><span id="TramDagDataset-335"><a href="#TramDagDataset-335"><span class="linenos">335</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Node Settings]&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-336"><a href="#TramDagDataset-336"><span class="linenos">336</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TramDagDataset-337"><a href="#TramDagDataset-337"><span class="linenos">337</span></a>            <span class="n">batch_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span>
</span><span id="TramDagDataset-338"><a href="#TramDagDataset-338"><span class="linenos">338</span></a>            <span class="n">shuffle_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span>
</span><span id="TramDagDataset-339"><a href="#TramDagDataset-339"><span class="linenos">339</span></a>            <span class="n">num_workers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span>
</span><span id="TramDagDataset-340"><a href="#TramDagDataset-340"><span class="linenos">340</span></a>            <span class="n">pin_memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pin_memory</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pin_memory</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">pin_memory</span>
</span><span id="TramDagDataset-341"><a href="#TramDagDataset-341"><span class="linenos">341</span></a>            <span class="n">rshift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_intercept_shift</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">return_intercept_shift</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_intercept_shift</span>
</span><span id="TramDagDataset-342"><a href="#TramDagDataset-342"><span class="linenos">342</span></a>            <span class="n">debug_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span>
</span><span id="TramDagDataset-343"><a href="#TramDagDataset-343"><span class="linenos">343</span></a>            <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span>
</span><span id="TramDagDataset-344"><a href="#TramDagDataset-344"><span class="linenos">344</span></a>
</span><span id="TramDagDataset-345"><a href="#TramDagDataset-345"><span class="linenos">345</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="TramDagDataset-346"><a href="#TramDagDataset-346"><span class="linenos">346</span></a>                <span class="sa">f</span><span class="s2">&quot; Node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;: &quot;</span>
</span><span id="TramDagDataset-347"><a href="#TramDagDataset-347"><span class="linenos">347</span></a>                <span class="sa">f</span><span class="s2">&quot;batch_size=</span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="TramDagDataset-348"><a href="#TramDagDataset-348"><span class="linenos">348</span></a>                <span class="sa">f</span><span class="s2">&quot;shuffle=</span><span class="si">{</span><span class="n">shuffle_flag</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="TramDagDataset-349"><a href="#TramDagDataset-349"><span class="linenos">349</span></a>                <span class="sa">f</span><span class="s2">&quot;num_workers=</span><span class="si">{</span><span class="n">num_workers</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="TramDagDataset-350"><a href="#TramDagDataset-350"><span class="linenos">350</span></a>                <span class="sa">f</span><span class="s2">&quot;pin_memory=</span><span class="si">{</span><span class="n">pin_memory</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="TramDagDataset-351"><a href="#TramDagDataset-351"><span class="linenos">351</span></a>                <span class="sa">f</span><span class="s2">&quot;return_intercept_shift=</span><span class="si">{</span><span class="n">rshift</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="TramDagDataset-352"><a href="#TramDagDataset-352"><span class="linenos">352</span></a>                <span class="sa">f</span><span class="s2">&quot;debug=</span><span class="si">{</span><span class="n">debug_flag</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="TramDagDataset-353"><a href="#TramDagDataset-353"><span class="linenos">353</span></a>                <span class="sa">f</span><span class="s2">&quot;transform=</span><span class="si">{</span><span class="n">transform</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="TramDagDataset-354"><a href="#TramDagDataset-354"><span class="linenos">354</span></a>            <span class="p">)</span>
</span><span id="TramDagDataset-355"><a href="#TramDagDataset-355"><span class="linenos">355</span></a>
</span><span id="TramDagDataset-356"><a href="#TramDagDataset-356"><span class="linenos">356</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;loaders&quot;</span><span class="p">):</span>
</span><span id="TramDagDataset-357"><a href="#TramDagDataset-357"><span class="linenos">357</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[DataLoaders]&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-358"><a href="#TramDagDataset-358"><span class="linenos">358</span></a>            <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">loader</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaders</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagDataset-359"><a href="#TramDagDataset-359"><span class="linenos">359</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagDataset-360"><a href="#TramDagDataset-360"><span class="linenos">360</span></a>                    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="p">)</span>
</span><span id="TramDagDataset-361"><a href="#TramDagDataset-361"><span class="linenos">361</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="TramDagDataset-362"><a href="#TramDagDataset-362"><span class="linenos">362</span></a>                    <span class="n">length</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span>
</span><span id="TramDagDataset-363"><a href="#TramDagDataset-363"><span class="linenos">363</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">loader</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">, len=</span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-364"><a href="#TramDagDataset-364"><span class="linenos">364</span></a>
</span><span id="TramDagDataset-365"><a href="#TramDagDataset-365"><span class="linenos">365</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-366"><a href="#TramDagDataset-366"><span class="linenos">366</span></a>
</span><span id="TramDagDataset-367"><a href="#TramDagDataset-367"><span class="linenos">367</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">defaults_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DEFAULTS&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagDataset-368"><a href="#TramDagDataset-368"><span class="linenos">368</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagDataset-369"><a href="#TramDagDataset-369"><span class="linenos">369</span></a><span class="sd">        Validate keyword arguments against a defaults dictionary.</span>
</span><span id="TramDagDataset-370"><a href="#TramDagDataset-370"><span class="linenos">370</span></a>
</span><span id="TramDagDataset-371"><a href="#TramDagDataset-371"><span class="linenos">371</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagDataset-372"><a href="#TramDagDataset-372"><span class="linenos">372</span></a><span class="sd">        ----------</span>
</span><span id="TramDagDataset-373"><a href="#TramDagDataset-373"><span class="linenos">373</span></a><span class="sd">        kwargs : dict</span>
</span><span id="TramDagDataset-374"><a href="#TramDagDataset-374"><span class="linenos">374</span></a><span class="sd">            Keyword arguments to validate.</span>
</span><span id="TramDagDataset-375"><a href="#TramDagDataset-375"><span class="linenos">375</span></a><span class="sd">        defaults_attr : str, optional</span>
</span><span id="TramDagDataset-376"><a href="#TramDagDataset-376"><span class="linenos">376</span></a><span class="sd">            Name of the attribute on this class containing the default keys</span>
</span><span id="TramDagDataset-377"><a href="#TramDagDataset-377"><span class="linenos">377</span></a><span class="sd">            (e.g. &quot;DEFAULTS&quot;). Default is &quot;DEFAULTS&quot;.</span>
</span><span id="TramDagDataset-378"><a href="#TramDagDataset-378"><span class="linenos">378</span></a><span class="sd">        context : str or None, optional</span>
</span><span id="TramDagDataset-379"><a href="#TramDagDataset-379"><span class="linenos">379</span></a><span class="sd">            Optional context label (e.g. caller name) included in error messages.</span>
</span><span id="TramDagDataset-380"><a href="#TramDagDataset-380"><span class="linenos">380</span></a>
</span><span id="TramDagDataset-381"><a href="#TramDagDataset-381"><span class="linenos">381</span></a><span class="sd">        Raises</span>
</span><span id="TramDagDataset-382"><a href="#TramDagDataset-382"><span class="linenos">382</span></a><span class="sd">        ------</span>
</span><span id="TramDagDataset-383"><a href="#TramDagDataset-383"><span class="linenos">383</span></a><span class="sd">        AttributeError</span>
</span><span id="TramDagDataset-384"><a href="#TramDagDataset-384"><span class="linenos">384</span></a><span class="sd">            If the attribute named by `defaults_attr` does not exist.</span>
</span><span id="TramDagDataset-385"><a href="#TramDagDataset-385"><span class="linenos">385</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagDataset-386"><a href="#TramDagDataset-386"><span class="linenos">386</span></a><span class="sd">            If any keys in `kwargs` are not present in the defaults dictionary.</span>
</span><span id="TramDagDataset-387"><a href="#TramDagDataset-387"><span class="linenos">387</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagDataset-388"><a href="#TramDagDataset-388"><span class="linenos">388</span></a>        <span class="n">defaults</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defaults_attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="TramDagDataset-389"><a href="#TramDagDataset-389"><span class="linenos">389</span></a>        <span class="k">if</span> <span class="n">defaults</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagDataset-390"><a href="#TramDagDataset-390"><span class="linenos">390</span></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> has no attribute &#39;</span><span class="si">{</span><span class="n">defaults_attr</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-391"><a href="#TramDagDataset-391"><span class="linenos">391</span></a>
</span><span id="TramDagDataset-392"><a href="#TramDagDataset-392"><span class="linenos">392</span></a>        <span class="n">unknown</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>
</span><span id="TramDagDataset-393"><a href="#TramDagDataset-393"><span class="linenos">393</span></a>        <span class="k">if</span> <span class="n">unknown</span><span class="p">:</span>
</span><span id="TramDagDataset-394"><a href="#TramDagDataset-394"><span class="linenos">394</span></a>            <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">] &quot;</span> <span class="k">if</span> <span class="n">context</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="TramDagDataset-395"><a href="#TramDagDataset-395"><span class="linenos">395</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">Unknown parameter(s): </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">unknown</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-396"><a href="#TramDagDataset-396"><span class="linenos">396</span></a>
</span><span id="TramDagDataset-397"><a href="#TramDagDataset-397"><span class="linenos">397</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="TramDagDataset-398"><a href="#TramDagDataset-398"><span class="linenos">398</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagDataset-399"><a href="#TramDagDataset-399"><span class="linenos">399</span></a><span class="sd">        Apply resolved settings to the dataset instance.</span>
</span><span id="TramDagDataset-400"><a href="#TramDagDataset-400"><span class="linenos">400</span></a>
</span><span id="TramDagDataset-401"><a href="#TramDagDataset-401"><span class="linenos">401</span></a><span class="sd">        This method:</span>
</span><span id="TramDagDataset-402"><a href="#TramDagDataset-402"><span class="linenos">402</span></a>
</span><span id="TramDagDataset-403"><a href="#TramDagDataset-403"><span class="linenos">403</span></a><span class="sd">        1. Stores all keyvalue pairs from `settings` as attributes on `self`.</span>
</span><span id="TramDagDataset-404"><a href="#TramDagDataset-404"><span class="linenos">404</span></a><span class="sd">        2. Extracts `nodes_dict` from the configuration.</span>
</span><span id="TramDagDataset-405"><a href="#TramDagDataset-405"><span class="linenos">405</span></a><span class="sd">        3. Validates that dict-valued core attributes (batch_size, shuffle, etc.)</span>
</span><span id="TramDagDataset-406"><a href="#TramDagDataset-406"><span class="linenos">406</span></a><span class="sd">        have keys matching the node set.</span>
</span><span id="TramDagDataset-407"><a href="#TramDagDataset-407"><span class="linenos">407</span></a>
</span><span id="TramDagDataset-408"><a href="#TramDagDataset-408"><span class="linenos">408</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagDataset-409"><a href="#TramDagDataset-409"><span class="linenos">409</span></a><span class="sd">        ----------</span>
</span><span id="TramDagDataset-410"><a href="#TramDagDataset-410"><span class="linenos">410</span></a><span class="sd">        settings : dict</span>
</span><span id="TramDagDataset-411"><a href="#TramDagDataset-411"><span class="linenos">411</span></a><span class="sd">            Resolved settings dictionary, usually built from `DEFAULTS` plus</span>
</span><span id="TramDagDataset-412"><a href="#TramDagDataset-412"><span class="linenos">412</span></a><span class="sd">            user overrides.</span>
</span><span id="TramDagDataset-413"><a href="#TramDagDataset-413"><span class="linenos">413</span></a>
</span><span id="TramDagDataset-414"><a href="#TramDagDataset-414"><span class="linenos">414</span></a><span class="sd">        Returns</span>
</span><span id="TramDagDataset-415"><a href="#TramDagDataset-415"><span class="linenos">415</span></a><span class="sd">        -------</span>
</span><span id="TramDagDataset-416"><a href="#TramDagDataset-416"><span class="linenos">416</span></a><span class="sd">        None</span>
</span><span id="TramDagDataset-417"><a href="#TramDagDataset-417"><span class="linenos">417</span></a>
</span><span id="TramDagDataset-418"><a href="#TramDagDataset-418"><span class="linenos">418</span></a><span class="sd">        Raises</span>
</span><span id="TramDagDataset-419"><a href="#TramDagDataset-419"><span class="linenos">419</span></a><span class="sd">        ------</span>
</span><span id="TramDagDataset-420"><a href="#TramDagDataset-420"><span class="linenos">420</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagDataset-421"><a href="#TramDagDataset-421"><span class="linenos">421</span></a><span class="sd">            If any dict-valued core attribute has keys that do not match</span>
</span><span id="TramDagDataset-422"><a href="#TramDagDataset-422"><span class="linenos">422</span></a><span class="sd">            `cfg.conf_dict[&quot;nodes&quot;].keys()`.</span>
</span><span id="TramDagDataset-423"><a href="#TramDagDataset-423"><span class="linenos">423</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagDataset-424"><a href="#TramDagDataset-424"><span class="linenos">424</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagDataset-425"><a href="#TramDagDataset-425"><span class="linenos">425</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="TramDagDataset-426"><a href="#TramDagDataset-426"><span class="linenos">426</span></a>
</span><span id="TramDagDataset-427"><a href="#TramDagDataset-427"><span class="linenos">427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span>
</span><span id="TramDagDataset-428"><a href="#TramDagDataset-428"><span class="linenos">428</span></a>
</span><span id="TramDagDataset-429"><a href="#TramDagDataset-429"><span class="linenos">429</span></a>        <span class="c1"># validate only the most important ones</span>
</span><span id="TramDagDataset-430"><a href="#TramDagDataset-430"><span class="linenos">430</span></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;batch_size&quot;</span><span class="p">,</span> <span class="s2">&quot;shuffle&quot;</span><span class="p">,</span> <span class="s2">&quot;num_workers&quot;</span><span class="p">,</span> <span class="s2">&quot;pin_memory&quot;</span><span class="p">,</span>
</span><span id="TramDagDataset-431"><a href="#TramDagDataset-431"><span class="linenos">431</span></a>                     <span class="s2">&quot;return_intercept_shift&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="s2">&quot;transform&quot;</span><span class="p">]:</span>
</span><span id="TramDagDataset-432"><a href="#TramDagDataset-432"><span class="linenos">432</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_keys</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
</span><span id="TramDagDataset-433"><a href="#TramDagDataset-433"><span class="linenos">433</span></a>
</span><span id="TramDagDataset-434"><a href="#TramDagDataset-434"><span class="linenos">434</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_build_dataloaders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagDataset-435"><a href="#TramDagDataset-435"><span class="linenos">435</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Build node-specific dataloaders or raw datasets depending on settings.&quot;&quot;&quot;</span>
</span><span id="TramDagDataset-436"><a href="#TramDagDataset-436"><span class="linenos">436</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loaders</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagDataset-437"><a href="#TramDagDataset-437"><span class="linenos">437</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">:</span>
</span><span id="TramDagDataset-438"><a href="#TramDagDataset-438"><span class="linenos">438</span></a>            <span class="n">ds</span> <span class="o">=</span> <span class="n">GenericDataset</span><span class="p">(</span>
</span><span id="TramDagDataset-439"><a href="#TramDagDataset-439"><span class="linenos">439</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span>
</span><span id="TramDagDataset-440"><a href="#TramDagDataset-440"><span class="linenos">440</span></a>                <span class="n">target_col</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
</span><span id="TramDagDataset-441"><a href="#TramDagDataset-441"><span class="linenos">441</span></a>                <span class="n">target_nodes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">,</span>
</span><span id="TramDagDataset-442"><a href="#TramDagDataset-442"><span class="linenos">442</span></a>                <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">[</span><span class="n">node</span><span class="p">],</span>
</span><span id="TramDagDataset-443"><a href="#TramDagDataset-443"><span class="linenos">443</span></a>                <span class="n">return_intercept_shift</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">return_intercept_shift</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">return_intercept_shift</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_intercept_shift</span><span class="p">[</span><span class="n">node</span><span class="p">],</span>
</span><span id="TramDagDataset-444"><a href="#TramDagDataset-444"><span class="linenos">444</span></a>                <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">[</span><span class="n">node</span><span class="p">],</span>
</span><span id="TramDagDataset-445"><a href="#TramDagDataset-445"><span class="linenos">445</span></a>            <span class="p">)</span>
</span><span id="TramDagDataset-446"><a href="#TramDagDataset-446"><span class="linenos">446</span></a>
</span><span id="TramDagDataset-447"><a href="#TramDagDataset-447"><span class="linenos">447</span></a>        <span class="c1">########## QUICK PATCH </span>
</span><span id="TramDagDataset-448"><a href="#TramDagDataset-448"><span class="linenos">448</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;use_precomputed&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_precomputed</span><span class="p">:</span>
</span><span id="TramDagDataset-449"><a href="#TramDagDataset-449"><span class="linenos">449</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;temp&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
</span><span id="TramDagDataset-450"><a href="#TramDagDataset-450"><span class="linenos">450</span></a>                <span class="n">pth</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;temp&quot;</span><span class="p">,</span> <span class="s2">&quot;precomputed.pt&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-451"><a href="#TramDagDataset-451"><span class="linenos">451</span></a>
</span><span id="TramDagDataset-452"><a href="#TramDagDataset-452"><span class="linenos">452</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="s2">&quot;save_precomputed&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="s2">&quot;save_precomputed&quot;</span><span class="p">)):</span>
</span><span id="TramDagDataset-453"><a href="#TramDagDataset-453"><span class="linenos">453</span></a>                    <span class="n">ds</span><span class="o">.</span><span class="n">save_precomputed</span><span class="p">(</span><span class="n">pth</span><span class="p">)</span>
</span><span id="TramDagDataset-454"><a href="#TramDagDataset-454"><span class="linenos">454</span></a>                    <span class="n">ds</span> <span class="o">=</span> <span class="n">GenericDatasetPrecomputed</span><span class="p">(</span><span class="n">pth</span><span class="p">)</span>
</span><span id="TramDagDataset-455"><a href="#TramDagDataset-455"><span class="linenos">455</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagDataset-456"><a href="#TramDagDataset-456"><span class="linenos">456</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] Dataset has no &#39;save_precomputed()&#39; method  skipping precomputation.&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-457"><a href="#TramDagDataset-457"><span class="linenos">457</span></a>
</span><span id="TramDagDataset-458"><a href="#TramDagDataset-458"><span class="linenos">458</span></a>
</span><span id="TramDagDataset-459"><a href="#TramDagDataset-459"><span class="linenos">459</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_dataloader</span><span class="p">:</span>
</span><span id="TramDagDataset-460"><a href="#TramDagDataset-460"><span class="linenos">460</span></a>                <span class="c1"># resolve per-node overrides</span>
</span><span id="TramDagDataset-461"><a href="#TramDagDataset-461"><span class="linenos">461</span></a>                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TramDagDataset-462"><a href="#TramDagDataset-462"><span class="linenos">462</span></a>                    <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="TramDagDataset-463"><a href="#TramDagDataset-463"><span class="linenos">463</span></a>                    <span class="s2">&quot;shuffle&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span><span class="p">,</span>
</span><span id="TramDagDataset-464"><a href="#TramDagDataset-464"><span class="linenos">464</span></a>                    <span class="s2">&quot;num_workers&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span><span class="p">,</span>
</span><span id="TramDagDataset-465"><a href="#TramDagDataset-465"><span class="linenos">465</span></a>                    <span class="s2">&quot;pin_memory&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pin_memory</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pin_memory</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">pin_memory</span><span class="p">,</span>
</span><span id="TramDagDataset-466"><a href="#TramDagDataset-466"><span class="linenos">466</span></a>                    <span class="s2">&quot;sampler&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="p">,</span>
</span><span id="TramDagDataset-467"><a href="#TramDagDataset-467"><span class="linenos">467</span></a>                    <span class="s2">&quot;batch_sampler&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_sampler</span><span class="p">,</span>
</span><span id="TramDagDataset-468"><a href="#TramDagDataset-468"><span class="linenos">468</span></a>                    <span class="s2">&quot;collate_fn&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">collate_fn</span><span class="p">,</span>
</span><span id="TramDagDataset-469"><a href="#TramDagDataset-469"><span class="linenos">469</span></a>                    <span class="s2">&quot;drop_last&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_last</span><span class="p">,</span>
</span><span id="TramDagDataset-470"><a href="#TramDagDataset-470"><span class="linenos">470</span></a>                    <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
</span><span id="TramDagDataset-471"><a href="#TramDagDataset-471"><span class="linenos">471</span></a>                    <span class="s2">&quot;worker_init_fn&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker_init_fn</span><span class="p">,</span>
</span><span id="TramDagDataset-472"><a href="#TramDagDataset-472"><span class="linenos">472</span></a>                    <span class="s2">&quot;multiprocessing_context&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiprocessing_context</span><span class="p">,</span>
</span><span id="TramDagDataset-473"><a href="#TramDagDataset-473"><span class="linenos">473</span></a>                    <span class="s2">&quot;generator&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="p">,</span>
</span><span id="TramDagDataset-474"><a href="#TramDagDataset-474"><span class="linenos">474</span></a>                    <span class="s2">&quot;prefetch_factor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefetch_factor</span><span class="p">,</span>
</span><span id="TramDagDataset-475"><a href="#TramDagDataset-475"><span class="linenos">475</span></a>                    <span class="s2">&quot;persistent_workers&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">persistent_workers</span><span class="p">,</span>
</span><span id="TramDagDataset-476"><a href="#TramDagDataset-476"><span class="linenos">476</span></a>                    <span class="s2">&quot;pin_memory_device&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pin_memory_device</span><span class="p">,</span>
</span><span id="TramDagDataset-477"><a href="#TramDagDataset-477"><span class="linenos">477</span></a>                <span class="p">}</span>
</span><span id="TramDagDataset-478"><a href="#TramDagDataset-478"><span class="linenos">478</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">loaders</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TramDagDataset-479"><a href="#TramDagDataset-479"><span class="linenos">479</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagDataset-480"><a href="#TramDagDataset-480"><span class="linenos">480</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">loaders</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span>
</span><span id="TramDagDataset-481"><a href="#TramDagDataset-481"><span class="linenos">481</span></a>                
</span><span id="TramDagDataset-482"><a href="#TramDagDataset-482"><span class="linenos">482</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;use_precomputed&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_precomputed</span><span class="p">:</span>
</span><span id="TramDagDataset-483"><a href="#TramDagDataset-483"><span class="linenos">483</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pth</span><span class="p">):</span>
</span><span id="TramDagDataset-484"><a href="#TramDagDataset-484"><span class="linenos">484</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagDataset-485"><a href="#TramDagDataset-485"><span class="linenos">485</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pth</span><span class="p">)</span>
</span><span id="TramDagDataset-486"><a href="#TramDagDataset-486"><span class="linenos">486</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagDataset-487"><a href="#TramDagDataset-487"><span class="linenos">487</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Removed existing precomputed file: </span><span class="si">{</span><span class="n">pth</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-488"><a href="#TramDagDataset-488"><span class="linenos">488</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagDataset-489"><a href="#TramDagDataset-489"><span class="linenos">489</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Could not remove </span><span class="si">{</span><span class="n">pth</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset-490"><a href="#TramDagDataset-490"><span class="linenos">490</span></a>
</span><span id="TramDagDataset-491"><a href="#TramDagDataset-491"><span class="linenos">491</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">):</span>
</span><span id="TramDagDataset-492"><a href="#TramDagDataset-492"><span class="linenos">492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagDataset-493"><a href="#TramDagDataset-493"><span class="linenos">493</span></a><span class="sd">        Check that dict-valued attributes use node names as keys.</span>
</span><span id="TramDagDataset-494"><a href="#TramDagDataset-494"><span class="linenos">494</span></a>
</span><span id="TramDagDataset-495"><a href="#TramDagDataset-495"><span class="linenos">495</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagDataset-496"><a href="#TramDagDataset-496"><span class="linenos">496</span></a><span class="sd">        ----------</span>
</span><span id="TramDagDataset-497"><a href="#TramDagDataset-497"><span class="linenos">497</span></a><span class="sd">        attr_name : str</span>
</span><span id="TramDagDataset-498"><a href="#TramDagDataset-498"><span class="linenos">498</span></a><span class="sd">            Name of the attribute being checked (for error messages).</span>
</span><span id="TramDagDataset-499"><a href="#TramDagDataset-499"><span class="linenos">499</span></a><span class="sd">        attr_value : Any</span>
</span><span id="TramDagDataset-500"><a href="#TramDagDataset-500"><span class="linenos">500</span></a><span class="sd">            Attribute value. If it is a dict, its keys are validated.</span>
</span><span id="TramDagDataset-501"><a href="#TramDagDataset-501"><span class="linenos">501</span></a>
</span><span id="TramDagDataset-502"><a href="#TramDagDataset-502"><span class="linenos">502</span></a><span class="sd">        Returns</span>
</span><span id="TramDagDataset-503"><a href="#TramDagDataset-503"><span class="linenos">503</span></a><span class="sd">        -------</span>
</span><span id="TramDagDataset-504"><a href="#TramDagDataset-504"><span class="linenos">504</span></a><span class="sd">        None</span>
</span><span id="TramDagDataset-505"><a href="#TramDagDataset-505"><span class="linenos">505</span></a>
</span><span id="TramDagDataset-506"><a href="#TramDagDataset-506"><span class="linenos">506</span></a><span class="sd">        Raises</span>
</span><span id="TramDagDataset-507"><a href="#TramDagDataset-507"><span class="linenos">507</span></a><span class="sd">        ------</span>
</span><span id="TramDagDataset-508"><a href="#TramDagDataset-508"><span class="linenos">508</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagDataset-509"><a href="#TramDagDataset-509"><span class="linenos">509</span></a><span class="sd">            If `attr_value` is a dict and its keys do not exactly match</span>
</span><span id="TramDagDataset-510"><a href="#TramDagDataset-510"><span class="linenos">510</span></a><span class="sd">            `cfg.conf_dict[&quot;nodes&quot;].keys()`.</span>
</span><span id="TramDagDataset-511"><a href="#TramDagDataset-511"><span class="linenos">511</span></a>
</span><span id="TramDagDataset-512"><a href="#TramDagDataset-512"><span class="linenos">512</span></a><span class="sd">        Notes</span>
</span><span id="TramDagDataset-513"><a href="#TramDagDataset-513"><span class="linenos">513</span></a><span class="sd">        -----</span>
</span><span id="TramDagDataset-514"><a href="#TramDagDataset-514"><span class="linenos">514</span></a><span class="sd">        This check prevents partial or mismatched per-node settings such as</span>
</span><span id="TramDagDataset-515"><a href="#TramDagDataset-515"><span class="linenos">515</span></a><span class="sd">        batch sizes or shuffle flags.</span>
</span><span id="TramDagDataset-516"><a href="#TramDagDataset-516"><span class="linenos">516</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagDataset-517"><a href="#TramDagDataset-517"><span class="linenos">517</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="TramDagDataset-518"><a href="#TramDagDataset-518"><span class="linenos">518</span></a>            <span class="n">expected_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagDataset-519"><a href="#TramDagDataset-519"><span class="linenos">519</span></a>            <span class="n">given_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">attr_value</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagDataset-520"><a href="#TramDagDataset-520"><span class="linenos">520</span></a>            <span class="k">if</span> <span class="n">expected_keys</span> <span class="o">!=</span> <span class="n">given_keys</span><span class="p">:</span>
</span><span id="TramDagDataset-521"><a href="#TramDagDataset-521"><span class="linenos">521</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagDataset-522"><a href="#TramDagDataset-522"><span class="linenos">522</span></a>                    <span class="sa">f</span><span class="s2">&quot;[ERROR] the provided attribute &#39;</span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2">&#39; keys are not same as in cfg.conf_dict[&#39;nodes&#39;].keys().</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="TramDagDataset-523"><a href="#TramDagDataset-523"><span class="linenos">523</span></a>                    <span class="sa">f</span><span class="s2">&quot;Expected: </span><span class="si">{</span><span class="n">expected_keys</span><span class="si">}</span><span class="s2">, but got: </span><span class="si">{</span><span class="n">given_keys</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="TramDagDataset-524"><a href="#TramDagDataset-524"><span class="linenos">524</span></a>                    <span class="sa">f</span><span class="s2">&quot;Please provide values for all variables.&quot;</span>
</span><span id="TramDagDataset-525"><a href="#TramDagDataset-525"><span class="linenos">525</span></a>                <span class="p">)</span>
</span><span id="TramDagDataset-526"><a href="#TramDagDataset-526"><span class="linenos">526</span></a>
</span><span id="TramDagDataset-527"><a href="#TramDagDataset-527"><span class="linenos">527</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
</span><span id="TramDagDataset-528"><a href="#TramDagDataset-528"><span class="linenos">528</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="TramDagDataset-529"><a href="#TramDagDataset-529"><span class="linenos">529</span></a>
</span><span id="TramDagDataset-530"><a href="#TramDagDataset-530"><span class="linenos">530</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagDataset-531"><a href="#TramDagDataset-531"><span class="linenos">531</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h1 id="tramdagdataset">TramDagDataset</h1>

<p>The <code><a href="#TramDagDataset">TramDagDataset</a></code> class handles structured data preparation for TRAM-DAG
models. It wraps a pandas DataFrame together with its configuration and provides
utilities for scaling, transformation, and efficient DataLoader construction
for each node in a DAG-based configuration.</p>

<hr />

<h2 id="core-responsibilities">Core Responsibilities</h2>

<ul>
<li>Validate and store configuration metadata (<code><a href="#TramDagConfig">TramDagConfig</a></code>).</li>
<li>Manage per-node settings for DataLoader creation (batch size, shuffling, workers).</li>
<li>Compute scaling information (quantile-based min/max).</li>
<li>Optionally precompute and cache dataset representations.</li>
<li>Expose PyTorch Dataset and DataLoader interfaces for model training.</li>
</ul>

<hr />

<h2 id="key-attributes">Key Attributes</h2>

<ul>
<li><p><strong>df</strong> : pandas.DataFrame<br />
The dataset content used for building loaders and computing scaling.</p></li>
<li><p><strong>cfg</strong> : TramDagConfig<br />
Configuration object defining nodes and variable metadata.</p></li>
<li><p><strong>nodes_dict</strong> : dict<br />
Mapping of variable names to node specifications from the configuration.</p></li>
<li><p><strong>loaders</strong> : dict<br />
Mapping of node names to <code>torch.utils.data.DataLoader</code> instances or <code>GenericDataset</code> objects.</p></li>
<li><p><strong>DEFAULTS</strong> : dict<br />
Default DataLoader and dataset-related settings (e.g., batch_size, shuffle, num_workers, etc.).</p></li>
</ul>

<hr />

<h2 id="main-methods">Main Methods</h2>

<ul>
<li><p><strong>from_dataframe(df, cfg, **kwargs)</strong><br />
Construct the dataset directly from a pandas DataFrame.</p></li>
<li><p><strong>compute_scaling(df=None, write=True)</strong><br />
Compute per-variable min/max scaling values from data.</p></li>
<li><p><strong>summary()</strong><br />
Print dataset overview including shape, dtypes, statistics, and node settings.</p></li>
</ul>

<hr />

<h2 id="notes">Notes</h2>

<ul>
<li>Intended for training data; <code><a href="#TramDagDataset.compute_scaling">compute_scaling()</a></code> should use only training subsets.</li>
<li>Compatible with both CPU and GPU DataLoader options.</li>
<li>Strict validation of keyword arguments against <code><a href="#TramDagDataset.DEFAULTS">DEFAULTS</a></code> prevents silent misconfiguration.</li>
</ul>

<hr />

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">cfg</span> <span class="o">=</span> <span class="n">TramDagConfig</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="s2">&quot;config.json&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span> <span class="o">=</span> <span class="n"><a href="#TramDagDataset.from_dataframe">TramDagDataset.from_dataframe</a></span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">minmax</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">compute_scaling</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">loader</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">loaders</span><span class="p">[</span><span class="s2">&quot;variable_x&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">loader</span><span class="p">))</span>
</code></pre>
</div>
</div>


                            <div id="TramDagDataset.__init__" class="classattr">
                                        <input id="TramDagDataset.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TramDagDataset</span><span class="signature pdoc-code condensed">()</span>

                <label class="view-source-button" for="TramDagDataset.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagDataset.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagDataset.__init__-121"><a href="#TramDagDataset.__init__-121"><span class="linenos">121</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagDataset.__init__-122"><a href="#TramDagDataset.__init__-122"><span class="linenos">122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagDataset.__init__-123"><a href="#TramDagDataset.__init__-123"><span class="linenos">123</span></a><span class="sd">        Initialize an empty TramDagDataset shell.</span>
</span><span id="TramDagDataset.__init__-124"><a href="#TramDagDataset.__init__-124"><span class="linenos">124</span></a>
</span><span id="TramDagDataset.__init__-125"><a href="#TramDagDataset.__init__-125"><span class="linenos">125</span></a><span class="sd">        Notes</span>
</span><span id="TramDagDataset.__init__-126"><a href="#TramDagDataset.__init__-126"><span class="linenos">126</span></a><span class="sd">        -----</span>
</span><span id="TramDagDataset.__init__-127"><a href="#TramDagDataset.__init__-127"><span class="linenos">127</span></a><span class="sd">        This constructor does not attach data or configuration. Use</span>
</span><span id="TramDagDataset.__init__-128"><a href="#TramDagDataset.__init__-128"><span class="linenos">128</span></a><span class="sd">        `TramDagDataset.from_dataframe` to obtain a ready-to-use instance.</span>
</span><span id="TramDagDataset.__init__-129"><a href="#TramDagDataset.__init__-129"><span class="linenos">129</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagDataset.__init__-130"><a href="#TramDagDataset.__init__-130"><span class="linenos">130</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Initialize an empty TramDagDataset shell.</p>

<h2 id="notes">Notes</h2>

<p>This constructor does not attach data or configuration. Use
<code><a href="#TramDagDataset.from_dataframe">TramDagDataset.from_dataframe</a></code> to obtain a ready-to-use instance.</p>
</div>


                            </div>
                            <div id="TramDagDataset.DEFAULTS" class="classattr">
                                <div class="attr variable">
            <span class="name">DEFAULTS</span>        =
<input id="TramDagDataset.DEFAULTS-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="TramDagDataset.DEFAULTS-view-value"></label><span class="default_value">{&#39;batch_size&#39;: 32000, &#39;shuffle&#39;: True, &#39;num_workers&#39;: 4, &#39;pin_memory&#39;: True, &#39;return_intercept_shift&#39;: True, &#39;debug&#39;: False, &#39;transform&#39;: None, &#39;use_dataloader&#39;: True, &#39;use_precomputed&#39;: False, &#39;sampler&#39;: None, &#39;batch_sampler&#39;: None, &#39;collate_fn&#39;: None, &#39;drop_last&#39;: False, &#39;timeout&#39;: 0, &#39;worker_init_fn&#39;: None, &#39;multiprocessing_context&#39;: None, &#39;generator&#39;: None, &#39;prefetch_factor&#39;: 2, &#39;persistent_workers&#39;: True, &#39;pin_memory_device&#39;: &#39;&#39;}</span>

        
    </div>
    <a class="headerlink" href="#TramDagDataset.DEFAULTS"></a>
    
    

                            </div>
                            <div id="TramDagDataset.from_dataframe" class="classattr">
                                        <input id="TramDagDataset.from_dataframe-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_dataframe</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">df</span>, </span><span class="param"><span class="n">cfg</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagDataset.from_dataframe-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagDataset.from_dataframe"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagDataset.from_dataframe-132"><a href="#TramDagDataset.from_dataframe-132"><span class="linenos">132</span></a>    <span class="nd">@classmethod</span>
</span><span id="TramDagDataset.from_dataframe-133"><a href="#TramDagDataset.from_dataframe-133"><span class="linenos">133</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_dataframe</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TramDagDataset.from_dataframe-134"><a href="#TramDagDataset.from_dataframe-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagDataset.from_dataframe-135"><a href="#TramDagDataset.from_dataframe-135"><span class="linenos">135</span></a><span class="sd">        Create a TramDagDataset instance directly from a pandas DataFrame.</span>
</span><span id="TramDagDataset.from_dataframe-136"><a href="#TramDagDataset.from_dataframe-136"><span class="linenos">136</span></a>
</span><span id="TramDagDataset.from_dataframe-137"><a href="#TramDagDataset.from_dataframe-137"><span class="linenos">137</span></a><span class="sd">        This classmethod:</span>
</span><span id="TramDagDataset.from_dataframe-138"><a href="#TramDagDataset.from_dataframe-138"><span class="linenos">138</span></a>
</span><span id="TramDagDataset.from_dataframe-139"><a href="#TramDagDataset.from_dataframe-139"><span class="linenos">139</span></a><span class="sd">        1. Validates keyword arguments against `DEFAULTS`.</span>
</span><span id="TramDagDataset.from_dataframe-140"><a href="#TramDagDataset.from_dataframe-140"><span class="linenos">140</span></a><span class="sd">        2. Merges user overrides with defaults into a resolved settings dict.</span>
</span><span id="TramDagDataset.from_dataframe-141"><a href="#TramDagDataset.from_dataframe-141"><span class="linenos">141</span></a><span class="sd">        3. Stores the configuration and verifies its completeness.</span>
</span><span id="TramDagDataset.from_dataframe-142"><a href="#TramDagDataset.from_dataframe-142"><span class="linenos">142</span></a><span class="sd">        4. Applies settings to the instance.</span>
</span><span id="TramDagDataset.from_dataframe-143"><a href="#TramDagDataset.from_dataframe-143"><span class="linenos">143</span></a><span class="sd">        5. Builds per-node datasets and DataLoaders.</span>
</span><span id="TramDagDataset.from_dataframe-144"><a href="#TramDagDataset.from_dataframe-144"><span class="linenos">144</span></a>
</span><span id="TramDagDataset.from_dataframe-145"><a href="#TramDagDataset.from_dataframe-145"><span class="linenos">145</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagDataset.from_dataframe-146"><a href="#TramDagDataset.from_dataframe-146"><span class="linenos">146</span></a><span class="sd">        ----------</span>
</span><span id="TramDagDataset.from_dataframe-147"><a href="#TramDagDataset.from_dataframe-147"><span class="linenos">147</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="TramDagDataset.from_dataframe-148"><a href="#TramDagDataset.from_dataframe-148"><span class="linenos">148</span></a><span class="sd">            Input DataFrame containing the dataset.</span>
</span><span id="TramDagDataset.from_dataframe-149"><a href="#TramDagDataset.from_dataframe-149"><span class="linenos">149</span></a><span class="sd">        cfg : TramDagConfig</span>
</span><span id="TramDagDataset.from_dataframe-150"><a href="#TramDagDataset.from_dataframe-150"><span class="linenos">150</span></a><span class="sd">            Configuration object defining nodes and variable metadata.</span>
</span><span id="TramDagDataset.from_dataframe-151"><a href="#TramDagDataset.from_dataframe-151"><span class="linenos">151</span></a><span class="sd">        **kwargs</span>
</span><span id="TramDagDataset.from_dataframe-152"><a href="#TramDagDataset.from_dataframe-152"><span class="linenos">152</span></a><span class="sd">            Optional overrides for `DEFAULTS`. All keys must exist in</span>
</span><span id="TramDagDataset.from_dataframe-153"><a href="#TramDagDataset.from_dataframe-153"><span class="linenos">153</span></a><span class="sd">            `TramDagDataset.DEFAULTS`. Common keys include:</span>
</span><span id="TramDagDataset.from_dataframe-154"><a href="#TramDagDataset.from_dataframe-154"><span class="linenos">154</span></a>
</span><span id="TramDagDataset.from_dataframe-155"><a href="#TramDagDataset.from_dataframe-155"><span class="linenos">155</span></a><span class="sd">            batch_size : int</span>
</span><span id="TramDagDataset.from_dataframe-156"><a href="#TramDagDataset.from_dataframe-156"><span class="linenos">156</span></a><span class="sd">                Batch size for DataLoaders.</span>
</span><span id="TramDagDataset.from_dataframe-157"><a href="#TramDagDataset.from_dataframe-157"><span class="linenos">157</span></a><span class="sd">            shuffle : bool</span>
</span><span id="TramDagDataset.from_dataframe-158"><a href="#TramDagDataset.from_dataframe-158"><span class="linenos">158</span></a><span class="sd">                Whether to shuffle samples per epoch.</span>
</span><span id="TramDagDataset.from_dataframe-159"><a href="#TramDagDataset.from_dataframe-159"><span class="linenos">159</span></a><span class="sd">            num_workers : int</span>
</span><span id="TramDagDataset.from_dataframe-160"><a href="#TramDagDataset.from_dataframe-160"><span class="linenos">160</span></a><span class="sd">                Number of DataLoader workers.</span>
</span><span id="TramDagDataset.from_dataframe-161"><a href="#TramDagDataset.from_dataframe-161"><span class="linenos">161</span></a><span class="sd">            pin_memory : bool</span>
</span><span id="TramDagDataset.from_dataframe-162"><a href="#TramDagDataset.from_dataframe-162"><span class="linenos">162</span></a><span class="sd">                Whether to pin memory for faster host-to-device transfers.</span>
</span><span id="TramDagDataset.from_dataframe-163"><a href="#TramDagDataset.from_dataframe-163"><span class="linenos">163</span></a><span class="sd">            return_intercept_shift : bool</span>
</span><span id="TramDagDataset.from_dataframe-164"><a href="#TramDagDataset.from_dataframe-164"><span class="linenos">164</span></a><span class="sd">                Whether datasets should return intercept/shift information.</span>
</span><span id="TramDagDataset.from_dataframe-165"><a href="#TramDagDataset.from_dataframe-165"><span class="linenos">165</span></a><span class="sd">            debug : bool</span>
</span><span id="TramDagDataset.from_dataframe-166"><a href="#TramDagDataset.from_dataframe-166"><span class="linenos">166</span></a><span class="sd">                Enable debug printing.</span>
</span><span id="TramDagDataset.from_dataframe-167"><a href="#TramDagDataset.from_dataframe-167"><span class="linenos">167</span></a><span class="sd">            transform : callable or dict or None</span>
</span><span id="TramDagDataset.from_dataframe-168"><a href="#TramDagDataset.from_dataframe-168"><span class="linenos">168</span></a><span class="sd">                Optional transform(s) applied to samples.</span>
</span><span id="TramDagDataset.from_dataframe-169"><a href="#TramDagDataset.from_dataframe-169"><span class="linenos">169</span></a><span class="sd">            use_dataloader : bool</span>
</span><span id="TramDagDataset.from_dataframe-170"><a href="#TramDagDataset.from_dataframe-170"><span class="linenos">170</span></a><span class="sd">                If True, construct DataLoaders; else store raw Dataset objects.</span>
</span><span id="TramDagDataset.from_dataframe-171"><a href="#TramDagDataset.from_dataframe-171"><span class="linenos">171</span></a><span class="sd">            use_precomputed : bool</span>
</span><span id="TramDagDataset.from_dataframe-172"><a href="#TramDagDataset.from_dataframe-172"><span class="linenos">172</span></a><span class="sd">                If True, precompute dataset representation to disk and reload it.</span>
</span><span id="TramDagDataset.from_dataframe-173"><a href="#TramDagDataset.from_dataframe-173"><span class="linenos">173</span></a>
</span><span id="TramDagDataset.from_dataframe-174"><a href="#TramDagDataset.from_dataframe-174"><span class="linenos">174</span></a><span class="sd">        Returns</span>
</span><span id="TramDagDataset.from_dataframe-175"><a href="#TramDagDataset.from_dataframe-175"><span class="linenos">175</span></a><span class="sd">        -------</span>
</span><span id="TramDagDataset.from_dataframe-176"><a href="#TramDagDataset.from_dataframe-176"><span class="linenos">176</span></a><span class="sd">        TramDagDataset</span>
</span><span id="TramDagDataset.from_dataframe-177"><a href="#TramDagDataset.from_dataframe-177"><span class="linenos">177</span></a><span class="sd">            Initialized dataset instance.</span>
</span><span id="TramDagDataset.from_dataframe-178"><a href="#TramDagDataset.from_dataframe-178"><span class="linenos">178</span></a>
</span><span id="TramDagDataset.from_dataframe-179"><a href="#TramDagDataset.from_dataframe-179"><span class="linenos">179</span></a><span class="sd">        Raises</span>
</span><span id="TramDagDataset.from_dataframe-180"><a href="#TramDagDataset.from_dataframe-180"><span class="linenos">180</span></a><span class="sd">        ------</span>
</span><span id="TramDagDataset.from_dataframe-181"><a href="#TramDagDataset.from_dataframe-181"><span class="linenos">181</span></a><span class="sd">        TypeError</span>
</span><span id="TramDagDataset.from_dataframe-182"><a href="#TramDagDataset.from_dataframe-182"><span class="linenos">182</span></a><span class="sd">            If `df` is not a pandas DataFrame.</span>
</span><span id="TramDagDataset.from_dataframe-183"><a href="#TramDagDataset.from_dataframe-183"><span class="linenos">183</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagDataset.from_dataframe-184"><a href="#TramDagDataset.from_dataframe-184"><span class="linenos">184</span></a><span class="sd">            If unknown keyword arguments are provided (when validation is enabled).</span>
</span><span id="TramDagDataset.from_dataframe-185"><a href="#TramDagDataset.from_dataframe-185"><span class="linenos">185</span></a>
</span><span id="TramDagDataset.from_dataframe-186"><a href="#TramDagDataset.from_dataframe-186"><span class="linenos">186</span></a><span class="sd">        Notes</span>
</span><span id="TramDagDataset.from_dataframe-187"><a href="#TramDagDataset.from_dataframe-187"><span class="linenos">187</span></a><span class="sd">        -----</span>
</span><span id="TramDagDataset.from_dataframe-188"><a href="#TramDagDataset.from_dataframe-188"><span class="linenos">188</span></a><span class="sd">        If `shuffle=True` and the inferred variable name of `df` suggests</span>
</span><span id="TramDagDataset.from_dataframe-189"><a href="#TramDagDataset.from_dataframe-189"><span class="linenos">189</span></a><span class="sd">        validation/test data (e.g. &quot;val&quot;, &quot;test&quot;), a warning is printed.</span>
</span><span id="TramDagDataset.from_dataframe-190"><a href="#TramDagDataset.from_dataframe-190"><span class="linenos">190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagDataset.from_dataframe-191"><a href="#TramDagDataset.from_dataframe-191"><span class="linenos">191</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span><span id="TramDagDataset.from_dataframe-192"><a href="#TramDagDataset.from_dataframe-192"><span class="linenos">192</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="TramDagDataset.from_dataframe-193"><a href="#TramDagDataset.from_dataframe-193"><span class="linenos">193</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] df must be a pandas DataFrame, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.from_dataframe-194"><a href="#TramDagDataset.from_dataframe-194"><span class="linenos">194</span></a>
</span><span id="TramDagDataset.from_dataframe-195"><a href="#TramDagDataset.from_dataframe-195"><span class="linenos">195</span></a>        <span class="c1"># validate kwargs</span>
</span><span id="TramDagDataset.from_dataframe-196"><a href="#TramDagDataset.from_dataframe-196"><span class="linenos">196</span></a>        <span class="c1"># TODO adjust validation such thath it works when called from tramdagmodel</span>
</span><span id="TramDagDataset.from_dataframe-197"><a href="#TramDagDataset.from_dataframe-197"><span class="linenos">197</span></a>        <span class="c1">#self._validate_kwargs(kwargs, context=&quot;from_dataframe&quot;)</span>
</span><span id="TramDagDataset.from_dataframe-198"><a href="#TramDagDataset.from_dataframe-198"><span class="linenos">198</span></a>        
</span><span id="TramDagDataset.from_dataframe-199"><a href="#TramDagDataset.from_dataframe-199"><span class="linenos">199</span></a>        <span class="c1"># merge defaults with overrides</span>
</span><span id="TramDagDataset.from_dataframe-200"><a href="#TramDagDataset.from_dataframe-200"><span class="linenos">200</span></a>        <span class="n">settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">DEFAULTS</span><span class="p">)</span>
</span><span id="TramDagDataset.from_dataframe-201"><a href="#TramDagDataset.from_dataframe-201"><span class="linenos">201</span></a>        <span class="n">settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TramDagDataset.from_dataframe-202"><a href="#TramDagDataset.from_dataframe-202"><span class="linenos">202</span></a>
</span><span id="TramDagDataset.from_dataframe-203"><a href="#TramDagDataset.from_dataframe-203"><span class="linenos">203</span></a>        <span class="c1"># store config and verify</span>
</span><span id="TramDagDataset.from_dataframe-204"><a href="#TramDagDataset.from_dataframe-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span>
</span><span id="TramDagDataset.from_dataframe-205"><a href="#TramDagDataset.from_dataframe-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">_verify_completeness</span><span class="p">()</span>
</span><span id="TramDagDataset.from_dataframe-206"><a href="#TramDagDataset.from_dataframe-206"><span class="linenos">206</span></a>
</span><span id="TramDagDataset.from_dataframe-207"><a href="#TramDagDataset.from_dataframe-207"><span class="linenos">207</span></a>        <span class="c1"># ouptu all setttings if debug</span>
</span><span id="TramDagDataset.from_dataframe-208"><a href="#TramDagDataset.from_dataframe-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagDataset.from_dataframe-209"><a href="#TramDagDataset.from_dataframe-209"><span class="linenos">209</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] TramDagDataset.from_dataframe() settings (after defaults + overrides):&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.from_dataframe-210"><a href="#TramDagDataset.from_dataframe-210"><span class="linenos">210</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagDataset.from_dataframe-211"><a href="#TramDagDataset.from_dataframe-211"><span class="linenos">211</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.from_dataframe-212"><a href="#TramDagDataset.from_dataframe-212"><span class="linenos">212</span></a>
</span><span id="TramDagDataset.from_dataframe-213"><a href="#TramDagDataset.from_dataframe-213"><span class="linenos">213</span></a>        <span class="c1"># infer variable name automatically</span>
</span><span id="TramDagDataset.from_dataframe-214"><a href="#TramDagDataset.from_dataframe-214"><span class="linenos">214</span></a>        <span class="n">callers_locals</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_locals</span>
</span><span id="TramDagDataset.from_dataframe-215"><a href="#TramDagDataset.from_dataframe-215"><span class="linenos">215</span></a>        <span class="n">inferred</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagDataset.from_dataframe-216"><a href="#TramDagDataset.from_dataframe-216"><span class="linenos">216</span></a>        <span class="k">for</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">var_val</span> <span class="ow">in</span> <span class="n">callers_locals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagDataset.from_dataframe-217"><a href="#TramDagDataset.from_dataframe-217"><span class="linenos">217</span></a>            <span class="k">if</span> <span class="n">var_val</span> <span class="ow">is</span> <span class="n">df</span><span class="p">:</span>
</span><span id="TramDagDataset.from_dataframe-218"><a href="#TramDagDataset.from_dataframe-218"><span class="linenos">218</span></a>                <span class="n">inferred</span> <span class="o">=</span> <span class="n">var_name</span>
</span><span id="TramDagDataset.from_dataframe-219"><a href="#TramDagDataset.from_dataframe-219"><span class="linenos">219</span></a>                <span class="k">break</span>
</span><span id="TramDagDataset.from_dataframe-220"><a href="#TramDagDataset.from_dataframe-220"><span class="linenos">220</span></a>        <span class="n">df_name</span> <span class="o">=</span> <span class="n">inferred</span> <span class="ow">or</span> <span class="s2">&quot;dataframe&quot;</span>
</span><span id="TramDagDataset.from_dataframe-221"><a href="#TramDagDataset.from_dataframe-221"><span class="linenos">221</span></a>
</span><span id="TramDagDataset.from_dataframe-222"><a href="#TramDagDataset.from_dataframe-222"><span class="linenos">222</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;shuffle&quot;</span><span class="p">]:</span>
</span><span id="TramDagDataset.from_dataframe-223"><a href="#TramDagDataset.from_dataframe-223"><span class="linenos">223</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">df_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="s2">&quot;validation&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">]):</span>
</span><span id="TramDagDataset.from_dataframe-224"><a href="#TramDagDataset.from_dataframe-224"><span class="linenos">224</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] DataFrame &#39;</span><span class="si">{</span><span class="n">df_name</span><span class="si">}</span><span class="s2">&#39; looks like a validation/test set  shuffle=True. Are you sure?&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.from_dataframe-225"><a href="#TramDagDataset.from_dataframe-225"><span class="linenos">225</span></a>
</span><span id="TramDagDataset.from_dataframe-226"><a href="#TramDagDataset.from_dataframe-226"><span class="linenos">226</span></a>        <span class="c1"># call again to ensure Warning messages if ordinal vars have missing levels</span>
</span><span id="TramDagDataset.from_dataframe-227"><a href="#TramDagDataset.from_dataframe-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TramDagDataset.from_dataframe-228"><a href="#TramDagDataset.from_dataframe-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_settings</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="TramDagDataset.from_dataframe-229"><a href="#TramDagDataset.from_dataframe-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_build_dataloaders</span><span class="p">()</span>
</span><span id="TramDagDataset.from_dataframe-230"><a href="#TramDagDataset.from_dataframe-230"><span class="linenos">230</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Create a TramDagDataset instance directly from a pandas DataFrame.</p>

<p>This classmethod:</p>

<ol>
<li>Validates keyword arguments against <code><a href="#TramDagDataset.DEFAULTS">DEFAULTS</a></code>.</li>
<li>Merges user overrides with defaults into a resolved settings dict.</li>
<li>Stores the configuration and verifies its completeness.</li>
<li>Applies settings to the instance.</li>
<li>Builds per-node datasets and DataLoaders.</li>
</ol>

<h2 id="parameters">Parameters</h2>

<p>df : pandas.DataFrame
    Input DataFrame containing the dataset.
cfg : TramDagConfig
    Configuration object defining nodes and variable metadata.
**kwargs
    Optional overrides for <code><a href="#TramDagDataset.DEFAULTS">DEFAULTS</a></code>. All keys must exist in
    <code><a href="#TramDagDataset.DEFAULTS">TramDagDataset.DEFAULTS</a></code>. Common keys include:</p>

<pre><code>batch_size : int
    Batch size for DataLoaders.
shuffle : bool
    Whether to shuffle samples per epoch.
num_workers : int
    Number of DataLoader workers.
pin_memory : bool
    Whether to pin memory for faster host-to-device transfers.
return_intercept_shift : bool
    Whether datasets should return intercept/shift information.
debug : bool
    Enable debug printing.
transform : callable or dict or None
    Optional transform(s) applied to samples.
use_dataloader : bool
    If True, construct DataLoaders; else store raw Dataset objects.
use_precomputed : bool
    If True, precompute dataset representation to disk and reload it.
</code></pre>

<h2 id="returns">Returns</h2>

<p>TramDagDataset
    Initialized dataset instance.</p>

<h2 id="raises">Raises</h2>

<p>TypeError
    If <code>df</code> is not a pandas DataFrame.
ValueError
    If unknown keyword arguments are provided (when validation is enabled).</p>

<h2 id="notes">Notes</h2>

<p>If <code>shuffle=True</code> and the inferred variable name of <code>df</code> suggests
validation/test data (e.g. "val", "test"), a warning is printed.</p>
</div>


                            </div>
                            <div id="TramDagDataset.compute_scaling" class="classattr">
                                        <input id="TramDagDataset.compute_scaling-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_scaling</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">write</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagDataset.compute_scaling-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagDataset.compute_scaling"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagDataset.compute_scaling-232"><a href="#TramDagDataset.compute_scaling-232"><span class="linenos">232</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">write</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="TramDagDataset.compute_scaling-233"><a href="#TramDagDataset.compute_scaling-233"><span class="linenos">233</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagDataset.compute_scaling-234"><a href="#TramDagDataset.compute_scaling-234"><span class="linenos">234</span></a><span class="sd">        Compute variable-wise scaling parameters from data.</span>
</span><span id="TramDagDataset.compute_scaling-235"><a href="#TramDagDataset.compute_scaling-235"><span class="linenos">235</span></a>
</span><span id="TramDagDataset.compute_scaling-236"><a href="#TramDagDataset.compute_scaling-236"><span class="linenos">236</span></a><span class="sd">        Per variable, this method computes approximate minimum and maximum</span>
</span><span id="TramDagDataset.compute_scaling-237"><a href="#TramDagDataset.compute_scaling-237"><span class="linenos">237</span></a><span class="sd">        values using the 5th and 95th percentiles. This is typically used</span>
</span><span id="TramDagDataset.compute_scaling-238"><a href="#TramDagDataset.compute_scaling-238"><span class="linenos">238</span></a><span class="sd">        to derive robust normalization/clipping ranges from training data.</span>
</span><span id="TramDagDataset.compute_scaling-239"><a href="#TramDagDataset.compute_scaling-239"><span class="linenos">239</span></a>
</span><span id="TramDagDataset.compute_scaling-240"><a href="#TramDagDataset.compute_scaling-240"><span class="linenos">240</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagDataset.compute_scaling-241"><a href="#TramDagDataset.compute_scaling-241"><span class="linenos">241</span></a><span class="sd">        ----------</span>
</span><span id="TramDagDataset.compute_scaling-242"><a href="#TramDagDataset.compute_scaling-242"><span class="linenos">242</span></a><span class="sd">        df : pandas.DataFrame or None, optional</span>
</span><span id="TramDagDataset.compute_scaling-243"><a href="#TramDagDataset.compute_scaling-243"><span class="linenos">243</span></a><span class="sd">            DataFrame used to compute scaling. If None, `self.df` is used.</span>
</span><span id="TramDagDataset.compute_scaling-244"><a href="#TramDagDataset.compute_scaling-244"><span class="linenos">244</span></a><span class="sd">        write : bool, optional</span>
</span><span id="TramDagDataset.compute_scaling-245"><a href="#TramDagDataset.compute_scaling-245"><span class="linenos">245</span></a><span class="sd">            Unused placeholder for interface compatibility with other components.</span>
</span><span id="TramDagDataset.compute_scaling-246"><a href="#TramDagDataset.compute_scaling-246"><span class="linenos">246</span></a><span class="sd">            Kept for potential future extensions. Default is True.</span>
</span><span id="TramDagDataset.compute_scaling-247"><a href="#TramDagDataset.compute_scaling-247"><span class="linenos">247</span></a>
</span><span id="TramDagDataset.compute_scaling-248"><a href="#TramDagDataset.compute_scaling-248"><span class="linenos">248</span></a><span class="sd">        Returns</span>
</span><span id="TramDagDataset.compute_scaling-249"><a href="#TramDagDataset.compute_scaling-249"><span class="linenos">249</span></a><span class="sd">        -------</span>
</span><span id="TramDagDataset.compute_scaling-250"><a href="#TramDagDataset.compute_scaling-250"><span class="linenos">250</span></a><span class="sd">        dict</span>
</span><span id="TramDagDataset.compute_scaling-251"><a href="#TramDagDataset.compute_scaling-251"><span class="linenos">251</span></a><span class="sd">            Mapping `{column_name: [min_value, max_value]}`, where values</span>
</span><span id="TramDagDataset.compute_scaling-252"><a href="#TramDagDataset.compute_scaling-252"><span class="linenos">252</span></a><span class="sd">            are derived from the 0.05 and 0.95 quantiles.</span>
</span><span id="TramDagDataset.compute_scaling-253"><a href="#TramDagDataset.compute_scaling-253"><span class="linenos">253</span></a>
</span><span id="TramDagDataset.compute_scaling-254"><a href="#TramDagDataset.compute_scaling-254"><span class="linenos">254</span></a><span class="sd">        Notes</span>
</span><span id="TramDagDataset.compute_scaling-255"><a href="#TramDagDataset.compute_scaling-255"><span class="linenos">255</span></a><span class="sd">        -----</span>
</span><span id="TramDagDataset.compute_scaling-256"><a href="#TramDagDataset.compute_scaling-256"><span class="linenos">256</span></a><span class="sd">        If `self.debug` is True, the method emits debug messages about the</span>
</span><span id="TramDagDataset.compute_scaling-257"><a href="#TramDagDataset.compute_scaling-257"><span class="linenos">257</span></a><span class="sd">        data source. Only training data should be used to avoid leakage.</span>
</span><span id="TramDagDataset.compute_scaling-258"><a href="#TramDagDataset.compute_scaling-258"><span class="linenos">258</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagDataset.compute_scaling-259"><a href="#TramDagDataset.compute_scaling-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagDataset.compute_scaling-260"><a href="#TramDagDataset.compute_scaling-260"><span class="linenos">260</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Make sure to provide only training data to compute_scaling!&quot;</span><span class="p">)</span>     
</span><span id="TramDagDataset.compute_scaling-261"><a href="#TramDagDataset.compute_scaling-261"><span class="linenos">261</span></a>        <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagDataset.compute_scaling-262"><a href="#TramDagDataset.compute_scaling-262"><span class="linenos">262</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span>
</span><span id="TramDagDataset.compute_scaling-263"><a href="#TramDagDataset.compute_scaling-263"><span class="linenos">263</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagDataset.compute_scaling-264"><a href="#TramDagDataset.compute_scaling-264"><span class="linenos">264</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] No DataFrame provided, using internal df.&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.compute_scaling-265"><a href="#TramDagDataset.compute_scaling-265"><span class="linenos">265</span></a>        <span class="n">quantiles</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">quantile</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>
</span><span id="TramDagDataset.compute_scaling-266"><a href="#TramDagDataset.compute_scaling-266"><span class="linenos">266</span></a>        <span class="n">min_vals</span> <span class="o">=</span> <span class="n">quantiles</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">0.05</span><span class="p">]</span>
</span><span id="TramDagDataset.compute_scaling-267"><a href="#TramDagDataset.compute_scaling-267"><span class="linenos">267</span></a>        <span class="n">max_vals</span> <span class="o">=</span> <span class="n">quantiles</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">0.95</span><span class="p">]</span>
</span><span id="TramDagDataset.compute_scaling-268"><a href="#TramDagDataset.compute_scaling-268"><span class="linenos">268</span></a>        <span class="n">minmax_dict</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">min_vals</span><span class="p">,</span> <span class="n">max_vals</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">)</span>
</span><span id="TramDagDataset.compute_scaling-269"><a href="#TramDagDataset.compute_scaling-269"><span class="linenos">269</span></a>        <span class="k">return</span> <span class="n">minmax_dict</span>
</span></pre></div>


            <div class="docstring"><p>Compute variable-wise scaling parameters from data.</p>

<p>Per variable, this method computes approximate minimum and maximum
values using the 5th and 95th percentiles. This is typically used
to derive robust normalization/clipping ranges from training data.</p>

<h2 id="parameters">Parameters</h2>

<p>df : pandas.DataFrame or None, optional
    DataFrame used to compute scaling. If None, <code>self.df</code> is used.
write : bool, optional
    Unused placeholder for interface compatibility with other components.
    Kept for potential future extensions. Default is True.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Mapping <code>{column_name: [min_value, max_value]}</code>, where values
    are derived from the 0.05 and 0.95 quantiles.</p>

<h2 id="notes">Notes</h2>

<p>If <code>self.debug</code> is True, the method emits debug messages about the
data source. Only training data should be used to avoid leakage.</p>
</div>


                            </div>
                            <div id="TramDagDataset.summary" class="classattr">
                                        <input id="TramDagDataset.summary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">summary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagDataset.summary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagDataset.summary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagDataset.summary-271"><a href="#TramDagDataset.summary-271"><span class="linenos">271</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagDataset.summary-272"><a href="#TramDagDataset.summary-272"><span class="linenos">272</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagDataset.summary-273"><a href="#TramDagDataset.summary-273"><span class="linenos">273</span></a><span class="sd">        Print a structured overview of the dataset and configuration.</span>
</span><span id="TramDagDataset.summary-274"><a href="#TramDagDataset.summary-274"><span class="linenos">274</span></a>
</span><span id="TramDagDataset.summary-275"><a href="#TramDagDataset.summary-275"><span class="linenos">275</span></a><span class="sd">        The summary includes:</span>
</span><span id="TramDagDataset.summary-276"><a href="#TramDagDataset.summary-276"><span class="linenos">276</span></a>
</span><span id="TramDagDataset.summary-277"><a href="#TramDagDataset.summary-277"><span class="linenos">277</span></a><span class="sd">        1. DataFrame information:</span>
</span><span id="TramDagDataset.summary-278"><a href="#TramDagDataset.summary-278"><span class="linenos">278</span></a><span class="sd">        - Shape</span>
</span><span id="TramDagDataset.summary-279"><a href="#TramDagDataset.summary-279"><span class="linenos">279</span></a><span class="sd">        - Columns</span>
</span><span id="TramDagDataset.summary-280"><a href="#TramDagDataset.summary-280"><span class="linenos">280</span></a><span class="sd">        - Head (first rows)</span>
</span><span id="TramDagDataset.summary-281"><a href="#TramDagDataset.summary-281"><span class="linenos">281</span></a><span class="sd">        - Dtypes</span>
</span><span id="TramDagDataset.summary-282"><a href="#TramDagDataset.summary-282"><span class="linenos">282</span></a><span class="sd">        - Descriptive statistics</span>
</span><span id="TramDagDataset.summary-283"><a href="#TramDagDataset.summary-283"><span class="linenos">283</span></a>
</span><span id="TramDagDataset.summary-284"><a href="#TramDagDataset.summary-284"><span class="linenos">284</span></a><span class="sd">        2. Configuration overview:</span>
</span><span id="TramDagDataset.summary-285"><a href="#TramDagDataset.summary-285"><span class="linenos">285</span></a><span class="sd">        - Number of nodes</span>
</span><span id="TramDagDataset.summary-286"><a href="#TramDagDataset.summary-286"><span class="linenos">286</span></a><span class="sd">        - Loader mode (DataLoader vs. raw Dataset)</span>
</span><span id="TramDagDataset.summary-287"><a href="#TramDagDataset.summary-287"><span class="linenos">287</span></a><span class="sd">        - Precomputation status</span>
</span><span id="TramDagDataset.summary-288"><a href="#TramDagDataset.summary-288"><span class="linenos">288</span></a>
</span><span id="TramDagDataset.summary-289"><a href="#TramDagDataset.summary-289"><span class="linenos">289</span></a><span class="sd">        3. Node settings:</span>
</span><span id="TramDagDataset.summary-290"><a href="#TramDagDataset.summary-290"><span class="linenos">290</span></a><span class="sd">        - Batch size</span>
</span><span id="TramDagDataset.summary-291"><a href="#TramDagDataset.summary-291"><span class="linenos">291</span></a><span class="sd">        - Shuffle flag</span>
</span><span id="TramDagDataset.summary-292"><a href="#TramDagDataset.summary-292"><span class="linenos">292</span></a><span class="sd">        - num_workers</span>
</span><span id="TramDagDataset.summary-293"><a href="#TramDagDataset.summary-293"><span class="linenos">293</span></a><span class="sd">        - pin_memory</span>
</span><span id="TramDagDataset.summary-294"><a href="#TramDagDataset.summary-294"><span class="linenos">294</span></a><span class="sd">        - return_intercept_shift</span>
</span><span id="TramDagDataset.summary-295"><a href="#TramDagDataset.summary-295"><span class="linenos">295</span></a><span class="sd">        - debug</span>
</span><span id="TramDagDataset.summary-296"><a href="#TramDagDataset.summary-296"><span class="linenos">296</span></a><span class="sd">        - transform</span>
</span><span id="TramDagDataset.summary-297"><a href="#TramDagDataset.summary-297"><span class="linenos">297</span></a>
</span><span id="TramDagDataset.summary-298"><a href="#TramDagDataset.summary-298"><span class="linenos">298</span></a><span class="sd">        4. DataLoader overview:</span>
</span><span id="TramDagDataset.summary-299"><a href="#TramDagDataset.summary-299"><span class="linenos">299</span></a><span class="sd">        - Type and length of each loader.</span>
</span><span id="TramDagDataset.summary-300"><a href="#TramDagDataset.summary-300"><span class="linenos">300</span></a>
</span><span id="TramDagDataset.summary-301"><a href="#TramDagDataset.summary-301"><span class="linenos">301</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagDataset.summary-302"><a href="#TramDagDataset.summary-302"><span class="linenos">302</span></a><span class="sd">        ----------</span>
</span><span id="TramDagDataset.summary-303"><a href="#TramDagDataset.summary-303"><span class="linenos">303</span></a><span class="sd">        None</span>
</span><span id="TramDagDataset.summary-304"><a href="#TramDagDataset.summary-304"><span class="linenos">304</span></a>
</span><span id="TramDagDataset.summary-305"><a href="#TramDagDataset.summary-305"><span class="linenos">305</span></a><span class="sd">        Returns</span>
</span><span id="TramDagDataset.summary-306"><a href="#TramDagDataset.summary-306"><span class="linenos">306</span></a><span class="sd">        -------</span>
</span><span id="TramDagDataset.summary-307"><a href="#TramDagDataset.summary-307"><span class="linenos">307</span></a><span class="sd">        None</span>
</span><span id="TramDagDataset.summary-308"><a href="#TramDagDataset.summary-308"><span class="linenos">308</span></a>
</span><span id="TramDagDataset.summary-309"><a href="#TramDagDataset.summary-309"><span class="linenos">309</span></a><span class="sd">        Notes</span>
</span><span id="TramDagDataset.summary-310"><a href="#TramDagDataset.summary-310"><span class="linenos">310</span></a><span class="sd">        -----</span>
</span><span id="TramDagDataset.summary-311"><a href="#TramDagDataset.summary-311"><span class="linenos">311</span></a><span class="sd">        Intended for quick inspection and debugging. Uses `print` statements</span>
</span><span id="TramDagDataset.summary-312"><a href="#TramDagDataset.summary-312"><span class="linenos">312</span></a><span class="sd">        and does not return structured metadata.</span>
</span><span id="TramDagDataset.summary-313"><a href="#TramDagDataset.summary-313"><span class="linenos">313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagDataset.summary-314"><a href="#TramDagDataset.summary-314"><span class="linenos">314</span></a>        
</span><span id="TramDagDataset.summary-315"><a href="#TramDagDataset.summary-315"><span class="linenos">315</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[TramDagDataset Summary]&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.summary-316"><a href="#TramDagDataset.summary-316"><span class="linenos">316</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="TramDagDataset.summary-317"><a href="#TramDagDataset.summary-317"><span class="linenos">317</span></a>
</span><span id="TramDagDataset.summary-318"><a href="#TramDagDataset.summary-318"><span class="linenos">318</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[DataFrame]&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.summary-319"><a href="#TramDagDataset.summary-319"><span class="linenos">319</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shape:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="TramDagDataset.summary-320"><a href="#TramDagDataset.summary-320"><span class="linenos">320</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Columns:&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
</span><span id="TramDagDataset.summary-321"><a href="#TramDagDataset.summary-321"><span class="linenos">321</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Head:&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.summary-322"><a href="#TramDagDataset.summary-322"><span class="linenos">322</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span><span id="TramDagDataset.summary-323"><a href="#TramDagDataset.summary-323"><span class="linenos">323</span></a>
</span><span id="TramDagDataset.summary-324"><a href="#TramDagDataset.summary-324"><span class="linenos">324</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Dtypes:&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.summary-325"><a href="#TramDagDataset.summary-325"><span class="linenos">325</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</span><span id="TramDagDataset.summary-326"><a href="#TramDagDataset.summary-326"><span class="linenos">326</span></a>
</span><span id="TramDagDataset.summary-327"><a href="#TramDagDataset.summary-327"><span class="linenos">327</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Describe:&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.summary-328"><a href="#TramDagDataset.summary-328"><span class="linenos">328</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">))</span>
</span><span id="TramDagDataset.summary-329"><a href="#TramDagDataset.summary-329"><span class="linenos">329</span></a>
</span><span id="TramDagDataset.summary-330"><a href="#TramDagDataset.summary-330"><span class="linenos">330</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Configuration]&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.summary-331"><a href="#TramDagDataset.summary-331"><span class="linenos">331</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nodes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.summary-332"><a href="#TramDagDataset.summary-332"><span class="linenos">332</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loader mode: </span><span class="si">{</span><span class="s1">&#39;DataLoader&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">use_dataloader</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Direct dataset&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.summary-333"><a href="#TramDagDataset.summary-333"><span class="linenos">333</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Precomputed: </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;use_precomputed&#39;</span><span class="p">,</span><span class="w"> </span><span class="kc">False</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.summary-334"><a href="#TramDagDataset.summary-334"><span class="linenos">334</span></a>
</span><span id="TramDagDataset.summary-335"><a href="#TramDagDataset.summary-335"><span class="linenos">335</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Node Settings]&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.summary-336"><a href="#TramDagDataset.summary-336"><span class="linenos">336</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TramDagDataset.summary-337"><a href="#TramDagDataset.summary-337"><span class="linenos">337</span></a>            <span class="n">batch_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span>
</span><span id="TramDagDataset.summary-338"><a href="#TramDagDataset.summary-338"><span class="linenos">338</span></a>            <span class="n">shuffle_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span>
</span><span id="TramDagDataset.summary-339"><a href="#TramDagDataset.summary-339"><span class="linenos">339</span></a>            <span class="n">num_workers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span>
</span><span id="TramDagDataset.summary-340"><a href="#TramDagDataset.summary-340"><span class="linenos">340</span></a>            <span class="n">pin_memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pin_memory</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pin_memory</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">pin_memory</span>
</span><span id="TramDagDataset.summary-341"><a href="#TramDagDataset.summary-341"><span class="linenos">341</span></a>            <span class="n">rshift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_intercept_shift</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">return_intercept_shift</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_intercept_shift</span>
</span><span id="TramDagDataset.summary-342"><a href="#TramDagDataset.summary-342"><span class="linenos">342</span></a>            <span class="n">debug_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span>
</span><span id="TramDagDataset.summary-343"><a href="#TramDagDataset.summary-343"><span class="linenos">343</span></a>            <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span>
</span><span id="TramDagDataset.summary-344"><a href="#TramDagDataset.summary-344"><span class="linenos">344</span></a>
</span><span id="TramDagDataset.summary-345"><a href="#TramDagDataset.summary-345"><span class="linenos">345</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="TramDagDataset.summary-346"><a href="#TramDagDataset.summary-346"><span class="linenos">346</span></a>                <span class="sa">f</span><span class="s2">&quot; Node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;: &quot;</span>
</span><span id="TramDagDataset.summary-347"><a href="#TramDagDataset.summary-347"><span class="linenos">347</span></a>                <span class="sa">f</span><span class="s2">&quot;batch_size=</span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="TramDagDataset.summary-348"><a href="#TramDagDataset.summary-348"><span class="linenos">348</span></a>                <span class="sa">f</span><span class="s2">&quot;shuffle=</span><span class="si">{</span><span class="n">shuffle_flag</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="TramDagDataset.summary-349"><a href="#TramDagDataset.summary-349"><span class="linenos">349</span></a>                <span class="sa">f</span><span class="s2">&quot;num_workers=</span><span class="si">{</span><span class="n">num_workers</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="TramDagDataset.summary-350"><a href="#TramDagDataset.summary-350"><span class="linenos">350</span></a>                <span class="sa">f</span><span class="s2">&quot;pin_memory=</span><span class="si">{</span><span class="n">pin_memory</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="TramDagDataset.summary-351"><a href="#TramDagDataset.summary-351"><span class="linenos">351</span></a>                <span class="sa">f</span><span class="s2">&quot;return_intercept_shift=</span><span class="si">{</span><span class="n">rshift</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="TramDagDataset.summary-352"><a href="#TramDagDataset.summary-352"><span class="linenos">352</span></a>                <span class="sa">f</span><span class="s2">&quot;debug=</span><span class="si">{</span><span class="n">debug_flag</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="TramDagDataset.summary-353"><a href="#TramDagDataset.summary-353"><span class="linenos">353</span></a>                <span class="sa">f</span><span class="s2">&quot;transform=</span><span class="si">{</span><span class="n">transform</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="TramDagDataset.summary-354"><a href="#TramDagDataset.summary-354"><span class="linenos">354</span></a>            <span class="p">)</span>
</span><span id="TramDagDataset.summary-355"><a href="#TramDagDataset.summary-355"><span class="linenos">355</span></a>
</span><span id="TramDagDataset.summary-356"><a href="#TramDagDataset.summary-356"><span class="linenos">356</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;loaders&quot;</span><span class="p">):</span>
</span><span id="TramDagDataset.summary-357"><a href="#TramDagDataset.summary-357"><span class="linenos">357</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[DataLoaders]&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.summary-358"><a href="#TramDagDataset.summary-358"><span class="linenos">358</span></a>            <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">loader</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaders</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagDataset.summary-359"><a href="#TramDagDataset.summary-359"><span class="linenos">359</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagDataset.summary-360"><a href="#TramDagDataset.summary-360"><span class="linenos">360</span></a>                    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="p">)</span>
</span><span id="TramDagDataset.summary-361"><a href="#TramDagDataset.summary-361"><span class="linenos">361</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="TramDagDataset.summary-362"><a href="#TramDagDataset.summary-362"><span class="linenos">362</span></a>                    <span class="n">length</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span>
</span><span id="TramDagDataset.summary-363"><a href="#TramDagDataset.summary-363"><span class="linenos">363</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">loader</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">, len=</span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagDataset.summary-364"><a href="#TramDagDataset.summary-364"><span class="linenos">364</span></a>
</span><span id="TramDagDataset.summary-365"><a href="#TramDagDataset.summary-365"><span class="linenos">365</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Print a structured overview of the dataset and configuration.</p>

<p>The summary includes:</p>

<ol>
<li>DataFrame information:</li>
</ol>

<ul>
<li>Shape</li>
<li>Columns</li>
<li>Head (first rows)</li>
<li>Dtypes</li>
<li>Descriptive statistics</li>
</ul>

<ol start="2">
<li>Configuration overview:</li>
</ol>

<ul>
<li>Number of nodes</li>
<li>Loader mode (DataLoader vs. raw Dataset)</li>
<li>Precomputation status</li>
</ul>

<ol start="3">
<li>Node settings:</li>
</ol>

<ul>
<li>Batch size</li>
<li>Shuffle flag</li>
<li>num_workers</li>
<li>pin_memory</li>
<li>return_intercept_shift</li>
<li>debug</li>
<li>transform</li>
</ul>

<ol start="4">
<li>DataLoader overview:</li>
</ol>

<ul>
<li>Type and length of each loader.</li>
</ul>

<h2 id="parameters">Parameters</h2>

<p>None</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="notes">Notes</h2>

<p>Intended for quick inspection and debugging. Uses <code>print</code> statements
and does not return structured metadata.</p>
</div>


                            </div>
                </section>
                <section id="TramDagModel">
                            <input id="TramDagModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TramDagModel</span>:

                <label class="view-source-button" for="TramDagModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel-66"><a href="#TramDagModel-66"><span class="linenos">  66</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TramDagModel</span><span class="p">:</span>
</span><span id="TramDagModel-67"><a href="#TramDagModel-67"><span class="linenos">  67</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-68"><a href="#TramDagModel-68"><span class="linenos">  68</span></a><span class="sd">    Probabilistic DAG model built from node-wise TRAMs (transformation models).</span>
</span><span id="TramDagModel-69"><a href="#TramDagModel-69"><span class="linenos">  69</span></a>
</span><span id="TramDagModel-70"><a href="#TramDagModel-70"><span class="linenos">  70</span></a><span class="sd">    This class manages:</span>
</span><span id="TramDagModel-71"><a href="#TramDagModel-71"><span class="linenos">  71</span></a><span class="sd">    - Configuration and per-node model construction.</span>
</span><span id="TramDagModel-72"><a href="#TramDagModel-72"><span class="linenos">  72</span></a><span class="sd">    - Data scaling (minmax).</span>
</span><span id="TramDagModel-73"><a href="#TramDagModel-73"><span class="linenos">  73</span></a><span class="sd">    - Training (sequential or per-node parallel on CPU).</span>
</span><span id="TramDagModel-74"><a href="#TramDagModel-74"><span class="linenos">  74</span></a><span class="sd">    - Diagnostics (loss history, intercepts, linear shifts, latents).</span>
</span><span id="TramDagModel-75"><a href="#TramDagModel-75"><span class="linenos">  75</span></a><span class="sd">    - Sampling from the joint DAG and loading stored samples.</span>
</span><span id="TramDagModel-76"><a href="#TramDagModel-76"><span class="linenos">  76</span></a><span class="sd">    - High-level summaries and plotting utilities.</span>
</span><span id="TramDagModel-77"><a href="#TramDagModel-77"><span class="linenos">  77</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TramDagModel-78"><a href="#TramDagModel-78"><span class="linenos">  78</span></a>    
</span><span id="TramDagModel-79"><a href="#TramDagModel-79"><span class="linenos">  79</span></a>    <span class="c1"># ---- defaults used at construction time ----</span>
</span><span id="TramDagModel-80"><a href="#TramDagModel-80"><span class="linenos">  80</span></a>    <span class="n">DEFAULTS_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TramDagModel-81"><a href="#TramDagModel-81"><span class="linenos">  81</span></a>        <span class="s2">&quot;set_initial_weights&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TramDagModel-82"><a href="#TramDagModel-82"><span class="linenos">  82</span></a>        <span class="s2">&quot;debug&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
</span><span id="TramDagModel-83"><a href="#TramDagModel-83"><span class="linenos">  83</span></a>        <span class="s2">&quot;verbose&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TramDagModel-84"><a href="#TramDagModel-84"><span class="linenos">  84</span></a>        <span class="s2">&quot;device&quot;</span><span class="p">:</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
</span><span id="TramDagModel-85"><a href="#TramDagModel-85"><span class="linenos">  85</span></a>        <span class="s2">&quot;initial_data&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagModel-86"><a href="#TramDagModel-86"><span class="linenos">  86</span></a>        <span class="s2">&quot;overwrite_initial_weights&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TramDagModel-87"><a href="#TramDagModel-87"><span class="linenos">  87</span></a>    <span class="p">}</span>
</span><span id="TramDagModel-88"><a href="#TramDagModel-88"><span class="linenos">  88</span></a>
</span><span id="TramDagModel-89"><a href="#TramDagModel-89"><span class="linenos">  89</span></a>    <span class="c1"># ---- defaults used at fit() time ----</span>
</span><span id="TramDagModel-90"><a href="#TramDagModel-90"><span class="linenos">  90</span></a>    <span class="n">DEFAULTS_FIT</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TramDagModel-91"><a href="#TramDagModel-91"><span class="linenos">  91</span></a>        <span class="s2">&quot;epochs&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="TramDagModel-92"><a href="#TramDagModel-92"><span class="linenos">  92</span></a>        <span class="s2">&quot;train_list&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagModel-93"><a href="#TramDagModel-93"><span class="linenos">  93</span></a>        <span class="s2">&quot;callbacks&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagModel-94"><a href="#TramDagModel-94"><span class="linenos">  94</span></a>        <span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
</span><span id="TramDagModel-95"><a href="#TramDagModel-95"><span class="linenos">  95</span></a>        <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span id="TramDagModel-96"><a href="#TramDagModel-96"><span class="linenos">  96</span></a>        <span class="s2">&quot;optimizers&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagModel-97"><a href="#TramDagModel-97"><span class="linenos">  97</span></a>        <span class="s2">&quot;schedulers&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagModel-98"><a href="#TramDagModel-98"><span class="linenos">  98</span></a>        <span class="s2">&quot;use_scheduler&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TramDagModel-99"><a href="#TramDagModel-99"><span class="linenos">  99</span></a>        <span class="s2">&quot;save_linear_shifts&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TramDagModel-100"><a href="#TramDagModel-100"><span class="linenos"> 100</span></a>        <span class="s2">&quot;save_simple_intercepts&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TramDagModel-101"><a href="#TramDagModel-101"><span class="linenos"> 101</span></a>        <span class="s2">&quot;debug&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
</span><span id="TramDagModel-102"><a href="#TramDagModel-102"><span class="linenos"> 102</span></a>        <span class="s2">&quot;verbose&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TramDagModel-103"><a href="#TramDagModel-103"><span class="linenos"> 103</span></a>        <span class="s2">&quot;train_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;sequential&quot;</span><span class="p">,</span>  <span class="c1"># or &quot;parallel&quot;</span>
</span><span id="TramDagModel-104"><a href="#TramDagModel-104"><span class="linenos"> 104</span></a>        <span class="s2">&quot;return_history&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TramDagModel-105"><a href="#TramDagModel-105"><span class="linenos"> 105</span></a>        <span class="s2">&quot;overwrite_inital_weights&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TramDagModel-106"><a href="#TramDagModel-106"><span class="linenos"> 106</span></a>        <span class="s2">&quot;num_workers&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="TramDagModel-107"><a href="#TramDagModel-107"><span class="linenos"> 107</span></a>        <span class="s2">&quot;persistent_workers&quot;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TramDagModel-108"><a href="#TramDagModel-108"><span class="linenos"> 108</span></a>        <span class="s2">&quot;prefetch_factor&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="TramDagModel-109"><a href="#TramDagModel-109"><span class="linenos"> 109</span></a>        <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span>
</span><span id="TramDagModel-110"><a href="#TramDagModel-110"><span class="linenos"> 110</span></a>        
</span><span id="TramDagModel-111"><a href="#TramDagModel-111"><span class="linenos"> 111</span></a>    <span class="p">}</span>
</span><span id="TramDagModel-112"><a href="#TramDagModel-112"><span class="linenos"> 112</span></a>
</span><span id="TramDagModel-113"><a href="#TramDagModel-113"><span class="linenos"> 113</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagModel-114"><a href="#TramDagModel-114"><span class="linenos"> 114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-115"><a href="#TramDagModel-115"><span class="linenos"> 115</span></a><span class="sd">        Initialize an empty TramDagModel shell.</span>
</span><span id="TramDagModel-116"><a href="#TramDagModel-116"><span class="linenos"> 116</span></a>
</span><span id="TramDagModel-117"><a href="#TramDagModel-117"><span class="linenos"> 117</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-118"><a href="#TramDagModel-118"><span class="linenos"> 118</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-119"><a href="#TramDagModel-119"><span class="linenos"> 119</span></a><span class="sd">        This constructor does not build any node models and does not attach a</span>
</span><span id="TramDagModel-120"><a href="#TramDagModel-120"><span class="linenos"> 120</span></a><span class="sd">        configuration. Use `TramDagModel.from_config` or `TramDagModel.from_directory`</span>
</span><span id="TramDagModel-121"><a href="#TramDagModel-121"><span class="linenos"> 121</span></a><span class="sd">        to obtain a fully configured and ready-to-use instance.</span>
</span><span id="TramDagModel-122"><a href="#TramDagModel-122"><span class="linenos"> 122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-123"><a href="#TramDagModel-123"><span class="linenos"> 123</span></a>        
</span><span id="TramDagModel-124"><a href="#TramDagModel-124"><span class="linenos"> 124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="TramDagModel-125"><a href="#TramDagModel-125"><span class="linenos"> 125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="TramDagModel-126"><a href="#TramDagModel-126"><span class="linenos"> 126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>
</span><span id="TramDagModel-127"><a href="#TramDagModel-127"><span class="linenos"> 127</span></a>        <span class="k">pass</span>
</span><span id="TramDagModel-128"><a href="#TramDagModel-128"><span class="linenos"> 128</span></a>
</span><span id="TramDagModel-129"><a href="#TramDagModel-129"><span class="linenos"> 129</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TramDagModel-130"><a href="#TramDagModel-130"><span class="linenos"> 130</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_device</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>
</span><span id="TramDagModel-131"><a href="#TramDagModel-131"><span class="linenos"> 131</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-132"><a href="#TramDagModel-132"><span class="linenos"> 132</span></a><span class="sd">        Resolve the target device string from a settings dictionary.</span>
</span><span id="TramDagModel-133"><a href="#TramDagModel-133"><span class="linenos"> 133</span></a>
</span><span id="TramDagModel-134"><a href="#TramDagModel-134"><span class="linenos"> 134</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-135"><a href="#TramDagModel-135"><span class="linenos"> 135</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-136"><a href="#TramDagModel-136"><span class="linenos"> 136</span></a><span class="sd">        settings : dict</span>
</span><span id="TramDagModel-137"><a href="#TramDagModel-137"><span class="linenos"> 137</span></a><span class="sd">            Dictionary containing at least a key ``&quot;device&quot;`` with one of</span>
</span><span id="TramDagModel-138"><a href="#TramDagModel-138"><span class="linenos"> 138</span></a><span class="sd">            {&quot;auto&quot;, &quot;cpu&quot;, &quot;cuda&quot;}. If missing, &quot;auto&quot; is assumed.</span>
</span><span id="TramDagModel-139"><a href="#TramDagModel-139"><span class="linenos"> 139</span></a>
</span><span id="TramDagModel-140"><a href="#TramDagModel-140"><span class="linenos"> 140</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-141"><a href="#TramDagModel-141"><span class="linenos"> 141</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-142"><a href="#TramDagModel-142"><span class="linenos"> 142</span></a><span class="sd">        str</span>
</span><span id="TramDagModel-143"><a href="#TramDagModel-143"><span class="linenos"> 143</span></a><span class="sd">            Device string, either &quot;cpu&quot; or &quot;cuda&quot;.</span>
</span><span id="TramDagModel-144"><a href="#TramDagModel-144"><span class="linenos"> 144</span></a>
</span><span id="TramDagModel-145"><a href="#TramDagModel-145"><span class="linenos"> 145</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-146"><a href="#TramDagModel-146"><span class="linenos"> 146</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-147"><a href="#TramDagModel-147"><span class="linenos"> 147</span></a><span class="sd">        If ``device == &quot;auto&quot;``, CUDA is selected if available, otherwise CPU.</span>
</span><span id="TramDagModel-148"><a href="#TramDagModel-148"><span class="linenos"> 148</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-149"><a href="#TramDagModel-149"><span class="linenos"> 149</span></a>        <span class="n">device_arg</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-150"><a href="#TramDagModel-150"><span class="linenos"> 150</span></a>        <span class="k">if</span> <span class="n">device_arg</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
</span><span id="TramDagModel-151"><a href="#TramDagModel-151"><span class="linenos"> 151</span></a>            <span class="n">device_str</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>
</span><span id="TramDagModel-152"><a href="#TramDagModel-152"><span class="linenos"> 152</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-153"><a href="#TramDagModel-153"><span class="linenos"> 153</span></a>            <span class="n">device_str</span> <span class="o">=</span> <span class="n">device_arg</span>
</span><span id="TramDagModel-154"><a href="#TramDagModel-154"><span class="linenos"> 154</span></a>        <span class="k">return</span> <span class="n">device_str</span>
</span><span id="TramDagModel-155"><a href="#TramDagModel-155"><span class="linenos"> 155</span></a>
</span><span id="TramDagModel-156"><a href="#TramDagModel-156"><span class="linenos"> 156</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">defaults_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DEFAULTS_FIT&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagModel-157"><a href="#TramDagModel-157"><span class="linenos"> 157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-158"><a href="#TramDagModel-158"><span class="linenos"> 158</span></a><span class="sd">        Validate a kwargs dictionary against a class-level defaults dictionary.</span>
</span><span id="TramDagModel-159"><a href="#TramDagModel-159"><span class="linenos"> 159</span></a>
</span><span id="TramDagModel-160"><a href="#TramDagModel-160"><span class="linenos"> 160</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-161"><a href="#TramDagModel-161"><span class="linenos"> 161</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-162"><a href="#TramDagModel-162"><span class="linenos"> 162</span></a><span class="sd">        kwargs : dict</span>
</span><span id="TramDagModel-163"><a href="#TramDagModel-163"><span class="linenos"> 163</span></a><span class="sd">            Keyword arguments to validate.</span>
</span><span id="TramDagModel-164"><a href="#TramDagModel-164"><span class="linenos"> 164</span></a><span class="sd">        defaults_attr : str, optional</span>
</span><span id="TramDagModel-165"><a href="#TramDagModel-165"><span class="linenos"> 165</span></a><span class="sd">            Name of the attribute on this class that contains the allowed keys,</span>
</span><span id="TramDagModel-166"><a href="#TramDagModel-166"><span class="linenos"> 166</span></a><span class="sd">            e.g. ``&quot;DEFAULTS_CONFIG&quot;`` or ``&quot;DEFAULTS_FIT&quot;``. Default is &quot;DEFAULTS_FIT&quot;.</span>
</span><span id="TramDagModel-167"><a href="#TramDagModel-167"><span class="linenos"> 167</span></a><span class="sd">        context : str or None, optional</span>
</span><span id="TramDagModel-168"><a href="#TramDagModel-168"><span class="linenos"> 168</span></a><span class="sd">            Optional label (e.g. caller name) to prepend in error messages.</span>
</span><span id="TramDagModel-169"><a href="#TramDagModel-169"><span class="linenos"> 169</span></a>
</span><span id="TramDagModel-170"><a href="#TramDagModel-170"><span class="linenos"> 170</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel-171"><a href="#TramDagModel-171"><span class="linenos"> 171</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel-172"><a href="#TramDagModel-172"><span class="linenos"> 172</span></a><span class="sd">        AttributeError</span>
</span><span id="TramDagModel-173"><a href="#TramDagModel-173"><span class="linenos"> 173</span></a><span class="sd">            If the attribute named by ``defaults_attr`` does not exist.</span>
</span><span id="TramDagModel-174"><a href="#TramDagModel-174"><span class="linenos"> 174</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel-175"><a href="#TramDagModel-175"><span class="linenos"> 175</span></a><span class="sd">            If any key in ``kwargs`` is not present in the corresponding defaults dict.</span>
</span><span id="TramDagModel-176"><a href="#TramDagModel-176"><span class="linenos"> 176</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-177"><a href="#TramDagModel-177"><span class="linenos"> 177</span></a>        <span class="n">defaults</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defaults_attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="TramDagModel-178"><a href="#TramDagModel-178"><span class="linenos"> 178</span></a>        <span class="k">if</span> <span class="n">defaults</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel-179"><a href="#TramDagModel-179"><span class="linenos"> 179</span></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> has no attribute &#39;</span><span class="si">{</span><span class="n">defaults_attr</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-180"><a href="#TramDagModel-180"><span class="linenos"> 180</span></a>
</span><span id="TramDagModel-181"><a href="#TramDagModel-181"><span class="linenos"> 181</span></a>        <span class="n">unknown</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>
</span><span id="TramDagModel-182"><a href="#TramDagModel-182"><span class="linenos"> 182</span></a>        <span class="k">if</span> <span class="n">unknown</span><span class="p">:</span>
</span><span id="TramDagModel-183"><a href="#TramDagModel-183"><span class="linenos"> 183</span></a>            <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">] &quot;</span> <span class="k">if</span> <span class="n">context</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="TramDagModel-184"><a href="#TramDagModel-184"><span class="linenos"> 184</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">Unknown parameter(s): </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">unknown</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-185"><a href="#TramDagModel-185"><span class="linenos"> 185</span></a>            
</span><span id="TramDagModel-186"><a href="#TramDagModel-186"><span class="linenos"> 186</span></a>    <span class="c1">## CREATE A TRAMDADMODEL</span>
</span><span id="TramDagModel-187"><a href="#TramDagModel-187"><span class="linenos"> 187</span></a>    <span class="nd">@classmethod</span>
</span><span id="TramDagModel-188"><a href="#TramDagModel-188"><span class="linenos"> 188</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TramDagModel-189"><a href="#TramDagModel-189"><span class="linenos"> 189</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-190"><a href="#TramDagModel-190"><span class="linenos"> 190</span></a><span class="sd">        Construct a TramDagModel from a TramDagConfig object.</span>
</span><span id="TramDagModel-191"><a href="#TramDagModel-191"><span class="linenos"> 191</span></a>
</span><span id="TramDagModel-192"><a href="#TramDagModel-192"><span class="linenos"> 192</span></a><span class="sd">        This builds one TRAM model per node in the DAG and optionally writes</span>
</span><span id="TramDagModel-193"><a href="#TramDagModel-193"><span class="linenos"> 193</span></a><span class="sd">        the initial model parameters to disk.</span>
</span><span id="TramDagModel-194"><a href="#TramDagModel-194"><span class="linenos"> 194</span></a>
</span><span id="TramDagModel-195"><a href="#TramDagModel-195"><span class="linenos"> 195</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-196"><a href="#TramDagModel-196"><span class="linenos"> 196</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-197"><a href="#TramDagModel-197"><span class="linenos"> 197</span></a><span class="sd">        cfg : TramDagConfig</span>
</span><span id="TramDagModel-198"><a href="#TramDagModel-198"><span class="linenos"> 198</span></a><span class="sd">            Configuration wrapper holding the underlying configuration dictionary,</span>
</span><span id="TramDagModel-199"><a href="#TramDagModel-199"><span class="linenos"> 199</span></a><span class="sd">            including at least:</span>
</span><span id="TramDagModel-200"><a href="#TramDagModel-200"><span class="linenos"> 200</span></a><span class="sd">            - ``conf_dict[&quot;nodes&quot;]``: mapping of node names to node configs.</span>
</span><span id="TramDagModel-201"><a href="#TramDagModel-201"><span class="linenos"> 201</span></a><span class="sd">            - ``conf_dict[&quot;PATHS&quot;][&quot;EXPERIMENT_DIR&quot;]``: experiment directory.</span>
</span><span id="TramDagModel-202"><a href="#TramDagModel-202"><span class="linenos"> 202</span></a><span class="sd">        **kwargs</span>
</span><span id="TramDagModel-203"><a href="#TramDagModel-203"><span class="linenos"> 203</span></a><span class="sd">            Node-level construction options. Each key must be present in</span>
</span><span id="TramDagModel-204"><a href="#TramDagModel-204"><span class="linenos"> 204</span></a><span class="sd">            ``DEFAULTS_CONFIG``. Values can be:</span>
</span><span id="TramDagModel-205"><a href="#TramDagModel-205"><span class="linenos"> 205</span></a><span class="sd">            - scalar: applied to all nodes.</span>
</span><span id="TramDagModel-206"><a href="#TramDagModel-206"><span class="linenos"> 206</span></a><span class="sd">            - dict: mapping ``{node_name: value}`` for per-node overrides.</span>
</span><span id="TramDagModel-207"><a href="#TramDagModel-207"><span class="linenos"> 207</span></a>
</span><span id="TramDagModel-208"><a href="#TramDagModel-208"><span class="linenos"> 208</span></a><span class="sd">            Common keys include:</span>
</span><span id="TramDagModel-209"><a href="#TramDagModel-209"><span class="linenos"> 209</span></a><span class="sd">            device : {&quot;auto&quot;, &quot;cpu&quot;, &quot;cuda&quot;}, default &quot;auto&quot;</span>
</span><span id="TramDagModel-210"><a href="#TramDagModel-210"><span class="linenos"> 210</span></a><span class="sd">                Device selection (CUDA if available when &quot;auto&quot;).</span>
</span><span id="TramDagModel-211"><a href="#TramDagModel-211"><span class="linenos"> 211</span></a><span class="sd">            debug : bool, default False</span>
</span><span id="TramDagModel-212"><a href="#TramDagModel-212"><span class="linenos"> 212</span></a><span class="sd">                If True, print debug messages.</span>
</span><span id="TramDagModel-213"><a href="#TramDagModel-213"><span class="linenos"> 213</span></a><span class="sd">            verbose : bool, default False</span>
</span><span id="TramDagModel-214"><a href="#TramDagModel-214"><span class="linenos"> 214</span></a><span class="sd">                If True, print informational messages.</span>
</span><span id="TramDagModel-215"><a href="#TramDagModel-215"><span class="linenos"> 215</span></a><span class="sd">            set_initial_weights : bool</span>
</span><span id="TramDagModel-216"><a href="#TramDagModel-216"><span class="linenos"> 216</span></a><span class="sd">                Passed to underlying TRAM model constructors.</span>
</span><span id="TramDagModel-217"><a href="#TramDagModel-217"><span class="linenos"> 217</span></a><span class="sd">            overwrite_initial_weights : bool, default True</span>
</span><span id="TramDagModel-218"><a href="#TramDagModel-218"><span class="linenos"> 218</span></a><span class="sd">                If True, overwrite any existing ``initial_model.pt`` files per node.</span>
</span><span id="TramDagModel-219"><a href="#TramDagModel-219"><span class="linenos"> 219</span></a><span class="sd">            initial_data : Any</span>
</span><span id="TramDagModel-220"><a href="#TramDagModel-220"><span class="linenos"> 220</span></a><span class="sd">                Optional object passed down to node constructors.</span>
</span><span id="TramDagModel-221"><a href="#TramDagModel-221"><span class="linenos"> 221</span></a>
</span><span id="TramDagModel-222"><a href="#TramDagModel-222"><span class="linenos"> 222</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-223"><a href="#TramDagModel-223"><span class="linenos"> 223</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-224"><a href="#TramDagModel-224"><span class="linenos"> 224</span></a><span class="sd">        TramDagModel</span>
</span><span id="TramDagModel-225"><a href="#TramDagModel-225"><span class="linenos"> 225</span></a><span class="sd">            Fully initialized instance with:</span>
</span><span id="TramDagModel-226"><a href="#TramDagModel-226"><span class="linenos"> 226</span></a><span class="sd">            - ``cfg``</span>
</span><span id="TramDagModel-227"><a href="#TramDagModel-227"><span class="linenos"> 227</span></a><span class="sd">            - ``nodes_dict``</span>
</span><span id="TramDagModel-228"><a href="#TramDagModel-228"><span class="linenos"> 228</span></a><span class="sd">            - ``models`` (per-node TRAMs)</span>
</span><span id="TramDagModel-229"><a href="#TramDagModel-229"><span class="linenos"> 229</span></a><span class="sd">            - ``settings`` (resolved per-node config)</span>
</span><span id="TramDagModel-230"><a href="#TramDagModel-230"><span class="linenos"> 230</span></a>
</span><span id="TramDagModel-231"><a href="#TramDagModel-231"><span class="linenos"> 231</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel-232"><a href="#TramDagModel-232"><span class="linenos"> 232</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel-233"><a href="#TramDagModel-233"><span class="linenos"> 233</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel-234"><a href="#TramDagModel-234"><span class="linenos"> 234</span></a><span class="sd">            If any dict-valued kwarg does not provide values for exactly the set</span>
</span><span id="TramDagModel-235"><a href="#TramDagModel-235"><span class="linenos"> 235</span></a><span class="sd">            of nodes in ``cfg.conf_dict[&quot;nodes&quot;]``.</span>
</span><span id="TramDagModel-236"><a href="#TramDagModel-236"><span class="linenos"> 236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-237"><a href="#TramDagModel-237"><span class="linenos"> 237</span></a>        
</span><span id="TramDagModel-238"><a href="#TramDagModel-238"><span class="linenos"> 238</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span><span id="TramDagModel-239"><a href="#TramDagModel-239"><span class="linenos"> 239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span>
</span><span id="TramDagModel-240"><a href="#TramDagModel-240"><span class="linenos"> 240</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># ensure latest version from disk</span>
</span><span id="TramDagModel-241"><a href="#TramDagModel-241"><span class="linenos"> 241</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">_verify_completeness</span><span class="p">()</span>
</span><span id="TramDagModel-242"><a href="#TramDagModel-242"><span class="linenos"> 242</span></a>        
</span><span id="TramDagModel-243"><a href="#TramDagModel-243"><span class="linenos"> 243</span></a>        
</span><span id="TramDagModel-244"><a href="#TramDagModel-244"><span class="linenos"> 244</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-245"><a href="#TramDagModel-245"><span class="linenos"> 245</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c1"># persist back to disk</span>
</span><span id="TramDagModel-246"><a href="#TramDagModel-246"><span class="linenos"> 246</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel-247"><a href="#TramDagModel-247"><span class="linenos"> 247</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Configuration updated and saved.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-248"><a href="#TramDagModel-248"><span class="linenos"> 248</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel-249"><a href="#TramDagModel-249"><span class="linenos"> 249</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Could not save configuration after update: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>        
</span><span id="TramDagModel-250"><a href="#TramDagModel-250"><span class="linenos"> 250</span></a>            
</span><span id="TramDagModel-251"><a href="#TramDagModel-251"><span class="linenos"> 251</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span> 
</span><span id="TramDagModel-252"><a href="#TramDagModel-252"><span class="linenos"> 252</span></a>
</span><span id="TramDagModel-253"><a href="#TramDagModel-253"><span class="linenos"> 253</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">defaults_attr</span><span class="o">=</span><span class="s1">&#39;DEFAULTS_CONFIG&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;from_config&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-254"><a href="#TramDagModel-254"><span class="linenos"> 254</span></a>
</span><span id="TramDagModel-255"><a href="#TramDagModel-255"><span class="linenos"> 255</span></a>        <span class="c1"># update defaults with kwargs</span>
</span><span id="TramDagModel-256"><a href="#TramDagModel-256"><span class="linenos"> 256</span></a>        <span class="n">settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">DEFAULTS_CONFIG</span><span class="p">)</span>
</span><span id="TramDagModel-257"><a href="#TramDagModel-257"><span class="linenos"> 257</span></a>        <span class="n">settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TramDagModel-258"><a href="#TramDagModel-258"><span class="linenos"> 258</span></a>
</span><span id="TramDagModel-259"><a href="#TramDagModel-259"><span class="linenos"> 259</span></a>        <span class="c1"># resolve device</span>
</span><span id="TramDagModel-260"><a href="#TramDagModel-260"><span class="linenos"> 260</span></a>        <span class="n">device_arg</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-261"><a href="#TramDagModel-261"><span class="linenos"> 261</span></a>        <span class="k">if</span> <span class="n">device_arg</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
</span><span id="TramDagModel-262"><a href="#TramDagModel-262"><span class="linenos"> 262</span></a>            <span class="n">device_str</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>
</span><span id="TramDagModel-263"><a href="#TramDagModel-263"><span class="linenos"> 263</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-264"><a href="#TramDagModel-264"><span class="linenos"> 264</span></a>            <span class="n">device_str</span> <span class="o">=</span> <span class="n">device_arg</span>
</span><span id="TramDagModel-265"><a href="#TramDagModel-265"><span class="linenos"> 265</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device_str</span><span class="p">)</span>
</span><span id="TramDagModel-266"><a href="#TramDagModel-266"><span class="linenos"> 266</span></a>
</span><span id="TramDagModel-267"><a href="#TramDagModel-267"><span class="linenos"> 267</span></a>        <span class="c1"># set flags on the instance so they are accessible later</span>
</span><span id="TramDagModel-268"><a href="#TramDagModel-268"><span class="linenos"> 268</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="TramDagModel-269"><a href="#TramDagModel-269"><span class="linenos"> 269</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="TramDagModel-270"><a href="#TramDagModel-270"><span class="linenos"> 270</span></a>
</span><span id="TramDagModel-271"><a href="#TramDagModel-271"><span class="linenos"> 271</span></a>        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel-272"><a href="#TramDagModel-272"><span class="linenos"> 272</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] TramDagModel using device: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-273"><a href="#TramDagModel-273"><span class="linenos"> 273</span></a>            
</span><span id="TramDagModel-274"><a href="#TramDagModel-274"><span class="linenos"> 274</span></a>        <span class="c1"># initialize settings storage</span>
</span><span id="TramDagModel-275"><a href="#TramDagModel-275"><span class="linenos"> 275</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
</span><span id="TramDagModel-276"><a href="#TramDagModel-276"><span class="linenos"> 276</span></a>
</span><span id="TramDagModel-277"><a href="#TramDagModel-277"><span class="linenos"> 277</span></a>        <span class="c1"># validate dict-typed args</span>
</span><span id="TramDagModel-278"><a href="#TramDagModel-278"><span class="linenos"> 278</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagModel-279"><a href="#TramDagModel-279"><span class="linenos"> 279</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="TramDagModel-280"><a href="#TramDagModel-280"><span class="linenos"> 280</span></a>                <span class="n">expected</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel-281"><a href="#TramDagModel-281"><span class="linenos"> 281</span></a>                <span class="n">given</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel-282"><a href="#TramDagModel-282"><span class="linenos"> 282</span></a>                <span class="k">if</span> <span class="n">expected</span> <span class="o">!=</span> <span class="n">given</span><span class="p">:</span>
</span><span id="TramDagModel-283"><a href="#TramDagModel-283"><span class="linenos"> 283</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel-284"><a href="#TramDagModel-284"><span class="linenos"> 284</span></a>                        <span class="sa">f</span><span class="s2">&quot;[ERROR] the provided argument &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; keys are not same as in cfg.conf_dict[&#39;nodes&#39;].keys().</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="TramDagModel-285"><a href="#TramDagModel-285"><span class="linenos"> 285</span></a>                        <span class="sa">f</span><span class="s2">&quot;Expected: </span><span class="si">{</span><span class="n">expected</span><span class="si">}</span><span class="s2">, but got: </span><span class="si">{</span><span class="n">given</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="TramDagModel-286"><a href="#TramDagModel-286"><span class="linenos"> 286</span></a>                        <span class="sa">f</span><span class="s2">&quot;Please provide values for all variables.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-287"><a href="#TramDagModel-287"><span class="linenos"> 287</span></a>
</span><span id="TramDagModel-288"><a href="#TramDagModel-288"><span class="linenos"> 288</span></a>        <span class="c1"># build one model per node</span>
</span><span id="TramDagModel-289"><a href="#TramDagModel-289"><span class="linenos"> 289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel-290"><a href="#TramDagModel-290"><span class="linenos"> 290</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TramDagModel-291"><a href="#TramDagModel-291"><span class="linenos"> 291</span></a>            <span class="n">per_node_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel-292"><a href="#TramDagModel-292"><span class="linenos"> 292</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagModel-293"><a href="#TramDagModel-293"><span class="linenos"> 293</span></a>                <span class="n">resolved</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span>
</span><span id="TramDagModel-294"><a href="#TramDagModel-294"><span class="linenos"> 294</span></a>                <span class="n">per_node_kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">resolved</span>
</span><span id="TramDagModel-295"><a href="#TramDagModel-295"><span class="linenos"> 295</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">resolved</span>
</span><span id="TramDagModel-296"><a href="#TramDagModel-296"><span class="linenos"> 296</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel-297"><a href="#TramDagModel-297"><span class="linenos"> 297</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[INFO] Building model for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; with settings: </span><span class="si">{</span><span class="n">per_node_kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-298"><a href="#TramDagModel-298"><span class="linenos"> 298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_fully_specified_tram_model</span><span class="p">(</span>
</span><span id="TramDagModel-299"><a href="#TramDagModel-299"><span class="linenos"> 299</span></a>                <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
</span><span id="TramDagModel-300"><a href="#TramDagModel-300"><span class="linenos"> 300</span></a>                <span class="n">configuration_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">,</span>
</span><span id="TramDagModel-301"><a href="#TramDagModel-301"><span class="linenos"> 301</span></a>                <span class="o">**</span><span class="n">per_node_kwargs</span><span class="p">)</span>
</span><span id="TramDagModel-302"><a href="#TramDagModel-302"><span class="linenos"> 302</span></a>            
</span><span id="TramDagModel-303"><a href="#TramDagModel-303"><span class="linenos"> 303</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-304"><a href="#TramDagModel-304"><span class="linenos"> 304</span></a>                <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-305"><a href="#TramDagModel-305"><span class="linenos"> 305</span></a>                <span class="n">NODE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-306"><a href="#TramDagModel-306"><span class="linenos"> 306</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TramDagModel-307"><a href="#TramDagModel-307"><span class="linenos"> 307</span></a>
</span><span id="TramDagModel-308"><a href="#TramDagModel-308"><span class="linenos"> 308</span></a>                <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">,</span> <span class="s2">&quot;initial_model.pt&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-309"><a href="#TramDagModel-309"><span class="linenos"> 309</span></a>                <span class="n">overwrite</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;overwrite_initial_weights&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="TramDagModel-310"><a href="#TramDagModel-310"><span class="linenos"> 310</span></a>
</span><span id="TramDagModel-311"><a href="#TramDagModel-311"><span class="linenos"> 311</span></a>                <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_path</span><span class="p">):</span>
</span><span id="TramDagModel-312"><a href="#TramDagModel-312"><span class="linenos"> 312</span></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="n">model_path</span><span class="p">)</span>
</span><span id="TramDagModel-313"><a href="#TramDagModel-313"><span class="linenos"> 313</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel-314"><a href="#TramDagModel-314"><span class="linenos"> 314</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Saved initial model state for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; to </span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s2"> (overwrite=</span><span class="si">{</span><span class="n">overwrite</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-315"><a href="#TramDagModel-315"><span class="linenos"> 315</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-316"><a href="#TramDagModel-316"><span class="linenos"> 316</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel-317"><a href="#TramDagModel-317"><span class="linenos"> 317</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Skipped saving initial model for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; (already exists at </span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-318"><a href="#TramDagModel-318"><span class="linenos"> 318</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel-319"><a href="#TramDagModel-319"><span class="linenos"> 319</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] Could not save initial model state for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-320"><a href="#TramDagModel-320"><span class="linenos"> 320</span></a>            
</span><span id="TramDagModel-321"><a href="#TramDagModel-321"><span class="linenos"> 321</span></a>            <span class="n">TEMP_DIR</span> <span class="o">=</span> <span class="s2">&quot;temp&quot;</span>
</span><span id="TramDagModel-322"><a href="#TramDagModel-322"><span class="linenos"> 322</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">TEMP_DIR</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">TEMP_DIR</span><span class="p">):</span>
</span><span id="TramDagModel-323"><a href="#TramDagModel-323"><span class="linenos"> 323</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">TEMP_DIR</span><span class="p">)</span>
</span><span id="TramDagModel-324"><a href="#TramDagModel-324"><span class="linenos"> 324</span></a>                            
</span><span id="TramDagModel-325"><a href="#TramDagModel-325"><span class="linenos"> 325</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="TramDagModel-326"><a href="#TramDagModel-326"><span class="linenos"> 326</span></a>
</span><span id="TramDagModel-327"><a href="#TramDagModel-327"><span class="linenos"> 327</span></a>    <span class="nd">@classmethod</span>
</span><span id="TramDagModel-328"><a href="#TramDagModel-328"><span class="linenos"> 328</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_directory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">EXPERIMENT_DIR</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel-329"><a href="#TramDagModel-329"><span class="linenos"> 329</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-330"><a href="#TramDagModel-330"><span class="linenos"> 330</span></a><span class="sd">        Reconstruct a TramDagModel from an experiment directory on disk.</span>
</span><span id="TramDagModel-331"><a href="#TramDagModel-331"><span class="linenos"> 331</span></a>
</span><span id="TramDagModel-332"><a href="#TramDagModel-332"><span class="linenos"> 332</span></a><span class="sd">        This method:</span>
</span><span id="TramDagModel-333"><a href="#TramDagModel-333"><span class="linenos"> 333</span></a><span class="sd">        1. Loads the configuration JSON.</span>
</span><span id="TramDagModel-334"><a href="#TramDagModel-334"><span class="linenos"> 334</span></a><span class="sd">        2. Wraps it in a TramDagConfig.</span>
</span><span id="TramDagModel-335"><a href="#TramDagModel-335"><span class="linenos"> 335</span></a><span class="sd">        3. Builds all node models via `from_config`.</span>
</span><span id="TramDagModel-336"><a href="#TramDagModel-336"><span class="linenos"> 336</span></a><span class="sd">        4. Loads the minmax scaling dictionary.</span>
</span><span id="TramDagModel-337"><a href="#TramDagModel-337"><span class="linenos"> 337</span></a>
</span><span id="TramDagModel-338"><a href="#TramDagModel-338"><span class="linenos"> 338</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-339"><a href="#TramDagModel-339"><span class="linenos"> 339</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-340"><a href="#TramDagModel-340"><span class="linenos"> 340</span></a><span class="sd">        EXPERIMENT_DIR : str</span>
</span><span id="TramDagModel-341"><a href="#TramDagModel-341"><span class="linenos"> 341</span></a><span class="sd">            Path to an experiment directory containing:</span>
</span><span id="TramDagModel-342"><a href="#TramDagModel-342"><span class="linenos"> 342</span></a><span class="sd">            - ``configuration.json``</span>
</span><span id="TramDagModel-343"><a href="#TramDagModel-343"><span class="linenos"> 343</span></a><span class="sd">            - ``min_max_scaling.json``.</span>
</span><span id="TramDagModel-344"><a href="#TramDagModel-344"><span class="linenos"> 344</span></a><span class="sd">        device : {&quot;auto&quot;, &quot;cpu&quot;, &quot;cuda&quot;}, optional</span>
</span><span id="TramDagModel-345"><a href="#TramDagModel-345"><span class="linenos"> 345</span></a><span class="sd">            Device selection. Default is &quot;auto&quot;.</span>
</span><span id="TramDagModel-346"><a href="#TramDagModel-346"><span class="linenos"> 346</span></a><span class="sd">        debug : bool, optional</span>
</span><span id="TramDagModel-347"><a href="#TramDagModel-347"><span class="linenos"> 347</span></a><span class="sd">            If True, enable debug messages. Default is False.</span>
</span><span id="TramDagModel-348"><a href="#TramDagModel-348"><span class="linenos"> 348</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="TramDagModel-349"><a href="#TramDagModel-349"><span class="linenos"> 349</span></a><span class="sd">            If True, enable informational messages. Default is False.</span>
</span><span id="TramDagModel-350"><a href="#TramDagModel-350"><span class="linenos"> 350</span></a>
</span><span id="TramDagModel-351"><a href="#TramDagModel-351"><span class="linenos"> 351</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-352"><a href="#TramDagModel-352"><span class="linenos"> 352</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-353"><a href="#TramDagModel-353"><span class="linenos"> 353</span></a><span class="sd">        TramDagModel</span>
</span><span id="TramDagModel-354"><a href="#TramDagModel-354"><span class="linenos"> 354</span></a><span class="sd">            A TramDagModel instance with models, config, and scaling loaded.</span>
</span><span id="TramDagModel-355"><a href="#TramDagModel-355"><span class="linenos"> 355</span></a>
</span><span id="TramDagModel-356"><a href="#TramDagModel-356"><span class="linenos"> 356</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel-357"><a href="#TramDagModel-357"><span class="linenos"> 357</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel-358"><a href="#TramDagModel-358"><span class="linenos"> 358</span></a><span class="sd">        FileNotFoundError</span>
</span><span id="TramDagModel-359"><a href="#TramDagModel-359"><span class="linenos"> 359</span></a><span class="sd">            If configuration or minmax files cannot be found.</span>
</span><span id="TramDagModel-360"><a href="#TramDagModel-360"><span class="linenos"> 360</span></a><span class="sd">        RuntimeError</span>
</span><span id="TramDagModel-361"><a href="#TramDagModel-361"><span class="linenos"> 361</span></a><span class="sd">            If the minmax file cannot be read or parsed.</span>
</span><span id="TramDagModel-362"><a href="#TramDagModel-362"><span class="linenos"> 362</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-363"><a href="#TramDagModel-363"><span class="linenos"> 363</span></a>
</span><span id="TramDagModel-364"><a href="#TramDagModel-364"><span class="linenos"> 364</span></a>        <span class="c1"># --- load config file ---</span>
</span><span id="TramDagModel-365"><a href="#TramDagModel-365"><span class="linenos"> 365</span></a>        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="s2">&quot;configuration.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-366"><a href="#TramDagModel-366"><span class="linenos"> 366</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_path</span><span class="p">):</span>
</span><span id="TramDagModel-367"><a href="#TramDagModel-367"><span class="linenos"> 367</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] Config file not found at </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-368"><a href="#TramDagModel-368"><span class="linenos"> 368</span></a>
</span><span id="TramDagModel-369"><a href="#TramDagModel-369"><span class="linenos"> 369</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel-370"><a href="#TramDagModel-370"><span class="linenos"> 370</span></a>            <span class="n">cfg_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TramDagModel-371"><a href="#TramDagModel-371"><span class="linenos"> 371</span></a>
</span><span id="TramDagModel-372"><a href="#TramDagModel-372"><span class="linenos"> 372</span></a>        <span class="c1"># Create TramConfig wrapper </span>
</span><span id="TramDagModel-373"><a href="#TramDagModel-373"><span class="linenos"> 373</span></a>        <span class="n">cfg</span> <span class="o">=</span> <span class="n">TramDagConfig</span><span class="p">(</span><span class="n">cfg_dict</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="o">=</span><span class="n">config_path</span><span class="p">)</span>
</span><span id="TramDagModel-374"><a href="#TramDagModel-374"><span class="linenos"> 374</span></a>
</span><span id="TramDagModel-375"><a href="#TramDagModel-375"><span class="linenos"> 375</span></a>        <span class="c1"># --- build model from config ---</span>
</span><span id="TramDagModel-376"><a href="#TramDagModel-376"><span class="linenos"> 376</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">overwrite_initial_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="TramDagModel-377"><a href="#TramDagModel-377"><span class="linenos"> 377</span></a>
</span><span id="TramDagModel-378"><a href="#TramDagModel-378"><span class="linenos"> 378</span></a>        <span class="c1"># --- load minmax scaling ---</span>
</span><span id="TramDagModel-379"><a href="#TramDagModel-379"><span class="linenos"> 379</span></a>        <span class="n">minmax_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="s2">&quot;min_max_scaling.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-380"><a href="#TramDagModel-380"><span class="linenos"> 380</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">minmax_path</span><span class="p">):</span>
</span><span id="TramDagModel-381"><a href="#TramDagModel-381"><span class="linenos"> 381</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] MinMax file not found at </span><span class="si">{</span><span class="n">minmax_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-382"><a href="#TramDagModel-382"><span class="linenos"> 382</span></a>
</span><span id="TramDagModel-383"><a href="#TramDagModel-383"><span class="linenos"> 383</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">minmax_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel-384"><a href="#TramDagModel-384"><span class="linenos"> 384</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TramDagModel-385"><a href="#TramDagModel-385"><span class="linenos"> 385</span></a>
</span><span id="TramDagModel-386"><a href="#TramDagModel-386"><span class="linenos"> 386</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel-387"><a href="#TramDagModel-387"><span class="linenos"> 387</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Loaded TramDagModel from </span><span class="si">{</span><span class="n">EXPERIMENT_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-388"><a href="#TramDagModel-388"><span class="linenos"> 388</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Config loaded from </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-389"><a href="#TramDagModel-389"><span class="linenos"> 389</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] MinMax scaling loaded from </span><span class="si">{</span><span class="n">minmax_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-390"><a href="#TramDagModel-390"><span class="linenos"> 390</span></a>
</span><span id="TramDagModel-391"><a href="#TramDagModel-391"><span class="linenos"> 391</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="TramDagModel-392"><a href="#TramDagModel-392"><span class="linenos"> 392</span></a>
</span><span id="TramDagModel-393"><a href="#TramDagModel-393"><span class="linenos"> 393</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_ensure_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">is_val</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TramDagModel-394"><a href="#TramDagModel-394"><span class="linenos"> 394</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-395"><a href="#TramDagModel-395"><span class="linenos"> 395</span></a><span class="sd">        Ensure that the input data is represented as a TramDagDataset.</span>
</span><span id="TramDagModel-396"><a href="#TramDagModel-396"><span class="linenos"> 396</span></a>
</span><span id="TramDagModel-397"><a href="#TramDagModel-397"><span class="linenos"> 397</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-398"><a href="#TramDagModel-398"><span class="linenos"> 398</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-399"><a href="#TramDagModel-399"><span class="linenos"> 399</span></a><span class="sd">        data : pandas.DataFrame, TramDagDataset, or None</span>
</span><span id="TramDagModel-400"><a href="#TramDagModel-400"><span class="linenos"> 400</span></a><span class="sd">            Input data to be converted or passed through.</span>
</span><span id="TramDagModel-401"><a href="#TramDagModel-401"><span class="linenos"> 401</span></a><span class="sd">        is_val : bool, optional</span>
</span><span id="TramDagModel-402"><a href="#TramDagModel-402"><span class="linenos"> 402</span></a><span class="sd">            If True, the resulting dataset is treated as validation data</span>
</span><span id="TramDagModel-403"><a href="#TramDagModel-403"><span class="linenos"> 403</span></a><span class="sd">            (e.g. no shuffling). Default is False.</span>
</span><span id="TramDagModel-404"><a href="#TramDagModel-404"><span class="linenos"> 404</span></a><span class="sd">        **kwargs</span>
</span><span id="TramDagModel-405"><a href="#TramDagModel-405"><span class="linenos"> 405</span></a><span class="sd">            Additional keyword arguments passed through to</span>
</span><span id="TramDagModel-406"><a href="#TramDagModel-406"><span class="linenos"> 406</span></a><span class="sd">            ``TramDagDataset.from_dataframe``.</span>
</span><span id="TramDagModel-407"><a href="#TramDagModel-407"><span class="linenos"> 407</span></a>
</span><span id="TramDagModel-408"><a href="#TramDagModel-408"><span class="linenos"> 408</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-409"><a href="#TramDagModel-409"><span class="linenos"> 409</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-410"><a href="#TramDagModel-410"><span class="linenos"> 410</span></a><span class="sd">        TramDagDataset or None</span>
</span><span id="TramDagModel-411"><a href="#TramDagModel-411"><span class="linenos"> 411</span></a><span class="sd">            A TramDagDataset if ``data`` is a DataFrame or TramDagDataset,</span>
</span><span id="TramDagModel-412"><a href="#TramDagModel-412"><span class="linenos"> 412</span></a><span class="sd">            otherwise None if ``data`` is None.</span>
</span><span id="TramDagModel-413"><a href="#TramDagModel-413"><span class="linenos"> 413</span></a>
</span><span id="TramDagModel-414"><a href="#TramDagModel-414"><span class="linenos"> 414</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel-415"><a href="#TramDagModel-415"><span class="linenos"> 415</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel-416"><a href="#TramDagModel-416"><span class="linenos"> 416</span></a><span class="sd">        TypeError</span>
</span><span id="TramDagModel-417"><a href="#TramDagModel-417"><span class="linenos"> 417</span></a><span class="sd">            If ``data`` is not a DataFrame, TramDagDataset, or None.</span>
</span><span id="TramDagModel-418"><a href="#TramDagModel-418"><span class="linenos"> 418</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-419"><a href="#TramDagModel-419"><span class="linenos"> 419</span></a>                
</span><span id="TramDagModel-420"><a href="#TramDagModel-420"><span class="linenos"> 420</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="TramDagModel-421"><a href="#TramDagModel-421"><span class="linenos"> 421</span></a>            <span class="k">return</span> <span class="n">TramDagDataset</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="ow">not</span> <span class="n">is_val</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TramDagModel-422"><a href="#TramDagModel-422"><span class="linenos"> 422</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">TramDagDataset</span><span class="p">):</span>
</span><span id="TramDagModel-423"><a href="#TramDagModel-423"><span class="linenos"> 423</span></a>            <span class="k">return</span> <span class="n">data</span>
</span><span id="TramDagModel-424"><a href="#TramDagModel-424"><span class="linenos"> 424</span></a>        <span class="k">elif</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel-425"><a href="#TramDagModel-425"><span class="linenos"> 425</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="TramDagModel-426"><a href="#TramDagModel-426"><span class="linenos"> 426</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-427"><a href="#TramDagModel-427"><span class="linenos"> 427</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="TramDagModel-428"><a href="#TramDagModel-428"><span class="linenos"> 428</span></a>                <span class="sa">f</span><span class="s2">&quot;[ERROR] data must be pd.DataFrame, TramDagDataset, or None, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="TramDagModel-429"><a href="#TramDagModel-429"><span class="linenos"> 429</span></a>            <span class="p">)</span>
</span><span id="TramDagModel-430"><a href="#TramDagModel-430"><span class="linenos"> 430</span></a>
</span><span id="TramDagModel-431"><a href="#TramDagModel-431"><span class="linenos"> 431</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_or_compute_minmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">td_train_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">use_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="TramDagModel-432"><a href="#TramDagModel-432"><span class="linenos"> 432</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-433"><a href="#TramDagModel-433"><span class="linenos"> 433</span></a><span class="sd">        Load an existing MinMax scaling dictionary from disk or compute a new one </span>
</span><span id="TramDagModel-434"><a href="#TramDagModel-434"><span class="linenos"> 434</span></a><span class="sd">        from the provided training dataset.</span>
</span><span id="TramDagModel-435"><a href="#TramDagModel-435"><span class="linenos"> 435</span></a>
</span><span id="TramDagModel-436"><a href="#TramDagModel-436"><span class="linenos"> 436</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-437"><a href="#TramDagModel-437"><span class="linenos"> 437</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-438"><a href="#TramDagModel-438"><span class="linenos"> 438</span></a><span class="sd">        use_existing : bool, optional (default=False)</span>
</span><span id="TramDagModel-439"><a href="#TramDagModel-439"><span class="linenos"> 439</span></a><span class="sd">            If True, attempts to load an existing `min_max_scaling.json` file </span>
</span><span id="TramDagModel-440"><a href="#TramDagModel-440"><span class="linenos"> 440</span></a><span class="sd">            from the experiment directory. Raises an error if the file is missing </span>
</span><span id="TramDagModel-441"><a href="#TramDagModel-441"><span class="linenos"> 441</span></a><span class="sd">            or unreadable.</span>
</span><span id="TramDagModel-442"><a href="#TramDagModel-442"><span class="linenos"> 442</span></a>
</span><span id="TramDagModel-443"><a href="#TramDagModel-443"><span class="linenos"> 443</span></a><span class="sd">        write : bool, optional (default=True)</span>
</span><span id="TramDagModel-444"><a href="#TramDagModel-444"><span class="linenos"> 444</span></a><span class="sd">            If True, writes the computed MinMax scaling dictionary to </span>
</span><span id="TramDagModel-445"><a href="#TramDagModel-445"><span class="linenos"> 445</span></a><span class="sd">            `&lt;EXPERIMENT_DIR&gt;/min_max_scaling.json`.</span>
</span><span id="TramDagModel-446"><a href="#TramDagModel-446"><span class="linenos"> 446</span></a>
</span><span id="TramDagModel-447"><a href="#TramDagModel-447"><span class="linenos"> 447</span></a><span class="sd">        td_train_data : object, optional</span>
</span><span id="TramDagModel-448"><a href="#TramDagModel-448"><span class="linenos"> 448</span></a><span class="sd">            Training dataset used to compute scaling statistics. If not provided,</span>
</span><span id="TramDagModel-449"><a href="#TramDagModel-449"><span class="linenos"> 449</span></a><span class="sd">            the method will ensure or construct it via `_ensure_dataset(data=..., is_val=False)`.</span>
</span><span id="TramDagModel-450"><a href="#TramDagModel-450"><span class="linenos"> 450</span></a>
</span><span id="TramDagModel-451"><a href="#TramDagModel-451"><span class="linenos"> 451</span></a><span class="sd">        Behavior</span>
</span><span id="TramDagModel-452"><a href="#TramDagModel-452"><span class="linenos"> 452</span></a><span class="sd">        --------</span>
</span><span id="TramDagModel-453"><a href="#TramDagModel-453"><span class="linenos"> 453</span></a><span class="sd">        - If `use_existing=True`, loads the JSON file containing previously saved </span>
</span><span id="TramDagModel-454"><a href="#TramDagModel-454"><span class="linenos"> 454</span></a><span class="sd">          minmax values and stores it in `self.minmax_dict`.</span>
</span><span id="TramDagModel-455"><a href="#TramDagModel-455"><span class="linenos"> 455</span></a><span class="sd">        - If `use_existing=False`, computes a new scaling dictionary using </span>
</span><span id="TramDagModel-456"><a href="#TramDagModel-456"><span class="linenos"> 456</span></a><span class="sd">          `td_train_data.compute_scaling()` and stores the result in </span>
</span><span id="TramDagModel-457"><a href="#TramDagModel-457"><span class="linenos"> 457</span></a><span class="sd">          `self.minmax_dict`.</span>
</span><span id="TramDagModel-458"><a href="#TramDagModel-458"><span class="linenos"> 458</span></a><span class="sd">        - Optionally writes the computed dictionary to disk.</span>
</span><span id="TramDagModel-459"><a href="#TramDagModel-459"><span class="linenos"> 459</span></a>
</span><span id="TramDagModel-460"><a href="#TramDagModel-460"><span class="linenos"> 460</span></a><span class="sd">        Side Effects</span>
</span><span id="TramDagModel-461"><a href="#TramDagModel-461"><span class="linenos"> 461</span></a><span class="sd">        -------------</span>
</span><span id="TramDagModel-462"><a href="#TramDagModel-462"><span class="linenos"> 462</span></a><span class="sd">        - Populates `self.minmax_dict` with scaling values.</span>
</span><span id="TramDagModel-463"><a href="#TramDagModel-463"><span class="linenos"> 463</span></a><span class="sd">        - Writes or loads the file `min_max_scaling.json` under </span>
</span><span id="TramDagModel-464"><a href="#TramDagModel-464"><span class="linenos"> 464</span></a><span class="sd">          `&lt;EXPERIMENT_DIR&gt;`.</span>
</span><span id="TramDagModel-465"><a href="#TramDagModel-465"><span class="linenos"> 465</span></a><span class="sd">        - Prints diagnostic output if `self.debug` or `self.verbose` is True.</span>
</span><span id="TramDagModel-466"><a href="#TramDagModel-466"><span class="linenos"> 466</span></a>
</span><span id="TramDagModel-467"><a href="#TramDagModel-467"><span class="linenos"> 467</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel-468"><a href="#TramDagModel-468"><span class="linenos"> 468</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel-469"><a href="#TramDagModel-469"><span class="linenos"> 469</span></a><span class="sd">        FileNotFoundError</span>
</span><span id="TramDagModel-470"><a href="#TramDagModel-470"><span class="linenos"> 470</span></a><span class="sd">            If `use_existing=True` but the minmax file does not exist.</span>
</span><span id="TramDagModel-471"><a href="#TramDagModel-471"><span class="linenos"> 471</span></a>
</span><span id="TramDagModel-472"><a href="#TramDagModel-472"><span class="linenos"> 472</span></a><span class="sd">        RuntimeError</span>
</span><span id="TramDagModel-473"><a href="#TramDagModel-473"><span class="linenos"> 473</span></a><span class="sd">            If an existing minmax file cannot be read or parsed.</span>
</span><span id="TramDagModel-474"><a href="#TramDagModel-474"><span class="linenos"> 474</span></a>
</span><span id="TramDagModel-475"><a href="#TramDagModel-475"><span class="linenos"> 475</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-476"><a href="#TramDagModel-476"><span class="linenos"> 476</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-477"><a href="#TramDagModel-477"><span class="linenos"> 477</span></a><span class="sd">        The computed minmax dictionary is expected to contain scaling statistics </span>
</span><span id="TramDagModel-478"><a href="#TramDagModel-478"><span class="linenos"> 478</span></a><span class="sd">        per feature, typically in the form:</span>
</span><span id="TramDagModel-479"><a href="#TramDagModel-479"><span class="linenos"> 479</span></a><span class="sd">            {</span>
</span><span id="TramDagModel-480"><a href="#TramDagModel-480"><span class="linenos"> 480</span></a><span class="sd">                &quot;node&quot;: {&quot;min&quot;: float, &quot;max&quot;: float},</span>
</span><span id="TramDagModel-481"><a href="#TramDagModel-481"><span class="linenos"> 481</span></a><span class="sd">                ...</span>
</span><span id="TramDagModel-482"><a href="#TramDagModel-482"><span class="linenos"> 482</span></a><span class="sd">            }</span>
</span><span id="TramDagModel-483"><a href="#TramDagModel-483"><span class="linenos"> 483</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-484"><a href="#TramDagModel-484"><span class="linenos"> 484</span></a>        <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-485"><a href="#TramDagModel-485"><span class="linenos"> 485</span></a>        <span class="n">minmax_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="s2">&quot;min_max_scaling.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-486"><a href="#TramDagModel-486"><span class="linenos"> 486</span></a>
</span><span id="TramDagModel-487"><a href="#TramDagModel-487"><span class="linenos"> 487</span></a>        <span class="c1"># laod exisitng if possible</span>
</span><span id="TramDagModel-488"><a href="#TramDagModel-488"><span class="linenos"> 488</span></a>        <span class="k">if</span> <span class="n">use_existing</span><span class="p">:</span>
</span><span id="TramDagModel-489"><a href="#TramDagModel-489"><span class="linenos"> 489</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">minmax_path</span><span class="p">):</span>
</span><span id="TramDagModel-490"><a href="#TramDagModel-490"><span class="linenos"> 490</span></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MinMax file not found: </span><span class="si">{</span><span class="n">minmax_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-491"><a href="#TramDagModel-491"><span class="linenos"> 491</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-492"><a href="#TramDagModel-492"><span class="linenos"> 492</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">minmax_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel-493"><a href="#TramDagModel-493"><span class="linenos"> 493</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TramDagModel-494"><a href="#TramDagModel-494"><span class="linenos"> 494</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="TramDagModel-495"><a href="#TramDagModel-495"><span class="linenos"> 495</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Loaded existing minmax dict from </span><span class="si">{</span><span class="n">minmax_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-496"><a href="#TramDagModel-496"><span class="linenos"> 496</span></a>                <span class="k">return</span>
</span><span id="TramDagModel-497"><a href="#TramDagModel-497"><span class="linenos"> 497</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel-498"><a href="#TramDagModel-498"><span class="linenos"> 498</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not load existing minmax dict: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-499"><a href="#TramDagModel-499"><span class="linenos"> 499</span></a>
</span><span id="TramDagModel-500"><a href="#TramDagModel-500"><span class="linenos"> 500</span></a>        <span class="c1"># </span>
</span><span id="TramDagModel-501"><a href="#TramDagModel-501"><span class="linenos"> 501</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="TramDagModel-502"><a href="#TramDagModel-502"><span class="linenos"> 502</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[INFO] Computing new minmax dict from training data...&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-503"><a href="#TramDagModel-503"><span class="linenos"> 503</span></a>            
</span><span id="TramDagModel-504"><a href="#TramDagModel-504"><span class="linenos"> 504</span></a>        <span class="n">td_train_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ensure_dataset</span><span class="p">(</span> <span class="n">data</span><span class="o">=</span><span class="n">td_train_data</span><span class="p">,</span> <span class="n">is_val</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>    
</span><span id="TramDagModel-505"><a href="#TramDagModel-505"><span class="linenos"> 505</span></a>            
</span><span id="TramDagModel-506"><a href="#TramDagModel-506"><span class="linenos"> 506</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span> <span class="o">=</span> <span class="n">td_train_data</span><span class="o">.</span><span class="n">compute_scaling</span><span class="p">()</span>
</span><span id="TramDagModel-507"><a href="#TramDagModel-507"><span class="linenos"> 507</span></a>
</span><span id="TramDagModel-508"><a href="#TramDagModel-508"><span class="linenos"> 508</span></a>        <span class="k">if</span> <span class="n">write</span><span class="p">:</span>
</span><span id="TramDagModel-509"><a href="#TramDagModel-509"><span class="linenos"> 509</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TramDagModel-510"><a href="#TramDagModel-510"><span class="linenos"> 510</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">minmax_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel-511"><a href="#TramDagModel-511"><span class="linenos"> 511</span></a>                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="TramDagModel-512"><a href="#TramDagModel-512"><span class="linenos"> 512</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="TramDagModel-513"><a href="#TramDagModel-513"><span class="linenos"> 513</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Saved new minmax dict to </span><span class="si">{</span><span class="n">minmax_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-514"><a href="#TramDagModel-514"><span class="linenos"> 514</span></a>
</span><span id="TramDagModel-515"><a href="#TramDagModel-515"><span class="linenos"> 515</span></a>    <span class="c1">## FIT METHODS</span>
</span><span id="TramDagModel-516"><a href="#TramDagModel-516"><span class="linenos"> 516</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TramDagModel-517"><a href="#TramDagModel-517"><span class="linenos"> 517</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_fit_single_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">self_ref</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">td_train_data</span><span class="p">,</span> <span class="n">td_val_data</span><span class="p">,</span> <span class="n">device_str</span><span class="p">):</span>
</span><span id="TramDagModel-518"><a href="#TramDagModel-518"><span class="linenos"> 518</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-519"><a href="#TramDagModel-519"><span class="linenos"> 519</span></a><span class="sd">        Train a single node model (helper for per-node training).</span>
</span><span id="TramDagModel-520"><a href="#TramDagModel-520"><span class="linenos"> 520</span></a>
</span><span id="TramDagModel-521"><a href="#TramDagModel-521"><span class="linenos"> 521</span></a><span class="sd">        This method is designed to be called either from the main process</span>
</span><span id="TramDagModel-522"><a href="#TramDagModel-522"><span class="linenos"> 522</span></a><span class="sd">        (sequential training) or from a joblib worker (parallel CPU training).</span>
</span><span id="TramDagModel-523"><a href="#TramDagModel-523"><span class="linenos"> 523</span></a>
</span><span id="TramDagModel-524"><a href="#TramDagModel-524"><span class="linenos"> 524</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-525"><a href="#TramDagModel-525"><span class="linenos"> 525</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-526"><a href="#TramDagModel-526"><span class="linenos"> 526</span></a><span class="sd">        node : str</span>
</span><span id="TramDagModel-527"><a href="#TramDagModel-527"><span class="linenos"> 527</span></a><span class="sd">            Name of the target node to train.</span>
</span><span id="TramDagModel-528"><a href="#TramDagModel-528"><span class="linenos"> 528</span></a><span class="sd">        self_ref : TramDagModel</span>
</span><span id="TramDagModel-529"><a href="#TramDagModel-529"><span class="linenos"> 529</span></a><span class="sd">            Reference to the TramDagModel instance containing models and config.</span>
</span><span id="TramDagModel-530"><a href="#TramDagModel-530"><span class="linenos"> 530</span></a><span class="sd">        settings : dict</span>
</span><span id="TramDagModel-531"><a href="#TramDagModel-531"><span class="linenos"> 531</span></a><span class="sd">            Training settings dictionary, typically derived from ``DEFAULTS_FIT``</span>
</span><span id="TramDagModel-532"><a href="#TramDagModel-532"><span class="linenos"> 532</span></a><span class="sd">            plus any user overrides.</span>
</span><span id="TramDagModel-533"><a href="#TramDagModel-533"><span class="linenos"> 533</span></a><span class="sd">        td_train_data : TramDagDataset</span>
</span><span id="TramDagModel-534"><a href="#TramDagModel-534"><span class="linenos"> 534</span></a><span class="sd">            Training dataset with node-specific DataLoaders in ``.loaders``.</span>
</span><span id="TramDagModel-535"><a href="#TramDagModel-535"><span class="linenos"> 535</span></a><span class="sd">        td_val_data : TramDagDataset or None</span>
</span><span id="TramDagModel-536"><a href="#TramDagModel-536"><span class="linenos"> 536</span></a><span class="sd">            Validation dataset or None.</span>
</span><span id="TramDagModel-537"><a href="#TramDagModel-537"><span class="linenos"> 537</span></a><span class="sd">        device_str : str</span>
</span><span id="TramDagModel-538"><a href="#TramDagModel-538"><span class="linenos"> 538</span></a><span class="sd">            Device string, e.g. &quot;cpu&quot; or &quot;cuda&quot;.</span>
</span><span id="TramDagModel-539"><a href="#TramDagModel-539"><span class="linenos"> 539</span></a>
</span><span id="TramDagModel-540"><a href="#TramDagModel-540"><span class="linenos"> 540</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-541"><a href="#TramDagModel-541"><span class="linenos"> 541</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-542"><a href="#TramDagModel-542"><span class="linenos"> 542</span></a><span class="sd">        tuple</span>
</span><span id="TramDagModel-543"><a href="#TramDagModel-543"><span class="linenos"> 543</span></a><span class="sd">            A tuple ``(node, history)`` where:</span>
</span><span id="TramDagModel-544"><a href="#TramDagModel-544"><span class="linenos"> 544</span></a><span class="sd">            node : str</span>
</span><span id="TramDagModel-545"><a href="#TramDagModel-545"><span class="linenos"> 545</span></a><span class="sd">                Node name.</span>
</span><span id="TramDagModel-546"><a href="#TramDagModel-546"><span class="linenos"> 546</span></a><span class="sd">            history : dict or Any</span>
</span><span id="TramDagModel-547"><a href="#TramDagModel-547"><span class="linenos"> 547</span></a><span class="sd">                Training history as returned by ``train_val_loop``.</span>
</span><span id="TramDagModel-548"><a href="#TramDagModel-548"><span class="linenos"> 548</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-549"><a href="#TramDagModel-549"><span class="linenos"> 549</span></a>        <span class="n">torch</span><span class="o">.</span><span class="n">set_num_threads</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># prevent thread oversubscription</span>
</span><span id="TramDagModel-550"><a href="#TramDagModel-550"><span class="linenos"> 550</span></a>
</span><span id="TramDagModel-551"><a href="#TramDagModel-551"><span class="linenos"> 551</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">self_ref</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel-552"><a href="#TramDagModel-552"><span class="linenos"> 552</span></a>
</span><span id="TramDagModel-553"><a href="#TramDagModel-553"><span class="linenos"> 553</span></a>        <span class="c1"># Resolve per-node settings</span>
</span><span id="TramDagModel-554"><a href="#TramDagModel-554"><span class="linenos"> 554</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_resolve</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
</span><span id="TramDagModel-555"><a href="#TramDagModel-555"><span class="linenos"> 555</span></a>            <span class="n">val</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="TramDagModel-556"><a href="#TramDagModel-556"><span class="linenos"> 556</span></a>            <span class="k">return</span> <span class="n">val</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">val</span>
</span><span id="TramDagModel-557"><a href="#TramDagModel-557"><span class="linenos"> 557</span></a>
</span><span id="TramDagModel-558"><a href="#TramDagModel-558"><span class="linenos"> 558</span></a>        <span class="n">node_epochs</span> <span class="o">=</span> <span class="n">_resolve</span><span class="p">(</span><span class="s2">&quot;epochs&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-559"><a href="#TramDagModel-559"><span class="linenos"> 559</span></a>        <span class="n">node_lr</span> <span class="o">=</span> <span class="n">_resolve</span><span class="p">(</span><span class="s2">&quot;learning_rate&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-560"><a href="#TramDagModel-560"><span class="linenos"> 560</span></a>        <span class="n">node_debug</span> <span class="o">=</span> <span class="n">_resolve</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-561"><a href="#TramDagModel-561"><span class="linenos"> 561</span></a>        <span class="n">node_save_linear_shifts</span> <span class="o">=</span> <span class="n">_resolve</span><span class="p">(</span><span class="s2">&quot;save_linear_shifts&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-562"><a href="#TramDagModel-562"><span class="linenos"> 562</span></a>        <span class="n">save_simple_intercepts</span>  <span class="o">=</span> <span class="n">_resolve</span><span class="p">(</span><span class="s2">&quot;save_simple_intercepts&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-563"><a href="#TramDagModel-563"><span class="linenos"> 563</span></a>        <span class="n">node_verbose</span> <span class="o">=</span> <span class="n">_resolve</span><span class="p">(</span><span class="s2">&quot;verbose&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-564"><a href="#TramDagModel-564"><span class="linenos"> 564</span></a>
</span><span id="TramDagModel-565"><a href="#TramDagModel-565"><span class="linenos"> 565</span></a>        <span class="c1"># Optimizer &amp; scheduler</span>
</span><span id="TramDagModel-566"><a href="#TramDagModel-566"><span class="linenos"> 566</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;optimizers&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;optimizers&quot;</span><span class="p">]:</span>
</span><span id="TramDagModel-567"><a href="#TramDagModel-567"><span class="linenos"> 567</span></a>            <span class="n">optimizer</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;optimizers&quot;</span><span class="p">][</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel-568"><a href="#TramDagModel-568"><span class="linenos"> 568</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-569"><a href="#TramDagModel-569"><span class="linenos"> 569</span></a>            <span class="n">optimizer</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">node_lr</span><span class="p">)</span>
</span><span id="TramDagModel-570"><a href="#TramDagModel-570"><span class="linenos"> 570</span></a>
</span><span id="TramDagModel-571"><a href="#TramDagModel-571"><span class="linenos"> 571</span></a>        <span class="n">scheduler</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;schedulers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;schedulers&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="TramDagModel-572"><a href="#TramDagModel-572"><span class="linenos"> 572</span></a>
</span><span id="TramDagModel-573"><a href="#TramDagModel-573"><span class="linenos"> 573</span></a>        <span class="c1"># Data loaders</span>
</span><span id="TramDagModel-574"><a href="#TramDagModel-574"><span class="linenos"> 574</span></a>        <span class="n">train_loader</span> <span class="o">=</span> <span class="n">td_train_data</span><span class="o">.</span><span class="n">loaders</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel-575"><a href="#TramDagModel-575"><span class="linenos"> 575</span></a>        <span class="n">val_loader</span> <span class="o">=</span> <span class="n">td_val_data</span><span class="o">.</span><span class="n">loaders</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="n">td_val_data</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="TramDagModel-576"><a href="#TramDagModel-576"><span class="linenos"> 576</span></a>
</span><span id="TramDagModel-577"><a href="#TramDagModel-577"><span class="linenos"> 577</span></a>        <span class="c1"># Min-max scaling tensors</span>
</span><span id="TramDagModel-578"><a href="#TramDagModel-578"><span class="linenos"> 578</span></a>        <span class="n">min_vals</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">self_ref</span><span class="o">.</span><span class="n">minmax_dict</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="TramDagModel-579"><a href="#TramDagModel-579"><span class="linenos"> 579</span></a>        <span class="n">max_vals</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">self_ref</span><span class="o">.</span><span class="n">minmax_dict</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="TramDagModel-580"><a href="#TramDagModel-580"><span class="linenos"> 580</span></a>        <span class="n">min_max</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">min_vals</span><span class="p">,</span> <span class="n">max_vals</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="TramDagModel-581"><a href="#TramDagModel-581"><span class="linenos"> 581</span></a>
</span><span id="TramDagModel-582"><a href="#TramDagModel-582"><span class="linenos"> 582</span></a>        <span class="c1"># Node directory</span>
</span><span id="TramDagModel-583"><a href="#TramDagModel-583"><span class="linenos"> 583</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-584"><a href="#TramDagModel-584"><span class="linenos"> 584</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="n">self_ref</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-585"><a href="#TramDagModel-585"><span class="linenos"> 585</span></a>            <span class="n">NODE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-586"><a href="#TramDagModel-586"><span class="linenos"> 586</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="TramDagModel-587"><a href="#TramDagModel-587"><span class="linenos"> 587</span></a>            <span class="n">NODE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;models&quot;</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
</span><span id="TramDagModel-588"><a href="#TramDagModel-588"><span class="linenos"> 588</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] No log directory specified in config, saving to default location.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-589"><a href="#TramDagModel-589"><span class="linenos"> 589</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TramDagModel-590"><a href="#TramDagModel-590"><span class="linenos"> 590</span></a>
</span><span id="TramDagModel-591"><a href="#TramDagModel-591"><span class="linenos"> 591</span></a>        <span class="k">if</span> <span class="n">node_verbose</span><span class="p">:</span>
</span><span id="TramDagModel-592"><a href="#TramDagModel-592"><span class="linenos"> 592</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[INFO] Training node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; for </span><span class="si">{</span><span class="n">node_epochs</span><span class="si">}</span><span class="s2"> epochs on </span><span class="si">{</span><span class="n">device_str</span><span class="si">}</span><span class="s2"> (pid=</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-593"><a href="#TramDagModel-593"><span class="linenos"> 593</span></a>
</span><span id="TramDagModel-594"><a href="#TramDagModel-594"><span class="linenos"> 594</span></a>        <span class="c1"># --- train ---</span>
</span><span id="TramDagModel-595"><a href="#TramDagModel-595"><span class="linenos"> 595</span></a>        <span class="n">history</span> <span class="o">=</span> <span class="n">train_val_loop</span><span class="p">(</span>
</span><span id="TramDagModel-596"><a href="#TramDagModel-596"><span class="linenos"> 596</span></a>            <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
</span><span id="TramDagModel-597"><a href="#TramDagModel-597"><span class="linenos"> 597</span></a>            <span class="n">target_nodes</span><span class="o">=</span><span class="n">self_ref</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">,</span>
</span><span id="TramDagModel-598"><a href="#TramDagModel-598"><span class="linenos"> 598</span></a>            <span class="n">NODE_DIR</span><span class="o">=</span><span class="n">NODE_DIR</span><span class="p">,</span>
</span><span id="TramDagModel-599"><a href="#TramDagModel-599"><span class="linenos"> 599</span></a>            <span class="n">tram_model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
</span><span id="TramDagModel-600"><a href="#TramDagModel-600"><span class="linenos"> 600</span></a>            <span class="n">train_loader</span><span class="o">=</span><span class="n">train_loader</span><span class="p">,</span>
</span><span id="TramDagModel-601"><a href="#TramDagModel-601"><span class="linenos"> 601</span></a>            <span class="n">val_loader</span><span class="o">=</span><span class="n">val_loader</span><span class="p">,</span>
</span><span id="TramDagModel-602"><a href="#TramDagModel-602"><span class="linenos"> 602</span></a>            <span class="n">epochs</span><span class="o">=</span><span class="n">node_epochs</span><span class="p">,</span>
</span><span id="TramDagModel-603"><a href="#TramDagModel-603"><span class="linenos"> 603</span></a>            <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
</span><span id="TramDagModel-604"><a href="#TramDagModel-604"><span class="linenos"> 604</span></a>            <span class="n">use_scheduler</span><span class="o">=</span><span class="p">(</span><span class="n">scheduler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="TramDagModel-605"><a href="#TramDagModel-605"><span class="linenos"> 605</span></a>            <span class="n">scheduler</span><span class="o">=</span><span class="n">scheduler</span><span class="p">,</span>
</span><span id="TramDagModel-606"><a href="#TramDagModel-606"><span class="linenos"> 606</span></a>            <span class="n">save_linear_shifts</span><span class="o">=</span><span class="n">node_save_linear_shifts</span><span class="p">,</span>
</span><span id="TramDagModel-607"><a href="#TramDagModel-607"><span class="linenos"> 607</span></a>            <span class="n">save_simple_intercepts</span><span class="o">=</span><span class="n">save_simple_intercepts</span><span class="p">,</span>
</span><span id="TramDagModel-608"><a href="#TramDagModel-608"><span class="linenos"> 608</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">node_verbose</span><span class="p">,</span>
</span><span id="TramDagModel-609"><a href="#TramDagModel-609"><span class="linenos"> 609</span></a>            <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device_str</span><span class="p">),</span>
</span><span id="TramDagModel-610"><a href="#TramDagModel-610"><span class="linenos"> 610</span></a>            <span class="n">debug</span><span class="o">=</span><span class="n">node_debug</span><span class="p">,</span>
</span><span id="TramDagModel-611"><a href="#TramDagModel-611"><span class="linenos"> 611</span></a>            <span class="n">min_max</span><span class="o">=</span><span class="n">min_max</span><span class="p">)</span>
</span><span id="TramDagModel-612"><a href="#TramDagModel-612"><span class="linenos"> 612</span></a>        <span class="k">return</span> <span class="n">node</span><span class="p">,</span> <span class="n">history</span>
</span><span id="TramDagModel-613"><a href="#TramDagModel-613"><span class="linenos"> 613</span></a>
</span><span id="TramDagModel-614"><a href="#TramDagModel-614"><span class="linenos"> 614</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">val_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TramDagModel-615"><a href="#TramDagModel-615"><span class="linenos"> 615</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-616"><a href="#TramDagModel-616"><span class="linenos"> 616</span></a><span class="sd">        Train TRAM models for all nodes in the DAG.</span>
</span><span id="TramDagModel-617"><a href="#TramDagModel-617"><span class="linenos"> 617</span></a>
</span><span id="TramDagModel-618"><a href="#TramDagModel-618"><span class="linenos"> 618</span></a><span class="sd">        Coordinates dataset preparation, minmax scaling, and per-node training,</span>
</span><span id="TramDagModel-619"><a href="#TramDagModel-619"><span class="linenos"> 619</span></a><span class="sd">        optionally in parallel on CPU.</span>
</span><span id="TramDagModel-620"><a href="#TramDagModel-620"><span class="linenos"> 620</span></a>
</span><span id="TramDagModel-621"><a href="#TramDagModel-621"><span class="linenos"> 621</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-622"><a href="#TramDagModel-622"><span class="linenos"> 622</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-623"><a href="#TramDagModel-623"><span class="linenos"> 623</span></a><span class="sd">        train_data : pandas.DataFrame or TramDagDataset</span>
</span><span id="TramDagModel-624"><a href="#TramDagModel-624"><span class="linenos"> 624</span></a><span class="sd">            Training data. If a DataFrame is given, it is converted into a</span>
</span><span id="TramDagModel-625"><a href="#TramDagModel-625"><span class="linenos"> 625</span></a><span class="sd">            TramDagDataset using `_ensure_dataset`.</span>
</span><span id="TramDagModel-626"><a href="#TramDagModel-626"><span class="linenos"> 626</span></a><span class="sd">        val_data : pandas.DataFrame or TramDagDataset or None, optional</span>
</span><span id="TramDagModel-627"><a href="#TramDagModel-627"><span class="linenos"> 627</span></a><span class="sd">            Validation data. If a DataFrame is given, it is converted into a</span>
</span><span id="TramDagModel-628"><a href="#TramDagModel-628"><span class="linenos"> 628</span></a><span class="sd">            TramDagDataset. If None, no validation loss is computed.</span>
</span><span id="TramDagModel-629"><a href="#TramDagModel-629"><span class="linenos"> 629</span></a><span class="sd">        **kwargs</span>
</span><span id="TramDagModel-630"><a href="#TramDagModel-630"><span class="linenos"> 630</span></a><span class="sd">            Overrides for ``DEFAULTS_FIT``. All keys must exist in</span>
</span><span id="TramDagModel-631"><a href="#TramDagModel-631"><span class="linenos"> 631</span></a><span class="sd">            ``DEFAULTS_FIT``. Common options:</span>
</span><span id="TramDagModel-632"><a href="#TramDagModel-632"><span class="linenos"> 632</span></a>
</span><span id="TramDagModel-633"><a href="#TramDagModel-633"><span class="linenos"> 633</span></a><span class="sd">            epochs : int, default 100</span>
</span><span id="TramDagModel-634"><a href="#TramDagModel-634"><span class="linenos"> 634</span></a><span class="sd">                Number of training epochs per node.</span>
</span><span id="TramDagModel-635"><a href="#TramDagModel-635"><span class="linenos"> 635</span></a><span class="sd">            learning_rate : float, default 0.01</span>
</span><span id="TramDagModel-636"><a href="#TramDagModel-636"><span class="linenos"> 636</span></a><span class="sd">                Learning rate for the default Adam optimizer.</span>
</span><span id="TramDagModel-637"><a href="#TramDagModel-637"><span class="linenos"> 637</span></a><span class="sd">            train_list : list of str or None, optional</span>
</span><span id="TramDagModel-638"><a href="#TramDagModel-638"><span class="linenos"> 638</span></a><span class="sd">                List of node names to train. If None, all nodes are trained.</span>
</span><span id="TramDagModel-639"><a href="#TramDagModel-639"><span class="linenos"> 639</span></a><span class="sd">            train_mode : {&quot;sequential&quot;, &quot;parallel&quot;}, default &quot;sequential&quot;</span>
</span><span id="TramDagModel-640"><a href="#TramDagModel-640"><span class="linenos"> 640</span></a><span class="sd">                Training mode. &quot;parallel&quot; uses joblib-based CPU multiprocessing.</span>
</span><span id="TramDagModel-641"><a href="#TramDagModel-641"><span class="linenos"> 641</span></a><span class="sd">                GPU forces sequential mode.</span>
</span><span id="TramDagModel-642"><a href="#TramDagModel-642"><span class="linenos"> 642</span></a><span class="sd">            device : {&quot;auto&quot;, &quot;cpu&quot;, &quot;cuda&quot;}, default &quot;auto&quot;</span>
</span><span id="TramDagModel-643"><a href="#TramDagModel-643"><span class="linenos"> 643</span></a><span class="sd">                Device selection.</span>
</span><span id="TramDagModel-644"><a href="#TramDagModel-644"><span class="linenos"> 644</span></a><span class="sd">            optimizers : dict or None</span>
</span><span id="TramDagModel-645"><a href="#TramDagModel-645"><span class="linenos"> 645</span></a><span class="sd">                Optional mapping ``{node_name: optimizer}``. If provided for a</span>
</span><span id="TramDagModel-646"><a href="#TramDagModel-646"><span class="linenos"> 646</span></a><span class="sd">                node, that optimizer is used instead of creating a new Adam.</span>
</span><span id="TramDagModel-647"><a href="#TramDagModel-647"><span class="linenos"> 647</span></a><span class="sd">            schedulers : dict or None</span>
</span><span id="TramDagModel-648"><a href="#TramDagModel-648"><span class="linenos"> 648</span></a><span class="sd">                Optional mapping ``{node_name: scheduler}``.</span>
</span><span id="TramDagModel-649"><a href="#TramDagModel-649"><span class="linenos"> 649</span></a><span class="sd">            use_scheduler : bool</span>
</span><span id="TramDagModel-650"><a href="#TramDagModel-650"><span class="linenos"> 650</span></a><span class="sd">                If True, enable scheduler usage in the training loop.</span>
</span><span id="TramDagModel-651"><a href="#TramDagModel-651"><span class="linenos"> 651</span></a><span class="sd">            num_workers : int</span>
</span><span id="TramDagModel-652"><a href="#TramDagModel-652"><span class="linenos"> 652</span></a><span class="sd">                DataLoader workers in sequential mode (ignored in parallel).</span>
</span><span id="TramDagModel-653"><a href="#TramDagModel-653"><span class="linenos"> 653</span></a><span class="sd">            persistent_workers : bool</span>
</span><span id="TramDagModel-654"><a href="#TramDagModel-654"><span class="linenos"> 654</span></a><span class="sd">                DataLoader persistence in sequential mode (ignored in parallel).</span>
</span><span id="TramDagModel-655"><a href="#TramDagModel-655"><span class="linenos"> 655</span></a><span class="sd">            prefetch_factor : int</span>
</span><span id="TramDagModel-656"><a href="#TramDagModel-656"><span class="linenos"> 656</span></a><span class="sd">                DataLoader prefetch factor (ignored in parallel).</span>
</span><span id="TramDagModel-657"><a href="#TramDagModel-657"><span class="linenos"> 657</span></a><span class="sd">            batch_size : int</span>
</span><span id="TramDagModel-658"><a href="#TramDagModel-658"><span class="linenos"> 658</span></a><span class="sd">                Batch size for all node DataLoaders.</span>
</span><span id="TramDagModel-659"><a href="#TramDagModel-659"><span class="linenos"> 659</span></a><span class="sd">            debug : bool</span>
</span><span id="TramDagModel-660"><a href="#TramDagModel-660"><span class="linenos"> 660</span></a><span class="sd">                Enable debug output.</span>
</span><span id="TramDagModel-661"><a href="#TramDagModel-661"><span class="linenos"> 661</span></a><span class="sd">            verbose : bool</span>
</span><span id="TramDagModel-662"><a href="#TramDagModel-662"><span class="linenos"> 662</span></a><span class="sd">                Enable informational logging.</span>
</span><span id="TramDagModel-663"><a href="#TramDagModel-663"><span class="linenos"> 663</span></a><span class="sd">            return_history : bool</span>
</span><span id="TramDagModel-664"><a href="#TramDagModel-664"><span class="linenos"> 664</span></a><span class="sd">                If True, return a history dict.</span>
</span><span id="TramDagModel-665"><a href="#TramDagModel-665"><span class="linenos"> 665</span></a>
</span><span id="TramDagModel-666"><a href="#TramDagModel-666"><span class="linenos"> 666</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-667"><a href="#TramDagModel-667"><span class="linenos"> 667</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-668"><a href="#TramDagModel-668"><span class="linenos"> 668</span></a><span class="sd">        dict or None</span>
</span><span id="TramDagModel-669"><a href="#TramDagModel-669"><span class="linenos"> 669</span></a><span class="sd">            If ``return_history=True``, a dictionary mapping each node name</span>
</span><span id="TramDagModel-670"><a href="#TramDagModel-670"><span class="linenos"> 670</span></a><span class="sd">            to its training history. Otherwise, returns None.</span>
</span><span id="TramDagModel-671"><a href="#TramDagModel-671"><span class="linenos"> 671</span></a>
</span><span id="TramDagModel-672"><a href="#TramDagModel-672"><span class="linenos"> 672</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel-673"><a href="#TramDagModel-673"><span class="linenos"> 673</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel-674"><a href="#TramDagModel-674"><span class="linenos"> 674</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel-675"><a href="#TramDagModel-675"><span class="linenos"> 675</span></a><span class="sd">            If ``train_mode`` is not &quot;sequential&quot; or &quot;parallel&quot;.</span>
</span><span id="TramDagModel-676"><a href="#TramDagModel-676"><span class="linenos"> 676</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-677"><a href="#TramDagModel-677"><span class="linenos"> 677</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">defaults_attr</span><span class="o">=</span><span class="s1">&#39;DEFAULTS_FIT&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-678"><a href="#TramDagModel-678"><span class="linenos"> 678</span></a>        
</span><span id="TramDagModel-679"><a href="#TramDagModel-679"><span class="linenos"> 679</span></a>        <span class="c1"># --- merge defaults ---</span>
</span><span id="TramDagModel-680"><a href="#TramDagModel-680"><span class="linenos"> 680</span></a>        <span class="n">settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULTS_FIT</span><span class="p">)</span>
</span><span id="TramDagModel-681"><a href="#TramDagModel-681"><span class="linenos"> 681</span></a>        <span class="n">settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TramDagModel-682"><a href="#TramDagModel-682"><span class="linenos"> 682</span></a>        
</span><span id="TramDagModel-683"><a href="#TramDagModel-683"><span class="linenos"> 683</span></a>        
</span><span id="TramDagModel-684"><a href="#TramDagModel-684"><span class="linenos"> 684</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="TramDagModel-685"><a href="#TramDagModel-685"><span class="linenos"> 685</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="TramDagModel-686"><a href="#TramDagModel-686"><span class="linenos"> 686</span></a>
</span><span id="TramDagModel-687"><a href="#TramDagModel-687"><span class="linenos"> 687</span></a>        <span class="c1"># --- resolve device ---</span>
</span><span id="TramDagModel-688"><a href="#TramDagModel-688"><span class="linenos"> 688</span></a>        <span class="n">device_str</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_device</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="TramDagModel-689"><a href="#TramDagModel-689"><span class="linenos"> 689</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device_str</span><span class="p">)</span>
</span><span id="TramDagModel-690"><a href="#TramDagModel-690"><span class="linenos"> 690</span></a>
</span><span id="TramDagModel-691"><a href="#TramDagModel-691"><span class="linenos"> 691</span></a>        <span class="c1"># --- training mode ---</span>
</span><span id="TramDagModel-692"><a href="#TramDagModel-692"><span class="linenos"> 692</span></a>        <span class="n">train_mode</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train_mode&quot;</span><span class="p">,</span> <span class="s2">&quot;sequential&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="TramDagModel-693"><a href="#TramDagModel-693"><span class="linenos"> 693</span></a>        <span class="k">if</span> <span class="n">train_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;sequential&quot;</span><span class="p">,</span> <span class="s2">&quot;parallel&quot;</span><span class="p">):</span>
</span><span id="TramDagModel-694"><a href="#TramDagModel-694"><span class="linenos"> 694</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;train_mode must be &#39;sequential&#39; or &#39;parallel&#39;&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-695"><a href="#TramDagModel-695"><span class="linenos"> 695</span></a>
</span><span id="TramDagModel-696"><a href="#TramDagModel-696"><span class="linenos"> 696</span></a>        <span class="c1"># --- DataLoader safety logic ---</span>
</span><span id="TramDagModel-697"><a href="#TramDagModel-697"><span class="linenos"> 697</span></a>        <span class="k">if</span> <span class="n">train_mode</span> <span class="o">==</span> <span class="s2">&quot;parallel&quot;</span><span class="p">:</span>
</span><span id="TramDagModel-698"><a href="#TramDagModel-698"><span class="linenos"> 698</span></a>            <span class="c1"># if user passed loader paralleling params, warn and override</span>
</span><span id="TramDagModel-699"><a href="#TramDagModel-699"><span class="linenos"> 699</span></a>            <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;num_workers&quot;</span><span class="p">,</span> <span class="s2">&quot;persistent_workers&quot;</span><span class="p">,</span> <span class="s2">&quot;prefetch_factor&quot;</span><span class="p">):</span>
</span><span id="TramDagModel-700"><a href="#TramDagModel-700"><span class="linenos"> 700</span></a>                <span class="k">if</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="TramDagModel-701"><a href="#TramDagModel-701"><span class="linenos"> 701</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] &#39;</span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s2">&#39; is ignored in parallel mode &quot;</span>
</span><span id="TramDagModel-702"><a href="#TramDagModel-702"><span class="linenos"> 702</span></a>                        <span class="sa">f</span><span class="s2">&quot;(disabled to prevent nested multiprocessing).&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-703"><a href="#TramDagModel-703"><span class="linenos"> 703</span></a>            <span class="c1"># disable unsafe loader multiprocessing options</span>
</span><span id="TramDagModel-704"><a href="#TramDagModel-704"><span class="linenos"> 704</span></a>            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_workers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TramDagModel-705"><a href="#TramDagModel-705"><span class="linenos"> 705</span></a>            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;persistent_workers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="TramDagModel-706"><a href="#TramDagModel-706"><span class="linenos"> 706</span></a>            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;prefetch_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagModel-707"><a href="#TramDagModel-707"><span class="linenos"> 707</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-708"><a href="#TramDagModel-708"><span class="linenos"> 708</span></a>            <span class="c1"># sequential mode  respect user DataLoader settings</span>
</span><span id="TramDagModel-709"><a href="#TramDagModel-709"><span class="linenos"> 709</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel-710"><a href="#TramDagModel-710"><span class="linenos"> 710</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Sequential mode: using DataLoader kwargs as provided.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-711"><a href="#TramDagModel-711"><span class="linenos"> 711</span></a>
</span><span id="TramDagModel-712"><a href="#TramDagModel-712"><span class="linenos"> 712</span></a>        <span class="c1"># --- which nodes to train ---</span>
</span><span id="TramDagModel-713"><a href="#TramDagModel-713"><span class="linenos"> 713</span></a>        <span class="n">train_list</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train_list&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel-714"><a href="#TramDagModel-714"><span class="linenos"> 714</span></a>
</span><span id="TramDagModel-715"><a href="#TramDagModel-715"><span class="linenos"> 715</span></a>
</span><span id="TramDagModel-716"><a href="#TramDagModel-716"><span class="linenos"> 716</span></a>        <span class="c1"># --- dataset prep (receives adjusted settings) ---</span>
</span><span id="TramDagModel-717"><a href="#TramDagModel-717"><span class="linenos"> 717</span></a>        <span class="n">td_train_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_dataset</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">is_val</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
</span><span id="TramDagModel-718"><a href="#TramDagModel-718"><span class="linenos"> 718</span></a>        <span class="n">td_val_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_dataset</span><span class="p">(</span><span class="n">val_data</span><span class="p">,</span> <span class="n">is_val</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
</span><span id="TramDagModel-719"><a href="#TramDagModel-719"><span class="linenos"> 719</span></a>
</span><span id="TramDagModel-720"><a href="#TramDagModel-720"><span class="linenos"> 720</span></a>        <span class="c1"># --- normalization ---</span>
</span><span id="TramDagModel-721"><a href="#TramDagModel-721"><span class="linenos"> 721</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_or_compute_minmax</span><span class="p">(</span><span class="n">use_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">td_train_data</span><span class="o">=</span><span class="n">td_train_data</span><span class="p">)</span>
</span><span id="TramDagModel-722"><a href="#TramDagModel-722"><span class="linenos"> 722</span></a>
</span><span id="TramDagModel-723"><a href="#TramDagModel-723"><span class="linenos"> 723</span></a>        <span class="c1"># --- print header ---</span>
</span><span id="TramDagModel-724"><a href="#TramDagModel-724"><span class="linenos"> 724</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel-725"><a href="#TramDagModel-725"><span class="linenos"> 725</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Training </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes (</span><span class="si">{</span><span class="n">train_mode</span><span class="si">}</span><span class="s2">) on </span><span class="si">{</span><span class="n">device_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-726"><a href="#TramDagModel-726"><span class="linenos"> 726</span></a>
</span><span id="TramDagModel-727"><a href="#TramDagModel-727"><span class="linenos"> 727</span></a>        <span class="c1"># ======================================================================</span>
</span><span id="TramDagModel-728"><a href="#TramDagModel-728"><span class="linenos"> 728</span></a>        <span class="c1"># Sequential mode  safe for GPU or debugging)</span>
</span><span id="TramDagModel-729"><a href="#TramDagModel-729"><span class="linenos"> 729</span></a>        <span class="c1"># ======================================================================</span>
</span><span id="TramDagModel-730"><a href="#TramDagModel-730"><span class="linenos"> 730</span></a>        <span class="k">if</span> <span class="n">train_mode</span> <span class="o">==</span> <span class="s2">&quot;sequential&quot;</span> <span class="ow">or</span> <span class="s2">&quot;cuda&quot;</span> <span class="ow">in</span> <span class="n">device_str</span><span class="p">:</span>
</span><span id="TramDagModel-731"><a href="#TramDagModel-731"><span class="linenos"> 731</span></a>            <span class="k">if</span> <span class="s2">&quot;cuda&quot;</span> <span class="ow">in</span> <span class="n">device_str</span> <span class="ow">and</span> <span class="n">train_mode</span> <span class="o">==</span> <span class="s2">&quot;parallel&quot;</span><span class="p">:</span>
</span><span id="TramDagModel-732"><a href="#TramDagModel-732"><span class="linenos"> 732</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] GPU device detected  forcing sequential mode.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-733"><a href="#TramDagModel-733"><span class="linenos"> 733</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel-734"><a href="#TramDagModel-734"><span class="linenos"> 734</span></a>            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">train_list</span><span class="p">:</span>
</span><span id="TramDagModel-735"><a href="#TramDagModel-735"><span class="linenos"> 735</span></a>                <span class="n">node</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_single_node</span><span class="p">(</span>
</span><span id="TramDagModel-736"><a href="#TramDagModel-736"><span class="linenos"> 736</span></a>                    <span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">td_train_data</span><span class="p">,</span> <span class="n">td_val_data</span><span class="p">,</span> <span class="n">device_str</span>
</span><span id="TramDagModel-737"><a href="#TramDagModel-737"><span class="linenos"> 737</span></a>                <span class="p">)</span>
</span><span id="TramDagModel-738"><a href="#TramDagModel-738"><span class="linenos"> 738</span></a>                <span class="n">results</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">history</span>
</span><span id="TramDagModel-739"><a href="#TramDagModel-739"><span class="linenos"> 739</span></a>        
</span><span id="TramDagModel-740"><a href="#TramDagModel-740"><span class="linenos"> 740</span></a>
</span><span id="TramDagModel-741"><a href="#TramDagModel-741"><span class="linenos"> 741</span></a>        <span class="c1"># ======================================================================</span>
</span><span id="TramDagModel-742"><a href="#TramDagModel-742"><span class="linenos"> 742</span></a>        <span class="c1"># parallel mode (CPU only)</span>
</span><span id="TramDagModel-743"><a href="#TramDagModel-743"><span class="linenos"> 743</span></a>        <span class="c1"># ======================================================================</span>
</span><span id="TramDagModel-744"><a href="#TramDagModel-744"><span class="linenos"> 744</span></a>        <span class="k">if</span> <span class="n">train_mode</span> <span class="o">==</span> <span class="s2">&quot;parallel&quot;</span><span class="p">:</span>
</span><span id="TramDagModel-745"><a href="#TramDagModel-745"><span class="linenos"> 745</span></a>
</span><span id="TramDagModel-746"><a href="#TramDagModel-746"><span class="linenos"> 746</span></a>            <span class="n">n_jobs</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_list</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel-747"><a href="#TramDagModel-747"><span class="linenos"> 747</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel-748"><a href="#TramDagModel-748"><span class="linenos"> 748</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Using </span><span class="si">{</span><span class="n">n_jobs</span><span class="si">}</span><span class="s2"> CPU workers for parallel node training&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-749"><a href="#TramDagModel-749"><span class="linenos"> 749</span></a>            <span class="n">parallel_outputs</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span>
</span><span id="TramDagModel-750"><a href="#TramDagModel-750"><span class="linenos"> 750</span></a>                <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
</span><span id="TramDagModel-751"><a href="#TramDagModel-751"><span class="linenos"> 751</span></a>                <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;loky&quot;</span><span class="p">,</span><span class="c1">#loky, multiprocessing</span>
</span><span id="TramDagModel-752"><a href="#TramDagModel-752"><span class="linenos"> 752</span></a>                <span class="n">verbose</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span id="TramDagModel-753"><a href="#TramDagModel-753"><span class="linenos"> 753</span></a>                <span class="n">prefer</span><span class="o">=</span><span class="s2">&quot;processes&quot;</span>
</span><span id="TramDagModel-754"><a href="#TramDagModel-754"><span class="linenos"> 754</span></a>            <span class="p">)(</span><span class="n">delayed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_single_node</span><span class="p">)(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">td_train_data</span><span class="p">,</span> <span class="n">td_val_data</span><span class="p">,</span> <span class="n">device_str</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">train_list</span> <span class="p">)</span>
</span><span id="TramDagModel-755"><a href="#TramDagModel-755"><span class="linenos"> 755</span></a>
</span><span id="TramDagModel-756"><a href="#TramDagModel-756"><span class="linenos"> 756</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="n">hist</span> <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">hist</span> <span class="ow">in</span> <span class="n">parallel_outputs</span><span class="p">}</span>
</span><span id="TramDagModel-757"><a href="#TramDagModel-757"><span class="linenos"> 757</span></a>        
</span><span id="TramDagModel-758"><a href="#TramDagModel-758"><span class="linenos"> 758</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;return_history&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel-759"><a href="#TramDagModel-759"><span class="linenos"> 759</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="TramDagModel-760"><a href="#TramDagModel-760"><span class="linenos"> 760</span></a>
</span><span id="TramDagModel-761"><a href="#TramDagModel-761"><span class="linenos"> 761</span></a>    <span class="c1">## FIT-DIAGNOSTICS</span>
</span><span id="TramDagModel-762"><a href="#TramDagModel-762"><span class="linenos"> 762</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">loss_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagModel-763"><a href="#TramDagModel-763"><span class="linenos"> 763</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-764"><a href="#TramDagModel-764"><span class="linenos"> 764</span></a><span class="sd">        Load training and validation loss history for all nodes.</span>
</span><span id="TramDagModel-765"><a href="#TramDagModel-765"><span class="linenos"> 765</span></a>
</span><span id="TramDagModel-766"><a href="#TramDagModel-766"><span class="linenos"> 766</span></a><span class="sd">        Looks for per-node JSON files:</span>
</span><span id="TramDagModel-767"><a href="#TramDagModel-767"><span class="linenos"> 767</span></a>
</span><span id="TramDagModel-768"><a href="#TramDagModel-768"><span class="linenos"> 768</span></a><span class="sd">        - ``EXPERIMENT_DIR/{node}/train_loss_hist.json``</span>
</span><span id="TramDagModel-769"><a href="#TramDagModel-769"><span class="linenos"> 769</span></a><span class="sd">        - ``EXPERIMENT_DIR/{node}/val_loss_hist.json``</span>
</span><span id="TramDagModel-770"><a href="#TramDagModel-770"><span class="linenos"> 770</span></a>
</span><span id="TramDagModel-771"><a href="#TramDagModel-771"><span class="linenos"> 771</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-772"><a href="#TramDagModel-772"><span class="linenos"> 772</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-773"><a href="#TramDagModel-773"><span class="linenos"> 773</span></a><span class="sd">        dict</span>
</span><span id="TramDagModel-774"><a href="#TramDagModel-774"><span class="linenos"> 774</span></a><span class="sd">            A dictionary mapping node names to:</span>
</span><span id="TramDagModel-775"><a href="#TramDagModel-775"><span class="linenos"> 775</span></a>
</span><span id="TramDagModel-776"><a href="#TramDagModel-776"><span class="linenos"> 776</span></a><span class="sd">            .. code-block:: python</span>
</span><span id="TramDagModel-777"><a href="#TramDagModel-777"><span class="linenos"> 777</span></a>
</span><span id="TramDagModel-778"><a href="#TramDagModel-778"><span class="linenos"> 778</span></a><span class="sd">                {</span>
</span><span id="TramDagModel-779"><a href="#TramDagModel-779"><span class="linenos"> 779</span></a><span class="sd">                    &quot;train&quot;: list or None,</span>
</span><span id="TramDagModel-780"><a href="#TramDagModel-780"><span class="linenos"> 780</span></a><span class="sd">                    &quot;validation&quot;: list or None</span>
</span><span id="TramDagModel-781"><a href="#TramDagModel-781"><span class="linenos"> 781</span></a><span class="sd">                }</span>
</span><span id="TramDagModel-782"><a href="#TramDagModel-782"><span class="linenos"> 782</span></a>
</span><span id="TramDagModel-783"><a href="#TramDagModel-783"><span class="linenos"> 783</span></a><span class="sd">            where each list contains NLL values per epoch, or None if not found.</span>
</span><span id="TramDagModel-784"><a href="#TramDagModel-784"><span class="linenos"> 784</span></a>
</span><span id="TramDagModel-785"><a href="#TramDagModel-785"><span class="linenos"> 785</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel-786"><a href="#TramDagModel-786"><span class="linenos"> 786</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel-787"><a href="#TramDagModel-787"><span class="linenos"> 787</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel-788"><a href="#TramDagModel-788"><span class="linenos"> 788</span></a><span class="sd">            If the experiment directory cannot be resolved from the configuration.</span>
</span><span id="TramDagModel-789"><a href="#TramDagModel-789"><span class="linenos"> 789</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-790"><a href="#TramDagModel-790"><span class="linenos"> 790</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-791"><a href="#TramDagModel-791"><span class="linenos"> 791</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-792"><a href="#TramDagModel-792"><span class="linenos"> 792</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="TramDagModel-793"><a href="#TramDagModel-793"><span class="linenos"> 793</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel-794"><a href="#TramDagModel-794"><span class="linenos"> 794</span></a>                <span class="s2">&quot;[ERROR] Missing &#39;EXPERIMENT_DIR&#39; in cfg.conf_dict[&#39;PATHS&#39;]. &quot;</span>
</span><span id="TramDagModel-795"><a href="#TramDagModel-795"><span class="linenos"> 795</span></a>                <span class="s2">&quot;History retrieval requires experiment logs.&quot;</span>
</span><span id="TramDagModel-796"><a href="#TramDagModel-796"><span class="linenos"> 796</span></a>            <span class="p">)</span>
</span><span id="TramDagModel-797"><a href="#TramDagModel-797"><span class="linenos"> 797</span></a>
</span><span id="TramDagModel-798"><a href="#TramDagModel-798"><span class="linenos"> 798</span></a>        <span class="n">all_histories</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel-799"><a href="#TramDagModel-799"><span class="linenos"> 799</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TramDagModel-800"><a href="#TramDagModel-800"><span class="linenos"> 800</span></a>            <span class="n">node_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
</span><span id="TramDagModel-801"><a href="#TramDagModel-801"><span class="linenos"> 801</span></a>            <span class="n">train_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="s2">&quot;train_loss_hist.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-802"><a href="#TramDagModel-802"><span class="linenos"> 802</span></a>            <span class="n">val_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="s2">&quot;val_loss_hist.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-803"><a href="#TramDagModel-803"><span class="linenos"> 803</span></a>
</span><span id="TramDagModel-804"><a href="#TramDagModel-804"><span class="linenos"> 804</span></a>            <span class="n">node_hist</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel-805"><a href="#TramDagModel-805"><span class="linenos"> 805</span></a>
</span><span id="TramDagModel-806"><a href="#TramDagModel-806"><span class="linenos"> 806</span></a>            <span class="c1"># --- load train history ---</span>
</span><span id="TramDagModel-807"><a href="#TramDagModel-807"><span class="linenos"> 807</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">train_path</span><span class="p">):</span>
</span><span id="TramDagModel-808"><a href="#TramDagModel-808"><span class="linenos"> 808</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-809"><a href="#TramDagModel-809"><span class="linenos"> 809</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">train_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel-810"><a href="#TramDagModel-810"><span class="linenos"> 810</span></a>                        <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TramDagModel-811"><a href="#TramDagModel-811"><span class="linenos"> 811</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel-812"><a href="#TramDagModel-812"><span class="linenos"> 812</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Could not load </span><span class="si">{</span><span class="n">train_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-813"><a href="#TramDagModel-813"><span class="linenos"> 813</span></a>                    <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagModel-814"><a href="#TramDagModel-814"><span class="linenos"> 814</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-815"><a href="#TramDagModel-815"><span class="linenos"> 815</span></a>                <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagModel-816"><a href="#TramDagModel-816"><span class="linenos"> 816</span></a>
</span><span id="TramDagModel-817"><a href="#TramDagModel-817"><span class="linenos"> 817</span></a>            <span class="c1"># --- load val history ---</span>
</span><span id="TramDagModel-818"><a href="#TramDagModel-818"><span class="linenos"> 818</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">val_path</span><span class="p">):</span>
</span><span id="TramDagModel-819"><a href="#TramDagModel-819"><span class="linenos"> 819</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-820"><a href="#TramDagModel-820"><span class="linenos"> 820</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">val_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel-821"><a href="#TramDagModel-821"><span class="linenos"> 821</span></a>                        <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;validation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TramDagModel-822"><a href="#TramDagModel-822"><span class="linenos"> 822</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel-823"><a href="#TramDagModel-823"><span class="linenos"> 823</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Could not load </span><span class="si">{</span><span class="n">val_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-824"><a href="#TramDagModel-824"><span class="linenos"> 824</span></a>                    <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;validation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagModel-825"><a href="#TramDagModel-825"><span class="linenos"> 825</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-826"><a href="#TramDagModel-826"><span class="linenos"> 826</span></a>                <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;validation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagModel-827"><a href="#TramDagModel-827"><span class="linenos"> 827</span></a>
</span><span id="TramDagModel-828"><a href="#TramDagModel-828"><span class="linenos"> 828</span></a>            <span class="n">all_histories</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_hist</span>
</span><span id="TramDagModel-829"><a href="#TramDagModel-829"><span class="linenos"> 829</span></a>
</span><span id="TramDagModel-830"><a href="#TramDagModel-830"><span class="linenos"> 830</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel-831"><a href="#TramDagModel-831"><span class="linenos"> 831</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Loaded training/validation histories for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_histories</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-832"><a href="#TramDagModel-832"><span class="linenos"> 832</span></a>
</span><span id="TramDagModel-833"><a href="#TramDagModel-833"><span class="linenos"> 833</span></a>        <span class="k">return</span> <span class="n">all_histories</span>
</span><span id="TramDagModel-834"><a href="#TramDagModel-834"><span class="linenos"> 834</span></a>
</span><span id="TramDagModel-835"><a href="#TramDagModel-835"><span class="linenos"> 835</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">linear_shift_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagModel-836"><a href="#TramDagModel-836"><span class="linenos"> 836</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-837"><a href="#TramDagModel-837"><span class="linenos"> 837</span></a><span class="sd">        Load linear shift term histories for all nodes.</span>
</span><span id="TramDagModel-838"><a href="#TramDagModel-838"><span class="linenos"> 838</span></a>
</span><span id="TramDagModel-839"><a href="#TramDagModel-839"><span class="linenos"> 839</span></a><span class="sd">        Each node history is expected in a JSON file named</span>
</span><span id="TramDagModel-840"><a href="#TramDagModel-840"><span class="linenos"> 840</span></a><span class="sd">        ``linear_shifts_all_epochs.json`` under the node directory.</span>
</span><span id="TramDagModel-841"><a href="#TramDagModel-841"><span class="linenos"> 841</span></a>
</span><span id="TramDagModel-842"><a href="#TramDagModel-842"><span class="linenos"> 842</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-843"><a href="#TramDagModel-843"><span class="linenos"> 843</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-844"><a href="#TramDagModel-844"><span class="linenos"> 844</span></a><span class="sd">        dict</span>
</span><span id="TramDagModel-845"><a href="#TramDagModel-845"><span class="linenos"> 845</span></a><span class="sd">            A mapping ``{node_name: pandas.DataFrame}``, where each DataFrame</span>
</span><span id="TramDagModel-846"><a href="#TramDagModel-846"><span class="linenos"> 846</span></a><span class="sd">            contains linear shift weights across epochs.</span>
</span><span id="TramDagModel-847"><a href="#TramDagModel-847"><span class="linenos"> 847</span></a>
</span><span id="TramDagModel-848"><a href="#TramDagModel-848"><span class="linenos"> 848</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel-849"><a href="#TramDagModel-849"><span class="linenos"> 849</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel-850"><a href="#TramDagModel-850"><span class="linenos"> 850</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel-851"><a href="#TramDagModel-851"><span class="linenos"> 851</span></a><span class="sd">            If the experiment directory cannot be resolved from the configuration.</span>
</span><span id="TramDagModel-852"><a href="#TramDagModel-852"><span class="linenos"> 852</span></a>
</span><span id="TramDagModel-853"><a href="#TramDagModel-853"><span class="linenos"> 853</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-854"><a href="#TramDagModel-854"><span class="linenos"> 854</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-855"><a href="#TramDagModel-855"><span class="linenos"> 855</span></a><span class="sd">        If a history file is missing for a node, a warning is printed and the</span>
</span><span id="TramDagModel-856"><a href="#TramDagModel-856"><span class="linenos"> 856</span></a><span class="sd">        node is omitted from the returned dictionary.</span>
</span><span id="TramDagModel-857"><a href="#TramDagModel-857"><span class="linenos"> 857</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-858"><a href="#TramDagModel-858"><span class="linenos"> 858</span></a>        <span class="n">histories</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel-859"><a href="#TramDagModel-859"><span class="linenos"> 859</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-860"><a href="#TramDagModel-860"><span class="linenos"> 860</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-861"><a href="#TramDagModel-861"><span class="linenos"> 861</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="TramDagModel-862"><a href="#TramDagModel-862"><span class="linenos"> 862</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel-863"><a href="#TramDagModel-863"><span class="linenos"> 863</span></a>                <span class="s2">&quot;[ERROR] Missing &#39;EXPERIMENT_DIR&#39; in cfg.conf_dict[&#39;PATHS&#39;]. &quot;</span>
</span><span id="TramDagModel-864"><a href="#TramDagModel-864"><span class="linenos"> 864</span></a>                <span class="s2">&quot;Cannot load histories without experiment directory.&quot;</span>
</span><span id="TramDagModel-865"><a href="#TramDagModel-865"><span class="linenos"> 865</span></a>            <span class="p">)</span>
</span><span id="TramDagModel-866"><a href="#TramDagModel-866"><span class="linenos"> 866</span></a>
</span><span id="TramDagModel-867"><a href="#TramDagModel-867"><span class="linenos"> 867</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TramDagModel-868"><a href="#TramDagModel-868"><span class="linenos"> 868</span></a>            <span class="n">node_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
</span><span id="TramDagModel-869"><a href="#TramDagModel-869"><span class="linenos"> 869</span></a>            <span class="n">history_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="s2">&quot;linear_shifts_all_epochs.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-870"><a href="#TramDagModel-870"><span class="linenos"> 870</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">history_path</span><span class="p">):</span>
</span><span id="TramDagModel-871"><a href="#TramDagModel-871"><span class="linenos"> 871</span></a>                <span class="n">histories</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">history_path</span><span class="p">)</span>
</span><span id="TramDagModel-872"><a href="#TramDagModel-872"><span class="linenos"> 872</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-873"><a href="#TramDagModel-873"><span class="linenos"> 873</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] No linear shift history found for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; at </span><span class="si">{</span><span class="n">history_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-874"><a href="#TramDagModel-874"><span class="linenos"> 874</span></a>        <span class="k">return</span> <span class="n">histories</span>
</span><span id="TramDagModel-875"><a href="#TramDagModel-875"><span class="linenos"> 875</span></a>
</span><span id="TramDagModel-876"><a href="#TramDagModel-876"><span class="linenos"> 876</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">simple_intercept_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagModel-877"><a href="#TramDagModel-877"><span class="linenos"> 877</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-878"><a href="#TramDagModel-878"><span class="linenos"> 878</span></a><span class="sd">        Load simple intercept histories for all nodes.</span>
</span><span id="TramDagModel-879"><a href="#TramDagModel-879"><span class="linenos"> 879</span></a>
</span><span id="TramDagModel-880"><a href="#TramDagModel-880"><span class="linenos"> 880</span></a><span class="sd">        Each node history is expected in a JSON file named</span>
</span><span id="TramDagModel-881"><a href="#TramDagModel-881"><span class="linenos"> 881</span></a><span class="sd">        ``simple_intercepts_all_epochs.json`` under the node directory.</span>
</span><span id="TramDagModel-882"><a href="#TramDagModel-882"><span class="linenos"> 882</span></a>
</span><span id="TramDagModel-883"><a href="#TramDagModel-883"><span class="linenos"> 883</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-884"><a href="#TramDagModel-884"><span class="linenos"> 884</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-885"><a href="#TramDagModel-885"><span class="linenos"> 885</span></a><span class="sd">        dict</span>
</span><span id="TramDagModel-886"><a href="#TramDagModel-886"><span class="linenos"> 886</span></a><span class="sd">            A mapping ``{node_name: pandas.DataFrame}``, where each DataFrame</span>
</span><span id="TramDagModel-887"><a href="#TramDagModel-887"><span class="linenos"> 887</span></a><span class="sd">            contains intercept weights across epochs.</span>
</span><span id="TramDagModel-888"><a href="#TramDagModel-888"><span class="linenos"> 888</span></a>
</span><span id="TramDagModel-889"><a href="#TramDagModel-889"><span class="linenos"> 889</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel-890"><a href="#TramDagModel-890"><span class="linenos"> 890</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel-891"><a href="#TramDagModel-891"><span class="linenos"> 891</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel-892"><a href="#TramDagModel-892"><span class="linenos"> 892</span></a><span class="sd">            If the experiment directory cannot be resolved from the configuration.</span>
</span><span id="TramDagModel-893"><a href="#TramDagModel-893"><span class="linenos"> 893</span></a>
</span><span id="TramDagModel-894"><a href="#TramDagModel-894"><span class="linenos"> 894</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-895"><a href="#TramDagModel-895"><span class="linenos"> 895</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-896"><a href="#TramDagModel-896"><span class="linenos"> 896</span></a><span class="sd">        If a history file is missing for a node, a warning is printed and the</span>
</span><span id="TramDagModel-897"><a href="#TramDagModel-897"><span class="linenos"> 897</span></a><span class="sd">        node is omitted from the returned dictionary.</span>
</span><span id="TramDagModel-898"><a href="#TramDagModel-898"><span class="linenos"> 898</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-899"><a href="#TramDagModel-899"><span class="linenos"> 899</span></a>        <span class="n">histories</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel-900"><a href="#TramDagModel-900"><span class="linenos"> 900</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-901"><a href="#TramDagModel-901"><span class="linenos"> 901</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-902"><a href="#TramDagModel-902"><span class="linenos"> 902</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="TramDagModel-903"><a href="#TramDagModel-903"><span class="linenos"> 903</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel-904"><a href="#TramDagModel-904"><span class="linenos"> 904</span></a>                <span class="s2">&quot;[ERROR] Missing &#39;EXPERIMENT_DIR&#39; in cfg.conf_dict[&#39;PATHS&#39;]. &quot;</span>
</span><span id="TramDagModel-905"><a href="#TramDagModel-905"><span class="linenos"> 905</span></a>                <span class="s2">&quot;Cannot load histories without experiment directory.&quot;</span>
</span><span id="TramDagModel-906"><a href="#TramDagModel-906"><span class="linenos"> 906</span></a>            <span class="p">)</span>
</span><span id="TramDagModel-907"><a href="#TramDagModel-907"><span class="linenos"> 907</span></a>
</span><span id="TramDagModel-908"><a href="#TramDagModel-908"><span class="linenos"> 908</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TramDagModel-909"><a href="#TramDagModel-909"><span class="linenos"> 909</span></a>            <span class="n">node_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
</span><span id="TramDagModel-910"><a href="#TramDagModel-910"><span class="linenos"> 910</span></a>            <span class="n">history_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="s2">&quot;simple_intercepts_all_epochs.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-911"><a href="#TramDagModel-911"><span class="linenos"> 911</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">history_path</span><span class="p">):</span>
</span><span id="TramDagModel-912"><a href="#TramDagModel-912"><span class="linenos"> 912</span></a>                <span class="n">histories</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">history_path</span><span class="p">)</span>
</span><span id="TramDagModel-913"><a href="#TramDagModel-913"><span class="linenos"> 913</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-914"><a href="#TramDagModel-914"><span class="linenos"> 914</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] No simple intercept history found for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; at </span><span class="si">{</span><span class="n">history_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-915"><a href="#TramDagModel-915"><span class="linenos"> 915</span></a>        <span class="k">return</span> <span class="n">histories</span>
</span><span id="TramDagModel-916"><a href="#TramDagModel-916"><span class="linenos"> 916</span></a>
</span><span id="TramDagModel-917"><a href="#TramDagModel-917"><span class="linenos"> 917</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_latent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel-918"><a href="#TramDagModel-918"><span class="linenos"> 918</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-919"><a href="#TramDagModel-919"><span class="linenos"> 919</span></a><span class="sd">        Compute latent representations for all nodes in the DAG.</span>
</span><span id="TramDagModel-920"><a href="#TramDagModel-920"><span class="linenos"> 920</span></a>
</span><span id="TramDagModel-921"><a href="#TramDagModel-921"><span class="linenos"> 921</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-922"><a href="#TramDagModel-922"><span class="linenos"> 922</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-923"><a href="#TramDagModel-923"><span class="linenos"> 923</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="TramDagModel-924"><a href="#TramDagModel-924"><span class="linenos"> 924</span></a><span class="sd">            Input data frame with columns corresponding to nodes in the DAG.</span>
</span><span id="TramDagModel-925"><a href="#TramDagModel-925"><span class="linenos"> 925</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="TramDagModel-926"><a href="#TramDagModel-926"><span class="linenos"> 926</span></a><span class="sd">            If True, print informational messages during latent computation.</span>
</span><span id="TramDagModel-927"><a href="#TramDagModel-927"><span class="linenos"> 927</span></a><span class="sd">            Default is False.</span>
</span><span id="TramDagModel-928"><a href="#TramDagModel-928"><span class="linenos"> 928</span></a>
</span><span id="TramDagModel-929"><a href="#TramDagModel-929"><span class="linenos"> 929</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-930"><a href="#TramDagModel-930"><span class="linenos"> 930</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-931"><a href="#TramDagModel-931"><span class="linenos"> 931</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="TramDagModel-932"><a href="#TramDagModel-932"><span class="linenos"> 932</span></a><span class="sd">            DataFrame containing the original columns plus latent variables</span>
</span><span id="TramDagModel-933"><a href="#TramDagModel-933"><span class="linenos"> 933</span></a><span class="sd">            for each node (e.g. columns named ``f&quot;{node}_U&quot;``).</span>
</span><span id="TramDagModel-934"><a href="#TramDagModel-934"><span class="linenos"> 934</span></a>
</span><span id="TramDagModel-935"><a href="#TramDagModel-935"><span class="linenos"> 935</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel-936"><a href="#TramDagModel-936"><span class="linenos"> 936</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel-937"><a href="#TramDagModel-937"><span class="linenos"> 937</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel-938"><a href="#TramDagModel-938"><span class="linenos"> 938</span></a><span class="sd">            If the experiment directory is missing from the configuration or</span>
</span><span id="TramDagModel-939"><a href="#TramDagModel-939"><span class="linenos"> 939</span></a><span class="sd">            if ``self.minmax_dict`` has not been set.</span>
</span><span id="TramDagModel-940"><a href="#TramDagModel-940"><span class="linenos"> 940</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-941"><a href="#TramDagModel-941"><span class="linenos"> 941</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-942"><a href="#TramDagModel-942"><span class="linenos"> 942</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-943"><a href="#TramDagModel-943"><span class="linenos"> 943</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="TramDagModel-944"><a href="#TramDagModel-944"><span class="linenos"> 944</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel-945"><a href="#TramDagModel-945"><span class="linenos"> 945</span></a>                <span class="s2">&quot;[ERROR] Missing &#39;EXPERIMENT_DIR&#39; in cfg.conf_dict[&#39;PATHS&#39;]. &quot;</span>
</span><span id="TramDagModel-946"><a href="#TramDagModel-946"><span class="linenos"> 946</span></a>                <span class="s2">&quot;Latent extraction requires trained model checkpoints.&quot;</span>
</span><span id="TramDagModel-947"><a href="#TramDagModel-947"><span class="linenos"> 947</span></a>            <span class="p">)</span>
</span><span id="TramDagModel-948"><a href="#TramDagModel-948"><span class="linenos"> 948</span></a>
</span><span id="TramDagModel-949"><a href="#TramDagModel-949"><span class="linenos"> 949</span></a>        <span class="c1"># ensure minmax_dict is available</span>
</span><span id="TramDagModel-950"><a href="#TramDagModel-950"><span class="linenos"> 950</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;minmax_dict&quot;</span><span class="p">):</span>
</span><span id="TramDagModel-951"><a href="#TramDagModel-951"><span class="linenos"> 951</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel-952"><a href="#TramDagModel-952"><span class="linenos"> 952</span></a>                <span class="s2">&quot;[ERROR] minmax_dict not found in the TramDagModel instance. &quot;</span>
</span><span id="TramDagModel-953"><a href="#TramDagModel-953"><span class="linenos"> 953</span></a>                <span class="s2">&quot;Either call .load_or_compute_minmax(td_train_data=train_df) or .fit() first.&quot;</span>
</span><span id="TramDagModel-954"><a href="#TramDagModel-954"><span class="linenos"> 954</span></a>            <span class="p">)</span>
</span><span id="TramDagModel-955"><a href="#TramDagModel-955"><span class="linenos"> 955</span></a>
</span><span id="TramDagModel-956"><a href="#TramDagModel-956"><span class="linenos"> 956</span></a>        <span class="n">all_latents_df</span> <span class="o">=</span> <span class="n">create_latent_df_for_full_dag</span><span class="p">(</span>
</span><span id="TramDagModel-957"><a href="#TramDagModel-957"><span class="linenos"> 957</span></a>            <span class="n">configuration_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">,</span>
</span><span id="TramDagModel-958"><a href="#TramDagModel-958"><span class="linenos"> 958</span></a>            <span class="n">EXPERIMENT_DIR</span><span class="o">=</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span>
</span><span id="TramDagModel-959"><a href="#TramDagModel-959"><span class="linenos"> 959</span></a>            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
</span><span id="TramDagModel-960"><a href="#TramDagModel-960"><span class="linenos"> 960</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="TramDagModel-961"><a href="#TramDagModel-961"><span class="linenos"> 961</span></a>            <span class="n">min_max_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span><span class="p">,</span>
</span><span id="TramDagModel-962"><a href="#TramDagModel-962"><span class="linenos"> 962</span></a>        <span class="p">)</span>
</span><span id="TramDagModel-963"><a href="#TramDagModel-963"><span class="linenos"> 963</span></a>
</span><span id="TramDagModel-964"><a href="#TramDagModel-964"><span class="linenos"> 964</span></a>        <span class="k">return</span> <span class="n">all_latents_df</span>
</span><span id="TramDagModel-965"><a href="#TramDagModel-965"><span class="linenos"> 965</span></a>
</span><span id="TramDagModel-966"><a href="#TramDagModel-966"><span class="linenos"> 966</span></a>    
</span><span id="TramDagModel-967"><a href="#TramDagModel-967"><span class="linenos"> 967</span></a>    <span class="c1">## PLOTTING FIT-DIAGNOSTICS</span>
</span><span id="TramDagModel-968"><a href="#TramDagModel-968"><span class="linenos"> 968</span></a>    
</span><span id="TramDagModel-969"><a href="#TramDagModel-969"><span class="linenos"> 969</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_loss_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagModel-970"><a href="#TramDagModel-970"><span class="linenos"> 970</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-971"><a href="#TramDagModel-971"><span class="linenos"> 971</span></a><span class="sd">        Plot training and validation loss evolution per node.</span>
</span><span id="TramDagModel-972"><a href="#TramDagModel-972"><span class="linenos"> 972</span></a>
</span><span id="TramDagModel-973"><a href="#TramDagModel-973"><span class="linenos"> 973</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-974"><a href="#TramDagModel-974"><span class="linenos"> 974</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-975"><a href="#TramDagModel-975"><span class="linenos"> 975</span></a><span class="sd">        variable : str or None, optional</span>
</span><span id="TramDagModel-976"><a href="#TramDagModel-976"><span class="linenos"> 976</span></a><span class="sd">            If provided, plot loss history for this node only. If None, plot</span>
</span><span id="TramDagModel-977"><a href="#TramDagModel-977"><span class="linenos"> 977</span></a><span class="sd">            histories for all nodes that have both train and validation logs.</span>
</span><span id="TramDagModel-978"><a href="#TramDagModel-978"><span class="linenos"> 978</span></a>
</span><span id="TramDagModel-979"><a href="#TramDagModel-979"><span class="linenos"> 979</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-980"><a href="#TramDagModel-980"><span class="linenos"> 980</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-981"><a href="#TramDagModel-981"><span class="linenos"> 981</span></a><span class="sd">        None</span>
</span><span id="TramDagModel-982"><a href="#TramDagModel-982"><span class="linenos"> 982</span></a>
</span><span id="TramDagModel-983"><a href="#TramDagModel-983"><span class="linenos"> 983</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-984"><a href="#TramDagModel-984"><span class="linenos"> 984</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-985"><a href="#TramDagModel-985"><span class="linenos"> 985</span></a><span class="sd">        Two subplots are produced:</span>
</span><span id="TramDagModel-986"><a href="#TramDagModel-986"><span class="linenos"> 986</span></a><span class="sd">        - Full epoch history.</span>
</span><span id="TramDagModel-987"><a href="#TramDagModel-987"><span class="linenos"> 987</span></a><span class="sd">        - Last 10% of epochs (or only the last epoch if fewer than 5 epochs).</span>
</span><span id="TramDagModel-988"><a href="#TramDagModel-988"><span class="linenos"> 988</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-989"><a href="#TramDagModel-989"><span class="linenos"> 989</span></a>
</span><span id="TramDagModel-990"><a href="#TramDagModel-990"><span class="linenos"> 990</span></a>        <span class="n">histories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_history</span><span class="p">()</span>
</span><span id="TramDagModel-991"><a href="#TramDagModel-991"><span class="linenos"> 991</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">histories</span><span class="p">:</span>
</span><span id="TramDagModel-992"><a href="#TramDagModel-992"><span class="linenos"> 992</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] No loss histories found.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-993"><a href="#TramDagModel-993"><span class="linenos"> 993</span></a>            <span class="k">return</span>
</span><span id="TramDagModel-994"><a href="#TramDagModel-994"><span class="linenos"> 994</span></a>
</span><span id="TramDagModel-995"><a href="#TramDagModel-995"><span class="linenos"> 995</span></a>        <span class="c1"># Select which nodes to plot</span>
</span><span id="TramDagModel-996"><a href="#TramDagModel-996"><span class="linenos"> 996</span></a>        <span class="k">if</span> <span class="n">variable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel-997"><a href="#TramDagModel-997"><span class="linenos"> 997</span></a>            <span class="k">if</span> <span class="n">variable</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">histories</span><span class="p">:</span>
</span><span id="TramDagModel-998"><a href="#TramDagModel-998"><span class="linenos"> 998</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] Node &#39;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&#39; not found in histories.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-999"><a href="#TramDagModel-999"><span class="linenos"> 999</span></a>            <span class="n">nodes_to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">variable</span><span class="p">]</span>
</span><span id="TramDagModel-1000"><a href="#TramDagModel-1000"><span class="linenos">1000</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-1001"><a href="#TramDagModel-1001"><span class="linenos">1001</span></a>            <span class="n">nodes_to_plot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">histories</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel-1002"><a href="#TramDagModel-1002"><span class="linenos">1002</span></a>
</span><span id="TramDagModel-1003"><a href="#TramDagModel-1003"><span class="linenos">1003</span></a>        <span class="c1"># Filter out nodes with no valid history</span>
</span><span id="TramDagModel-1004"><a href="#TramDagModel-1004"><span class="linenos">1004</span></a>        <span class="n">nodes_to_plot</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="TramDagModel-1005"><a href="#TramDagModel-1005"><span class="linenos">1005</span></a>            <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes_to_plot</span>
</span><span id="TramDagModel-1006"><a href="#TramDagModel-1006"><span class="linenos">1006</span></a>            <span class="k">if</span> <span class="n">histories</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">histories</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;train&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="TramDagModel-1007"><a href="#TramDagModel-1007"><span class="linenos">1007</span></a>            <span class="ow">and</span> <span class="n">histories</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;validation&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">histories</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;validation&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="TramDagModel-1008"><a href="#TramDagModel-1008"><span class="linenos">1008</span></a>        <span class="p">]</span>
</span><span id="TramDagModel-1009"><a href="#TramDagModel-1009"><span class="linenos">1009</span></a>
</span><span id="TramDagModel-1010"><a href="#TramDagModel-1010"><span class="linenos">1010</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">nodes_to_plot</span><span class="p">:</span>
</span><span id="TramDagModel-1011"><a href="#TramDagModel-1011"><span class="linenos">1011</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] No valid histories found to plot.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1012"><a href="#TramDagModel-1012"><span class="linenos">1012</span></a>            <span class="k">return</span>
</span><span id="TramDagModel-1013"><a href="#TramDagModel-1013"><span class="linenos">1013</span></a>
</span><span id="TramDagModel-1014"><a href="#TramDagModel-1014"><span class="linenos">1014</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
</span><span id="TramDagModel-1015"><a href="#TramDagModel-1015"><span class="linenos">1015</span></a>
</span><span id="TramDagModel-1016"><a href="#TramDagModel-1016"><span class="linenos">1016</span></a>        <span class="c1"># --- Full history (top plot) ---</span>
</span><span id="TramDagModel-1017"><a href="#TramDagModel-1017"><span class="linenos">1017</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel-1018"><a href="#TramDagModel-1018"><span class="linenos">1018</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes_to_plot</span><span class="p">:</span>
</span><span id="TramDagModel-1019"><a href="#TramDagModel-1019"><span class="linenos">1019</span></a>            <span class="n">node_hist</span> <span class="o">=</span> <span class="n">histories</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel-1020"><a href="#TramDagModel-1020"><span class="linenos">1020</span></a>            <span class="n">train_hist</span><span class="p">,</span> <span class="n">val_hist</span> <span class="o">=</span> <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">],</span> <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;validation&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-1021"><a href="#TramDagModel-1021"><span class="linenos">1021</span></a>
</span><span id="TramDagModel-1022"><a href="#TramDagModel-1022"><span class="linenos">1022</span></a>            <span class="n">epochs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_hist</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel-1023"><a href="#TramDagModel-1023"><span class="linenos">1023</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">train_hist</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2"> - train&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1024"><a href="#TramDagModel-1024"><span class="linenos">1024</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">val_hist</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2"> - val&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1025"><a href="#TramDagModel-1025"><span class="linenos">1025</span></a>
</span><span id="TramDagModel-1026"><a href="#TramDagModel-1026"><span class="linenos">1026</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Training and Validation NLL - Full History&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1027"><a href="#TramDagModel-1027"><span class="linenos">1027</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1028"><a href="#TramDagModel-1028"><span class="linenos">1028</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;NLL&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1029"><a href="#TramDagModel-1029"><span class="linenos">1029</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="TramDagModel-1030"><a href="#TramDagModel-1030"><span class="linenos">1030</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TramDagModel-1031"><a href="#TramDagModel-1031"><span class="linenos">1031</span></a>
</span><span id="TramDagModel-1032"><a href="#TramDagModel-1032"><span class="linenos">1032</span></a>        <span class="c1"># --- Last 10% of epochs (bottom plot) ---</span>
</span><span id="TramDagModel-1033"><a href="#TramDagModel-1033"><span class="linenos">1033</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="TramDagModel-1034"><a href="#TramDagModel-1034"><span class="linenos">1034</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes_to_plot</span><span class="p">:</span>
</span><span id="TramDagModel-1035"><a href="#TramDagModel-1035"><span class="linenos">1035</span></a>            <span class="n">node_hist</span> <span class="o">=</span> <span class="n">histories</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel-1036"><a href="#TramDagModel-1036"><span class="linenos">1036</span></a>            <span class="n">train_hist</span><span class="p">,</span> <span class="n">val_hist</span> <span class="o">=</span> <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">],</span> <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;validation&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-1037"><a href="#TramDagModel-1037"><span class="linenos">1037</span></a>
</span><span id="TramDagModel-1038"><a href="#TramDagModel-1038"><span class="linenos">1038</span></a>            <span class="n">total_epochs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_hist</span><span class="p">)</span>
</span><span id="TramDagModel-1039"><a href="#TramDagModel-1039"><span class="linenos">1039</span></a>            <span class="n">start_idx</span> <span class="o">=</span> <span class="n">total_epochs</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">total_epochs</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_epochs</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">)</span>
</span><span id="TramDagModel-1040"><a href="#TramDagModel-1040"><span class="linenos">1040</span></a>
</span><span id="TramDagModel-1041"><a href="#TramDagModel-1041"><span class="linenos">1041</span></a>            <span class="n">epochs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total_epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel-1042"><a href="#TramDagModel-1042"><span class="linenos">1042</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">train_hist</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2"> - train&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1043"><a href="#TramDagModel-1043"><span class="linenos">1043</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">val_hist</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2"> - val&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1044"><a href="#TramDagModel-1044"><span class="linenos">1044</span></a>
</span><span id="TramDagModel-1045"><a href="#TramDagModel-1045"><span class="linenos">1045</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Training and Validation NLL - Last 10</span><span class="si">% o</span><span class="s2">f Epochs (or Last Epoch if &lt;5)&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1046"><a href="#TramDagModel-1046"><span class="linenos">1046</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1047"><a href="#TramDagModel-1047"><span class="linenos">1047</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;NLL&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1048"><a href="#TramDagModel-1048"><span class="linenos">1048</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="TramDagModel-1049"><a href="#TramDagModel-1049"><span class="linenos">1049</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TramDagModel-1050"><a href="#TramDagModel-1050"><span class="linenos">1050</span></a>
</span><span id="TramDagModel-1051"><a href="#TramDagModel-1051"><span class="linenos">1051</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="TramDagModel-1052"><a href="#TramDagModel-1052"><span class="linenos">1052</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="TramDagModel-1053"><a href="#TramDagModel-1053"><span class="linenos">1053</span></a>
</span><span id="TramDagModel-1054"><a href="#TramDagModel-1054"><span class="linenos">1054</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_linear_shift_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref_lines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagModel-1055"><a href="#TramDagModel-1055"><span class="linenos">1055</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-1056"><a href="#TramDagModel-1056"><span class="linenos">1056</span></a><span class="sd">        Plot the evolution of linear shift terms over epochs.</span>
</span><span id="TramDagModel-1057"><a href="#TramDagModel-1057"><span class="linenos">1057</span></a>
</span><span id="TramDagModel-1058"><a href="#TramDagModel-1058"><span class="linenos">1058</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-1059"><a href="#TramDagModel-1059"><span class="linenos">1059</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-1060"><a href="#TramDagModel-1060"><span class="linenos">1060</span></a><span class="sd">        data_dict : dict or None, optional</span>
</span><span id="TramDagModel-1061"><a href="#TramDagModel-1061"><span class="linenos">1061</span></a><span class="sd">            Pre-loaded mapping ``{node_name: pandas.DataFrame}`` containing shift</span>
</span><span id="TramDagModel-1062"><a href="#TramDagModel-1062"><span class="linenos">1062</span></a><span class="sd">            weights across epochs. If None, `linear_shift_history()` is called.</span>
</span><span id="TramDagModel-1063"><a href="#TramDagModel-1063"><span class="linenos">1063</span></a><span class="sd">        node : str or None, optional</span>
</span><span id="TramDagModel-1064"><a href="#TramDagModel-1064"><span class="linenos">1064</span></a><span class="sd">            If provided, plot only this node. Otherwise, plot all nodes</span>
</span><span id="TramDagModel-1065"><a href="#TramDagModel-1065"><span class="linenos">1065</span></a><span class="sd">            present in ``data_dict``.</span>
</span><span id="TramDagModel-1066"><a href="#TramDagModel-1066"><span class="linenos">1066</span></a><span class="sd">        ref_lines : dict or None, optional</span>
</span><span id="TramDagModel-1067"><a href="#TramDagModel-1067"><span class="linenos">1067</span></a><span class="sd">            Optional mapping ``{node_name: list of float}``. For each specified</span>
</span><span id="TramDagModel-1068"><a href="#TramDagModel-1068"><span class="linenos">1068</span></a><span class="sd">            node, horizontal reference lines are drawn at the given values.</span>
</span><span id="TramDagModel-1069"><a href="#TramDagModel-1069"><span class="linenos">1069</span></a>
</span><span id="TramDagModel-1070"><a href="#TramDagModel-1070"><span class="linenos">1070</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-1071"><a href="#TramDagModel-1071"><span class="linenos">1071</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-1072"><a href="#TramDagModel-1072"><span class="linenos">1072</span></a><span class="sd">        None</span>
</span><span id="TramDagModel-1073"><a href="#TramDagModel-1073"><span class="linenos">1073</span></a>
</span><span id="TramDagModel-1074"><a href="#TramDagModel-1074"><span class="linenos">1074</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-1075"><a href="#TramDagModel-1075"><span class="linenos">1075</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-1076"><a href="#TramDagModel-1076"><span class="linenos">1076</span></a><span class="sd">        The function flattens nested list-like entries in the DataFrames to scalars,</span>
</span><span id="TramDagModel-1077"><a href="#TramDagModel-1077"><span class="linenos">1077</span></a><span class="sd">        converts epoch labels to numeric, and then draws one line per shift term.</span>
</span><span id="TramDagModel-1078"><a href="#TramDagModel-1078"><span class="linenos">1078</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-1079"><a href="#TramDagModel-1079"><span class="linenos">1079</span></a>
</span><span id="TramDagModel-1080"><a href="#TramDagModel-1080"><span class="linenos">1080</span></a>        <span class="k">if</span> <span class="n">data_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel-1081"><a href="#TramDagModel-1081"><span class="linenos">1081</span></a>            <span class="n">data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_shift_history</span><span class="p">()</span>
</span><span id="TramDagModel-1082"><a href="#TramDagModel-1082"><span class="linenos">1082</span></a>            <span class="k">if</span> <span class="n">data_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel-1083"><a href="#TramDagModel-1083"><span class="linenos">1083</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No shift history data provided or stored in the class.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1084"><a href="#TramDagModel-1084"><span class="linenos">1084</span></a>
</span><span id="TramDagModel-1085"><a href="#TramDagModel-1085"><span class="linenos">1085</span></a>        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="n">node</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel-1086"><a href="#TramDagModel-1086"><span class="linenos">1086</span></a>
</span><span id="TramDagModel-1087"><a href="#TramDagModel-1087"><span class="linenos">1087</span></a>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
</span><span id="TramDagModel-1088"><a href="#TramDagModel-1088"><span class="linenos">1088</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TramDagModel-1089"><a href="#TramDagModel-1089"><span class="linenos">1089</span></a>
</span><span id="TramDagModel-1090"><a href="#TramDagModel-1090"><span class="linenos">1090</span></a>            <span class="c1"># Flatten nested lists or list-like cells</span>
</span><span id="TramDagModel-1091"><a href="#TramDagModel-1091"><span class="linenos">1091</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">flatten</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="TramDagModel-1092"><a href="#TramDagModel-1092"><span class="linenos">1092</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="TramDagModel-1093"><a href="#TramDagModel-1093"><span class="linenos">1093</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TramDagModel-1094"><a href="#TramDagModel-1094"><span class="linenos">1094</span></a>                        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="TramDagModel-1095"><a href="#TramDagModel-1095"><span class="linenos">1095</span></a>                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">):</span>
</span><span id="TramDagModel-1096"><a href="#TramDagModel-1096"><span class="linenos">1096</span></a>                        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># average simple list</span>
</span><span id="TramDagModel-1097"><a href="#TramDagModel-1097"><span class="linenos">1097</span></a>                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">):</span>
</span><span id="TramDagModel-1098"><a href="#TramDagModel-1098"><span class="linenos">1098</span></a>                        <span class="c1"># nested list -&gt; flatten inner and average</span>
</span><span id="TramDagModel-1099"><a href="#TramDagModel-1099"><span class="linenos">1099</span></a>                        <span class="n">flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="n">sub</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">sub</span><span class="p">])]</span>
</span><span id="TramDagModel-1100"><a href="#TramDagModel-1100"><span class="linenos">1100</span></a>                        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">flat</span><span class="p">)</span> <span class="k">if</span> <span class="n">flat</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="TramDagModel-1101"><a href="#TramDagModel-1101"><span class="linenos">1101</span></a>                    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="TramDagModel-1102"><a href="#TramDagModel-1102"><span class="linenos">1102</span></a>                <span class="k">return</span> <span class="n">x</span>
</span><span id="TramDagModel-1103"><a href="#TramDagModel-1103"><span class="linenos">1103</span></a>
</span><span id="TramDagModel-1104"><a href="#TramDagModel-1104"><span class="linenos">1104</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="n">flatten</span><span class="p">)</span>
</span><span id="TramDagModel-1105"><a href="#TramDagModel-1105"><span class="linenos">1105</span></a>
</span><span id="TramDagModel-1106"><a href="#TramDagModel-1106"><span class="linenos">1106</span></a>            <span class="c1"># Ensure numeric columns</span>
</span><span id="TramDagModel-1107"><a href="#TramDagModel-1107"><span class="linenos">1107</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="TramDagModel-1108"><a href="#TramDagModel-1108"><span class="linenos">1108</span></a>
</span><span id="TramDagModel-1109"><a href="#TramDagModel-1109"><span class="linenos">1109</span></a>            <span class="c1"># Convert epoch labels to numeric</span>
</span><span id="TramDagModel-1110"><a href="#TramDagModel-1110"><span class="linenos">1110</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="TramDagModel-1111"><a href="#TramDagModel-1111"><span class="linenos">1111</span></a>                <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;epoch_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;epoch_&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">c</span>
</span><span id="TramDagModel-1112"><a href="#TramDagModel-1112"><span class="linenos">1112</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</span><span id="TramDagModel-1113"><a href="#TramDagModel-1113"><span class="linenos">1113</span></a>            <span class="p">]</span>
</span><span id="TramDagModel-1114"><a href="#TramDagModel-1114"><span class="linenos">1114</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel-1115"><a href="#TramDagModel-1115"><span class="linenos">1115</span></a>
</span><span id="TramDagModel-1116"><a href="#TramDagModel-1116"><span class="linenos">1116</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="TramDagModel-1117"><a href="#TramDagModel-1117"><span class="linenos">1117</span></a>            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="TramDagModel-1118"><a href="#TramDagModel-1118"><span class="linenos">1118</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;shift_</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1119"><a href="#TramDagModel-1119"><span class="linenos">1119</span></a>
</span><span id="TramDagModel-1120"><a href="#TramDagModel-1120"><span class="linenos">1120</span></a>            <span class="k">if</span> <span class="n">ref_lines</span> <span class="ow">and</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ref_lines</span><span class="p">:</span>
</span><span id="TramDagModel-1121"><a href="#TramDagModel-1121"><span class="linenos">1121</span></a>                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ref_lines</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span>
</span><span id="TramDagModel-1122"><a href="#TramDagModel-1122"><span class="linenos">1122</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="TramDagModel-1123"><a href="#TramDagModel-1123"><span class="linenos">1123</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span><span id="TramDagModel-1124"><a href="#TramDagModel-1124"><span class="linenos">1124</span></a>
</span><span id="TramDagModel-1125"><a href="#TramDagModel-1125"><span class="linenos">1125</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1126"><a href="#TramDagModel-1126"><span class="linenos">1126</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Shift Value&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1127"><a href="#TramDagModel-1127"><span class="linenos">1127</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shift Term History  Node: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1128"><a href="#TramDagModel-1128"><span class="linenos">1128</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1129"><a href="#TramDagModel-1129"><span class="linenos">1129</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="TramDagModel-1130"><a href="#TramDagModel-1130"><span class="linenos">1130</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="TramDagModel-1131"><a href="#TramDagModel-1131"><span class="linenos">1131</span></a>
</span><span id="TramDagModel-1132"><a href="#TramDagModel-1132"><span class="linenos">1132</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_simple_intercepts_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ref_lines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagModel-1133"><a href="#TramDagModel-1133"><span class="linenos">1133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-1134"><a href="#TramDagModel-1134"><span class="linenos">1134</span></a><span class="sd">        Plot the evolution of simple intercept weights over epochs.</span>
</span><span id="TramDagModel-1135"><a href="#TramDagModel-1135"><span class="linenos">1135</span></a>
</span><span id="TramDagModel-1136"><a href="#TramDagModel-1136"><span class="linenos">1136</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-1137"><a href="#TramDagModel-1137"><span class="linenos">1137</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-1138"><a href="#TramDagModel-1138"><span class="linenos">1138</span></a><span class="sd">        data_dict : dict or None, optional</span>
</span><span id="TramDagModel-1139"><a href="#TramDagModel-1139"><span class="linenos">1139</span></a><span class="sd">            Pre-loaded mapping ``{node_name: pandas.DataFrame}`` containing intercept</span>
</span><span id="TramDagModel-1140"><a href="#TramDagModel-1140"><span class="linenos">1140</span></a><span class="sd">            weights across epochs. If None, `simple_intercept_history()` is called.</span>
</span><span id="TramDagModel-1141"><a href="#TramDagModel-1141"><span class="linenos">1141</span></a><span class="sd">        node : str or None, optional</span>
</span><span id="TramDagModel-1142"><a href="#TramDagModel-1142"><span class="linenos">1142</span></a><span class="sd">            If provided, plot only this node. Otherwise, plot all nodes present</span>
</span><span id="TramDagModel-1143"><a href="#TramDagModel-1143"><span class="linenos">1143</span></a><span class="sd">            in ``data_dict``.</span>
</span><span id="TramDagModel-1144"><a href="#TramDagModel-1144"><span class="linenos">1144</span></a><span class="sd">        ref_lines : dict or None, optional</span>
</span><span id="TramDagModel-1145"><a href="#TramDagModel-1145"><span class="linenos">1145</span></a><span class="sd">            Optional mapping ``{node_name: list of float}``. For each specified</span>
</span><span id="TramDagModel-1146"><a href="#TramDagModel-1146"><span class="linenos">1146</span></a><span class="sd">            node, horizontal reference lines are drawn at the given values.</span>
</span><span id="TramDagModel-1147"><a href="#TramDagModel-1147"><span class="linenos">1147</span></a>
</span><span id="TramDagModel-1148"><a href="#TramDagModel-1148"><span class="linenos">1148</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-1149"><a href="#TramDagModel-1149"><span class="linenos">1149</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-1150"><a href="#TramDagModel-1150"><span class="linenos">1150</span></a><span class="sd">        None</span>
</span><span id="TramDagModel-1151"><a href="#TramDagModel-1151"><span class="linenos">1151</span></a>
</span><span id="TramDagModel-1152"><a href="#TramDagModel-1152"><span class="linenos">1152</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-1153"><a href="#TramDagModel-1153"><span class="linenos">1153</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-1154"><a href="#TramDagModel-1154"><span class="linenos">1154</span></a><span class="sd">        Nested list-like entries in the DataFrames are reduced to scalars before</span>
</span><span id="TramDagModel-1155"><a href="#TramDagModel-1155"><span class="linenos">1155</span></a><span class="sd">        plotting. One line is drawn per intercept parameter.</span>
</span><span id="TramDagModel-1156"><a href="#TramDagModel-1156"><span class="linenos">1156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-1157"><a href="#TramDagModel-1157"><span class="linenos">1157</span></a>        <span class="k">if</span> <span class="n">data_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel-1158"><a href="#TramDagModel-1158"><span class="linenos">1158</span></a>            <span class="n">data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_intercept_history</span><span class="p">()</span>
</span><span id="TramDagModel-1159"><a href="#TramDagModel-1159"><span class="linenos">1159</span></a>            <span class="k">if</span> <span class="n">data_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel-1160"><a href="#TramDagModel-1160"><span class="linenos">1160</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No intercept history data provided or stored in the class.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1161"><a href="#TramDagModel-1161"><span class="linenos">1161</span></a>
</span><span id="TramDagModel-1162"><a href="#TramDagModel-1162"><span class="linenos">1162</span></a>        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="n">node</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel-1163"><a href="#TramDagModel-1163"><span class="linenos">1163</span></a>
</span><span id="TramDagModel-1164"><a href="#TramDagModel-1164"><span class="linenos">1164</span></a>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
</span><span id="TramDagModel-1165"><a href="#TramDagModel-1165"><span class="linenos">1165</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TramDagModel-1166"><a href="#TramDagModel-1166"><span class="linenos">1166</span></a>
</span><span id="TramDagModel-1167"><a href="#TramDagModel-1167"><span class="linenos">1167</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">extract_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="TramDagModel-1168"><a href="#TramDagModel-1168"><span class="linenos">1168</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="TramDagModel-1169"><a href="#TramDagModel-1169"><span class="linenos">1169</span></a>                    <span class="k">while</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TramDagModel-1170"><a href="#TramDagModel-1170"><span class="linenos">1170</span></a>                        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TramDagModel-1171"><a href="#TramDagModel-1171"><span class="linenos">1171</span></a>                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">))</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="TramDagModel-1172"><a href="#TramDagModel-1172"><span class="linenos">1172</span></a>
</span><span id="TramDagModel-1173"><a href="#TramDagModel-1173"><span class="linenos">1173</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="n">extract_scalar</span><span class="p">)</span>
</span><span id="TramDagModel-1174"><a href="#TramDagModel-1174"><span class="linenos">1174</span></a>
</span><span id="TramDagModel-1175"><a href="#TramDagModel-1175"><span class="linenos">1175</span></a>            <span class="c1"># Convert epoch labels  numeric</span>
</span><span id="TramDagModel-1176"><a href="#TramDagModel-1176"><span class="linenos">1176</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="TramDagModel-1177"><a href="#TramDagModel-1177"><span class="linenos">1177</span></a>                <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;epoch_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;epoch_&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">c</span>
</span><span id="TramDagModel-1178"><a href="#TramDagModel-1178"><span class="linenos">1178</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</span><span id="TramDagModel-1179"><a href="#TramDagModel-1179"><span class="linenos">1179</span></a>            <span class="p">]</span>
</span><span id="TramDagModel-1180"><a href="#TramDagModel-1180"><span class="linenos">1180</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel-1181"><a href="#TramDagModel-1181"><span class="linenos">1181</span></a>
</span><span id="TramDagModel-1182"><a href="#TramDagModel-1182"><span class="linenos">1182</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="TramDagModel-1183"><a href="#TramDagModel-1183"><span class="linenos">1183</span></a>            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="TramDagModel-1184"><a href="#TramDagModel-1184"><span class="linenos">1184</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;theta_</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1185"><a href="#TramDagModel-1185"><span class="linenos">1185</span></a>            
</span><span id="TramDagModel-1186"><a href="#TramDagModel-1186"><span class="linenos">1186</span></a>            <span class="k">if</span> <span class="n">ref_lines</span> <span class="ow">and</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ref_lines</span><span class="p">:</span>
</span><span id="TramDagModel-1187"><a href="#TramDagModel-1187"><span class="linenos">1187</span></a>                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ref_lines</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span>
</span><span id="TramDagModel-1188"><a href="#TramDagModel-1188"><span class="linenos">1188</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="TramDagModel-1189"><a href="#TramDagModel-1189"><span class="linenos">1189</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span><span id="TramDagModel-1190"><a href="#TramDagModel-1190"><span class="linenos">1190</span></a>                
</span><span id="TramDagModel-1191"><a href="#TramDagModel-1191"><span class="linenos">1191</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1192"><a href="#TramDagModel-1192"><span class="linenos">1192</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intercept Weight&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1193"><a href="#TramDagModel-1193"><span class="linenos">1193</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simple Intercept Evolution  Node: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1194"><a href="#TramDagModel-1194"><span class="linenos">1194</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1195"><a href="#TramDagModel-1195"><span class="linenos">1195</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="TramDagModel-1196"><a href="#TramDagModel-1196"><span class="linenos">1196</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="TramDagModel-1197"><a href="#TramDagModel-1197"><span class="linenos">1197</span></a>
</span><span id="TramDagModel-1198"><a href="#TramDagModel-1198"><span class="linenos">1198</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_latents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">simulations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">):</span>
</span><span id="TramDagModel-1199"><a href="#TramDagModel-1199"><span class="linenos">1199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-1200"><a href="#TramDagModel-1200"><span class="linenos">1200</span></a><span class="sd">        Visualize latent U distributions for one or all nodes.</span>
</span><span id="TramDagModel-1201"><a href="#TramDagModel-1201"><span class="linenos">1201</span></a>
</span><span id="TramDagModel-1202"><a href="#TramDagModel-1202"><span class="linenos">1202</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-1203"><a href="#TramDagModel-1203"><span class="linenos">1203</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-1204"><a href="#TramDagModel-1204"><span class="linenos">1204</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="TramDagModel-1205"><a href="#TramDagModel-1205"><span class="linenos">1205</span></a><span class="sd">            Input data frame with raw node values.</span>
</span><span id="TramDagModel-1206"><a href="#TramDagModel-1206"><span class="linenos">1206</span></a><span class="sd">        variable : str or None, optional</span>
</span><span id="TramDagModel-1207"><a href="#TramDagModel-1207"><span class="linenos">1207</span></a><span class="sd">            If provided, only this node&#39;s latents are plotted. If None, all</span>
</span><span id="TramDagModel-1208"><a href="#TramDagModel-1208"><span class="linenos">1208</span></a><span class="sd">            nodes with latent columns are processed.</span>
</span><span id="TramDagModel-1209"><a href="#TramDagModel-1209"><span class="linenos">1209</span></a><span class="sd">        confidence : float, optional</span>
</span><span id="TramDagModel-1210"><a href="#TramDagModel-1210"><span class="linenos">1210</span></a><span class="sd">            Confidence level for QQ-plot bands (0 &lt; confidence &lt; 1).</span>
</span><span id="TramDagModel-1211"><a href="#TramDagModel-1211"><span class="linenos">1211</span></a><span class="sd">            Default is 0.95.</span>
</span><span id="TramDagModel-1212"><a href="#TramDagModel-1212"><span class="linenos">1212</span></a><span class="sd">        simulations : int, optional</span>
</span><span id="TramDagModel-1213"><a href="#TramDagModel-1213"><span class="linenos">1213</span></a><span class="sd">            Number of Monte Carlo simulations for QQ-plot bands. Default is 1000.</span>
</span><span id="TramDagModel-1214"><a href="#TramDagModel-1214"><span class="linenos">1214</span></a>
</span><span id="TramDagModel-1215"><a href="#TramDagModel-1215"><span class="linenos">1215</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-1216"><a href="#TramDagModel-1216"><span class="linenos">1216</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-1217"><a href="#TramDagModel-1217"><span class="linenos">1217</span></a><span class="sd">        None</span>
</span><span id="TramDagModel-1218"><a href="#TramDagModel-1218"><span class="linenos">1218</span></a>
</span><span id="TramDagModel-1219"><a href="#TramDagModel-1219"><span class="linenos">1219</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-1220"><a href="#TramDagModel-1220"><span class="linenos">1220</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-1221"><a href="#TramDagModel-1221"><span class="linenos">1221</span></a><span class="sd">        For each node, two plots are produced:</span>
</span><span id="TramDagModel-1222"><a href="#TramDagModel-1222"><span class="linenos">1222</span></a><span class="sd">        - Histogram of the latent U values.</span>
</span><span id="TramDagModel-1223"><a href="#TramDagModel-1223"><span class="linenos">1223</span></a><span class="sd">        - QQ-plot with simulation-based confidence bands under a logistic reference.</span>
</span><span id="TramDagModel-1224"><a href="#TramDagModel-1224"><span class="linenos">1224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-1225"><a href="#TramDagModel-1225"><span class="linenos">1225</span></a>        <span class="c1"># Compute latent representations</span>
</span><span id="TramDagModel-1226"><a href="#TramDagModel-1226"><span class="linenos">1226</span></a>        <span class="n">latents_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latent</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="TramDagModel-1227"><a href="#TramDagModel-1227"><span class="linenos">1227</span></a>
</span><span id="TramDagModel-1228"><a href="#TramDagModel-1228"><span class="linenos">1228</span></a>        <span class="c1"># Select nodes</span>
</span><span id="TramDagModel-1229"><a href="#TramDagModel-1229"><span class="linenos">1229</span></a>        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="k">if</span> <span class="n">variable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="TramDagModel-1230"><a href="#TramDagModel-1230"><span class="linenos">1230</span></a>
</span><span id="TramDagModel-1231"><a href="#TramDagModel-1231"><span class="linenos">1231</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
</span><span id="TramDagModel-1232"><a href="#TramDagModel-1232"><span class="linenos">1232</span></a>            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">_U&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">latents_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="TramDagModel-1233"><a href="#TramDagModel-1233"><span class="linenos">1233</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] No latent found for node </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">, skipping.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1234"><a href="#TramDagModel-1234"><span class="linenos">1234</span></a>                <span class="k">continue</span>
</span><span id="TramDagModel-1235"><a href="#TramDagModel-1235"><span class="linenos">1235</span></a>
</span><span id="TramDagModel-1236"><a href="#TramDagModel-1236"><span class="linenos">1236</span></a>            <span class="n">sample</span> <span class="o">=</span> <span class="n">latents_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">_U&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="TramDagModel-1237"><a href="#TramDagModel-1237"><span class="linenos">1237</span></a>
</span><span id="TramDagModel-1238"><a href="#TramDagModel-1238"><span class="linenos">1238</span></a>            <span class="c1"># --- Create plots ---</span>
</span><span id="TramDagModel-1239"><a href="#TramDagModel-1239"><span class="linenos">1239</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="TramDagModel-1240"><a href="#TramDagModel-1240"><span class="linenos">1240</span></a>
</span><span id="TramDagModel-1241"><a href="#TramDagModel-1241"><span class="linenos">1241</span></a>            <span class="c1"># Histogram</span>
</span><span id="TramDagModel-1242"><a href="#TramDagModel-1242"><span class="linenos">1242</span></a>            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;steelblue&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span><span id="TramDagModel-1243"><a href="#TramDagModel-1243"><span class="linenos">1243</span></a>            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Latent Histogram (</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1244"><a href="#TramDagModel-1244"><span class="linenos">1244</span></a>            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1245"><a href="#TramDagModel-1245"><span class="linenos">1245</span></a>            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1246"><a href="#TramDagModel-1246"><span class="linenos">1246</span></a>
</span><span id="TramDagModel-1247"><a href="#TramDagModel-1247"><span class="linenos">1247</span></a>            <span class="c1"># QQ Plot with confidence bands</span>
</span><span id="TramDagModel-1248"><a href="#TramDagModel-1248"><span class="linenos">1248</span></a>            <span class="n">probplot</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&quot;logistic&quot;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="TramDagModel-1249"><a href="#TramDagModel-1249"><span class="linenos">1249</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_r_style_confidence_bands</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sample</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">logistic</span><span class="p">,</span><span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span> <span class="n">simulations</span><span class="o">=</span><span class="n">simulations</span><span class="p">)</span>
</span><span id="TramDagModel-1250"><a href="#TramDagModel-1250"><span class="linenos">1250</span></a>            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Latent QQ Plot (</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1251"><a href="#TramDagModel-1251"><span class="linenos">1251</span></a>
</span><span id="TramDagModel-1252"><a href="#TramDagModel-1252"><span class="linenos">1252</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Latent Diagnostics for Node: </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="TramDagModel-1253"><a href="#TramDagModel-1253"><span class="linenos">1253</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>
</span><span id="TramDagModel-1254"><a href="#TramDagModel-1254"><span class="linenos">1254</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="TramDagModel-1255"><a href="#TramDagModel-1255"><span class="linenos">1255</span></a>
</span><span id="TramDagModel-1256"><a href="#TramDagModel-1256"><span class="linenos">1256</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_hdag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_n_rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TramDagModel-1257"><a href="#TramDagModel-1257"><span class="linenos">1257</span></a><span class="w">        </span>
</span><span id="TramDagModel-1258"><a href="#TramDagModel-1258"><span class="linenos">1258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-1259"><a href="#TramDagModel-1259"><span class="linenos">1259</span></a><span class="sd">        Visualize the transformation function h() for selected DAG nodes.</span>
</span><span id="TramDagModel-1260"><a href="#TramDagModel-1260"><span class="linenos">1260</span></a>
</span><span id="TramDagModel-1261"><a href="#TramDagModel-1261"><span class="linenos">1261</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-1262"><a href="#TramDagModel-1262"><span class="linenos">1262</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-1263"><a href="#TramDagModel-1263"><span class="linenos">1263</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="TramDagModel-1264"><a href="#TramDagModel-1264"><span class="linenos">1264</span></a><span class="sd">            Input data containing node values or model predictions.</span>
</span><span id="TramDagModel-1265"><a href="#TramDagModel-1265"><span class="linenos">1265</span></a><span class="sd">        variables : list of str or None, optional</span>
</span><span id="TramDagModel-1266"><a href="#TramDagModel-1266"><span class="linenos">1266</span></a><span class="sd">            Names of nodes to visualize. If None, all nodes in ``self.models``</span>
</span><span id="TramDagModel-1267"><a href="#TramDagModel-1267"><span class="linenos">1267</span></a><span class="sd">            are considered.</span>
</span><span id="TramDagModel-1268"><a href="#TramDagModel-1268"><span class="linenos">1268</span></a><span class="sd">        plot_n_rows : int, optional</span>
</span><span id="TramDagModel-1269"><a href="#TramDagModel-1269"><span class="linenos">1269</span></a><span class="sd">            Maximum number of rows from ``df`` to visualize. Default is 1.</span>
</span><span id="TramDagModel-1270"><a href="#TramDagModel-1270"><span class="linenos">1270</span></a><span class="sd">        **kwargs</span>
</span><span id="TramDagModel-1271"><a href="#TramDagModel-1271"><span class="linenos">1271</span></a><span class="sd">            Additional keyword arguments forwarded to the underlying plotting</span>
</span><span id="TramDagModel-1272"><a href="#TramDagModel-1272"><span class="linenos">1272</span></a><span class="sd">            helpers (`show_hdag_continous` / `show_hdag_ordinal`).</span>
</span><span id="TramDagModel-1273"><a href="#TramDagModel-1273"><span class="linenos">1273</span></a>
</span><span id="TramDagModel-1274"><a href="#TramDagModel-1274"><span class="linenos">1274</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-1275"><a href="#TramDagModel-1275"><span class="linenos">1275</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-1276"><a href="#TramDagModel-1276"><span class="linenos">1276</span></a><span class="sd">        None</span>
</span><span id="TramDagModel-1277"><a href="#TramDagModel-1277"><span class="linenos">1277</span></a>
</span><span id="TramDagModel-1278"><a href="#TramDagModel-1278"><span class="linenos">1278</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-1279"><a href="#TramDagModel-1279"><span class="linenos">1279</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-1280"><a href="#TramDagModel-1280"><span class="linenos">1280</span></a><span class="sd">        - For continuous outcomes, `show_hdag_continous` is called.</span>
</span><span id="TramDagModel-1281"><a href="#TramDagModel-1281"><span class="linenos">1281</span></a><span class="sd">        - For ordinal outcomes, `show_hdag_ordinal` is called.</span>
</span><span id="TramDagModel-1282"><a href="#TramDagModel-1282"><span class="linenos">1282</span></a><span class="sd">        - Nodes that are neither continuous nor ordinal are skipped with a warning.</span>
</span><span id="TramDagModel-1283"><a href="#TramDagModel-1283"><span class="linenos">1283</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-1284"><a href="#TramDagModel-1284"><span class="linenos">1284</span></a>                
</span><span id="TramDagModel-1285"><a href="#TramDagModel-1285"><span class="linenos">1285</span></a>
</span><span id="TramDagModel-1286"><a href="#TramDagModel-1286"><span class="linenos">1286</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TramDagModel-1287"><a href="#TramDagModel-1287"><span class="linenos">1287</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] len(df)&gt;1, set: plot_n_rows accordingly&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1288"><a href="#TramDagModel-1288"><span class="linenos">1288</span></a>        
</span><span id="TramDagModel-1289"><a href="#TramDagModel-1289"><span class="linenos">1289</span></a>        <span class="n">variables_list</span><span class="o">=</span><span class="n">variables</span> <span class="k">if</span> <span class="n">variables</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel-1290"><a href="#TramDagModel-1290"><span class="linenos">1290</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">variables_list</span><span class="p">:</span>
</span><span id="TramDagModel-1291"><a href="#TramDagModel-1291"><span class="linenos">1291</span></a>            <span class="k">if</span> <span class="n">is_outcome_modelled_continous</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">):</span>
</span><span id="TramDagModel-1292"><a href="#TramDagModel-1292"><span class="linenos">1292</span></a>                <span class="n">show_hdag_continous</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span><span class="n">configuration_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">,</span><span class="n">minmax_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span><span class="p">,</span><span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span><span class="n">plot_n_rows</span><span class="o">=</span><span class="n">plot_n_rows</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TramDagModel-1293"><a href="#TramDagModel-1293"><span class="linenos">1293</span></a>            
</span><span id="TramDagModel-1294"><a href="#TramDagModel-1294"><span class="linenos">1294</span></a>            <span class="k">elif</span> <span class="n">is_outcome_modelled_ordinal</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">):</span>
</span><span id="TramDagModel-1295"><a href="#TramDagModel-1295"><span class="linenos">1295</span></a>                <span class="n">show_hdag_ordinal</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span><span class="n">configuration_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">,</span><span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span><span class="n">plot_n_rows</span><span class="o">=</span><span class="n">plot_n_rows</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TramDagModel-1296"><a href="#TramDagModel-1296"><span class="linenos">1296</span></a>                <span class="c1"># plot_cutpoints_with_logistic(df,node=node,configuration_dict=self.cfg.conf_dict,device=self.device,plot_n_rows=plot_n_rows,**kwargs)</span>
</span><span id="TramDagModel-1297"><a href="#TramDagModel-1297"><span class="linenos">1297</span></a>                <span class="c1"># save_cutpoints_with_logistic(df,node=node,configuration_dict=self.cfg.conf_dict,device=self.device,**kwargs)</span>
</span><span id="TramDagModel-1298"><a href="#TramDagModel-1298"><span class="linenos">1298</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-1299"><a href="#TramDagModel-1299"><span class="linenos">1299</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Node </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2"> is wheter ordinal nor continous, not implemented yet&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1300"><a href="#TramDagModel-1300"><span class="linenos">1300</span></a>    
</span><span id="TramDagModel-1301"><a href="#TramDagModel-1301"><span class="linenos">1301</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TramDagModel-1302"><a href="#TramDagModel-1302"><span class="linenos">1302</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_add_r_style_confidence_bands</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">simulations</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
</span><span id="TramDagModel-1303"><a href="#TramDagModel-1303"><span class="linenos">1303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-1304"><a href="#TramDagModel-1304"><span class="linenos">1304</span></a><span class="sd">        Add simulation-based confidence bands to a QQ-plot.</span>
</span><span id="TramDagModel-1305"><a href="#TramDagModel-1305"><span class="linenos">1305</span></a>
</span><span id="TramDagModel-1306"><a href="#TramDagModel-1306"><span class="linenos">1306</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-1307"><a href="#TramDagModel-1307"><span class="linenos">1307</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-1308"><a href="#TramDagModel-1308"><span class="linenos">1308</span></a><span class="sd">        ax : matplotlib.axes.Axes</span>
</span><span id="TramDagModel-1309"><a href="#TramDagModel-1309"><span class="linenos">1309</span></a><span class="sd">            Axes object on which to draw the QQ-plot and bands.</span>
</span><span id="TramDagModel-1310"><a href="#TramDagModel-1310"><span class="linenos">1310</span></a><span class="sd">        sample : array-like</span>
</span><span id="TramDagModel-1311"><a href="#TramDagModel-1311"><span class="linenos">1311</span></a><span class="sd">            Empirical sample used in the QQ-plot.</span>
</span><span id="TramDagModel-1312"><a href="#TramDagModel-1312"><span class="linenos">1312</span></a><span class="sd">        dist : scipy.stats distribution</span>
</span><span id="TramDagModel-1313"><a href="#TramDagModel-1313"><span class="linenos">1313</span></a><span class="sd">            Distribution object providing ``ppf`` and ``rvs`` methods (e.g. logistic).</span>
</span><span id="TramDagModel-1314"><a href="#TramDagModel-1314"><span class="linenos">1314</span></a><span class="sd">        confidence : float, optional</span>
</span><span id="TramDagModel-1315"><a href="#TramDagModel-1315"><span class="linenos">1315</span></a><span class="sd">            Confidence level (0 &lt; confidence &lt; 1) for the bands. Default is 0.95.</span>
</span><span id="TramDagModel-1316"><a href="#TramDagModel-1316"><span class="linenos">1316</span></a><span class="sd">        simulations : int, optional</span>
</span><span id="TramDagModel-1317"><a href="#TramDagModel-1317"><span class="linenos">1317</span></a><span class="sd">            Number of Monte Carlo simulations used to estimate the bands. Default is 1000.</span>
</span><span id="TramDagModel-1318"><a href="#TramDagModel-1318"><span class="linenos">1318</span></a>
</span><span id="TramDagModel-1319"><a href="#TramDagModel-1319"><span class="linenos">1319</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-1320"><a href="#TramDagModel-1320"><span class="linenos">1320</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-1321"><a href="#TramDagModel-1321"><span class="linenos">1321</span></a><span class="sd">        None</span>
</span><span id="TramDagModel-1322"><a href="#TramDagModel-1322"><span class="linenos">1322</span></a>
</span><span id="TramDagModel-1323"><a href="#TramDagModel-1323"><span class="linenos">1323</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-1324"><a href="#TramDagModel-1324"><span class="linenos">1324</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-1325"><a href="#TramDagModel-1325"><span class="linenos">1325</span></a><span class="sd">        The axes are cleared, and a new QQ-plot is drawn with:</span>
</span><span id="TramDagModel-1326"><a href="#TramDagModel-1326"><span class="linenos">1326</span></a><span class="sd">        - Empirical vs. theoretical quantiles.</span>
</span><span id="TramDagModel-1327"><a href="#TramDagModel-1327"><span class="linenos">1327</span></a><span class="sd">        - 45-degree reference line.</span>
</span><span id="TramDagModel-1328"><a href="#TramDagModel-1328"><span class="linenos">1328</span></a><span class="sd">        - Shaded confidence band region.</span>
</span><span id="TramDagModel-1329"><a href="#TramDagModel-1329"><span class="linenos">1329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-1330"><a href="#TramDagModel-1330"><span class="linenos">1330</span></a>        
</span><span id="TramDagModel-1331"><a href="#TramDagModel-1331"><span class="linenos">1331</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
</span><span id="TramDagModel-1332"><a href="#TramDagModel-1332"><span class="linenos">1332</span></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TramDagModel-1333"><a href="#TramDagModel-1333"><span class="linenos">1333</span></a>            <span class="k">return</span>
</span><span id="TramDagModel-1334"><a href="#TramDagModel-1334"><span class="linenos">1334</span></a>
</span><span id="TramDagModel-1335"><a href="#TramDagModel-1335"><span class="linenos">1335</span></a>        <span class="n">quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">n</span>
</span><span id="TramDagModel-1336"><a href="#TramDagModel-1336"><span class="linenos">1336</span></a>        <span class="n">theo_q</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">quantiles</span><span class="p">)</span>
</span><span id="TramDagModel-1337"><a href="#TramDagModel-1337"><span class="linenos">1337</span></a>
</span><span id="TramDagModel-1338"><a href="#TramDagModel-1338"><span class="linenos">1338</span></a>        <span class="c1"># Simulate order statistics from the theoretical distribution</span>
</span><span id="TramDagModel-1339"><a href="#TramDagModel-1339"><span class="linenos">1339</span></a>        <span class="n">sim_data</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">simulations</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
</span><span id="TramDagModel-1340"><a href="#TramDagModel-1340"><span class="linenos">1340</span></a>        <span class="n">sim_order_stats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">sim_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel-1341"><a href="#TramDagModel-1341"><span class="linenos">1341</span></a>
</span><span id="TramDagModel-1342"><a href="#TramDagModel-1342"><span class="linenos">1342</span></a>        <span class="c1"># Confidence bands</span>
</span><span id="TramDagModel-1343"><a href="#TramDagModel-1343"><span class="linenos">1343</span></a>        <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">sim_order_stats</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">confidence</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="TramDagModel-1344"><a href="#TramDagModel-1344"><span class="linenos">1344</span></a>        <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">sim_order_stats</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">confidence</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="TramDagModel-1345"><a href="#TramDagModel-1345"><span class="linenos">1345</span></a>
</span><span id="TramDagModel-1346"><a href="#TramDagModel-1346"><span class="linenos">1346</span></a>        <span class="c1"># Sort empirical sample</span>
</span><span id="TramDagModel-1347"><a href="#TramDagModel-1347"><span class="linenos">1347</span></a>        <span class="n">sample_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
</span><span id="TramDagModel-1348"><a href="#TramDagModel-1348"><span class="linenos">1348</span></a>
</span><span id="TramDagModel-1349"><a href="#TramDagModel-1349"><span class="linenos">1349</span></a>        <span class="c1"># Re-draw points and CI (overwrite probplot defaults)</span>
</span><span id="TramDagModel-1350"><a href="#TramDagModel-1350"><span class="linenos">1350</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="TramDagModel-1351"><a href="#TramDagModel-1351"><span class="linenos">1351</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theo_q</span><span class="p">,</span> <span class="n">sample_sorted</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Empirical Q-Q&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1352"><a href="#TramDagModel-1352"><span class="linenos">1352</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">theo_q</span><span class="p">,</span> <span class="n">theo_q</span><span class="p">,</span> <span class="s1">&#39;b--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;y = x&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1353"><a href="#TramDagModel-1353"><span class="linenos">1353</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">theo_q</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</span><span id="TramDagModel-1354"><a href="#TramDagModel-1354"><span class="linenos">1354</span></a>                        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">confidence</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s1">% CI&#39;</span><span class="p">)</span>
</span><span id="TramDagModel-1355"><a href="#TramDagModel-1355"><span class="linenos">1355</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="TramDagModel-1356"><a href="#TramDagModel-1356"><span class="linenos">1356</span></a>    
</span><span id="TramDagModel-1357"><a href="#TramDagModel-1357"><span class="linenos">1357</span></a>    <span class="c1">## SAMPLING METHODS</span>
</span><span id="TramDagModel-1358"><a href="#TramDagModel-1358"><span class="linenos">1358</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span>
</span><span id="TramDagModel-1359"><a href="#TramDagModel-1359"><span class="linenos">1359</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TramDagModel-1360"><a href="#TramDagModel-1360"><span class="linenos">1360</span></a>        <span class="n">do_interventions</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagModel-1361"><a href="#TramDagModel-1361"><span class="linenos">1361</span></a>        <span class="n">predefined_latent_samples_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagModel-1362"><a href="#TramDagModel-1362"><span class="linenos">1362</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="TramDagModel-1363"><a href="#TramDagModel-1363"><span class="linenos">1363</span></a>    <span class="p">):</span>
</span><span id="TramDagModel-1364"><a href="#TramDagModel-1364"><span class="linenos">1364</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-1365"><a href="#TramDagModel-1365"><span class="linenos">1365</span></a><span class="sd">        Sample from the joint DAG using the trained TRAM models.</span>
</span><span id="TramDagModel-1366"><a href="#TramDagModel-1366"><span class="linenos">1366</span></a>
</span><span id="TramDagModel-1367"><a href="#TramDagModel-1367"><span class="linenos">1367</span></a><span class="sd">        Allows for:</span>
</span><span id="TramDagModel-1368"><a href="#TramDagModel-1368"><span class="linenos">1368</span></a><span class="sd">        </span>
</span><span id="TramDagModel-1369"><a href="#TramDagModel-1369"><span class="linenos">1369</span></a><span class="sd">        Oberservational sampling</span>
</span><span id="TramDagModel-1370"><a href="#TramDagModel-1370"><span class="linenos">1370</span></a><span class="sd">        Interventional sampling via ``do()`` operations</span>
</span><span id="TramDagModel-1371"><a href="#TramDagModel-1371"><span class="linenos">1371</span></a><span class="sd">        Counterfactial sampling using predefined latent draws and do()</span>
</span><span id="TramDagModel-1372"><a href="#TramDagModel-1372"><span class="linenos">1372</span></a><span class="sd">        </span>
</span><span id="TramDagModel-1373"><a href="#TramDagModel-1373"><span class="linenos">1373</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-1374"><a href="#TramDagModel-1374"><span class="linenos">1374</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-1375"><a href="#TramDagModel-1375"><span class="linenos">1375</span></a><span class="sd">        do_interventions : dict or None, optional</span>
</span><span id="TramDagModel-1376"><a href="#TramDagModel-1376"><span class="linenos">1376</span></a><span class="sd">            Mapping of node names to intervened (fixed) values. For example:</span>
</span><span id="TramDagModel-1377"><a href="#TramDagModel-1377"><span class="linenos">1377</span></a><span class="sd">            ``{&quot;x1&quot;: 1.0}`` represents ``do(x1 = 1.0)``. Default is None.</span>
</span><span id="TramDagModel-1378"><a href="#TramDagModel-1378"><span class="linenos">1378</span></a><span class="sd">        predefined_latent_samples_df : pandas.DataFrame or None, optional</span>
</span><span id="TramDagModel-1379"><a href="#TramDagModel-1379"><span class="linenos">1379</span></a><span class="sd">            DataFrame containing columns ``&quot;{node}_U&quot;`` with predefined latent</span>
</span><span id="TramDagModel-1380"><a href="#TramDagModel-1380"><span class="linenos">1380</span></a><span class="sd">            draws to be used instead of sampling from the prior. Default is None.</span>
</span><span id="TramDagModel-1381"><a href="#TramDagModel-1381"><span class="linenos">1381</span></a><span class="sd">        **kwargs</span>
</span><span id="TramDagModel-1382"><a href="#TramDagModel-1382"><span class="linenos">1382</span></a><span class="sd">            Sampling options overriding internal defaults:</span>
</span><span id="TramDagModel-1383"><a href="#TramDagModel-1383"><span class="linenos">1383</span></a>
</span><span id="TramDagModel-1384"><a href="#TramDagModel-1384"><span class="linenos">1384</span></a><span class="sd">            number_of_samples : int, default 10000</span>
</span><span id="TramDagModel-1385"><a href="#TramDagModel-1385"><span class="linenos">1385</span></a><span class="sd">                Total number of samples to draw.</span>
</span><span id="TramDagModel-1386"><a href="#TramDagModel-1386"><span class="linenos">1386</span></a><span class="sd">            batch_size : int, default 32</span>
</span><span id="TramDagModel-1387"><a href="#TramDagModel-1387"><span class="linenos">1387</span></a><span class="sd">                Batch size for internal sampling loops.</span>
</span><span id="TramDagModel-1388"><a href="#TramDagModel-1388"><span class="linenos">1388</span></a><span class="sd">            delete_all_previously_sampled : bool, default True</span>
</span><span id="TramDagModel-1389"><a href="#TramDagModel-1389"><span class="linenos">1389</span></a><span class="sd">                If True, delete old sampling files in node-specific sampling</span>
</span><span id="TramDagModel-1390"><a href="#TramDagModel-1390"><span class="linenos">1390</span></a><span class="sd">                directories before writing new ones.</span>
</span><span id="TramDagModel-1391"><a href="#TramDagModel-1391"><span class="linenos">1391</span></a><span class="sd">            verbose : bool</span>
</span><span id="TramDagModel-1392"><a href="#TramDagModel-1392"><span class="linenos">1392</span></a><span class="sd">                If True, print informational messages.</span>
</span><span id="TramDagModel-1393"><a href="#TramDagModel-1393"><span class="linenos">1393</span></a><span class="sd">            debug : bool</span>
</span><span id="TramDagModel-1394"><a href="#TramDagModel-1394"><span class="linenos">1394</span></a><span class="sd">                If True, print debug output.</span>
</span><span id="TramDagModel-1395"><a href="#TramDagModel-1395"><span class="linenos">1395</span></a><span class="sd">            device : {&quot;auto&quot;, &quot;cpu&quot;, &quot;cuda&quot;}</span>
</span><span id="TramDagModel-1396"><a href="#TramDagModel-1396"><span class="linenos">1396</span></a><span class="sd">                Device selection for sampling.</span>
</span><span id="TramDagModel-1397"><a href="#TramDagModel-1397"><span class="linenos">1397</span></a><span class="sd">            use_initial_weights_for_sampling : bool, default False</span>
</span><span id="TramDagModel-1398"><a href="#TramDagModel-1398"><span class="linenos">1398</span></a><span class="sd">                If True, sample from initial (untrained) model parameters.</span>
</span><span id="TramDagModel-1399"><a href="#TramDagModel-1399"><span class="linenos">1399</span></a>
</span><span id="TramDagModel-1400"><a href="#TramDagModel-1400"><span class="linenos">1400</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-1401"><a href="#TramDagModel-1401"><span class="linenos">1401</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-1402"><a href="#TramDagModel-1402"><span class="linenos">1402</span></a><span class="sd">        tuple</span>
</span><span id="TramDagModel-1403"><a href="#TramDagModel-1403"><span class="linenos">1403</span></a><span class="sd">            A tuple ``(sampled_by_node, latents_by_node)``:</span>
</span><span id="TramDagModel-1404"><a href="#TramDagModel-1404"><span class="linenos">1404</span></a>
</span><span id="TramDagModel-1405"><a href="#TramDagModel-1405"><span class="linenos">1405</span></a><span class="sd">            sampled_by_node : dict</span>
</span><span id="TramDagModel-1406"><a href="#TramDagModel-1406"><span class="linenos">1406</span></a><span class="sd">                Mapping ``{node_name: torch.Tensor}`` of sampled node values.</span>
</span><span id="TramDagModel-1407"><a href="#TramDagModel-1407"><span class="linenos">1407</span></a><span class="sd">            latents_by_node : dict</span>
</span><span id="TramDagModel-1408"><a href="#TramDagModel-1408"><span class="linenos">1408</span></a><span class="sd">                Mapping ``{node_name: torch.Tensor}`` of latent U values used.</span>
</span><span id="TramDagModel-1409"><a href="#TramDagModel-1409"><span class="linenos">1409</span></a>
</span><span id="TramDagModel-1410"><a href="#TramDagModel-1410"><span class="linenos">1410</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel-1411"><a href="#TramDagModel-1411"><span class="linenos">1411</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel-1412"><a href="#TramDagModel-1412"><span class="linenos">1412</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel-1413"><a href="#TramDagModel-1413"><span class="linenos">1413</span></a><span class="sd">            If the experiment directory cannot be resolved or if scaling</span>
</span><span id="TramDagModel-1414"><a href="#TramDagModel-1414"><span class="linenos">1414</span></a><span class="sd">            information (``self.minmax_dict``) is missing.</span>
</span><span id="TramDagModel-1415"><a href="#TramDagModel-1415"><span class="linenos">1415</span></a><span class="sd">        RuntimeError</span>
</span><span id="TramDagModel-1416"><a href="#TramDagModel-1416"><span class="linenos">1416</span></a><span class="sd">            If minmax scaling has not been computed before calling `sample`.</span>
</span><span id="TramDagModel-1417"><a href="#TramDagModel-1417"><span class="linenos">1417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-1418"><a href="#TramDagModel-1418"><span class="linenos">1418</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-1419"><a href="#TramDagModel-1419"><span class="linenos">1419</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-1420"><a href="#TramDagModel-1420"><span class="linenos">1420</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="TramDagModel-1421"><a href="#TramDagModel-1421"><span class="linenos">1421</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel-1422"><a href="#TramDagModel-1422"><span class="linenos">1422</span></a>                <span class="s2">&quot;[ERROR] Missing &#39;EXPERIMENT_DIR&#39; in cfg.conf_dict[&#39;PATHS&#39;]. &quot;</span>
</span><span id="TramDagModel-1423"><a href="#TramDagModel-1423"><span class="linenos">1423</span></a>                <span class="s2">&quot;Sampling requires trained model checkpoints.&quot;</span>
</span><span id="TramDagModel-1424"><a href="#TramDagModel-1424"><span class="linenos">1424</span></a>            <span class="p">)</span>
</span><span id="TramDagModel-1425"><a href="#TramDagModel-1425"><span class="linenos">1425</span></a>
</span><span id="TramDagModel-1426"><a href="#TramDagModel-1426"><span class="linenos">1426</span></a>        <span class="c1"># ---- defaults ----</span>
</span><span id="TramDagModel-1427"><a href="#TramDagModel-1427"><span class="linenos">1427</span></a>        <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TramDagModel-1428"><a href="#TramDagModel-1428"><span class="linenos">1428</span></a>            <span class="s2">&quot;number_of_samples&quot;</span><span class="p">:</span> <span class="mi">10_000</span><span class="p">,</span>
</span><span id="TramDagModel-1429"><a href="#TramDagModel-1429"><span class="linenos">1429</span></a>            <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
</span><span id="TramDagModel-1430"><a href="#TramDagModel-1430"><span class="linenos">1430</span></a>            <span class="s2">&quot;delete_all_previously_sampled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TramDagModel-1431"><a href="#TramDagModel-1431"><span class="linenos">1431</span></a>            <span class="s2">&quot;verbose&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TramDagModel-1432"><a href="#TramDagModel-1432"><span class="linenos">1432</span></a>            <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TramDagModel-1433"><a href="#TramDagModel-1433"><span class="linenos">1433</span></a>            <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">type</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;device&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span id="TramDagModel-1434"><a href="#TramDagModel-1434"><span class="linenos">1434</span></a>            <span class="s2">&quot;use_initial_weights_for_sampling&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TramDagModel-1435"><a href="#TramDagModel-1435"><span class="linenos">1435</span></a>            
</span><span id="TramDagModel-1436"><a href="#TramDagModel-1436"><span class="linenos">1436</span></a>        <span class="p">}</span>
</span><span id="TramDagModel-1437"><a href="#TramDagModel-1437"><span class="linenos">1437</span></a>        
</span><span id="TramDagModel-1438"><a href="#TramDagModel-1438"><span class="linenos">1438</span></a>        <span class="c1"># TODO adjust validation</span>
</span><span id="TramDagModel-1439"><a href="#TramDagModel-1439"><span class="linenos">1439</span></a>        <span class="c1"># self._validate_kwargs( kwargs, defaults_attr= &quot;settings&quot;, context=&quot;sample&quot;)</span>
</span><span id="TramDagModel-1440"><a href="#TramDagModel-1440"><span class="linenos">1440</span></a>        
</span><span id="TramDagModel-1441"><a href="#TramDagModel-1441"><span class="linenos">1441</span></a>        <span class="n">settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TramDagModel-1442"><a href="#TramDagModel-1442"><span class="linenos">1442</span></a>
</span><span id="TramDagModel-1443"><a href="#TramDagModel-1443"><span class="linenos">1443</span></a>        
</span><span id="TramDagModel-1444"><a href="#TramDagModel-1444"><span class="linenos">1444</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;minmax_dict&quot;</span><span class="p">):</span>
</span><span id="TramDagModel-1445"><a href="#TramDagModel-1445"><span class="linenos">1445</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="TramDagModel-1446"><a href="#TramDagModel-1446"><span class="linenos">1446</span></a>                <span class="s2">&quot;[ERROR] minmax_dict not found. You must call .fit() or .load_or_compute_minmax() &quot;</span>
</span><span id="TramDagModel-1447"><a href="#TramDagModel-1447"><span class="linenos">1447</span></a>                <span class="s2">&quot;before sampling, so scaling info is available.&quot;</span>
</span><span id="TramDagModel-1448"><a href="#TramDagModel-1448"><span class="linenos">1448</span></a>                <span class="p">)</span>
</span><span id="TramDagModel-1449"><a href="#TramDagModel-1449"><span class="linenos">1449</span></a>            
</span><span id="TramDagModel-1450"><a href="#TramDagModel-1450"><span class="linenos">1450</span></a>        <span class="c1"># ---- resolve device ----</span>
</span><span id="TramDagModel-1451"><a href="#TramDagModel-1451"><span class="linenos">1451</span></a>        <span class="n">device_str</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_device</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="TramDagModel-1452"><a href="#TramDagModel-1452"><span class="linenos">1452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device_str</span><span class="p">)</span>
</span><span id="TramDagModel-1453"><a href="#TramDagModel-1453"><span class="linenos">1453</span></a>
</span><span id="TramDagModel-1454"><a href="#TramDagModel-1454"><span class="linenos">1454</span></a>
</span><span id="TramDagModel-1455"><a href="#TramDagModel-1455"><span class="linenos">1455</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">or</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">]:</span>
</span><span id="TramDagModel-1456"><a href="#TramDagModel-1456"><span class="linenos">1456</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] sample(): device: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1457"><a href="#TramDagModel-1457"><span class="linenos">1457</span></a>
</span><span id="TramDagModel-1458"><a href="#TramDagModel-1458"><span class="linenos">1458</span></a>        <span class="c1"># ---- perform sampling ----</span>
</span><span id="TramDagModel-1459"><a href="#TramDagModel-1459"><span class="linenos">1459</span></a>        <span class="n">sampled_by_node</span><span class="p">,</span> <span class="n">latents_by_node</span> <span class="o">=</span> <span class="n">sample_full_dag</span><span class="p">(</span>
</span><span id="TramDagModel-1460"><a href="#TramDagModel-1460"><span class="linenos">1460</span></a>            <span class="n">configuration_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">,</span>
</span><span id="TramDagModel-1461"><a href="#TramDagModel-1461"><span class="linenos">1461</span></a>            <span class="n">EXPERIMENT_DIR</span><span class="o">=</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span>
</span><span id="TramDagModel-1462"><a href="#TramDagModel-1462"><span class="linenos">1462</span></a>            <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
</span><span id="TramDagModel-1463"><a href="#TramDagModel-1463"><span class="linenos">1463</span></a>            <span class="n">do_interventions</span><span class="o">=</span><span class="n">do_interventions</span> <span class="ow">or</span> <span class="p">{},</span>
</span><span id="TramDagModel-1464"><a href="#TramDagModel-1464"><span class="linenos">1464</span></a>            <span class="n">predefined_latent_samples_df</span><span class="o">=</span><span class="n">predefined_latent_samples_df</span><span class="p">,</span>
</span><span id="TramDagModel-1465"><a href="#TramDagModel-1465"><span class="linenos">1465</span></a>            <span class="n">number_of_samples</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;number_of_samples&quot;</span><span class="p">],</span>
</span><span id="TramDagModel-1466"><a href="#TramDagModel-1466"><span class="linenos">1466</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;batch_size&quot;</span><span class="p">],</span>
</span><span id="TramDagModel-1467"><a href="#TramDagModel-1467"><span class="linenos">1467</span></a>            <span class="n">delete_all_previously_sampled</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;delete_all_previously_sampled&quot;</span><span class="p">],</span>
</span><span id="TramDagModel-1468"><a href="#TramDagModel-1468"><span class="linenos">1468</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">],</span>
</span><span id="TramDagModel-1469"><a href="#TramDagModel-1469"><span class="linenos">1469</span></a>            <span class="n">debug</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">],</span>
</span><span id="TramDagModel-1470"><a href="#TramDagModel-1470"><span class="linenos">1470</span></a>            <span class="n">minmax_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span><span class="p">,</span>
</span><span id="TramDagModel-1471"><a href="#TramDagModel-1471"><span class="linenos">1471</span></a>            <span class="n">use_initial_weights_for_sampling</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;use_initial_weights_for_sampling&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-1472"><a href="#TramDagModel-1472"><span class="linenos">1472</span></a>        <span class="p">)</span>
</span><span id="TramDagModel-1473"><a href="#TramDagModel-1473"><span class="linenos">1473</span></a>
</span><span id="TramDagModel-1474"><a href="#TramDagModel-1474"><span class="linenos">1474</span></a>        <span class="k">return</span> <span class="n">sampled_by_node</span><span class="p">,</span> <span class="n">latents_by_node</span>
</span><span id="TramDagModel-1475"><a href="#TramDagModel-1475"><span class="linenos">1475</span></a>
</span><span id="TramDagModel-1476"><a href="#TramDagModel-1476"><span class="linenos">1476</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_sampled_and_latents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">EXPERIMENT_DIR</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagModel-1477"><a href="#TramDagModel-1477"><span class="linenos">1477</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-1478"><a href="#TramDagModel-1478"><span class="linenos">1478</span></a><span class="sd">        Load previously stored sampled values and latents for each node.</span>
</span><span id="TramDagModel-1479"><a href="#TramDagModel-1479"><span class="linenos">1479</span></a>
</span><span id="TramDagModel-1480"><a href="#TramDagModel-1480"><span class="linenos">1480</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-1481"><a href="#TramDagModel-1481"><span class="linenos">1481</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-1482"><a href="#TramDagModel-1482"><span class="linenos">1482</span></a><span class="sd">        EXPERIMENT_DIR : str or None, optional</span>
</span><span id="TramDagModel-1483"><a href="#TramDagModel-1483"><span class="linenos">1483</span></a><span class="sd">            Experiment directory path. If None, it is taken from</span>
</span><span id="TramDagModel-1484"><a href="#TramDagModel-1484"><span class="linenos">1484</span></a><span class="sd">            ``self.cfg.conf_dict[&quot;PATHS&quot;][&quot;EXPERIMENT_DIR&quot;]``.</span>
</span><span id="TramDagModel-1485"><a href="#TramDagModel-1485"><span class="linenos">1485</span></a><span class="sd">        nodes : list of str or None, optional</span>
</span><span id="TramDagModel-1486"><a href="#TramDagModel-1486"><span class="linenos">1486</span></a><span class="sd">            Nodes for which to load samples. If None, use all nodes from</span>
</span><span id="TramDagModel-1487"><a href="#TramDagModel-1487"><span class="linenos">1487</span></a><span class="sd">            ``self.nodes_dict``.</span>
</span><span id="TramDagModel-1488"><a href="#TramDagModel-1488"><span class="linenos">1488</span></a>
</span><span id="TramDagModel-1489"><a href="#TramDagModel-1489"><span class="linenos">1489</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-1490"><a href="#TramDagModel-1490"><span class="linenos">1490</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-1491"><a href="#TramDagModel-1491"><span class="linenos">1491</span></a><span class="sd">        tuple</span>
</span><span id="TramDagModel-1492"><a href="#TramDagModel-1492"><span class="linenos">1492</span></a><span class="sd">            A tuple ``(sampled_by_node, latents_by_node)``:</span>
</span><span id="TramDagModel-1493"><a href="#TramDagModel-1493"><span class="linenos">1493</span></a>
</span><span id="TramDagModel-1494"><a href="#TramDagModel-1494"><span class="linenos">1494</span></a><span class="sd">            sampled_by_node : dict</span>
</span><span id="TramDagModel-1495"><a href="#TramDagModel-1495"><span class="linenos">1495</span></a><span class="sd">                Mapping ``{node_name: torch.Tensor}`` of sampled values (on CPU).</span>
</span><span id="TramDagModel-1496"><a href="#TramDagModel-1496"><span class="linenos">1496</span></a><span class="sd">            latents_by_node : dict</span>
</span><span id="TramDagModel-1497"><a href="#TramDagModel-1497"><span class="linenos">1497</span></a><span class="sd">                Mapping ``{node_name: torch.Tensor}`` of latent values (on CPU).</span>
</span><span id="TramDagModel-1498"><a href="#TramDagModel-1498"><span class="linenos">1498</span></a>
</span><span id="TramDagModel-1499"><a href="#TramDagModel-1499"><span class="linenos">1499</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel-1500"><a href="#TramDagModel-1500"><span class="linenos">1500</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel-1501"><a href="#TramDagModel-1501"><span class="linenos">1501</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel-1502"><a href="#TramDagModel-1502"><span class="linenos">1502</span></a><span class="sd">            If the experiment directory cannot be resolved or if no node list</span>
</span><span id="TramDagModel-1503"><a href="#TramDagModel-1503"><span class="linenos">1503</span></a><span class="sd">            is available and ``nodes`` is None.</span>
</span><span id="TramDagModel-1504"><a href="#TramDagModel-1504"><span class="linenos">1504</span></a>
</span><span id="TramDagModel-1505"><a href="#TramDagModel-1505"><span class="linenos">1505</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-1506"><a href="#TramDagModel-1506"><span class="linenos">1506</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-1507"><a href="#TramDagModel-1507"><span class="linenos">1507</span></a><span class="sd">        Nodes without both ``sampled.pt`` and ``latents.pt`` files are skipped</span>
</span><span id="TramDagModel-1508"><a href="#TramDagModel-1508"><span class="linenos">1508</span></a><span class="sd">        with a warning.</span>
</span><span id="TramDagModel-1509"><a href="#TramDagModel-1509"><span class="linenos">1509</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-1510"><a href="#TramDagModel-1510"><span class="linenos">1510</span></a>        <span class="c1"># --- resolve paths and node list ---</span>
</span><span id="TramDagModel-1511"><a href="#TramDagModel-1511"><span class="linenos">1511</span></a>        <span class="k">if</span> <span class="n">EXPERIMENT_DIR</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel-1512"><a href="#TramDagModel-1512"><span class="linenos">1512</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-1513"><a href="#TramDagModel-1513"><span class="linenos">1513</span></a>                <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-1514"><a href="#TramDagModel-1514"><span class="linenos">1514</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
</span><span id="TramDagModel-1515"><a href="#TramDagModel-1515"><span class="linenos">1515</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel-1516"><a href="#TramDagModel-1516"><span class="linenos">1516</span></a>                    <span class="s2">&quot;[ERROR] Could not resolve EXPERIMENT_DIR from cfg.conf_dict[&#39;PATHS&#39;]. &quot;</span>
</span><span id="TramDagModel-1517"><a href="#TramDagModel-1517"><span class="linenos">1517</span></a>                    <span class="s2">&quot;Please provide EXPERIMENT_DIR explicitly.&quot;</span>
</span><span id="TramDagModel-1518"><a href="#TramDagModel-1518"><span class="linenos">1518</span></a>                <span class="p">)</span>
</span><span id="TramDagModel-1519"><a href="#TramDagModel-1519"><span class="linenos">1519</span></a>
</span><span id="TramDagModel-1520"><a href="#TramDagModel-1520"><span class="linenos">1520</span></a>        <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel-1521"><a href="#TramDagModel-1521"><span class="linenos">1521</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;nodes_dict&quot;</span><span class="p">):</span>
</span><span id="TramDagModel-1522"><a href="#TramDagModel-1522"><span class="linenos">1522</span></a>                <span class="n">nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel-1523"><a href="#TramDagModel-1523"><span class="linenos">1523</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-1524"><a href="#TramDagModel-1524"><span class="linenos">1524</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel-1525"><a href="#TramDagModel-1525"><span class="linenos">1525</span></a>                    <span class="s2">&quot;[ERROR] No node list found. Please provide `nodes` or initialize model with a config.&quot;</span>
</span><span id="TramDagModel-1526"><a href="#TramDagModel-1526"><span class="linenos">1526</span></a>                <span class="p">)</span>
</span><span id="TramDagModel-1527"><a href="#TramDagModel-1527"><span class="linenos">1527</span></a>
</span><span id="TramDagModel-1528"><a href="#TramDagModel-1528"><span class="linenos">1528</span></a>        <span class="c1"># --- load tensors ---</span>
</span><span id="TramDagModel-1529"><a href="#TramDagModel-1529"><span class="linenos">1529</span></a>        <span class="n">sampled_by_node</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel-1530"><a href="#TramDagModel-1530"><span class="linenos">1530</span></a>        <span class="n">latents_by_node</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel-1531"><a href="#TramDagModel-1531"><span class="linenos">1531</span></a>
</span><span id="TramDagModel-1532"><a href="#TramDagModel-1532"><span class="linenos">1532</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
</span><span id="TramDagModel-1533"><a href="#TramDagModel-1533"><span class="linenos">1533</span></a>            <span class="n">node_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1534"><a href="#TramDagModel-1534"><span class="linenos">1534</span></a>            <span class="n">sampling_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="s2">&quot;sampling&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1535"><a href="#TramDagModel-1535"><span class="linenos">1535</span></a>
</span><span id="TramDagModel-1536"><a href="#TramDagModel-1536"><span class="linenos">1536</span></a>            <span class="n">sampled_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sampling_dir</span><span class="p">,</span> <span class="s2">&quot;sampled.pt&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1537"><a href="#TramDagModel-1537"><span class="linenos">1537</span></a>            <span class="n">latents_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sampling_dir</span><span class="p">,</span> <span class="s2">&quot;latents.pt&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1538"><a href="#TramDagModel-1538"><span class="linenos">1538</span></a>
</span><span id="TramDagModel-1539"><a href="#TramDagModel-1539"><span class="linenos">1539</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">sampled_path</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">latents_path</span><span class="p">):</span>
</span><span id="TramDagModel-1540"><a href="#TramDagModel-1540"><span class="linenos">1540</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Missing files for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;  skipping.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1541"><a href="#TramDagModel-1541"><span class="linenos">1541</span></a>                <span class="k">continue</span>
</span><span id="TramDagModel-1542"><a href="#TramDagModel-1542"><span class="linenos">1542</span></a>
</span><span id="TramDagModel-1543"><a href="#TramDagModel-1543"><span class="linenos">1543</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-1544"><a href="#TramDagModel-1544"><span class="linenos">1544</span></a>                <span class="n">sampled</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">sampled_path</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1545"><a href="#TramDagModel-1545"><span class="linenos">1545</span></a>                <span class="n">latent_sample</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">latents_path</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1546"><a href="#TramDagModel-1546"><span class="linenos">1546</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel-1547"><a href="#TramDagModel-1547"><span class="linenos">1547</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] Could not load sampling files for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1548"><a href="#TramDagModel-1548"><span class="linenos">1548</span></a>                <span class="k">continue</span>
</span><span id="TramDagModel-1549"><a href="#TramDagModel-1549"><span class="linenos">1549</span></a>
</span><span id="TramDagModel-1550"><a href="#TramDagModel-1550"><span class="linenos">1550</span></a>            <span class="n">sampled_by_node</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">sampled</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
</span><span id="TramDagModel-1551"><a href="#TramDagModel-1551"><span class="linenos">1551</span></a>            <span class="n">latents_by_node</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">latent_sample</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
</span><span id="TramDagModel-1552"><a href="#TramDagModel-1552"><span class="linenos">1552</span></a>
</span><span id="TramDagModel-1553"><a href="#TramDagModel-1553"><span class="linenos">1553</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel-1554"><a href="#TramDagModel-1554"><span class="linenos">1554</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Loaded sampled and latent tensors for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sampled_by_node</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes from </span><span class="si">{</span><span class="n">EXPERIMENT_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1555"><a href="#TramDagModel-1555"><span class="linenos">1555</span></a>
</span><span id="TramDagModel-1556"><a href="#TramDagModel-1556"><span class="linenos">1556</span></a>        <span class="k">return</span> <span class="n">sampled_by_node</span><span class="p">,</span> <span class="n">latents_by_node</span>
</span><span id="TramDagModel-1557"><a href="#TramDagModel-1557"><span class="linenos">1557</span></a>
</span><span id="TramDagModel-1558"><a href="#TramDagModel-1558"><span class="linenos">1558</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_samples_vs_true</span><span class="p">(</span>
</span><span id="TramDagModel-1559"><a href="#TramDagModel-1559"><span class="linenos">1559</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TramDagModel-1560"><a href="#TramDagModel-1560"><span class="linenos">1560</span></a>        <span class="n">df</span><span class="p">,</span>
</span><span id="TramDagModel-1561"><a href="#TramDagModel-1561"><span class="linenos">1561</span></a>        <span class="n">sampled</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagModel-1562"><a href="#TramDagModel-1562"><span class="linenos">1562</span></a>        <span class="n">variable</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagModel-1563"><a href="#TramDagModel-1563"><span class="linenos">1563</span></a>        <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="TramDagModel-1564"><a href="#TramDagModel-1564"><span class="linenos">1564</span></a>        <span class="n">hist_true_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="TramDagModel-1565"><a href="#TramDagModel-1565"><span class="linenos">1565</span></a>        <span class="n">hist_est_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span>
</span><span id="TramDagModel-1566"><a href="#TramDagModel-1566"><span class="linenos">1566</span></a>        <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
</span><span id="TramDagModel-1567"><a href="#TramDagModel-1567"><span class="linenos">1567</span></a>    <span class="p">):</span>
</span><span id="TramDagModel-1568"><a href="#TramDagModel-1568"><span class="linenos">1568</span></a><span class="w">        </span>
</span><span id="TramDagModel-1569"><a href="#TramDagModel-1569"><span class="linenos">1569</span></a><span class="w">        </span>
</span><span id="TramDagModel-1570"><a href="#TramDagModel-1570"><span class="linenos">1570</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-1571"><a href="#TramDagModel-1571"><span class="linenos">1571</span></a><span class="sd">        Compare sampled vs. observed distributions for selected nodes.</span>
</span><span id="TramDagModel-1572"><a href="#TramDagModel-1572"><span class="linenos">1572</span></a>
</span><span id="TramDagModel-1573"><a href="#TramDagModel-1573"><span class="linenos">1573</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-1574"><a href="#TramDagModel-1574"><span class="linenos">1574</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-1575"><a href="#TramDagModel-1575"><span class="linenos">1575</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="TramDagModel-1576"><a href="#TramDagModel-1576"><span class="linenos">1576</span></a><span class="sd">            Data frame containing the observed node values.</span>
</span><span id="TramDagModel-1577"><a href="#TramDagModel-1577"><span class="linenos">1577</span></a><span class="sd">        sampled : dict or None, optional</span>
</span><span id="TramDagModel-1578"><a href="#TramDagModel-1578"><span class="linenos">1578</span></a><span class="sd">            Optional mapping ``{node_name: array-like or torch.Tensor}`` of sampled</span>
</span><span id="TramDagModel-1579"><a href="#TramDagModel-1579"><span class="linenos">1579</span></a><span class="sd">            values. If None or if a node is missing, samples are loaded from</span>
</span><span id="TramDagModel-1580"><a href="#TramDagModel-1580"><span class="linenos">1580</span></a><span class="sd">            ``EXPERIMENT_DIR/{node}/sampling/sampled.pt``.</span>
</span><span id="TramDagModel-1581"><a href="#TramDagModel-1581"><span class="linenos">1581</span></a><span class="sd">        variable : list of str or None, optional</span>
</span><span id="TramDagModel-1582"><a href="#TramDagModel-1582"><span class="linenos">1582</span></a><span class="sd">            Subset of nodes to plot. If None, all nodes in the configuration</span>
</span><span id="TramDagModel-1583"><a href="#TramDagModel-1583"><span class="linenos">1583</span></a><span class="sd">            are considered.</span>
</span><span id="TramDagModel-1584"><a href="#TramDagModel-1584"><span class="linenos">1584</span></a><span class="sd">        bins : int, optional</span>
</span><span id="TramDagModel-1585"><a href="#TramDagModel-1585"><span class="linenos">1585</span></a><span class="sd">            Number of histogram bins for continuous variables. Default is 100.</span>
</span><span id="TramDagModel-1586"><a href="#TramDagModel-1586"><span class="linenos">1586</span></a><span class="sd">        hist_true_color : str, optional</span>
</span><span id="TramDagModel-1587"><a href="#TramDagModel-1587"><span class="linenos">1587</span></a><span class="sd">            Color name for the histogram of true values. Default is &quot;blue&quot;.</span>
</span><span id="TramDagModel-1588"><a href="#TramDagModel-1588"><span class="linenos">1588</span></a><span class="sd">        hist_est_color : str, optional</span>
</span><span id="TramDagModel-1589"><a href="#TramDagModel-1589"><span class="linenos">1589</span></a><span class="sd">            Color name for the histogram of sampled values. Default is &quot;orange&quot;.</span>
</span><span id="TramDagModel-1590"><a href="#TramDagModel-1590"><span class="linenos">1590</span></a><span class="sd">        figsize : tuple, optional</span>
</span><span id="TramDagModel-1591"><a href="#TramDagModel-1591"><span class="linenos">1591</span></a><span class="sd">            Figure size for the matplotlib plots. Default is (14, 5).</span>
</span><span id="TramDagModel-1592"><a href="#TramDagModel-1592"><span class="linenos">1592</span></a>
</span><span id="TramDagModel-1593"><a href="#TramDagModel-1593"><span class="linenos">1593</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-1594"><a href="#TramDagModel-1594"><span class="linenos">1594</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-1595"><a href="#TramDagModel-1595"><span class="linenos">1595</span></a><span class="sd">        None</span>
</span><span id="TramDagModel-1596"><a href="#TramDagModel-1596"><span class="linenos">1596</span></a>
</span><span id="TramDagModel-1597"><a href="#TramDagModel-1597"><span class="linenos">1597</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-1598"><a href="#TramDagModel-1598"><span class="linenos">1598</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-1599"><a href="#TramDagModel-1599"><span class="linenos">1599</span></a><span class="sd">        - Continuous outcomes: histogram overlay + QQ-plot.</span>
</span><span id="TramDagModel-1600"><a href="#TramDagModel-1600"><span class="linenos">1600</span></a><span class="sd">        - Ordinal outcomes: side-by-side bar plot of relative frequencies.</span>
</span><span id="TramDagModel-1601"><a href="#TramDagModel-1601"><span class="linenos">1601</span></a><span class="sd">        - Other categorical outcomes: side-by-side bar plot with category labels.</span>
</span><span id="TramDagModel-1602"><a href="#TramDagModel-1602"><span class="linenos">1602</span></a><span class="sd">        - If samples are probabilistic (2D tensor), the argmax across classes is used.</span>
</span><span id="TramDagModel-1603"><a href="#TramDagModel-1603"><span class="linenos">1603</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-1604"><a href="#TramDagModel-1604"><span class="linenos">1604</span></a>        
</span><span id="TramDagModel-1605"><a href="#TramDagModel-1605"><span class="linenos">1605</span></a>        <span class="n">target_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-1606"><a href="#TramDagModel-1606"><span class="linenos">1606</span></a>        <span class="n">experiment_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-1607"><a href="#TramDagModel-1607"><span class="linenos">1607</span></a>        <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1608"><a href="#TramDagModel-1608"><span class="linenos">1608</span></a>
</span><span id="TramDagModel-1609"><a href="#TramDagModel-1609"><span class="linenos">1609</span></a>        <span class="n">plot_list</span> <span class="o">=</span> <span class="n">variable</span> <span class="k">if</span> <span class="n">variable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">target_nodes</span>
</span><span id="TramDagModel-1610"><a href="#TramDagModel-1610"><span class="linenos">1610</span></a>
</span><span id="TramDagModel-1611"><a href="#TramDagModel-1611"><span class="linenos">1611</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">plot_list</span><span class="p">:</span>
</span><span id="TramDagModel-1612"><a href="#TramDagModel-1612"><span class="linenos">1612</span></a>            <span class="c1"># Load sampled data</span>
</span><span id="TramDagModel-1613"><a href="#TramDagModel-1613"><span class="linenos">1613</span></a>            <span class="k">if</span> <span class="n">sampled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">sampled</span><span class="p">:</span>
</span><span id="TramDagModel-1614"><a href="#TramDagModel-1614"><span class="linenos">1614</span></a>                <span class="n">sdata</span> <span class="o">=</span> <span class="n">sampled</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel-1615"><a href="#TramDagModel-1615"><span class="linenos">1615</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sdata</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</span><span id="TramDagModel-1616"><a href="#TramDagModel-1616"><span class="linenos">1616</span></a>                    <span class="n">sampled_vals</span> <span class="o">=</span> <span class="n">sdata</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="TramDagModel-1617"><a href="#TramDagModel-1617"><span class="linenos">1617</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-1618"><a href="#TramDagModel-1618"><span class="linenos">1618</span></a>                    <span class="n">sampled_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sdata</span><span class="p">)</span>
</span><span id="TramDagModel-1619"><a href="#TramDagModel-1619"><span class="linenos">1619</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-1620"><a href="#TramDagModel-1620"><span class="linenos">1620</span></a>                <span class="n">sample_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">experiment_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">/sampling/sampled.pt&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1621"><a href="#TramDagModel-1621"><span class="linenos">1621</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">sample_path</span><span class="p">):</span>
</span><span id="TramDagModel-1622"><a href="#TramDagModel-1622"><span class="linenos">1622</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] skip </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">sample_path</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1623"><a href="#TramDagModel-1623"><span class="linenos">1623</span></a>                    <span class="k">continue</span>
</span><span id="TramDagModel-1624"><a href="#TramDagModel-1624"><span class="linenos">1624</span></a>
</span><span id="TramDagModel-1625"><a href="#TramDagModel-1625"><span class="linenos">1625</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-1626"><a href="#TramDagModel-1626"><span class="linenos">1626</span></a>                    <span class="n">sampled_vals</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">sample_path</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="TramDagModel-1627"><a href="#TramDagModel-1627"><span class="linenos">1627</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel-1628"><a href="#TramDagModel-1628"><span class="linenos">1628</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] Could not load </span><span class="si">{</span><span class="n">sample_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1629"><a href="#TramDagModel-1629"><span class="linenos">1629</span></a>                    <span class="k">continue</span>
</span><span id="TramDagModel-1630"><a href="#TramDagModel-1630"><span class="linenos">1630</span></a>
</span><span id="TramDagModel-1631"><a href="#TramDagModel-1631"><span class="linenos">1631</span></a>            <span class="c1"># If logits/probabilities per sample, take argmax</span>
</span><span id="TramDagModel-1632"><a href="#TramDagModel-1632"><span class="linenos">1632</span></a>            <span class="k">if</span> <span class="n">sampled_vals</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="TramDagModel-1633"><a href="#TramDagModel-1633"><span class="linenos">1633</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] CAUTION! </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">: samples are probabilistic  each sample follows a probability &quot;</span>
</span><span id="TramDagModel-1634"><a href="#TramDagModel-1634"><span class="linenos">1634</span></a>                    <span class="sa">f</span><span class="s2">&quot;distribution based on the valid latent range. &quot;</span>
</span><span id="TramDagModel-1635"><a href="#TramDagModel-1635"><span class="linenos">1635</span></a>                    <span class="sa">f</span><span class="s2">&quot;Note that this frequency plot reflects only the distribution of the most probable &quot;</span>
</span><span id="TramDagModel-1636"><a href="#TramDagModel-1636"><span class="linenos">1636</span></a>                    <span class="sa">f</span><span class="s2">&quot;class per sample.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1637"><a href="#TramDagModel-1637"><span class="linenos">1637</span></a>                    <span class="n">sampled_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sampled_vals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel-1638"><a href="#TramDagModel-1638"><span class="linenos">1638</span></a>
</span><span id="TramDagModel-1639"><a href="#TramDagModel-1639"><span class="linenos">1639</span></a>            <span class="n">sampled_vals</span> <span class="o">=</span> <span class="n">sampled_vals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">sampled_vals</span><span class="p">)]</span>
</span><span id="TramDagModel-1640"><a href="#TramDagModel-1640"><span class="linenos">1640</span></a>
</span><span id="TramDagModel-1641"><a href="#TramDagModel-1641"><span class="linenos">1641</span></a>            <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="TramDagModel-1642"><a href="#TramDagModel-1642"><span class="linenos">1642</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] skip </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">: column not found in DataFrame.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1643"><a href="#TramDagModel-1643"><span class="linenos">1643</span></a>                <span class="k">continue</span>
</span><span id="TramDagModel-1644"><a href="#TramDagModel-1644"><span class="linenos">1644</span></a>
</span><span id="TramDagModel-1645"><a href="#TramDagModel-1645"><span class="linenos">1645</span></a>            <span class="n">true_vals</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
</span><span id="TramDagModel-1646"><a href="#TramDagModel-1646"><span class="linenos">1646</span></a>            <span class="n">true_vals</span> <span class="o">=</span> <span class="n">true_vals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">true_vals</span><span class="p">)]</span>
</span><span id="TramDagModel-1647"><a href="#TramDagModel-1647"><span class="linenos">1647</span></a>
</span><span id="TramDagModel-1648"><a href="#TramDagModel-1648"><span class="linenos">1648</span></a>            <span class="k">if</span> <span class="n">sampled_vals</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">true_vals</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TramDagModel-1649"><a href="#TramDagModel-1649"><span class="linenos">1649</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] skip </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">: empty array after NaN/Inf removal.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1650"><a href="#TramDagModel-1650"><span class="linenos">1650</span></a>                <span class="k">continue</span>
</span><span id="TramDagModel-1651"><a href="#TramDagModel-1651"><span class="linenos">1651</span></a>
</span><span id="TramDagModel-1652"><a href="#TramDagModel-1652"><span class="linenos">1652</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
</span><span id="TramDagModel-1653"><a href="#TramDagModel-1653"><span class="linenos">1653</span></a>
</span><span id="TramDagModel-1654"><a href="#TramDagModel-1654"><span class="linenos">1654</span></a>            <span class="k">if</span> <span class="n">is_outcome_modelled_continous</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">target_nodes</span><span class="p">):</span>
</span><span id="TramDagModel-1655"><a href="#TramDagModel-1655"><span class="linenos">1655</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">true_vals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
</span><span id="TramDagModel-1656"><a href="#TramDagModel-1656"><span class="linenos">1656</span></a>                            <span class="n">color</span><span class="o">=</span><span class="n">hist_true_color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;True </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1657"><a href="#TramDagModel-1657"><span class="linenos">1657</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sampled_vals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
</span><span id="TramDagModel-1658"><a href="#TramDagModel-1658"><span class="linenos">1658</span></a>                            <span class="n">color</span><span class="o">=</span><span class="n">hist_est_color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sampled&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1659"><a href="#TramDagModel-1659"><span class="linenos">1659</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1660"><a href="#TramDagModel-1660"><span class="linenos">1660</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1661"><a href="#TramDagModel-1661"><span class="linenos">1661</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Histogram overlay for </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1662"><a href="#TramDagModel-1662"><span class="linenos">1662</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="TramDagModel-1663"><a href="#TramDagModel-1663"><span class="linenos">1663</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="TramDagModel-1664"><a href="#TramDagModel-1664"><span class="linenos">1664</span></a>
</span><span id="TramDagModel-1665"><a href="#TramDagModel-1665"><span class="linenos">1665</span></a>                <span class="n">qqplot_2samples</span><span class="p">(</span><span class="n">true_vals</span><span class="p">,</span> <span class="n">sampled_vals</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="s2">&quot;45&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="TramDagModel-1666"><a href="#TramDagModel-1666"><span class="linenos">1666</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;True quantiles&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1667"><a href="#TramDagModel-1667"><span class="linenos">1667</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Sampled quantiles&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1668"><a href="#TramDagModel-1668"><span class="linenos">1668</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;QQ plot for </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1669"><a href="#TramDagModel-1669"><span class="linenos">1669</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="TramDagModel-1670"><a href="#TramDagModel-1670"><span class="linenos">1670</span></a>
</span><span id="TramDagModel-1671"><a href="#TramDagModel-1671"><span class="linenos">1671</span></a>            <span class="k">elif</span> <span class="n">is_outcome_modelled_ordinal</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">target_nodes</span><span class="p">):</span>
</span><span id="TramDagModel-1672"><a href="#TramDagModel-1672"><span class="linenos">1672</span></a>                <span class="n">unique_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">union1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">true_vals</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">sampled_vals</span><span class="p">))</span>
</span><span id="TramDagModel-1673"><a href="#TramDagModel-1673"><span class="linenos">1673</span></a>                <span class="n">unique_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">)</span>
</span><span id="TramDagModel-1674"><a href="#TramDagModel-1674"><span class="linenos">1674</span></a>                <span class="n">true_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">true_vals</span> <span class="o">==</span> <span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">unique_vals</span><span class="p">])</span>
</span><span id="TramDagModel-1675"><a href="#TramDagModel-1675"><span class="linenos">1675</span></a>                <span class="n">sampled_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">sampled_vals</span> <span class="o">==</span> <span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">unique_vals</span><span class="p">])</span>
</span><span id="TramDagModel-1676"><a href="#TramDagModel-1676"><span class="linenos">1676</span></a>
</span><span id="TramDagModel-1677"><a href="#TramDagModel-1677"><span class="linenos">1677</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">unique_vals</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">true_counts</span> <span class="o">/</span> <span class="n">true_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
</span><span id="TramDagModel-1678"><a href="#TramDagModel-1678"><span class="linenos">1678</span></a>                        <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">hist_true_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1679"><a href="#TramDagModel-1679"><span class="linenos">1679</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">unique_vals</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">sampled_counts</span> <span class="o">/</span> <span class="n">sampled_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
</span><span id="TramDagModel-1680"><a href="#TramDagModel-1680"><span class="linenos">1680</span></a>                        <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">hist_est_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sampled&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1681"><a href="#TramDagModel-1681"><span class="linenos">1681</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">)</span>
</span><span id="TramDagModel-1682"><a href="#TramDagModel-1682"><span class="linenos">1682</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Ordinal Level&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1683"><a href="#TramDagModel-1683"><span class="linenos">1683</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Relative Frequency&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1684"><a href="#TramDagModel-1684"><span class="linenos">1684</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ordinal bar plot for </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1685"><a href="#TramDagModel-1685"><span class="linenos">1685</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="TramDagModel-1686"><a href="#TramDagModel-1686"><span class="linenos">1686</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="TramDagModel-1687"><a href="#TramDagModel-1687"><span class="linenos">1687</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1688"><a href="#TramDagModel-1688"><span class="linenos">1688</span></a>
</span><span id="TramDagModel-1689"><a href="#TramDagModel-1689"><span class="linenos">1689</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-1690"><a href="#TramDagModel-1690"><span class="linenos">1690</span></a>                <span class="n">unique_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">union1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">true_vals</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">sampled_vals</span><span class="p">))</span>
</span><span id="TramDagModel-1691"><a href="#TramDagModel-1691"><span class="linenos">1691</span></a>                <span class="n">unique_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
</span><span id="TramDagModel-1692"><a href="#TramDagModel-1692"><span class="linenos">1692</span></a>                <span class="n">true_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">true_vals</span> <span class="o">==</span> <span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">unique_vals</span><span class="p">])</span>
</span><span id="TramDagModel-1693"><a href="#TramDagModel-1693"><span class="linenos">1693</span></a>                <span class="n">sampled_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">sampled_vals</span> <span class="o">==</span> <span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">unique_vals</span><span class="p">])</span>
</span><span id="TramDagModel-1694"><a href="#TramDagModel-1694"><span class="linenos">1694</span></a>
</span><span id="TramDagModel-1695"><a href="#TramDagModel-1695"><span class="linenos">1695</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">true_counts</span> <span class="o">/</span> <span class="n">true_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
</span><span id="TramDagModel-1696"><a href="#TramDagModel-1696"><span class="linenos">1696</span></a>                        <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">hist_true_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1697"><a href="#TramDagModel-1697"><span class="linenos">1697</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">sampled_counts</span> <span class="o">/</span> <span class="n">sampled_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
</span><span id="TramDagModel-1698"><a href="#TramDagModel-1698"><span class="linenos">1698</span></a>                        <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">hist_est_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sampled&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1699"><a href="#TramDagModel-1699"><span class="linenos">1699</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">)))</span>
</span><span id="TramDagModel-1700"><a href="#TramDagModel-1700"><span class="linenos">1700</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
</span><span id="TramDagModel-1701"><a href="#TramDagModel-1701"><span class="linenos">1701</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Category&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1702"><a href="#TramDagModel-1702"><span class="linenos">1702</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Relative Frequency&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1703"><a href="#TramDagModel-1703"><span class="linenos">1703</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Categorical bar plot for </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1704"><a href="#TramDagModel-1704"><span class="linenos">1704</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="TramDagModel-1705"><a href="#TramDagModel-1705"><span class="linenos">1705</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="TramDagModel-1706"><a href="#TramDagModel-1706"><span class="linenos">1706</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1707"><a href="#TramDagModel-1707"><span class="linenos">1707</span></a>
</span><span id="TramDagModel-1708"><a href="#TramDagModel-1708"><span class="linenos">1708</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="TramDagModel-1709"><a href="#TramDagModel-1709"><span class="linenos">1709</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="TramDagModel-1710"><a href="#TramDagModel-1710"><span class="linenos">1710</span></a>
</span><span id="TramDagModel-1711"><a href="#TramDagModel-1711"><span class="linenos">1711</span></a>    <span class="c1">## SUMMARY METHODS</span>
</span><span id="TramDagModel-1712"><a href="#TramDagModel-1712"><span class="linenos">1712</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagModel-1713"><a href="#TramDagModel-1713"><span class="linenos">1713</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-1714"><a href="#TramDagModel-1714"><span class="linenos">1714</span></a><span class="sd">        Compute the Negative Log-Likelihood (NLL) for all or selected TRAM nodes.</span>
</span><span id="TramDagModel-1715"><a href="#TramDagModel-1715"><span class="linenos">1715</span></a>
</span><span id="TramDagModel-1716"><a href="#TramDagModel-1716"><span class="linenos">1716</span></a><span class="sd">        This function evaluates trained TRAM models for each specified variable (node) </span>
</span><span id="TramDagModel-1717"><a href="#TramDagModel-1717"><span class="linenos">1717</span></a><span class="sd">        on the provided dataset. It performs forward passes onlyno training, no weight </span>
</span><span id="TramDagModel-1718"><a href="#TramDagModel-1718"><span class="linenos">1718</span></a><span class="sd">        updatesand returns the mean NLL per node.</span>
</span><span id="TramDagModel-1719"><a href="#TramDagModel-1719"><span class="linenos">1719</span></a>
</span><span id="TramDagModel-1720"><a href="#TramDagModel-1720"><span class="linenos">1720</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-1721"><a href="#TramDagModel-1721"><span class="linenos">1721</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-1722"><a href="#TramDagModel-1722"><span class="linenos">1722</span></a><span class="sd">        data : object</span>
</span><span id="TramDagModel-1723"><a href="#TramDagModel-1723"><span class="linenos">1723</span></a><span class="sd">            Input dataset or data source compatible with `_ensure_dataset`, containing </span>
</span><span id="TramDagModel-1724"><a href="#TramDagModel-1724"><span class="linenos">1724</span></a><span class="sd">            both inputs and targets for each node.</span>
</span><span id="TramDagModel-1725"><a href="#TramDagModel-1725"><span class="linenos">1725</span></a><span class="sd">        variables : list[str], optional</span>
</span><span id="TramDagModel-1726"><a href="#TramDagModel-1726"><span class="linenos">1726</span></a><span class="sd">            List of variable (node) names to evaluate. If None, all nodes in </span>
</span><span id="TramDagModel-1727"><a href="#TramDagModel-1727"><span class="linenos">1727</span></a><span class="sd">            `self.models` are evaluated.</span>
</span><span id="TramDagModel-1728"><a href="#TramDagModel-1728"><span class="linenos">1728</span></a>
</span><span id="TramDagModel-1729"><a href="#TramDagModel-1729"><span class="linenos">1729</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-1730"><a href="#TramDagModel-1730"><span class="linenos">1730</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-1731"><a href="#TramDagModel-1731"><span class="linenos">1731</span></a><span class="sd">        dict[str, float]</span>
</span><span id="TramDagModel-1732"><a href="#TramDagModel-1732"><span class="linenos">1732</span></a><span class="sd">            Dictionary mapping each node name to its average NLL value.</span>
</span><span id="TramDagModel-1733"><a href="#TramDagModel-1733"><span class="linenos">1733</span></a>
</span><span id="TramDagModel-1734"><a href="#TramDagModel-1734"><span class="linenos">1734</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-1735"><a href="#TramDagModel-1735"><span class="linenos">1735</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-1736"><a href="#TramDagModel-1736"><span class="linenos">1736</span></a><span class="sd">        - Each model is evaluated independently on its respective DataLoader.</span>
</span><span id="TramDagModel-1737"><a href="#TramDagModel-1737"><span class="linenos">1737</span></a><span class="sd">        - The normalization values (`min_max`) for each node are retrieved from </span>
</span><span id="TramDagModel-1738"><a href="#TramDagModel-1738"><span class="linenos">1738</span></a><span class="sd">          `self.minmax_dict[node]`.</span>
</span><span id="TramDagModel-1739"><a href="#TramDagModel-1739"><span class="linenos">1739</span></a><span class="sd">        - The function uses `evaluate_tramdag_model()` for per-node evaluation.</span>
</span><span id="TramDagModel-1740"><a href="#TramDagModel-1740"><span class="linenos">1740</span></a><span class="sd">        - Expected directory structure:</span>
</span><span id="TramDagModel-1741"><a href="#TramDagModel-1741"><span class="linenos">1741</span></a><span class="sd">              `&lt;EXPERIMENT_DIR&gt;/&lt;node&gt;/`</span>
</span><span id="TramDagModel-1742"><a href="#TramDagModel-1742"><span class="linenos">1742</span></a><span class="sd">          where each node directory contains the trained model.</span>
</span><span id="TramDagModel-1743"><a href="#TramDagModel-1743"><span class="linenos">1743</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-1744"><a href="#TramDagModel-1744"><span class="linenos">1744</span></a>
</span><span id="TramDagModel-1745"><a href="#TramDagModel-1745"><span class="linenos">1745</span></a>        <span class="n">td_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_dataset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">is_val</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
</span><span id="TramDagModel-1746"><a href="#TramDagModel-1746"><span class="linenos">1746</span></a>        <span class="n">variables_list</span> <span class="o">=</span> <span class="n">variables</span> <span class="k">if</span> <span class="n">variables</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel-1747"><a href="#TramDagModel-1747"><span class="linenos">1747</span></a>        <span class="n">nll_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel-1748"><a href="#TramDagModel-1748"><span class="linenos">1748</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">variables_list</span><span class="p">:</span>  
</span><span id="TramDagModel-1749"><a href="#TramDagModel-1749"><span class="linenos">1749</span></a>                <span class="n">min_vals</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="TramDagModel-1750"><a href="#TramDagModel-1750"><span class="linenos">1750</span></a>                <span class="n">max_vals</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="TramDagModel-1751"><a href="#TramDagModel-1751"><span class="linenos">1751</span></a>                <span class="n">min_max</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">min_vals</span><span class="p">,</span> <span class="n">max_vals</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="TramDagModel-1752"><a href="#TramDagModel-1752"><span class="linenos">1752</span></a>                <span class="n">data_loader</span> <span class="o">=</span> <span class="n">td_data</span><span class="o">.</span><span class="n">loaders</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel-1753"><a href="#TramDagModel-1753"><span class="linenos">1753</span></a>                <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel-1754"><a href="#TramDagModel-1754"><span class="linenos">1754</span></a>                <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-1755"><a href="#TramDagModel-1755"><span class="linenos">1755</span></a>                <span class="n">NODE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1756"><a href="#TramDagModel-1756"><span class="linenos">1756</span></a>                <span class="n">nll</span><span class="o">=</span> <span class="n">evaluate_tramdag_model</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
</span><span id="TramDagModel-1757"><a href="#TramDagModel-1757"><span class="linenos">1757</span></a>                                            <span class="n">target_nodes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">,</span>
</span><span id="TramDagModel-1758"><a href="#TramDagModel-1758"><span class="linenos">1758</span></a>                                            <span class="n">NODE_DIR</span><span class="o">=</span><span class="n">NODE_DIR</span><span class="p">,</span>
</span><span id="TramDagModel-1759"><a href="#TramDagModel-1759"><span class="linenos">1759</span></a>                                            <span class="n">tram_model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
</span><span id="TramDagModel-1760"><a href="#TramDagModel-1760"><span class="linenos">1760</span></a>                                            <span class="n">data_loader</span><span class="o">=</span><span class="n">data_loader</span><span class="p">,</span>
</span><span id="TramDagModel-1761"><a href="#TramDagModel-1761"><span class="linenos">1761</span></a>                                            <span class="n">min_max</span><span class="o">=</span><span class="n">min_max</span><span class="p">)</span>
</span><span id="TramDagModel-1762"><a href="#TramDagModel-1762"><span class="linenos">1762</span></a>                <span class="n">nll_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">nll</span>
</span><span id="TramDagModel-1763"><a href="#TramDagModel-1763"><span class="linenos">1763</span></a>        <span class="k">return</span> <span class="n">nll_dict</span>
</span><span id="TramDagModel-1764"><a href="#TramDagModel-1764"><span class="linenos">1764</span></a>    
</span><span id="TramDagModel-1765"><a href="#TramDagModel-1765"><span class="linenos">1765</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_train_val_nll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="TramDagModel-1766"><a href="#TramDagModel-1766"><span class="linenos">1766</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-1767"><a href="#TramDagModel-1767"><span class="linenos">1767</span></a><span class="sd">        Retrieve training and validation NLL for a node and a given model state.</span>
</span><span id="TramDagModel-1768"><a href="#TramDagModel-1768"><span class="linenos">1768</span></a>
</span><span id="TramDagModel-1769"><a href="#TramDagModel-1769"><span class="linenos">1769</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-1770"><a href="#TramDagModel-1770"><span class="linenos">1770</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-1771"><a href="#TramDagModel-1771"><span class="linenos">1771</span></a><span class="sd">        node : str</span>
</span><span id="TramDagModel-1772"><a href="#TramDagModel-1772"><span class="linenos">1772</span></a><span class="sd">            Node name.</span>
</span><span id="TramDagModel-1773"><a href="#TramDagModel-1773"><span class="linenos">1773</span></a><span class="sd">        mode : {&quot;best&quot;, &quot;last&quot;, &quot;init&quot;}</span>
</span><span id="TramDagModel-1774"><a href="#TramDagModel-1774"><span class="linenos">1774</span></a><span class="sd">            State of interest:</span>
</span><span id="TramDagModel-1775"><a href="#TramDagModel-1775"><span class="linenos">1775</span></a><span class="sd">            - &quot;best&quot;: epoch with lowest validation NLL.</span>
</span><span id="TramDagModel-1776"><a href="#TramDagModel-1776"><span class="linenos">1776</span></a><span class="sd">            - &quot;last&quot;: final epoch.</span>
</span><span id="TramDagModel-1777"><a href="#TramDagModel-1777"><span class="linenos">1777</span></a><span class="sd">            - &quot;init&quot;: first epoch (index 0).</span>
</span><span id="TramDagModel-1778"><a href="#TramDagModel-1778"><span class="linenos">1778</span></a>
</span><span id="TramDagModel-1779"><a href="#TramDagModel-1779"><span class="linenos">1779</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-1780"><a href="#TramDagModel-1780"><span class="linenos">1780</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-1781"><a href="#TramDagModel-1781"><span class="linenos">1781</span></a><span class="sd">        tuple of (float or None, float or None)</span>
</span><span id="TramDagModel-1782"><a href="#TramDagModel-1782"><span class="linenos">1782</span></a><span class="sd">            A tuple ``(train_nll, val_nll)`` for the requested mode.</span>
</span><span id="TramDagModel-1783"><a href="#TramDagModel-1783"><span class="linenos">1783</span></a><span class="sd">            Returns ``(None, None)`` if loss files are missing or cannot be read.</span>
</span><span id="TramDagModel-1784"><a href="#TramDagModel-1784"><span class="linenos">1784</span></a>
</span><span id="TramDagModel-1785"><a href="#TramDagModel-1785"><span class="linenos">1785</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-1786"><a href="#TramDagModel-1786"><span class="linenos">1786</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-1787"><a href="#TramDagModel-1787"><span class="linenos">1787</span></a><span class="sd">        This method expects per-node JSON files:</span>
</span><span id="TramDagModel-1788"><a href="#TramDagModel-1788"><span class="linenos">1788</span></a>
</span><span id="TramDagModel-1789"><a href="#TramDagModel-1789"><span class="linenos">1789</span></a><span class="sd">        - ``train_loss_hist.json``</span>
</span><span id="TramDagModel-1790"><a href="#TramDagModel-1790"><span class="linenos">1790</span></a><span class="sd">        - ``val_loss_hist.json``</span>
</span><span id="TramDagModel-1791"><a href="#TramDagModel-1791"><span class="linenos">1791</span></a>
</span><span id="TramDagModel-1792"><a href="#TramDagModel-1792"><span class="linenos">1792</span></a><span class="sd">        in the node directory.</span>
</span><span id="TramDagModel-1793"><a href="#TramDagModel-1793"><span class="linenos">1793</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-1794"><a href="#TramDagModel-1794"><span class="linenos">1794</span></a>        <span class="n">NODE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">],</span> <span class="n">node</span><span class="p">)</span>
</span><span id="TramDagModel-1795"><a href="#TramDagModel-1795"><span class="linenos">1795</span></a>        <span class="n">train_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">,</span> <span class="s2">&quot;train_loss_hist.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1796"><a href="#TramDagModel-1796"><span class="linenos">1796</span></a>        <span class="n">val_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">,</span> <span class="s2">&quot;val_loss_hist.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1797"><a href="#TramDagModel-1797"><span class="linenos">1797</span></a>
</span><span id="TramDagModel-1798"><a href="#TramDagModel-1798"><span class="linenos">1798</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">train_path</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">val_path</span><span class="p">):</span>
</span><span id="TramDagModel-1799"><a href="#TramDagModel-1799"><span class="linenos">1799</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel-1800"><a href="#TramDagModel-1800"><span class="linenos">1800</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Missing loss files for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;. Returning None.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1801"><a href="#TramDagModel-1801"><span class="linenos">1801</span></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="TramDagModel-1802"><a href="#TramDagModel-1802"><span class="linenos">1802</span></a>
</span><span id="TramDagModel-1803"><a href="#TramDagModel-1803"><span class="linenos">1803</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-1804"><a href="#TramDagModel-1804"><span class="linenos">1804</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">train_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel-1805"><a href="#TramDagModel-1805"><span class="linenos">1805</span></a>                <span class="n">train_hist</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TramDagModel-1806"><a href="#TramDagModel-1806"><span class="linenos">1806</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">val_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel-1807"><a href="#TramDagModel-1807"><span class="linenos">1807</span></a>                <span class="n">val_hist</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TramDagModel-1808"><a href="#TramDagModel-1808"><span class="linenos">1808</span></a>
</span><span id="TramDagModel-1809"><a href="#TramDagModel-1809"><span class="linenos">1809</span></a>            <span class="n">train_nlls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_hist</span><span class="p">)</span>
</span><span id="TramDagModel-1810"><a href="#TramDagModel-1810"><span class="linenos">1810</span></a>            <span class="n">val_nlls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val_hist</span><span class="p">)</span>
</span><span id="TramDagModel-1811"><a href="#TramDagModel-1811"><span class="linenos">1811</span></a>
</span><span id="TramDagModel-1812"><a href="#TramDagModel-1812"><span class="linenos">1812</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;init&quot;</span><span class="p">:</span>
</span><span id="TramDagModel-1813"><a href="#TramDagModel-1813"><span class="linenos">1813</span></a>                <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TramDagModel-1814"><a href="#TramDagModel-1814"><span class="linenos">1814</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span>
</span><span id="TramDagModel-1815"><a href="#TramDagModel-1815"><span class="linenos">1815</span></a>                <span class="n">idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_nlls</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="TramDagModel-1816"><a href="#TramDagModel-1816"><span class="linenos">1816</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;best&quot;</span><span class="p">:</span>
</span><span id="TramDagModel-1817"><a href="#TramDagModel-1817"><span class="linenos">1817</span></a>                <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">val_nlls</span><span class="p">))</span>
</span><span id="TramDagModel-1818"><a href="#TramDagModel-1818"><span class="linenos">1818</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-1819"><a href="#TramDagModel-1819"><span class="linenos">1819</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid mode &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39;  must be one of &#39;best&#39;, &#39;last&#39;, &#39;init&#39;.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1820"><a href="#TramDagModel-1820"><span class="linenos">1820</span></a>
</span><span id="TramDagModel-1821"><a href="#TramDagModel-1821"><span class="linenos">1821</span></a>            <span class="n">train_nll</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">train_nlls</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span><span id="TramDagModel-1822"><a href="#TramDagModel-1822"><span class="linenos">1822</span></a>            <span class="n">val_nll</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val_nlls</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span><span id="TramDagModel-1823"><a href="#TramDagModel-1823"><span class="linenos">1823</span></a>            <span class="k">return</span> <span class="n">train_nll</span><span class="p">,</span> <span class="n">val_nll</span>
</span><span id="TramDagModel-1824"><a href="#TramDagModel-1824"><span class="linenos">1824</span></a>
</span><span id="TramDagModel-1825"><a href="#TramDagModel-1825"><span class="linenos">1825</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel-1826"><a href="#TramDagModel-1826"><span class="linenos">1826</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] Failed to load NLLs for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1827"><a href="#TramDagModel-1827"><span class="linenos">1827</span></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="TramDagModel-1828"><a href="#TramDagModel-1828"><span class="linenos">1828</span></a>
</span><span id="TramDagModel-1829"><a href="#TramDagModel-1829"><span class="linenos">1829</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_thetas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;best&quot;</span><span class="p">):</span>
</span><span id="TramDagModel-1830"><a href="#TramDagModel-1830"><span class="linenos">1830</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-1831"><a href="#TramDagModel-1831"><span class="linenos">1831</span></a><span class="sd">        Return transformed intercept (theta) parameters for a node and state.</span>
</span><span id="TramDagModel-1832"><a href="#TramDagModel-1832"><span class="linenos">1832</span></a>
</span><span id="TramDagModel-1833"><a href="#TramDagModel-1833"><span class="linenos">1833</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-1834"><a href="#TramDagModel-1834"><span class="linenos">1834</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-1835"><a href="#TramDagModel-1835"><span class="linenos">1835</span></a><span class="sd">        node : str</span>
</span><span id="TramDagModel-1836"><a href="#TramDagModel-1836"><span class="linenos">1836</span></a><span class="sd">            Node name.</span>
</span><span id="TramDagModel-1837"><a href="#TramDagModel-1837"><span class="linenos">1837</span></a><span class="sd">        state : {&quot;best&quot;, &quot;last&quot;, &quot;init&quot;}, optional</span>
</span><span id="TramDagModel-1838"><a href="#TramDagModel-1838"><span class="linenos">1838</span></a><span class="sd">            Model state for which to return parameters. Default is &quot;best&quot;.</span>
</span><span id="TramDagModel-1839"><a href="#TramDagModel-1839"><span class="linenos">1839</span></a>
</span><span id="TramDagModel-1840"><a href="#TramDagModel-1840"><span class="linenos">1840</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-1841"><a href="#TramDagModel-1841"><span class="linenos">1841</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-1842"><a href="#TramDagModel-1842"><span class="linenos">1842</span></a><span class="sd">        Any or None</span>
</span><span id="TramDagModel-1843"><a href="#TramDagModel-1843"><span class="linenos">1843</span></a><span class="sd">            Transformed theta parameters for the requested node and state.</span>
</span><span id="TramDagModel-1844"><a href="#TramDagModel-1844"><span class="linenos">1844</span></a><span class="sd">            The exact structure (scalar, list, or other) depends on the model.</span>
</span><span id="TramDagModel-1845"><a href="#TramDagModel-1845"><span class="linenos">1845</span></a>
</span><span id="TramDagModel-1846"><a href="#TramDagModel-1846"><span class="linenos">1846</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel-1847"><a href="#TramDagModel-1847"><span class="linenos">1847</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel-1848"><a href="#TramDagModel-1848"><span class="linenos">1848</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel-1849"><a href="#TramDagModel-1849"><span class="linenos">1849</span></a><span class="sd">            If an invalid state is given (not in {&quot;best&quot;, &quot;last&quot;, &quot;init&quot;}).</span>
</span><span id="TramDagModel-1850"><a href="#TramDagModel-1850"><span class="linenos">1850</span></a>
</span><span id="TramDagModel-1851"><a href="#TramDagModel-1851"><span class="linenos">1851</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-1852"><a href="#TramDagModel-1852"><span class="linenos">1852</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-1853"><a href="#TramDagModel-1853"><span class="linenos">1853</span></a><span class="sd">        Intercept dictionaries are cached on the instance under the attribute</span>
</span><span id="TramDagModel-1854"><a href="#TramDagModel-1854"><span class="linenos">1854</span></a><span class="sd">        ``intercept_dicts``. If missing or incomplete, they are recomputed using</span>
</span><span id="TramDagModel-1855"><a href="#TramDagModel-1855"><span class="linenos">1855</span></a><span class="sd">        `get_simple_intercepts_dict`.</span>
</span><span id="TramDagModel-1856"><a href="#TramDagModel-1856"><span class="linenos">1856</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-1857"><a href="#TramDagModel-1857"><span class="linenos">1857</span></a>
</span><span id="TramDagModel-1858"><a href="#TramDagModel-1858"><span class="linenos">1858</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="TramDagModel-1859"><a href="#TramDagModel-1859"><span class="linenos">1859</span></a>        <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;init&quot;</span><span class="p">]:</span>
</span><span id="TramDagModel-1860"><a href="#TramDagModel-1860"><span class="linenos">1860</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] Invalid state &#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&#39;. Must be one of [&#39;best&#39;, &#39;last&#39;, &#39;init&#39;].&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1861"><a href="#TramDagModel-1861"><span class="linenos">1861</span></a>
</span><span id="TramDagModel-1862"><a href="#TramDagModel-1862"><span class="linenos">1862</span></a>        <span class="n">dict_attr</span> <span class="o">=</span> <span class="s2">&quot;intercept_dicts&quot;</span>
</span><span id="TramDagModel-1863"><a href="#TramDagModel-1863"><span class="linenos">1863</span></a>
</span><span id="TramDagModel-1864"><a href="#TramDagModel-1864"><span class="linenos">1864</span></a>        <span class="c1"># If no cached intercepts exist, compute them</span>
</span><span id="TramDagModel-1865"><a href="#TramDagModel-1865"><span class="linenos">1865</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">):</span>
</span><span id="TramDagModel-1866"><a href="#TramDagModel-1866"><span class="linenos">1866</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel-1867"><a href="#TramDagModel-1867"><span class="linenos">1867</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] &#39;</span><span class="si">{</span><span class="n">dict_attr</span><span class="si">}</span><span class="s2">&#39; not found, computing via get_simple_intercepts_dict().&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1868"><a href="#TramDagModel-1868"><span class="linenos">1868</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_simple_intercepts_dict</span><span class="p">())</span>
</span><span id="TramDagModel-1869"><a href="#TramDagModel-1869"><span class="linenos">1869</span></a>
</span><span id="TramDagModel-1870"><a href="#TramDagModel-1870"><span class="linenos">1870</span></a>        <span class="n">all_dicts</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">)</span>
</span><span id="TramDagModel-1871"><a href="#TramDagModel-1871"><span class="linenos">1871</span></a>
</span><span id="TramDagModel-1872"><a href="#TramDagModel-1872"><span class="linenos">1872</span></a>        <span class="c1"># If the requested state isnt cached, recompute</span>
</span><span id="TramDagModel-1873"><a href="#TramDagModel-1873"><span class="linenos">1873</span></a>        <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_dicts</span><span class="p">:</span>
</span><span id="TramDagModel-1874"><a href="#TramDagModel-1874"><span class="linenos">1874</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel-1875"><a href="#TramDagModel-1875"><span class="linenos">1875</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] State &#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&#39; not found in cached intercepts, recomputing full dict.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1876"><a href="#TramDagModel-1876"><span class="linenos">1876</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_simple_intercepts_dict</span><span class="p">())</span>
</span><span id="TramDagModel-1877"><a href="#TramDagModel-1877"><span class="linenos">1877</span></a>            <span class="n">all_dicts</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">)</span>
</span><span id="TramDagModel-1878"><a href="#TramDagModel-1878"><span class="linenos">1878</span></a>
</span><span id="TramDagModel-1879"><a href="#TramDagModel-1879"><span class="linenos">1879</span></a>        <span class="n">state_dict</span> <span class="o">=</span> <span class="n">all_dicts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="TramDagModel-1880"><a href="#TramDagModel-1880"><span class="linenos">1880</span></a>
</span><span id="TramDagModel-1881"><a href="#TramDagModel-1881"><span class="linenos">1881</span></a>        <span class="c1"># Return cached node intercept if present</span>
</span><span id="TramDagModel-1882"><a href="#TramDagModel-1882"><span class="linenos">1882</span></a>        <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="p">:</span>
</span><span id="TramDagModel-1883"><a href="#TramDagModel-1883"><span class="linenos">1883</span></a>            <span class="k">return</span> <span class="n">state_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel-1884"><a href="#TramDagModel-1884"><span class="linenos">1884</span></a>
</span><span id="TramDagModel-1885"><a href="#TramDagModel-1885"><span class="linenos">1885</span></a>        <span class="c1"># If not found, recompute full dict as fallback</span>
</span><span id="TramDagModel-1886"><a href="#TramDagModel-1886"><span class="linenos">1886</span></a>        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel-1887"><a href="#TramDagModel-1887"><span class="linenos">1887</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; not found in state &#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&#39;, recomputing full dict.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1888"><a href="#TramDagModel-1888"><span class="linenos">1888</span></a>        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_simple_intercepts_dict</span><span class="p">())</span>
</span><span id="TramDagModel-1889"><a href="#TramDagModel-1889"><span class="linenos">1889</span></a>        <span class="n">all_dicts</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">)</span>
</span><span id="TramDagModel-1890"><a href="#TramDagModel-1890"><span class="linenos">1890</span></a>        <span class="k">return</span> <span class="n">all_dicts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="TramDagModel-1891"><a href="#TramDagModel-1891"><span class="linenos">1891</span></a>        
</span><span id="TramDagModel-1892"><a href="#TramDagModel-1892"><span class="linenos">1892</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_linear_shifts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;best&quot;</span><span class="p">):</span>
</span><span id="TramDagModel-1893"><a href="#TramDagModel-1893"><span class="linenos">1893</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-1894"><a href="#TramDagModel-1894"><span class="linenos">1894</span></a><span class="sd">        Return learned linear shift terms for a node and a given state.</span>
</span><span id="TramDagModel-1895"><a href="#TramDagModel-1895"><span class="linenos">1895</span></a>
</span><span id="TramDagModel-1896"><a href="#TramDagModel-1896"><span class="linenos">1896</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-1897"><a href="#TramDagModel-1897"><span class="linenos">1897</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-1898"><a href="#TramDagModel-1898"><span class="linenos">1898</span></a><span class="sd">        node : str</span>
</span><span id="TramDagModel-1899"><a href="#TramDagModel-1899"><span class="linenos">1899</span></a><span class="sd">            Node name.</span>
</span><span id="TramDagModel-1900"><a href="#TramDagModel-1900"><span class="linenos">1900</span></a><span class="sd">        state : {&quot;best&quot;, &quot;last&quot;, &quot;init&quot;}, optional</span>
</span><span id="TramDagModel-1901"><a href="#TramDagModel-1901"><span class="linenos">1901</span></a><span class="sd">            Model state for which to return linear shift terms. Default is &quot;best&quot;.</span>
</span><span id="TramDagModel-1902"><a href="#TramDagModel-1902"><span class="linenos">1902</span></a>
</span><span id="TramDagModel-1903"><a href="#TramDagModel-1903"><span class="linenos">1903</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-1904"><a href="#TramDagModel-1904"><span class="linenos">1904</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-1905"><a href="#TramDagModel-1905"><span class="linenos">1905</span></a><span class="sd">        dict or Any or None</span>
</span><span id="TramDagModel-1906"><a href="#TramDagModel-1906"><span class="linenos">1906</span></a><span class="sd">            Linear shift terms for the given node and state. Usually a dict</span>
</span><span id="TramDagModel-1907"><a href="#TramDagModel-1907"><span class="linenos">1907</span></a><span class="sd">            mapping term names to weights.</span>
</span><span id="TramDagModel-1908"><a href="#TramDagModel-1908"><span class="linenos">1908</span></a>
</span><span id="TramDagModel-1909"><a href="#TramDagModel-1909"><span class="linenos">1909</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel-1910"><a href="#TramDagModel-1910"><span class="linenos">1910</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel-1911"><a href="#TramDagModel-1911"><span class="linenos">1911</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel-1912"><a href="#TramDagModel-1912"><span class="linenos">1912</span></a><span class="sd">            If an invalid state is given (not in {&quot;best&quot;, &quot;last&quot;, &quot;init&quot;}).</span>
</span><span id="TramDagModel-1913"><a href="#TramDagModel-1913"><span class="linenos">1913</span></a>
</span><span id="TramDagModel-1914"><a href="#TramDagModel-1914"><span class="linenos">1914</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-1915"><a href="#TramDagModel-1915"><span class="linenos">1915</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-1916"><a href="#TramDagModel-1916"><span class="linenos">1916</span></a><span class="sd">        Linear shift dictionaries are cached on the instance under the attribute</span>
</span><span id="TramDagModel-1917"><a href="#TramDagModel-1917"><span class="linenos">1917</span></a><span class="sd">        ``linear_shift_dicts``. If missing or incomplete, they are recomputed using</span>
</span><span id="TramDagModel-1918"><a href="#TramDagModel-1918"><span class="linenos">1918</span></a><span class="sd">        `get_linear_shifts_dict`.</span>
</span><span id="TramDagModel-1919"><a href="#TramDagModel-1919"><span class="linenos">1919</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-1920"><a href="#TramDagModel-1920"><span class="linenos">1920</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="TramDagModel-1921"><a href="#TramDagModel-1921"><span class="linenos">1921</span></a>        <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;init&quot;</span><span class="p">]:</span>
</span><span id="TramDagModel-1922"><a href="#TramDagModel-1922"><span class="linenos">1922</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] Invalid state &#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&#39;. Must be one of [&#39;best&#39;, &#39;last&#39;, &#39;init&#39;].&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1923"><a href="#TramDagModel-1923"><span class="linenos">1923</span></a>
</span><span id="TramDagModel-1924"><a href="#TramDagModel-1924"><span class="linenos">1924</span></a>        <span class="n">dict_attr</span> <span class="o">=</span> <span class="s2">&quot;linear_shift_dicts&quot;</span>
</span><span id="TramDagModel-1925"><a href="#TramDagModel-1925"><span class="linenos">1925</span></a>
</span><span id="TramDagModel-1926"><a href="#TramDagModel-1926"><span class="linenos">1926</span></a>        <span class="c1"># If no global dicts cached, compute once</span>
</span><span id="TramDagModel-1927"><a href="#TramDagModel-1927"><span class="linenos">1927</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">):</span>
</span><span id="TramDagModel-1928"><a href="#TramDagModel-1928"><span class="linenos">1928</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel-1929"><a href="#TramDagModel-1929"><span class="linenos">1929</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] &#39;</span><span class="si">{</span><span class="n">dict_attr</span><span class="si">}</span><span class="s2">&#39; not found, computing via get_linear_shifts_dict().&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1930"><a href="#TramDagModel-1930"><span class="linenos">1930</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_linear_shifts_dict</span><span class="p">())</span>
</span><span id="TramDagModel-1931"><a href="#TramDagModel-1931"><span class="linenos">1931</span></a>
</span><span id="TramDagModel-1932"><a href="#TramDagModel-1932"><span class="linenos">1932</span></a>        <span class="n">all_dicts</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">)</span>
</span><span id="TramDagModel-1933"><a href="#TramDagModel-1933"><span class="linenos">1933</span></a>
</span><span id="TramDagModel-1934"><a href="#TramDagModel-1934"><span class="linenos">1934</span></a>        <span class="c1"># If the requested state isn&#39;t cached, compute all again (covers fresh runs)</span>
</span><span id="TramDagModel-1935"><a href="#TramDagModel-1935"><span class="linenos">1935</span></a>        <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_dicts</span><span class="p">:</span>
</span><span id="TramDagModel-1936"><a href="#TramDagModel-1936"><span class="linenos">1936</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel-1937"><a href="#TramDagModel-1937"><span class="linenos">1937</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] State &#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&#39; not found in cached linear shifts, recomputing full dict.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1938"><a href="#TramDagModel-1938"><span class="linenos">1938</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_linear_shifts_dict</span><span class="p">())</span>
</span><span id="TramDagModel-1939"><a href="#TramDagModel-1939"><span class="linenos">1939</span></a>            <span class="n">all_dicts</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">)</span>
</span><span id="TramDagModel-1940"><a href="#TramDagModel-1940"><span class="linenos">1940</span></a>
</span><span id="TramDagModel-1941"><a href="#TramDagModel-1941"><span class="linenos">1941</span></a>        <span class="c1"># Now fetch the dictionary for this state</span>
</span><span id="TramDagModel-1942"><a href="#TramDagModel-1942"><span class="linenos">1942</span></a>        <span class="n">state_dict</span> <span class="o">=</span> <span class="n">all_dicts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="TramDagModel-1943"><a href="#TramDagModel-1943"><span class="linenos">1943</span></a>
</span><span id="TramDagModel-1944"><a href="#TramDagModel-1944"><span class="linenos">1944</span></a>        <span class="c1"># If the node is available, return its entry</span>
</span><span id="TramDagModel-1945"><a href="#TramDagModel-1945"><span class="linenos">1945</span></a>        <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="p">:</span>
</span><span id="TramDagModel-1946"><a href="#TramDagModel-1946"><span class="linenos">1946</span></a>            <span class="k">return</span> <span class="n">state_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel-1947"><a href="#TramDagModel-1947"><span class="linenos">1947</span></a>
</span><span id="TramDagModel-1948"><a href="#TramDagModel-1948"><span class="linenos">1948</span></a>        <span class="c1"># If missing, try recomputing (fallback)</span>
</span><span id="TramDagModel-1949"><a href="#TramDagModel-1949"><span class="linenos">1949</span></a>        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel-1950"><a href="#TramDagModel-1950"><span class="linenos">1950</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; not found in state &#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&#39;, recomputing full dict.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1951"><a href="#TramDagModel-1951"><span class="linenos">1951</span></a>        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_linear_shifts_dict</span><span class="p">())</span>
</span><span id="TramDagModel-1952"><a href="#TramDagModel-1952"><span class="linenos">1952</span></a>        <span class="n">all_dicts</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">)</span>
</span><span id="TramDagModel-1953"><a href="#TramDagModel-1953"><span class="linenos">1953</span></a>        <span class="k">return</span> <span class="n">all_dicts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="TramDagModel-1954"><a href="#TramDagModel-1954"><span class="linenos">1954</span></a>
</span><span id="TramDagModel-1955"><a href="#TramDagModel-1955"><span class="linenos">1955</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_linear_shifts_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagModel-1956"><a href="#TramDagModel-1956"><span class="linenos">1956</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-1957"><a href="#TramDagModel-1957"><span class="linenos">1957</span></a><span class="sd">        Compute linear shift term dictionaries for all nodes and states.</span>
</span><span id="TramDagModel-1958"><a href="#TramDagModel-1958"><span class="linenos">1958</span></a>
</span><span id="TramDagModel-1959"><a href="#TramDagModel-1959"><span class="linenos">1959</span></a><span class="sd">        For each node and each available state (&quot;best&quot;, &quot;last&quot;, &quot;init&quot;), this</span>
</span><span id="TramDagModel-1960"><a href="#TramDagModel-1960"><span class="linenos">1960</span></a><span class="sd">        method loads the corresponding model checkpoint, extracts linear shift</span>
</span><span id="TramDagModel-1961"><a href="#TramDagModel-1961"><span class="linenos">1961</span></a><span class="sd">        weights from the TRAM model, and stores them in a nested dictionary.</span>
</span><span id="TramDagModel-1962"><a href="#TramDagModel-1962"><span class="linenos">1962</span></a>
</span><span id="TramDagModel-1963"><a href="#TramDagModel-1963"><span class="linenos">1963</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-1964"><a href="#TramDagModel-1964"><span class="linenos">1964</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-1965"><a href="#TramDagModel-1965"><span class="linenos">1965</span></a><span class="sd">        dict</span>
</span><span id="TramDagModel-1966"><a href="#TramDagModel-1966"><span class="linenos">1966</span></a><span class="sd">            Nested dictionary of the form:</span>
</span><span id="TramDagModel-1967"><a href="#TramDagModel-1967"><span class="linenos">1967</span></a>
</span><span id="TramDagModel-1968"><a href="#TramDagModel-1968"><span class="linenos">1968</span></a><span class="sd">            .. code-block:: python</span>
</span><span id="TramDagModel-1969"><a href="#TramDagModel-1969"><span class="linenos">1969</span></a>
</span><span id="TramDagModel-1970"><a href="#TramDagModel-1970"><span class="linenos">1970</span></a><span class="sd">                {</span>
</span><span id="TramDagModel-1971"><a href="#TramDagModel-1971"><span class="linenos">1971</span></a><span class="sd">                    &quot;best&quot;: {node: {...}},</span>
</span><span id="TramDagModel-1972"><a href="#TramDagModel-1972"><span class="linenos">1972</span></a><span class="sd">                    &quot;last&quot;: {node: {...}},</span>
</span><span id="TramDagModel-1973"><a href="#TramDagModel-1973"><span class="linenos">1973</span></a><span class="sd">                    &quot;init&quot;: {node: {...}},</span>
</span><span id="TramDagModel-1974"><a href="#TramDagModel-1974"><span class="linenos">1974</span></a><span class="sd">                }</span>
</span><span id="TramDagModel-1975"><a href="#TramDagModel-1975"><span class="linenos">1975</span></a>
</span><span id="TramDagModel-1976"><a href="#TramDagModel-1976"><span class="linenos">1976</span></a><span class="sd">            where the innermost dict maps term labels (e.g. ``&quot;ls(parent_name)&quot;``)</span>
</span><span id="TramDagModel-1977"><a href="#TramDagModel-1977"><span class="linenos">1977</span></a><span class="sd">            to their weights.</span>
</span><span id="TramDagModel-1978"><a href="#TramDagModel-1978"><span class="linenos">1978</span></a>
</span><span id="TramDagModel-1979"><a href="#TramDagModel-1979"><span class="linenos">1979</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-1980"><a href="#TramDagModel-1980"><span class="linenos">1980</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-1981"><a href="#TramDagModel-1981"><span class="linenos">1981</span></a><span class="sd">        - If &quot;best&quot; or &quot;last&quot; checkpoints are unavailable for a node, only</span>
</span><span id="TramDagModel-1982"><a href="#TramDagModel-1982"><span class="linenos">1982</span></a><span class="sd">        the &quot;init&quot; entry is populated.</span>
</span><span id="TramDagModel-1983"><a href="#TramDagModel-1983"><span class="linenos">1983</span></a><span class="sd">        - Empty outer states (without any nodes) are removed from the result.</span>
</span><span id="TramDagModel-1984"><a href="#TramDagModel-1984"><span class="linenos">1984</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-1985"><a href="#TramDagModel-1985"><span class="linenos">1985</span></a>
</span><span id="TramDagModel-1986"><a href="#TramDagModel-1986"><span class="linenos">1986</span></a>        <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-1987"><a href="#TramDagModel-1987"><span class="linenos">1987</span></a>        <span class="n">nodes_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel-1988"><a href="#TramDagModel-1988"><span class="linenos">1988</span></a>        <span class="n">all_states</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;init&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-1989"><a href="#TramDagModel-1989"><span class="linenos">1989</span></a>        <span class="n">all_linear_shift_dicts</span> <span class="o">=</span> <span class="p">{</span><span class="n">state</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">all_states</span><span class="p">}</span>
</span><span id="TramDagModel-1990"><a href="#TramDagModel-1990"><span class="linenos">1990</span></a>
</span><span id="TramDagModel-1991"><a href="#TramDagModel-1991"><span class="linenos">1991</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes_list</span><span class="p">:</span>
</span><span id="TramDagModel-1992"><a href="#TramDagModel-1992"><span class="linenos">1992</span></a>            <span class="n">NODE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
</span><span id="TramDagModel-1993"><a href="#TramDagModel-1993"><span class="linenos">1993</span></a>            <span class="n">BEST_MODEL_PATH</span><span class="p">,</span> <span class="n">LAST_MODEL_PATH</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model_train_val_paths</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">)</span>
</span><span id="TramDagModel-1994"><a href="#TramDagModel-1994"><span class="linenos">1994</span></a>            <span class="n">INIT_MODEL_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">,</span> <span class="s2">&quot;initial_model.pt&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-1995"><a href="#TramDagModel-1995"><span class="linenos">1995</span></a>
</span><span id="TramDagModel-1996"><a href="#TramDagModel-1996"><span class="linenos">1996</span></a>            <span class="n">state_paths</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TramDagModel-1997"><a href="#TramDagModel-1997"><span class="linenos">1997</span></a>                <span class="s2">&quot;best&quot;</span><span class="p">:</span> <span class="n">BEST_MODEL_PATH</span><span class="p">,</span>
</span><span id="TramDagModel-1998"><a href="#TramDagModel-1998"><span class="linenos">1998</span></a>                <span class="s2">&quot;last&quot;</span><span class="p">:</span> <span class="n">LAST_MODEL_PATH</span><span class="p">,</span>
</span><span id="TramDagModel-1999"><a href="#TramDagModel-1999"><span class="linenos">1999</span></a>                <span class="s2">&quot;init&quot;</span><span class="p">:</span> <span class="n">INIT_MODEL_PATH</span><span class="p">,</span>
</span><span id="TramDagModel-2000"><a href="#TramDagModel-2000"><span class="linenos">2000</span></a>            <span class="p">}</span>
</span><span id="TramDagModel-2001"><a href="#TramDagModel-2001"><span class="linenos">2001</span></a>
</span><span id="TramDagModel-2002"><a href="#TramDagModel-2002"><span class="linenos">2002</span></a>            <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">LOAD_PATH</span> <span class="ow">in</span> <span class="n">state_paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagModel-2003"><a href="#TramDagModel-2003"><span class="linenos">2003</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">LOAD_PATH</span><span class="p">):</span>
</span><span id="TramDagModel-2004"><a href="#TramDagModel-2004"><span class="linenos">2004</span></a>                    <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="s2">&quot;init&quot;</span><span class="p">:</span>
</span><span id="TramDagModel-2005"><a href="#TramDagModel-2005"><span class="linenos">2005</span></a>                        <span class="c1"># skip best/last if unavailable</span>
</span><span id="TramDagModel-2006"><a href="#TramDagModel-2006"><span class="linenos">2006</span></a>                        <span class="k">continue</span>
</span><span id="TramDagModel-2007"><a href="#TramDagModel-2007"><span class="linenos">2007</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-2008"><a href="#TramDagModel-2008"><span class="linenos">2008</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] No models found for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;. Only initial model will be used.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2009"><a href="#TramDagModel-2009"><span class="linenos">2009</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">LOAD_PATH</span><span class="p">):</span>
</span><span id="TramDagModel-2010"><a href="#TramDagModel-2010"><span class="linenos">2010</span></a>                            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel-2011"><a href="#TramDagModel-2011"><span class="linenos">2011</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Initial model also missing for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;. Skipping.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2012"><a href="#TramDagModel-2012"><span class="linenos">2012</span></a>                            <span class="k">continue</span>
</span><span id="TramDagModel-2013"><a href="#TramDagModel-2013"><span class="linenos">2013</span></a>
</span><span id="TramDagModel-2014"><a href="#TramDagModel-2014"><span class="linenos">2014</span></a>                <span class="c1"># Load parents and model</span>
</span><span id="TramDagModel-2015"><a href="#TramDagModel-2015"><span class="linenos">2015</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">terms_dict</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ordered_parents</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">)</span>
</span><span id="TramDagModel-2016"><a href="#TramDagModel-2016"><span class="linenos">2016</span></a>                <span class="n">state_dict</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">LOAD_PATH</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="TramDagModel-2017"><a href="#TramDagModel-2017"><span class="linenos">2017</span></a>                <span class="n">tram_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel-2018"><a href="#TramDagModel-2018"><span class="linenos">2018</span></a>                <span class="n">tram_model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">state_dict</span><span class="p">)</span>
</span><span id="TramDagModel-2019"><a href="#TramDagModel-2019"><span class="linenos">2019</span></a>
</span><span id="TramDagModel-2020"><a href="#TramDagModel-2020"><span class="linenos">2020</span></a>                <span class="n">epoch_weights</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel-2021"><a href="#TramDagModel-2021"><span class="linenos">2021</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tram_model</span><span class="p">,</span> <span class="s2">&quot;nn_shift&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tram_model</span><span class="o">.</span><span class="n">nn_shift</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel-2022"><a href="#TramDagModel-2022"><span class="linenos">2022</span></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">shift_layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tram_model</span><span class="o">.</span><span class="n">nn_shift</span><span class="p">):</span>
</span><span id="TramDagModel-2023"><a href="#TramDagModel-2023"><span class="linenos">2023</span></a>                        <span class="n">module_name</span> <span class="o">=</span> <span class="n">shift_layer</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="TramDagModel-2024"><a href="#TramDagModel-2024"><span class="linenos">2024</span></a>                        <span class="k">if</span> <span class="p">(</span>
</span><span id="TramDagModel-2025"><a href="#TramDagModel-2025"><span class="linenos">2025</span></a>                            <span class="nb">hasattr</span><span class="p">(</span><span class="n">shift_layer</span><span class="p">,</span> <span class="s2">&quot;fc&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2026"><a href="#TramDagModel-2026"><span class="linenos">2026</span></a>                            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">shift_layer</span><span class="o">.</span><span class="n">fc</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2027"><a href="#TramDagModel-2027"><span class="linenos">2027</span></a>                            <span class="ow">and</span> <span class="n">module_name</span> <span class="o">==</span> <span class="s2">&quot;LinearShift&quot;</span>
</span><span id="TramDagModel-2028"><a href="#TramDagModel-2028"><span class="linenos">2028</span></a>                        <span class="p">):</span>
</span><span id="TramDagModel-2029"><a href="#TramDagModel-2029"><span class="linenos">2029</span></a>                            <span class="n">term_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">terms_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span>
</span><span id="TramDagModel-2030"><a href="#TramDagModel-2030"><span class="linenos">2030</span></a>                            <span class="n">epoch_weights</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ls(</span><span class="si">{</span><span class="n">term_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="TramDagModel-2031"><a href="#TramDagModel-2031"><span class="linenos">2031</span></a>                                <span class="n">shift_layer</span><span class="o">.</span><span class="n">fc</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="TramDagModel-2032"><a href="#TramDagModel-2032"><span class="linenos">2032</span></a>                            <span class="p">)</span>
</span><span id="TramDagModel-2033"><a href="#TramDagModel-2033"><span class="linenos">2033</span></a>                        <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel-2034"><a href="#TramDagModel-2034"><span class="linenos">2034</span></a>                            <span class="n">term_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">terms_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span>
</span><span id="TramDagModel-2035"><a href="#TramDagModel-2035"><span class="linenos">2035</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] ls(</span><span class="si">{</span><span class="n">term_name</span><span class="si">}</span><span class="s2">): missing &#39;fc&#39; or &#39;weight&#39; in LinearShift.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2036"><a href="#TramDagModel-2036"><span class="linenos">2036</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-2037"><a href="#TramDagModel-2037"><span class="linenos">2037</span></a>                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel-2038"><a href="#TramDagModel-2038"><span class="linenos">2038</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Tram model for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; has no nn_shift or it is None.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2039"><a href="#TramDagModel-2039"><span class="linenos">2039</span></a>
</span><span id="TramDagModel-2040"><a href="#TramDagModel-2040"><span class="linenos">2040</span></a>                <span class="n">all_linear_shift_dicts</span><span class="p">[</span><span class="n">state</span><span class="p">][</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoch_weights</span>
</span><span id="TramDagModel-2041"><a href="#TramDagModel-2041"><span class="linenos">2041</span></a>
</span><span id="TramDagModel-2042"><a href="#TramDagModel-2042"><span class="linenos">2042</span></a>        <span class="c1"># Remove empty states (e.g., when best/last not found for all nodes)</span>
</span><span id="TramDagModel-2043"><a href="#TramDagModel-2043"><span class="linenos">2043</span></a>        <span class="n">all_linear_shift_dicts</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_linear_shift_dicts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">}</span>
</span><span id="TramDagModel-2044"><a href="#TramDagModel-2044"><span class="linenos">2044</span></a>
</span><span id="TramDagModel-2045"><a href="#TramDagModel-2045"><span class="linenos">2045</span></a>        <span class="k">return</span> <span class="n">all_linear_shift_dicts</span>
</span><span id="TramDagModel-2046"><a href="#TramDagModel-2046"><span class="linenos">2046</span></a>
</span><span id="TramDagModel-2047"><a href="#TramDagModel-2047"><span class="linenos">2047</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_simple_intercepts_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagModel-2048"><a href="#TramDagModel-2048"><span class="linenos">2048</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-2049"><a href="#TramDagModel-2049"><span class="linenos">2049</span></a><span class="sd">        Compute transformed simple intercept dictionaries for all nodes and states.</span>
</span><span id="TramDagModel-2050"><a href="#TramDagModel-2050"><span class="linenos">2050</span></a>
</span><span id="TramDagModel-2051"><a href="#TramDagModel-2051"><span class="linenos">2051</span></a><span class="sd">        For each node and each available state (&quot;best&quot;, &quot;last&quot;, &quot;init&quot;), this</span>
</span><span id="TramDagModel-2052"><a href="#TramDagModel-2052"><span class="linenos">2052</span></a><span class="sd">        method loads the corresponding model checkpoint, extracts simple intercept</span>
</span><span id="TramDagModel-2053"><a href="#TramDagModel-2053"><span class="linenos">2053</span></a><span class="sd">        weights, transforms them into interpretable theta parameters, and stores</span>
</span><span id="TramDagModel-2054"><a href="#TramDagModel-2054"><span class="linenos">2054</span></a><span class="sd">        them in a nested dictionary.</span>
</span><span id="TramDagModel-2055"><a href="#TramDagModel-2055"><span class="linenos">2055</span></a>
</span><span id="TramDagModel-2056"><a href="#TramDagModel-2056"><span class="linenos">2056</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-2057"><a href="#TramDagModel-2057"><span class="linenos">2057</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-2058"><a href="#TramDagModel-2058"><span class="linenos">2058</span></a><span class="sd">        dict</span>
</span><span id="TramDagModel-2059"><a href="#TramDagModel-2059"><span class="linenos">2059</span></a><span class="sd">            Nested dictionary of the form:</span>
</span><span id="TramDagModel-2060"><a href="#TramDagModel-2060"><span class="linenos">2060</span></a>
</span><span id="TramDagModel-2061"><a href="#TramDagModel-2061"><span class="linenos">2061</span></a><span class="sd">            .. code-block:: python</span>
</span><span id="TramDagModel-2062"><a href="#TramDagModel-2062"><span class="linenos">2062</span></a>
</span><span id="TramDagModel-2063"><a href="#TramDagModel-2063"><span class="linenos">2063</span></a><span class="sd">                {</span>
</span><span id="TramDagModel-2064"><a href="#TramDagModel-2064"><span class="linenos">2064</span></a><span class="sd">                    &quot;best&quot;: {node: [[theta_1], [theta_2], ...]},</span>
</span><span id="TramDagModel-2065"><a href="#TramDagModel-2065"><span class="linenos">2065</span></a><span class="sd">                    &quot;last&quot;: {node: [[theta_1], [theta_2], ...]},</span>
</span><span id="TramDagModel-2066"><a href="#TramDagModel-2066"><span class="linenos">2066</span></a><span class="sd">                    &quot;init&quot;: {node: [[theta_1], [theta_2], ...]},</span>
</span><span id="TramDagModel-2067"><a href="#TramDagModel-2067"><span class="linenos">2067</span></a><span class="sd">                }</span>
</span><span id="TramDagModel-2068"><a href="#TramDagModel-2068"><span class="linenos">2068</span></a>
</span><span id="TramDagModel-2069"><a href="#TramDagModel-2069"><span class="linenos">2069</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-2070"><a href="#TramDagModel-2070"><span class="linenos">2070</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-2071"><a href="#TramDagModel-2071"><span class="linenos">2071</span></a><span class="sd">        - For ordinal models (``self.is_ontram == True``), `transform_intercepts_ordinal`</span>
</span><span id="TramDagModel-2072"><a href="#TramDagModel-2072"><span class="linenos">2072</span></a><span class="sd">        is used.</span>
</span><span id="TramDagModel-2073"><a href="#TramDagModel-2073"><span class="linenos">2073</span></a><span class="sd">        - For continuous models, `transform_intercepts_continous` is used.</span>
</span><span id="TramDagModel-2074"><a href="#TramDagModel-2074"><span class="linenos">2074</span></a><span class="sd">        - Empty outer states (without any nodes) are removed from the result.</span>
</span><span id="TramDagModel-2075"><a href="#TramDagModel-2075"><span class="linenos">2075</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-2076"><a href="#TramDagModel-2076"><span class="linenos">2076</span></a>
</span><span id="TramDagModel-2077"><a href="#TramDagModel-2077"><span class="linenos">2077</span></a>        <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-2078"><a href="#TramDagModel-2078"><span class="linenos">2078</span></a>        <span class="n">nodes_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel-2079"><a href="#TramDagModel-2079"><span class="linenos">2079</span></a>        <span class="n">all_states</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;init&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-2080"><a href="#TramDagModel-2080"><span class="linenos">2080</span></a>        <span class="n">all_si_intercept_dicts</span> <span class="o">=</span> <span class="p">{</span><span class="n">state</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">all_states</span><span class="p">}</span>
</span><span id="TramDagModel-2081"><a href="#TramDagModel-2081"><span class="linenos">2081</span></a>
</span><span id="TramDagModel-2082"><a href="#TramDagModel-2082"><span class="linenos">2082</span></a>        <span class="n">debug</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="TramDagModel-2083"><a href="#TramDagModel-2083"><span class="linenos">2083</span></a>        <span class="n">verbose</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="TramDagModel-2084"><a href="#TramDagModel-2084"><span class="linenos">2084</span></a>        <span class="n">is_ontram</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;is_ontram&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="TramDagModel-2085"><a href="#TramDagModel-2085"><span class="linenos">2085</span></a>
</span><span id="TramDagModel-2086"><a href="#TramDagModel-2086"><span class="linenos">2086</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes_list</span><span class="p">:</span>
</span><span id="TramDagModel-2087"><a href="#TramDagModel-2087"><span class="linenos">2087</span></a>            <span class="n">NODE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
</span><span id="TramDagModel-2088"><a href="#TramDagModel-2088"><span class="linenos">2088</span></a>            <span class="n">BEST_MODEL_PATH</span><span class="p">,</span> <span class="n">LAST_MODEL_PATH</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model_train_val_paths</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">)</span>
</span><span id="TramDagModel-2089"><a href="#TramDagModel-2089"><span class="linenos">2089</span></a>            <span class="n">INIT_MODEL_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">,</span> <span class="s2">&quot;initial_model.pt&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2090"><a href="#TramDagModel-2090"><span class="linenos">2090</span></a>
</span><span id="TramDagModel-2091"><a href="#TramDagModel-2091"><span class="linenos">2091</span></a>            <span class="n">state_paths</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TramDagModel-2092"><a href="#TramDagModel-2092"><span class="linenos">2092</span></a>                <span class="s2">&quot;best&quot;</span><span class="p">:</span> <span class="n">BEST_MODEL_PATH</span><span class="p">,</span>
</span><span id="TramDagModel-2093"><a href="#TramDagModel-2093"><span class="linenos">2093</span></a>                <span class="s2">&quot;last&quot;</span><span class="p">:</span> <span class="n">LAST_MODEL_PATH</span><span class="p">,</span>
</span><span id="TramDagModel-2094"><a href="#TramDagModel-2094"><span class="linenos">2094</span></a>                <span class="s2">&quot;init&quot;</span><span class="p">:</span> <span class="n">INIT_MODEL_PATH</span><span class="p">,</span>
</span><span id="TramDagModel-2095"><a href="#TramDagModel-2095"><span class="linenos">2095</span></a>            <span class="p">}</span>
</span><span id="TramDagModel-2096"><a href="#TramDagModel-2096"><span class="linenos">2096</span></a>
</span><span id="TramDagModel-2097"><a href="#TramDagModel-2097"><span class="linenos">2097</span></a>            <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">LOAD_PATH</span> <span class="ow">in</span> <span class="n">state_paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagModel-2098"><a href="#TramDagModel-2098"><span class="linenos">2098</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">LOAD_PATH</span><span class="p">):</span>
</span><span id="TramDagModel-2099"><a href="#TramDagModel-2099"><span class="linenos">2099</span></a>                    <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="s2">&quot;init&quot;</span><span class="p">:</span>
</span><span id="TramDagModel-2100"><a href="#TramDagModel-2100"><span class="linenos">2100</span></a>                        <span class="k">continue</span>
</span><span id="TramDagModel-2101"><a href="#TramDagModel-2101"><span class="linenos">2101</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-2102"><a href="#TramDagModel-2102"><span class="linenos">2102</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] No models found for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;. Only initial model will be used.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2103"><a href="#TramDagModel-2103"><span class="linenos">2103</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">LOAD_PATH</span><span class="p">):</span>
</span><span id="TramDagModel-2104"><a href="#TramDagModel-2104"><span class="linenos">2104</span></a>                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel-2105"><a href="#TramDagModel-2105"><span class="linenos">2105</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Initial model also missing for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;. Skipping.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2106"><a href="#TramDagModel-2106"><span class="linenos">2106</span></a>                            <span class="k">continue</span>
</span><span id="TramDagModel-2107"><a href="#TramDagModel-2107"><span class="linenos">2107</span></a>
</span><span id="TramDagModel-2108"><a href="#TramDagModel-2108"><span class="linenos">2108</span></a>                <span class="c1"># Load model state</span>
</span><span id="TramDagModel-2109"><a href="#TramDagModel-2109"><span class="linenos">2109</span></a>                <span class="n">state_dict</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">LOAD_PATH</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="TramDagModel-2110"><a href="#TramDagModel-2110"><span class="linenos">2110</span></a>                <span class="n">tram_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel-2111"><a href="#TramDagModel-2111"><span class="linenos">2111</span></a>                <span class="n">tram_model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">state_dict</span><span class="p">)</span>
</span><span id="TramDagModel-2112"><a href="#TramDagModel-2112"><span class="linenos">2112</span></a>
</span><span id="TramDagModel-2113"><a href="#TramDagModel-2113"><span class="linenos">2113</span></a>                <span class="c1"># Extract and transform simple intercept weights</span>
</span><span id="TramDagModel-2114"><a href="#TramDagModel-2114"><span class="linenos">2114</span></a>                <span class="n">si_weights</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagModel-2115"><a href="#TramDagModel-2115"><span class="linenos">2115</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tram_model</span><span class="p">,</span> <span class="s2">&quot;nn_int&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tram_model</span><span class="o">.</span><span class="n">nn_int</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tram_model</span><span class="o">.</span><span class="n">nn_int</span><span class="p">,</span> <span class="n">SimpleIntercept</span><span class="p">):</span>
</span><span id="TramDagModel-2116"><a href="#TramDagModel-2116"><span class="linenos">2116</span></a>                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tram_model</span><span class="o">.</span><span class="n">nn_int</span><span class="p">,</span> <span class="s2">&quot;fc&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tram_model</span><span class="o">.</span><span class="n">nn_int</span><span class="o">.</span><span class="n">fc</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">):</span>
</span><span id="TramDagModel-2117"><a href="#TramDagModel-2117"><span class="linenos">2117</span></a>                        <span class="n">weights</span> <span class="o">=</span> <span class="n">tram_model</span><span class="o">.</span><span class="n">nn_int</span><span class="o">.</span><span class="n">fc</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="TramDagModel-2118"><a href="#TramDagModel-2118"><span class="linenos">2118</span></a>                        <span class="n">weights_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</span><span id="TramDagModel-2119"><a href="#TramDagModel-2119"><span class="linenos">2119</span></a>
</span><span id="TramDagModel-2120"><a href="#TramDagModel-2120"><span class="linenos">2120</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel-2121"><a href="#TramDagModel-2121"><span class="linenos">2121</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">) theta tilde shape: </span><span class="si">{</span><span class="n">weights_tensor</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2122"><a href="#TramDagModel-2122"><span class="linenos">2122</span></a>
</span><span id="TramDagModel-2123"><a href="#TramDagModel-2123"><span class="linenos">2123</span></a>                        <span class="k">if</span> <span class="n">is_ontram</span><span class="p">:</span>
</span><span id="TramDagModel-2124"><a href="#TramDagModel-2124"><span class="linenos">2124</span></a>                            <span class="n">si_weights</span> <span class="o">=</span> <span class="n">transform_intercepts_ordinal</span><span class="p">(</span><span class="n">weights_tensor</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))[:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel-2125"><a href="#TramDagModel-2125"><span class="linenos">2125</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-2126"><a href="#TramDagModel-2126"><span class="linenos">2126</span></a>                            <span class="n">si_weights</span> <span class="o">=</span> <span class="n">transform_intercepts_continous</span><span class="p">(</span><span class="n">weights_tensor</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel-2127"><a href="#TramDagModel-2127"><span class="linenos">2127</span></a>
</span><span id="TramDagModel-2128"><a href="#TramDagModel-2128"><span class="linenos">2128</span></a>                        <span class="n">si_weights</span> <span class="o">=</span> <span class="n">si_weights</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="TramDagModel-2129"><a href="#TramDagModel-2129"><span class="linenos">2129</span></a>
</span><span id="TramDagModel-2130"><a href="#TramDagModel-2130"><span class="linenos">2130</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel-2131"><a href="#TramDagModel-2131"><span class="linenos">2131</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">) theta transformed: </span><span class="si">{</span><span class="n">si_weights</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2132"><a href="#TramDagModel-2132"><span class="linenos">2132</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-2133"><a href="#TramDagModel-2133"><span class="linenos">2133</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel-2134"><a href="#TramDagModel-2134"><span class="linenos">2134</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">): missing &#39;fc&#39; or &#39;weight&#39; in SimpleIntercept.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2135"><a href="#TramDagModel-2135"><span class="linenos">2135</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-2136"><a href="#TramDagModel-2136"><span class="linenos">2136</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel-2137"><a href="#TramDagModel-2137"><span class="linenos">2137</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Tram model for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; has no nn_int or it is None.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2138"><a href="#TramDagModel-2138"><span class="linenos">2138</span></a>
</span><span id="TramDagModel-2139"><a href="#TramDagModel-2139"><span class="linenos">2139</span></a>                <span class="n">all_si_intercept_dicts</span><span class="p">[</span><span class="n">state</span><span class="p">][</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">si_weights</span>
</span><span id="TramDagModel-2140"><a href="#TramDagModel-2140"><span class="linenos">2140</span></a>
</span><span id="TramDagModel-2141"><a href="#TramDagModel-2141"><span class="linenos">2141</span></a>        <span class="c1"># Clean up empty states</span>
</span><span id="TramDagModel-2142"><a href="#TramDagModel-2142"><span class="linenos">2142</span></a>        <span class="n">all_si_intercept_dicts</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_si_intercept_dicts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">}</span>
</span><span id="TramDagModel-2143"><a href="#TramDagModel-2143"><span class="linenos">2143</span></a>        <span class="k">return</span> <span class="n">all_si_intercept_dicts</span>
</span><span id="TramDagModel-2144"><a href="#TramDagModel-2144"><span class="linenos">2144</span></a>       
</span><span id="TramDagModel-2145"><a href="#TramDagModel-2145"><span class="linenos">2145</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel-2146"><a href="#TramDagModel-2146"><span class="linenos">2146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel-2147"><a href="#TramDagModel-2147"><span class="linenos">2147</span></a><span class="sd">        Print a multi-part textual summary of the TramDagModel.</span>
</span><span id="TramDagModel-2148"><a href="#TramDagModel-2148"><span class="linenos">2148</span></a>
</span><span id="TramDagModel-2149"><a href="#TramDagModel-2149"><span class="linenos">2149</span></a><span class="sd">        The summary includes:</span>
</span><span id="TramDagModel-2150"><a href="#TramDagModel-2150"><span class="linenos">2150</span></a><span class="sd">        1. Training metrics overview per node (best/last NLL, epochs).</span>
</span><span id="TramDagModel-2151"><a href="#TramDagModel-2151"><span class="linenos">2151</span></a><span class="sd">        2. Node-specific details (thetas, linear shifts, optional architecture).</span>
</span><span id="TramDagModel-2152"><a href="#TramDagModel-2152"><span class="linenos">2152</span></a><span class="sd">        3. Basic information about the attached training DataFrame, if present.</span>
</span><span id="TramDagModel-2153"><a href="#TramDagModel-2153"><span class="linenos">2153</span></a>
</span><span id="TramDagModel-2154"><a href="#TramDagModel-2154"><span class="linenos">2154</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel-2155"><a href="#TramDagModel-2155"><span class="linenos">2155</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel-2156"><a href="#TramDagModel-2156"><span class="linenos">2156</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="TramDagModel-2157"><a href="#TramDagModel-2157"><span class="linenos">2157</span></a><span class="sd">            If True, include extended per-node details such as the model</span>
</span><span id="TramDagModel-2158"><a href="#TramDagModel-2158"><span class="linenos">2158</span></a><span class="sd">            architecture, parameter count, and availability of checkpoints</span>
</span><span id="TramDagModel-2159"><a href="#TramDagModel-2159"><span class="linenos">2159</span></a><span class="sd">            and sampling results. Default is False.</span>
</span><span id="TramDagModel-2160"><a href="#TramDagModel-2160"><span class="linenos">2160</span></a>
</span><span id="TramDagModel-2161"><a href="#TramDagModel-2161"><span class="linenos">2161</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel-2162"><a href="#TramDagModel-2162"><span class="linenos">2162</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel-2163"><a href="#TramDagModel-2163"><span class="linenos">2163</span></a><span class="sd">        None</span>
</span><span id="TramDagModel-2164"><a href="#TramDagModel-2164"><span class="linenos">2164</span></a>
</span><span id="TramDagModel-2165"><a href="#TramDagModel-2165"><span class="linenos">2165</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel-2166"><a href="#TramDagModel-2166"><span class="linenos">2166</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel-2167"><a href="#TramDagModel-2167"><span class="linenos">2167</span></a><span class="sd">        This method prints to stdout and does not return structured data.</span>
</span><span id="TramDagModel-2168"><a href="#TramDagModel-2168"><span class="linenos">2168</span></a><span class="sd">        It is intended for quick, human-readable inspection of the current</span>
</span><span id="TramDagModel-2169"><a href="#TramDagModel-2169"><span class="linenos">2169</span></a><span class="sd">        training and model state.</span>
</span><span id="TramDagModel-2170"><a href="#TramDagModel-2170"><span class="linenos">2170</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel-2171"><a href="#TramDagModel-2171"><span class="linenos">2171</span></a>
</span><span id="TramDagModel-2172"><a href="#TramDagModel-2172"><span class="linenos">2172</span></a>        <span class="c1"># ---------- SETUP ----------</span>
</span><span id="TramDagModel-2173"><a href="#TramDagModel-2173"><span class="linenos">2173</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-2174"><a href="#TramDagModel-2174"><span class="linenos">2174</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel-2175"><a href="#TramDagModel-2175"><span class="linenos">2175</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="TramDagModel-2176"><a href="#TramDagModel-2176"><span class="linenos">2176</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagModel-2177"><a href="#TramDagModel-2177"><span class="linenos">2177</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] Missing EXPERIMENT_DIR in cfg.conf_dict[&#39;PATHS&#39;].&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2178"><a href="#TramDagModel-2178"><span class="linenos">2178</span></a>
</span><span id="TramDagModel-2179"><a href="#TramDagModel-2179"><span class="linenos">2179</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">120</span><span class="p">)</span>
</span><span id="TramDagModel-2180"><a href="#TramDagModel-2180"><span class="linenos">2180</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;TRAM DAG MODEL SUMMARY&#39;</span><span class="si">:</span><span class="s2">^120</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2181"><a href="#TramDagModel-2181"><span class="linenos">2181</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">120</span><span class="p">)</span>
</span><span id="TramDagModel-2182"><a href="#TramDagModel-2182"><span class="linenos">2182</span></a>
</span><span id="TramDagModel-2183"><a href="#TramDagModel-2183"><span class="linenos">2183</span></a>        <span class="c1"># ---------- METRICS OVERVIEW ----------</span>
</span><span id="TramDagModel-2184"><a href="#TramDagModel-2184"><span class="linenos">2184</span></a>        <span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TramDagModel-2185"><a href="#TramDagModel-2185"><span class="linenos">2185</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TramDagModel-2186"><a href="#TramDagModel-2186"><span class="linenos">2186</span></a>            <span class="n">node_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">],</span> <span class="n">node</span><span class="p">)</span>
</span><span id="TramDagModel-2187"><a href="#TramDagModel-2187"><span class="linenos">2187</span></a>            <span class="n">train_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="s2">&quot;train_loss_hist.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2188"><a href="#TramDagModel-2188"><span class="linenos">2188</span></a>            <span class="n">val_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="s2">&quot;val_loss_hist.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2189"><a href="#TramDagModel-2189"><span class="linenos">2189</span></a>
</span><span id="TramDagModel-2190"><a href="#TramDagModel-2190"><span class="linenos">2190</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">train_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">val_path</span><span class="p">):</span>
</span><span id="TramDagModel-2191"><a href="#TramDagModel-2191"><span class="linenos">2191</span></a>                <span class="n">best_train_nll</span><span class="p">,</span> <span class="n">best_val_nll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_train_val_nll</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;best&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2192"><a href="#TramDagModel-2192"><span class="linenos">2192</span></a>                <span class="n">last_train_nll</span><span class="p">,</span> <span class="n">last_val_nll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_train_val_nll</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2193"><a href="#TramDagModel-2193"><span class="linenos">2193</span></a>                <span class="n">n_epochs_total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">train_path</span><span class="p">)))</span>
</span><span id="TramDagModel-2194"><a href="#TramDagModel-2194"><span class="linenos">2194</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-2195"><a href="#TramDagModel-2195"><span class="linenos">2195</span></a>                <span class="n">best_train_nll</span> <span class="o">=</span> <span class="n">best_val_nll</span> <span class="o">=</span> <span class="n">last_train_nll</span> <span class="o">=</span> <span class="n">last_val_nll</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagModel-2196"><a href="#TramDagModel-2196"><span class="linenos">2196</span></a>                <span class="n">n_epochs_total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TramDagModel-2197"><a href="#TramDagModel-2197"><span class="linenos">2197</span></a>
</span><span id="TramDagModel-2198"><a href="#TramDagModel-2198"><span class="linenos">2198</span></a>            <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="TramDagModel-2199"><a href="#TramDagModel-2199"><span class="linenos">2199</span></a>                <span class="s2">&quot;Node&quot;</span><span class="p">:</span> <span class="n">node</span><span class="p">,</span>
</span><span id="TramDagModel-2200"><a href="#TramDagModel-2200"><span class="linenos">2200</span></a>                <span class="s2">&quot;Best Train NLL&quot;</span><span class="p">:</span> <span class="n">best_train_nll</span><span class="p">,</span>
</span><span id="TramDagModel-2201"><a href="#TramDagModel-2201"><span class="linenos">2201</span></a>                <span class="s2">&quot;Best Val NLL&quot;</span><span class="p">:</span> <span class="n">best_val_nll</span><span class="p">,</span>
</span><span id="TramDagModel-2202"><a href="#TramDagModel-2202"><span class="linenos">2202</span></a>                <span class="s2">&quot;Last Train NLL&quot;</span><span class="p">:</span> <span class="n">last_train_nll</span><span class="p">,</span>
</span><span id="TramDagModel-2203"><a href="#TramDagModel-2203"><span class="linenos">2203</span></a>                <span class="s2">&quot;Last Val NLL&quot;</span><span class="p">:</span> <span class="n">last_val_nll</span><span class="p">,</span>
</span><span id="TramDagModel-2204"><a href="#TramDagModel-2204"><span class="linenos">2204</span></a>                <span class="s2">&quot;Epochs&quot;</span><span class="p">:</span> <span class="n">n_epochs_total</span><span class="p">,</span>
</span><span id="TramDagModel-2205"><a href="#TramDagModel-2205"><span class="linenos">2205</span></a>            <span class="p">})</span>
</span><span id="TramDagModel-2206"><a href="#TramDagModel-2206"><span class="linenos">2206</span></a>
</span><span id="TramDagModel-2207"><a href="#TramDagModel-2207"><span class="linenos">2207</span></a>        <span class="n">df_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>
</span><span id="TramDagModel-2208"><a href="#TramDagModel-2208"><span class="linenos">2208</span></a>        <span class="n">df_summary</span> <span class="o">=</span> <span class="n">df_summary</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="TramDagModel-2209"><a href="#TramDagModel-2209"><span class="linenos">2209</span></a>
</span><span id="TramDagModel-2210"><a href="#TramDagModel-2210"><span class="linenos">2210</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[1] TRAINING METRICS OVERVIEW&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2211"><a href="#TramDagModel-2211"><span class="linenos">2211</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">120</span><span class="p">)</span>
</span><span id="TramDagModel-2212"><a href="#TramDagModel-2212"><span class="linenos">2212</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">df_summary</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="TramDagModel-2213"><a href="#TramDagModel-2213"><span class="linenos">2213</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="TramDagModel-2214"><a href="#TramDagModel-2214"><span class="linenos">2214</span></a>                <span class="n">df_summary</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
</span><span id="TramDagModel-2215"><a href="#TramDagModel-2215"><span class="linenos">2215</span></a>                    <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="TramDagModel-2216"><a href="#TramDagModel-2216"><span class="linenos">2216</span></a>                    <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
</span><span id="TramDagModel-2217"><a href="#TramDagModel-2217"><span class="linenos">2217</span></a>                    <span class="n">col_space</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="TramDagModel-2218"><a href="#TramDagModel-2218"><span class="linenos">2218</span></a>                    <span class="n">float_format</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">7.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="TramDagModel-2219"><a href="#TramDagModel-2219"><span class="linenos">2219</span></a>                <span class="p">)</span>
</span><span id="TramDagModel-2220"><a href="#TramDagModel-2220"><span class="linenos">2220</span></a>            <span class="p">)</span>
</span><span id="TramDagModel-2221"><a href="#TramDagModel-2221"><span class="linenos">2221</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-2222"><a href="#TramDagModel-2222"><span class="linenos">2222</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No training history found for any node.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2223"><a href="#TramDagModel-2223"><span class="linenos">2223</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">120</span><span class="p">)</span>
</span><span id="TramDagModel-2224"><a href="#TramDagModel-2224"><span class="linenos">2224</span></a>
</span><span id="TramDagModel-2225"><a href="#TramDagModel-2225"><span class="linenos">2225</span></a>        <span class="c1"># ---------- NODE DETAILS ----------</span>
</span><span id="TramDagModel-2226"><a href="#TramDagModel-2226"><span class="linenos">2226</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[2] NODE-SPECIFIC DETAILS&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2227"><a href="#TramDagModel-2227"><span class="linenos">2227</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">120</span><span class="p">)</span>
</span><span id="TramDagModel-2228"><a href="#TramDagModel-2228"><span class="linenos">2228</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TramDagModel-2229"><a href="#TramDagModel-2229"><span class="linenos">2229</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="sa">f</span><span class="s1">&#39;NODE: </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s1">&#39;</span><span class="si">:</span><span class="s2">^120</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2230"><a href="#TramDagModel-2230"><span class="linenos">2230</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">120</span><span class="p">)</span>
</span><span id="TramDagModel-2231"><a href="#TramDagModel-2231"><span class="linenos">2231</span></a>
</span><span id="TramDagModel-2232"><a href="#TramDagModel-2232"><span class="linenos">2232</span></a>            <span class="c1"># THETAS &amp; SHIFTS</span>
</span><span id="TramDagModel-2233"><a href="#TramDagModel-2233"><span class="linenos">2233</span></a>            <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;best&quot;</span><span class="p">]:</span>
</span><span id="TramDagModel-2234"><a href="#TramDagModel-2234"><span class="linenos">2234</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  [</span><span class="si">{</span><span class="n">state</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> STATE]&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2235"><a href="#TramDagModel-2235"><span class="linenos">2235</span></a>
</span><span id="TramDagModel-2236"><a href="#TramDagModel-2236"><span class="linenos">2236</span></a>                <span class="c1"># ---- Thetas ----</span>
</span><span id="TramDagModel-2237"><a href="#TramDagModel-2237"><span class="linenos">2237</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-2238"><a href="#TramDagModel-2238"><span class="linenos">2238</span></a>                    <span class="n">thetas</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_thetas&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="kc">None</span><span class="p">:</span> <span class="kc">None</span><span class="p">)(</span><span class="n">node</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span><span id="TramDagModel-2239"><a href="#TramDagModel-2239"><span class="linenos">2239</span></a>                    <span class="k">if</span> <span class="n">thetas</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel-2240"><a href="#TramDagModel-2240"><span class="linenos">2240</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thetas</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
</span><span id="TramDagModel-2241"><a href="#TramDagModel-2241"><span class="linenos">2241</span></a>                            <span class="n">thetas_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">thetas</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="TramDagModel-2242"><a href="#TramDagModel-2242"><span class="linenos">2242</span></a>                            <span class="n">compact</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">thetas_flat</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="TramDagModel-2243"><a href="#TramDagModel-2243"><span class="linenos">2243</span></a>                            <span class="n">arr_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array2string</span><span class="p">(</span>
</span><span id="TramDagModel-2244"><a href="#TramDagModel-2244"><span class="linenos">2244</span></a>                                <span class="n">compact</span><span class="p">,</span>
</span><span id="TramDagModel-2245"><a href="#TramDagModel-2245"><span class="linenos">2245</span></a>                                <span class="n">max_line_width</span><span class="o">=</span><span class="mi">110</span><span class="p">,</span>
</span><span id="TramDagModel-2246"><a href="#TramDagModel-2246"><span class="linenos">2246</span></a>                                <span class="n">threshold</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
</span><span id="TramDagModel-2247"><a href="#TramDagModel-2247"><span class="linenos">2247</span></a>                                <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;, &quot;</span>
</span><span id="TramDagModel-2248"><a href="#TramDagModel-2248"><span class="linenos">2248</span></a>                            <span class="p">)</span>
</span><span id="TramDagModel-2249"><a href="#TramDagModel-2249"><span class="linenos">2249</span></a>                            <span class="n">lines</span> <span class="o">=</span> <span class="n">arr_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2250"><a href="#TramDagModel-2250"><span class="linenos">2250</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="TramDagModel-2251"><a href="#TramDagModel-2251"><span class="linenos">2251</span></a>                                <span class="n">arr_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; ...&quot;</span>
</span><span id="TramDagModel-2252"><a href="#TramDagModel-2252"><span class="linenos">2252</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">thetas_flat</span><span class="p">)</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">arr_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2253"><a href="#TramDagModel-2253"><span class="linenos">2253</span></a>                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thetas</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="TramDagModel-2254"><a href="#TramDagModel-2254"><span class="linenos">2254</span></a>                            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">thetas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagModel-2255"><a href="#TramDagModel-2255"><span class="linenos">2255</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     [</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">]: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2256"><a href="#TramDagModel-2256"><span class="linenos">2256</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-2257"><a href="#TramDagModel-2257"><span class="linenos">2257</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    : </span><span class="si">{</span><span class="n">thetas</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2258"><a href="#TramDagModel-2258"><span class="linenos">2258</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-2259"><a href="#TramDagModel-2259"><span class="linenos">2259</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    : not available&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2260"><a href="#TramDagModel-2260"><span class="linenos">2260</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel-2261"><a href="#TramDagModel-2261"><span class="linenos">2261</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [Error loading thetas] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2262"><a href="#TramDagModel-2262"><span class="linenos">2262</span></a>
</span><span id="TramDagModel-2263"><a href="#TramDagModel-2263"><span class="linenos">2263</span></a>                <span class="c1"># ---- Linear Shifts ----</span>
</span><span id="TramDagModel-2264"><a href="#TramDagModel-2264"><span class="linenos">2264</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-2265"><a href="#TramDagModel-2265"><span class="linenos">2265</span></a>                    <span class="n">linear_shifts</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_linear_shifts&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="kc">None</span><span class="p">:</span> <span class="kc">None</span><span class="p">)(</span><span class="n">node</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span><span id="TramDagModel-2266"><a href="#TramDagModel-2266"><span class="linenos">2266</span></a>                    <span class="k">if</span> <span class="n">linear_shifts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel-2267"><a href="#TramDagModel-2267"><span class="linenos">2267</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">linear_shifts</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="TramDagModel-2268"><a href="#TramDagModel-2268"><span class="linenos">2268</span></a>                            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">linear_shifts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagModel-2269"><a href="#TramDagModel-2269"><span class="linenos">2269</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2270"><a href="#TramDagModel-2270"><span class="linenos">2270</span></a>                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">linear_shifts</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
</span><span id="TramDagModel-2271"><a href="#TramDagModel-2271"><span class="linenos">2271</span></a>                            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">linear_shifts</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="TramDagModel-2272"><a href="#TramDagModel-2272"><span class="linenos">2272</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Linear shifts (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">arr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2273"><a href="#TramDagModel-2273"><span class="linenos">2273</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-2274"><a href="#TramDagModel-2274"><span class="linenos">2274</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Linear shifts: </span><span class="si">{</span><span class="n">linear_shifts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2275"><a href="#TramDagModel-2275"><span class="linenos">2275</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-2276"><a href="#TramDagModel-2276"><span class="linenos">2276</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Linear shifts: not available&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2277"><a href="#TramDagModel-2277"><span class="linenos">2277</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel-2278"><a href="#TramDagModel-2278"><span class="linenos">2278</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [Error loading linear shifts] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2279"><a href="#TramDagModel-2279"><span class="linenos">2279</span></a>
</span><span id="TramDagModel-2280"><a href="#TramDagModel-2280"><span class="linenos">2280</span></a>            <span class="c1"># ---- Verbose info directly below node ----</span>
</span><span id="TramDagModel-2281"><a href="#TramDagModel-2281"><span class="linenos">2281</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="TramDagModel-2282"><a href="#TramDagModel-2282"><span class="linenos">2282</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  [DETAILS]&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2283"><a href="#TramDagModel-2283"><span class="linenos">2283</span></a>                <span class="n">node_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="k">if</span> <span class="n">EXPERIMENT_DIR</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="TramDagModel-2284"><a href="#TramDagModel-2284"><span class="linenos">2284</span></a>                <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel-2285"><a href="#TramDagModel-2285"><span class="linenos">2285</span></a>
</span><span id="TramDagModel-2286"><a href="#TramDagModel-2286"><span class="linenos">2286</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Model Architecture:&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2287"><a href="#TramDagModel-2287"><span class="linenos">2287</span></a>                <span class="n">arch_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2288"><a href="#TramDagModel-2288"><span class="linenos">2288</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">arch_str</span><span class="p">:</span>
</span><span id="TramDagModel-2289"><a href="#TramDagModel-2289"><span class="linenos">2289</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2290"><a href="#TramDagModel-2290"><span class="linenos">2290</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Parameter count: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2291"><a href="#TramDagModel-2291"><span class="linenos">2291</span></a>
</span><span id="TramDagModel-2292"><a href="#TramDagModel-2292"><span class="linenos">2292</span></a>                <span class="k">if</span> <span class="n">node_dir</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">node_dir</span><span class="p">):</span>
</span><span id="TramDagModel-2293"><a href="#TramDagModel-2293"><span class="linenos">2293</span></a>                    <span class="n">ckpt_exists</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s1">&#39;.pt&#39;</span><span class="p">,</span> <span class="s1">&#39;.pth&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">node_dir</span><span class="p">))</span>
</span><span id="TramDagModel-2294"><a href="#TramDagModel-2294"><span class="linenos">2294</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Checkpoints found: </span><span class="si">{</span><span class="n">ckpt_exists</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2295"><a href="#TramDagModel-2295"><span class="linenos">2295</span></a>
</span><span id="TramDagModel-2296"><a href="#TramDagModel-2296"><span class="linenos">2296</span></a>                    <span class="n">sampling_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="s2">&quot;sampling&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2297"><a href="#TramDagModel-2297"><span class="linenos">2297</span></a>                    <span class="n">sampling_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">sampling_dir</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sampling_dir</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="TramDagModel-2298"><a href="#TramDagModel-2298"><span class="linenos">2298</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Sampling results found: </span><span class="si">{</span><span class="n">sampling_exists</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2299"><a href="#TramDagModel-2299"><span class="linenos">2299</span></a>
</span><span id="TramDagModel-2300"><a href="#TramDagModel-2300"><span class="linenos">2300</span></a>                    <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;Train&quot;</span><span class="p">,</span> <span class="s2">&quot;train_loss_hist.json&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Validation&quot;</span><span class="p">,</span> <span class="s2">&quot;val_loss_hist.json&quot;</span><span class="p">)]:</span>
</span><span id="TramDagModel-2301"><a href="#TramDagModel-2301"><span class="linenos">2301</span></a>                        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="TramDagModel-2302"><a href="#TramDagModel-2302"><span class="linenos">2302</span></a>                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="TramDagModel-2303"><a href="#TramDagModel-2303"><span class="linenos">2303</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-2304"><a href="#TramDagModel-2304"><span class="linenos">2304</span></a>                                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel-2305"><a href="#TramDagModel-2305"><span class="linenos">2305</span></a>                                    <span class="n">hist</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TramDagModel-2306"><a href="#TramDagModel-2306"><span class="linenos">2306</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> history: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span><span class="si">}</span><span class="s2"> epochs&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2307"><a href="#TramDagModel-2307"><span class="linenos">2307</span></a>                            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel-2308"><a href="#TramDagModel-2308"><span class="linenos">2308</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> history: failed to load (</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2309"><a href="#TramDagModel-2309"><span class="linenos">2309</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-2310"><a href="#TramDagModel-2310"><span class="linenos">2310</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> history: not found&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2311"><a href="#TramDagModel-2311"><span class="linenos">2311</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel-2312"><a href="#TramDagModel-2312"><span class="linenos">2312</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    [INFO] No experiment directory defined or missing for this node.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2313"><a href="#TramDagModel-2313"><span class="linenos">2313</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">120</span><span class="p">)</span>
</span><span id="TramDagModel-2314"><a href="#TramDagModel-2314"><span class="linenos">2314</span></a>
</span><span id="TramDagModel-2315"><a href="#TramDagModel-2315"><span class="linenos">2315</span></a>        <span class="c1"># ---------- TRAINING DATAFRAME ----------</span>
</span><span id="TramDagModel-2316"><a href="#TramDagModel-2316"><span class="linenos">2316</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[3] TRAINING DATAFRAME&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2317"><a href="#TramDagModel-2317"><span class="linenos">2317</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">120</span><span class="p">)</span>
</span><span id="TramDagModel-2318"><a href="#TramDagModel-2318"><span class="linenos">2318</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel-2319"><a href="#TramDagModel-2319"><span class="linenos">2319</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">train_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</span><span id="TramDagModel-2320"><a href="#TramDagModel-2320"><span class="linenos">2320</span></a>        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="TramDagModel-2321"><a href="#TramDagModel-2321"><span class="linenos">2321</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No training DataFrame attached to this TramDagModel.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel-2322"><a href="#TramDagModel-2322"><span class="linenos">2322</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">120</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Probabilistic DAG model built from node-wise TRAMs (transformation models).</p>

<p>This class manages:</p>

<ul>
<li>Configuration and per-node model construction.</li>
<li>Data scaling (minmax).</li>
<li>Training (sequential or per-node parallel on CPU).</li>
<li>Diagnostics (loss history, intercepts, linear shifts, latents).</li>
<li>Sampling from the joint DAG and loading stored samples.</li>
<li>High-level summaries and plotting utilities.</li>
</ul>
</div>


                            <div id="TramDagModel.__init__" class="classattr">
                                        <input id="TramDagModel.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TramDagModel</span><span class="signature pdoc-code condensed">()</span>

                <label class="view-source-button" for="TramDagModel.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.__init__-113"><a href="#TramDagModel.__init__-113"><span class="linenos">113</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagModel.__init__-114"><a href="#TramDagModel.__init__-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.__init__-115"><a href="#TramDagModel.__init__-115"><span class="linenos">115</span></a><span class="sd">        Initialize an empty TramDagModel shell.</span>
</span><span id="TramDagModel.__init__-116"><a href="#TramDagModel.__init__-116"><span class="linenos">116</span></a>
</span><span id="TramDagModel.__init__-117"><a href="#TramDagModel.__init__-117"><span class="linenos">117</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.__init__-118"><a href="#TramDagModel.__init__-118"><span class="linenos">118</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.__init__-119"><a href="#TramDagModel.__init__-119"><span class="linenos">119</span></a><span class="sd">        This constructor does not build any node models and does not attach a</span>
</span><span id="TramDagModel.__init__-120"><a href="#TramDagModel.__init__-120"><span class="linenos">120</span></a><span class="sd">        configuration. Use `TramDagModel.from_config` or `TramDagModel.from_directory`</span>
</span><span id="TramDagModel.__init__-121"><a href="#TramDagModel.__init__-121"><span class="linenos">121</span></a><span class="sd">        to obtain a fully configured and ready-to-use instance.</span>
</span><span id="TramDagModel.__init__-122"><a href="#TramDagModel.__init__-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.__init__-123"><a href="#TramDagModel.__init__-123"><span class="linenos">123</span></a>        
</span><span id="TramDagModel.__init__-124"><a href="#TramDagModel.__init__-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="TramDagModel.__init__-125"><a href="#TramDagModel.__init__-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="TramDagModel.__init__-126"><a href="#TramDagModel.__init__-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>
</span><span id="TramDagModel.__init__-127"><a href="#TramDagModel.__init__-127"><span class="linenos">127</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Initialize an empty TramDagModel shell.</p>

<h2 id="notes">Notes</h2>

<p>This constructor does not build any node models and does not attach a
configuration. Use <code><a href="#TramDagModel.from_config">TramDagModel.from_config</a></code> or <code><a href="#TramDagModel.from_directory">TramDagModel.from_directory</a></code>
to obtain a fully configured and ready-to-use instance.</p>
</div>


                            </div>
                            <div id="TramDagModel.DEFAULTS_CONFIG" class="classattr">
                                <div class="attr variable">
            <span class="name">DEFAULTS_CONFIG</span>        =
<input id="TramDagModel.DEFAULTS_CONFIG-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="TramDagModel.DEFAULTS_CONFIG-view-value"></label><span class="default_value">{&#39;set_initial_weights&#39;: False, &#39;debug&#39;: False, &#39;verbose&#39;: False, &#39;device&#39;: &#39;auto&#39;, &#39;initial_data&#39;: None, &#39;overwrite_initial_weights&#39;: True}</span>

        
    </div>
    <a class="headerlink" href="#TramDagModel.DEFAULTS_CONFIG"></a>
    
    

                            </div>
                            <div id="TramDagModel.DEFAULTS_FIT" class="classattr">
                                <div class="attr variable">
            <span class="name">DEFAULTS_FIT</span>        =
<input id="TramDagModel.DEFAULTS_FIT-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="TramDagModel.DEFAULTS_FIT-view-value"></label><span class="default_value">{&#39;epochs&#39;: 100, &#39;train_list&#39;: None, &#39;callbacks&#39;: None, &#39;learning_rate&#39;: 0.01, &#39;device&#39;: &#39;auto&#39;, &#39;optimizers&#39;: None, &#39;schedulers&#39;: None, &#39;use_scheduler&#39;: False, &#39;save_linear_shifts&#39;: True, &#39;save_simple_intercepts&#39;: True, &#39;debug&#39;: False, &#39;verbose&#39;: True, &#39;train_mode&#39;: &#39;sequential&#39;, &#39;return_history&#39;: False, &#39;overwrite_inital_weights&#39;: True, &#39;num_workers&#39;: 4, &#39;persistent_workers&#39;: True, &#39;prefetch_factor&#39;: 4, &#39;batch_size&#39;: 1000}</span>

        
    </div>
    <a class="headerlink" href="#TramDagModel.DEFAULTS_FIT"></a>
    
    

                            </div>
                            <div id="TramDagModel.debug" class="classattr">
                                <div class="attr variable">
            <span class="name">debug</span>

        
    </div>
    <a class="headerlink" href="#TramDagModel.debug"></a>
    
    

                            </div>
                            <div id="TramDagModel.verbose" class="classattr">
                                <div class="attr variable">
            <span class="name">verbose</span>

        
    </div>
    <a class="headerlink" href="#TramDagModel.verbose"></a>
    
    

                            </div>
                            <div id="TramDagModel.device" class="classattr">
                                <div class="attr variable">
            <span class="name">device</span>

        
    </div>
    <a class="headerlink" href="#TramDagModel.device"></a>
    
    

                            </div>
                            <div id="TramDagModel.get_device" class="classattr">
                                        <input id="TramDagModel.get_device-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_device</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">settings</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.get_device-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.get_device"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.get_device-129"><a href="#TramDagModel.get_device-129"><span class="linenos">129</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TramDagModel.get_device-130"><a href="#TramDagModel.get_device-130"><span class="linenos">130</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_device</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>
</span><span id="TramDagModel.get_device-131"><a href="#TramDagModel.get_device-131"><span class="linenos">131</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.get_device-132"><a href="#TramDagModel.get_device-132"><span class="linenos">132</span></a><span class="sd">        Resolve the target device string from a settings dictionary.</span>
</span><span id="TramDagModel.get_device-133"><a href="#TramDagModel.get_device-133"><span class="linenos">133</span></a>
</span><span id="TramDagModel.get_device-134"><a href="#TramDagModel.get_device-134"><span class="linenos">134</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.get_device-135"><a href="#TramDagModel.get_device-135"><span class="linenos">135</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.get_device-136"><a href="#TramDagModel.get_device-136"><span class="linenos">136</span></a><span class="sd">        settings : dict</span>
</span><span id="TramDagModel.get_device-137"><a href="#TramDagModel.get_device-137"><span class="linenos">137</span></a><span class="sd">            Dictionary containing at least a key ``&quot;device&quot;`` with one of</span>
</span><span id="TramDagModel.get_device-138"><a href="#TramDagModel.get_device-138"><span class="linenos">138</span></a><span class="sd">            {&quot;auto&quot;, &quot;cpu&quot;, &quot;cuda&quot;}. If missing, &quot;auto&quot; is assumed.</span>
</span><span id="TramDagModel.get_device-139"><a href="#TramDagModel.get_device-139"><span class="linenos">139</span></a>
</span><span id="TramDagModel.get_device-140"><a href="#TramDagModel.get_device-140"><span class="linenos">140</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.get_device-141"><a href="#TramDagModel.get_device-141"><span class="linenos">141</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.get_device-142"><a href="#TramDagModel.get_device-142"><span class="linenos">142</span></a><span class="sd">        str</span>
</span><span id="TramDagModel.get_device-143"><a href="#TramDagModel.get_device-143"><span class="linenos">143</span></a><span class="sd">            Device string, either &quot;cpu&quot; or &quot;cuda&quot;.</span>
</span><span id="TramDagModel.get_device-144"><a href="#TramDagModel.get_device-144"><span class="linenos">144</span></a>
</span><span id="TramDagModel.get_device-145"><a href="#TramDagModel.get_device-145"><span class="linenos">145</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.get_device-146"><a href="#TramDagModel.get_device-146"><span class="linenos">146</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.get_device-147"><a href="#TramDagModel.get_device-147"><span class="linenos">147</span></a><span class="sd">        If ``device == &quot;auto&quot;``, CUDA is selected if available, otherwise CPU.</span>
</span><span id="TramDagModel.get_device-148"><a href="#TramDagModel.get_device-148"><span class="linenos">148</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.get_device-149"><a href="#TramDagModel.get_device-149"><span class="linenos">149</span></a>        <span class="n">device_arg</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_device-150"><a href="#TramDagModel.get_device-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="n">device_arg</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
</span><span id="TramDagModel.get_device-151"><a href="#TramDagModel.get_device-151"><span class="linenos">151</span></a>            <span class="n">device_str</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>
</span><span id="TramDagModel.get_device-152"><a href="#TramDagModel.get_device-152"><span class="linenos">152</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.get_device-153"><a href="#TramDagModel.get_device-153"><span class="linenos">153</span></a>            <span class="n">device_str</span> <span class="o">=</span> <span class="n">device_arg</span>
</span><span id="TramDagModel.get_device-154"><a href="#TramDagModel.get_device-154"><span class="linenos">154</span></a>        <span class="k">return</span> <span class="n">device_str</span>
</span></pre></div>


            <div class="docstring"><p>Resolve the target device string from a settings dictionary.</p>

<h2 id="parameters">Parameters</h2>

<p>settings : dict
    Dictionary containing at least a key <code>"device"</code> with one of
    {"auto", "cpu", "cuda"}. If missing, "auto" is assumed.</p>

<h2 id="returns">Returns</h2>

<p>str
    Device string, either "cpu" or "cuda".</p>

<h2 id="notes">Notes</h2>

<p>If <code>device == "auto"</code>, CUDA is selected if available, otherwise CPU.</p>
</div>


                            </div>
                            <div id="TramDagModel.from_config" class="classattr">
                                        <input id="TramDagModel.from_config-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_config</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">cfg</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.from_config-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.from_config"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.from_config-187"><a href="#TramDagModel.from_config-187"><span class="linenos">187</span></a>    <span class="nd">@classmethod</span>
</span><span id="TramDagModel.from_config-188"><a href="#TramDagModel.from_config-188"><span class="linenos">188</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TramDagModel.from_config-189"><a href="#TramDagModel.from_config-189"><span class="linenos">189</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.from_config-190"><a href="#TramDagModel.from_config-190"><span class="linenos">190</span></a><span class="sd">        Construct a TramDagModel from a TramDagConfig object.</span>
</span><span id="TramDagModel.from_config-191"><a href="#TramDagModel.from_config-191"><span class="linenos">191</span></a>
</span><span id="TramDagModel.from_config-192"><a href="#TramDagModel.from_config-192"><span class="linenos">192</span></a><span class="sd">        This builds one TRAM model per node in the DAG and optionally writes</span>
</span><span id="TramDagModel.from_config-193"><a href="#TramDagModel.from_config-193"><span class="linenos">193</span></a><span class="sd">        the initial model parameters to disk.</span>
</span><span id="TramDagModel.from_config-194"><a href="#TramDagModel.from_config-194"><span class="linenos">194</span></a>
</span><span id="TramDagModel.from_config-195"><a href="#TramDagModel.from_config-195"><span class="linenos">195</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.from_config-196"><a href="#TramDagModel.from_config-196"><span class="linenos">196</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.from_config-197"><a href="#TramDagModel.from_config-197"><span class="linenos">197</span></a><span class="sd">        cfg : TramDagConfig</span>
</span><span id="TramDagModel.from_config-198"><a href="#TramDagModel.from_config-198"><span class="linenos">198</span></a><span class="sd">            Configuration wrapper holding the underlying configuration dictionary,</span>
</span><span id="TramDagModel.from_config-199"><a href="#TramDagModel.from_config-199"><span class="linenos">199</span></a><span class="sd">            including at least:</span>
</span><span id="TramDagModel.from_config-200"><a href="#TramDagModel.from_config-200"><span class="linenos">200</span></a><span class="sd">            - ``conf_dict[&quot;nodes&quot;]``: mapping of node names to node configs.</span>
</span><span id="TramDagModel.from_config-201"><a href="#TramDagModel.from_config-201"><span class="linenos">201</span></a><span class="sd">            - ``conf_dict[&quot;PATHS&quot;][&quot;EXPERIMENT_DIR&quot;]``: experiment directory.</span>
</span><span id="TramDagModel.from_config-202"><a href="#TramDagModel.from_config-202"><span class="linenos">202</span></a><span class="sd">        **kwargs</span>
</span><span id="TramDagModel.from_config-203"><a href="#TramDagModel.from_config-203"><span class="linenos">203</span></a><span class="sd">            Node-level construction options. Each key must be present in</span>
</span><span id="TramDagModel.from_config-204"><a href="#TramDagModel.from_config-204"><span class="linenos">204</span></a><span class="sd">            ``DEFAULTS_CONFIG``. Values can be:</span>
</span><span id="TramDagModel.from_config-205"><a href="#TramDagModel.from_config-205"><span class="linenos">205</span></a><span class="sd">            - scalar: applied to all nodes.</span>
</span><span id="TramDagModel.from_config-206"><a href="#TramDagModel.from_config-206"><span class="linenos">206</span></a><span class="sd">            - dict: mapping ``{node_name: value}`` for per-node overrides.</span>
</span><span id="TramDagModel.from_config-207"><a href="#TramDagModel.from_config-207"><span class="linenos">207</span></a>
</span><span id="TramDagModel.from_config-208"><a href="#TramDagModel.from_config-208"><span class="linenos">208</span></a><span class="sd">            Common keys include:</span>
</span><span id="TramDagModel.from_config-209"><a href="#TramDagModel.from_config-209"><span class="linenos">209</span></a><span class="sd">            device : {&quot;auto&quot;, &quot;cpu&quot;, &quot;cuda&quot;}, default &quot;auto&quot;</span>
</span><span id="TramDagModel.from_config-210"><a href="#TramDagModel.from_config-210"><span class="linenos">210</span></a><span class="sd">                Device selection (CUDA if available when &quot;auto&quot;).</span>
</span><span id="TramDagModel.from_config-211"><a href="#TramDagModel.from_config-211"><span class="linenos">211</span></a><span class="sd">            debug : bool, default False</span>
</span><span id="TramDagModel.from_config-212"><a href="#TramDagModel.from_config-212"><span class="linenos">212</span></a><span class="sd">                If True, print debug messages.</span>
</span><span id="TramDagModel.from_config-213"><a href="#TramDagModel.from_config-213"><span class="linenos">213</span></a><span class="sd">            verbose : bool, default False</span>
</span><span id="TramDagModel.from_config-214"><a href="#TramDagModel.from_config-214"><span class="linenos">214</span></a><span class="sd">                If True, print informational messages.</span>
</span><span id="TramDagModel.from_config-215"><a href="#TramDagModel.from_config-215"><span class="linenos">215</span></a><span class="sd">            set_initial_weights : bool</span>
</span><span id="TramDagModel.from_config-216"><a href="#TramDagModel.from_config-216"><span class="linenos">216</span></a><span class="sd">                Passed to underlying TRAM model constructors.</span>
</span><span id="TramDagModel.from_config-217"><a href="#TramDagModel.from_config-217"><span class="linenos">217</span></a><span class="sd">            overwrite_initial_weights : bool, default True</span>
</span><span id="TramDagModel.from_config-218"><a href="#TramDagModel.from_config-218"><span class="linenos">218</span></a><span class="sd">                If True, overwrite any existing ``initial_model.pt`` files per node.</span>
</span><span id="TramDagModel.from_config-219"><a href="#TramDagModel.from_config-219"><span class="linenos">219</span></a><span class="sd">            initial_data : Any</span>
</span><span id="TramDagModel.from_config-220"><a href="#TramDagModel.from_config-220"><span class="linenos">220</span></a><span class="sd">                Optional object passed down to node constructors.</span>
</span><span id="TramDagModel.from_config-221"><a href="#TramDagModel.from_config-221"><span class="linenos">221</span></a>
</span><span id="TramDagModel.from_config-222"><a href="#TramDagModel.from_config-222"><span class="linenos">222</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.from_config-223"><a href="#TramDagModel.from_config-223"><span class="linenos">223</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.from_config-224"><a href="#TramDagModel.from_config-224"><span class="linenos">224</span></a><span class="sd">        TramDagModel</span>
</span><span id="TramDagModel.from_config-225"><a href="#TramDagModel.from_config-225"><span class="linenos">225</span></a><span class="sd">            Fully initialized instance with:</span>
</span><span id="TramDagModel.from_config-226"><a href="#TramDagModel.from_config-226"><span class="linenos">226</span></a><span class="sd">            - ``cfg``</span>
</span><span id="TramDagModel.from_config-227"><a href="#TramDagModel.from_config-227"><span class="linenos">227</span></a><span class="sd">            - ``nodes_dict``</span>
</span><span id="TramDagModel.from_config-228"><a href="#TramDagModel.from_config-228"><span class="linenos">228</span></a><span class="sd">            - ``models`` (per-node TRAMs)</span>
</span><span id="TramDagModel.from_config-229"><a href="#TramDagModel.from_config-229"><span class="linenos">229</span></a><span class="sd">            - ``settings`` (resolved per-node config)</span>
</span><span id="TramDagModel.from_config-230"><a href="#TramDagModel.from_config-230"><span class="linenos">230</span></a>
</span><span id="TramDagModel.from_config-231"><a href="#TramDagModel.from_config-231"><span class="linenos">231</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel.from_config-232"><a href="#TramDagModel.from_config-232"><span class="linenos">232</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel.from_config-233"><a href="#TramDagModel.from_config-233"><span class="linenos">233</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel.from_config-234"><a href="#TramDagModel.from_config-234"><span class="linenos">234</span></a><span class="sd">            If any dict-valued kwarg does not provide values for exactly the set</span>
</span><span id="TramDagModel.from_config-235"><a href="#TramDagModel.from_config-235"><span class="linenos">235</span></a><span class="sd">            of nodes in ``cfg.conf_dict[&quot;nodes&quot;]``.</span>
</span><span id="TramDagModel.from_config-236"><a href="#TramDagModel.from_config-236"><span class="linenos">236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.from_config-237"><a href="#TramDagModel.from_config-237"><span class="linenos">237</span></a>        
</span><span id="TramDagModel.from_config-238"><a href="#TramDagModel.from_config-238"><span class="linenos">238</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
</span><span id="TramDagModel.from_config-239"><a href="#TramDagModel.from_config-239"><span class="linenos">239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span>
</span><span id="TramDagModel.from_config-240"><a href="#TramDagModel.from_config-240"><span class="linenos">240</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># ensure latest version from disk</span>
</span><span id="TramDagModel.from_config-241"><a href="#TramDagModel.from_config-241"><span class="linenos">241</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">_verify_completeness</span><span class="p">()</span>
</span><span id="TramDagModel.from_config-242"><a href="#TramDagModel.from_config-242"><span class="linenos">242</span></a>        
</span><span id="TramDagModel.from_config-243"><a href="#TramDagModel.from_config-243"><span class="linenos">243</span></a>        
</span><span id="TramDagModel.from_config-244"><a href="#TramDagModel.from_config-244"><span class="linenos">244</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.from_config-245"><a href="#TramDagModel.from_config-245"><span class="linenos">245</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c1"># persist back to disk</span>
</span><span id="TramDagModel.from_config-246"><a href="#TramDagModel.from_config-246"><span class="linenos">246</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel.from_config-247"><a href="#TramDagModel.from_config-247"><span class="linenos">247</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Configuration updated and saved.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-248"><a href="#TramDagModel.from_config-248"><span class="linenos">248</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel.from_config-249"><a href="#TramDagModel.from_config-249"><span class="linenos">249</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Could not save configuration after update: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>        
</span><span id="TramDagModel.from_config-250"><a href="#TramDagModel.from_config-250"><span class="linenos">250</span></a>            
</span><span id="TramDagModel.from_config-251"><a href="#TramDagModel.from_config-251"><span class="linenos">251</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span> 
</span><span id="TramDagModel.from_config-252"><a href="#TramDagModel.from_config-252"><span class="linenos">252</span></a>
</span><span id="TramDagModel.from_config-253"><a href="#TramDagModel.from_config-253"><span class="linenos">253</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">defaults_attr</span><span class="o">=</span><span class="s1">&#39;DEFAULTS_CONFIG&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;from_config&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-254"><a href="#TramDagModel.from_config-254"><span class="linenos">254</span></a>
</span><span id="TramDagModel.from_config-255"><a href="#TramDagModel.from_config-255"><span class="linenos">255</span></a>        <span class="c1"># update defaults with kwargs</span>
</span><span id="TramDagModel.from_config-256"><a href="#TramDagModel.from_config-256"><span class="linenos">256</span></a>        <span class="n">settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">DEFAULTS_CONFIG</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-257"><a href="#TramDagModel.from_config-257"><span class="linenos">257</span></a>        <span class="n">settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-258"><a href="#TramDagModel.from_config-258"><span class="linenos">258</span></a>
</span><span id="TramDagModel.from_config-259"><a href="#TramDagModel.from_config-259"><span class="linenos">259</span></a>        <span class="c1"># resolve device</span>
</span><span id="TramDagModel.from_config-260"><a href="#TramDagModel.from_config-260"><span class="linenos">260</span></a>        <span class="n">device_arg</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-261"><a href="#TramDagModel.from_config-261"><span class="linenos">261</span></a>        <span class="k">if</span> <span class="n">device_arg</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
</span><span id="TramDagModel.from_config-262"><a href="#TramDagModel.from_config-262"><span class="linenos">262</span></a>            <span class="n">device_str</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>
</span><span id="TramDagModel.from_config-263"><a href="#TramDagModel.from_config-263"><span class="linenos">263</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.from_config-264"><a href="#TramDagModel.from_config-264"><span class="linenos">264</span></a>            <span class="n">device_str</span> <span class="o">=</span> <span class="n">device_arg</span>
</span><span id="TramDagModel.from_config-265"><a href="#TramDagModel.from_config-265"><span class="linenos">265</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device_str</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-266"><a href="#TramDagModel.from_config-266"><span class="linenos">266</span></a>
</span><span id="TramDagModel.from_config-267"><a href="#TramDagModel.from_config-267"><span class="linenos">267</span></a>        <span class="c1"># set flags on the instance so they are accessible later</span>
</span><span id="TramDagModel.from_config-268"><a href="#TramDagModel.from_config-268"><span class="linenos">268</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-269"><a href="#TramDagModel.from_config-269"><span class="linenos">269</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-270"><a href="#TramDagModel.from_config-270"><span class="linenos">270</span></a>
</span><span id="TramDagModel.from_config-271"><a href="#TramDagModel.from_config-271"><span class="linenos">271</span></a>        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel.from_config-272"><a href="#TramDagModel.from_config-272"><span class="linenos">272</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] TramDagModel using device: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-273"><a href="#TramDagModel.from_config-273"><span class="linenos">273</span></a>            
</span><span id="TramDagModel.from_config-274"><a href="#TramDagModel.from_config-274"><span class="linenos">274</span></a>        <span class="c1"># initialize settings storage</span>
</span><span id="TramDagModel.from_config-275"><a href="#TramDagModel.from_config-275"><span class="linenos">275</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
</span><span id="TramDagModel.from_config-276"><a href="#TramDagModel.from_config-276"><span class="linenos">276</span></a>
</span><span id="TramDagModel.from_config-277"><a href="#TramDagModel.from_config-277"><span class="linenos">277</span></a>        <span class="c1"># validate dict-typed args</span>
</span><span id="TramDagModel.from_config-278"><a href="#TramDagModel.from_config-278"><span class="linenos">278</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagModel.from_config-279"><a href="#TramDagModel.from_config-279"><span class="linenos">279</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="TramDagModel.from_config-280"><a href="#TramDagModel.from_config-280"><span class="linenos">280</span></a>                <span class="n">expected</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel.from_config-281"><a href="#TramDagModel.from_config-281"><span class="linenos">281</span></a>                <span class="n">given</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel.from_config-282"><a href="#TramDagModel.from_config-282"><span class="linenos">282</span></a>                <span class="k">if</span> <span class="n">expected</span> <span class="o">!=</span> <span class="n">given</span><span class="p">:</span>
</span><span id="TramDagModel.from_config-283"><a href="#TramDagModel.from_config-283"><span class="linenos">283</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel.from_config-284"><a href="#TramDagModel.from_config-284"><span class="linenos">284</span></a>                        <span class="sa">f</span><span class="s2">&quot;[ERROR] the provided argument &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; keys are not same as in cfg.conf_dict[&#39;nodes&#39;].keys().</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="TramDagModel.from_config-285"><a href="#TramDagModel.from_config-285"><span class="linenos">285</span></a>                        <span class="sa">f</span><span class="s2">&quot;Expected: </span><span class="si">{</span><span class="n">expected</span><span class="si">}</span><span class="s2">, but got: </span><span class="si">{</span><span class="n">given</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="TramDagModel.from_config-286"><a href="#TramDagModel.from_config-286"><span class="linenos">286</span></a>                        <span class="sa">f</span><span class="s2">&quot;Please provide values for all variables.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-287"><a href="#TramDagModel.from_config-287"><span class="linenos">287</span></a>
</span><span id="TramDagModel.from_config-288"><a href="#TramDagModel.from_config-288"><span class="linenos">288</span></a>        <span class="c1"># build one model per node</span>
</span><span id="TramDagModel.from_config-289"><a href="#TramDagModel.from_config-289"><span class="linenos">289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel.from_config-290"><a href="#TramDagModel.from_config-290"><span class="linenos">290</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TramDagModel.from_config-291"><a href="#TramDagModel.from_config-291"><span class="linenos">291</span></a>            <span class="n">per_node_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel.from_config-292"><a href="#TramDagModel.from_config-292"><span class="linenos">292</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagModel.from_config-293"><a href="#TramDagModel.from_config-293"><span class="linenos">293</span></a>                <span class="n">resolved</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span>
</span><span id="TramDagModel.from_config-294"><a href="#TramDagModel.from_config-294"><span class="linenos">294</span></a>                <span class="n">per_node_kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">resolved</span>
</span><span id="TramDagModel.from_config-295"><a href="#TramDagModel.from_config-295"><span class="linenos">295</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">resolved</span>
</span><span id="TramDagModel.from_config-296"><a href="#TramDagModel.from_config-296"><span class="linenos">296</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel.from_config-297"><a href="#TramDagModel.from_config-297"><span class="linenos">297</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[INFO] Building model for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; with settings: </span><span class="si">{</span><span class="n">per_node_kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-298"><a href="#TramDagModel.from_config-298"><span class="linenos">298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_fully_specified_tram_model</span><span class="p">(</span>
</span><span id="TramDagModel.from_config-299"><a href="#TramDagModel.from_config-299"><span class="linenos">299</span></a>                <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
</span><span id="TramDagModel.from_config-300"><a href="#TramDagModel.from_config-300"><span class="linenos">300</span></a>                <span class="n">configuration_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">,</span>
</span><span id="TramDagModel.from_config-301"><a href="#TramDagModel.from_config-301"><span class="linenos">301</span></a>                <span class="o">**</span><span class="n">per_node_kwargs</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-302"><a href="#TramDagModel.from_config-302"><span class="linenos">302</span></a>            
</span><span id="TramDagModel.from_config-303"><a href="#TramDagModel.from_config-303"><span class="linenos">303</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.from_config-304"><a href="#TramDagModel.from_config-304"><span class="linenos">304</span></a>                <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.from_config-305"><a href="#TramDagModel.from_config-305"><span class="linenos">305</span></a>                <span class="n">NODE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-306"><a href="#TramDagModel.from_config-306"><span class="linenos">306</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-307"><a href="#TramDagModel.from_config-307"><span class="linenos">307</span></a>
</span><span id="TramDagModel.from_config-308"><a href="#TramDagModel.from_config-308"><span class="linenos">308</span></a>                <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">,</span> <span class="s2">&quot;initial_model.pt&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-309"><a href="#TramDagModel.from_config-309"><span class="linenos">309</span></a>                <span class="n">overwrite</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;overwrite_initial_weights&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-310"><a href="#TramDagModel.from_config-310"><span class="linenos">310</span></a>
</span><span id="TramDagModel.from_config-311"><a href="#TramDagModel.from_config-311"><span class="linenos">311</span></a>                <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_path</span><span class="p">):</span>
</span><span id="TramDagModel.from_config-312"><a href="#TramDagModel.from_config-312"><span class="linenos">312</span></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="n">model_path</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-313"><a href="#TramDagModel.from_config-313"><span class="linenos">313</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel.from_config-314"><a href="#TramDagModel.from_config-314"><span class="linenos">314</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Saved initial model state for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; to </span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s2"> (overwrite=</span><span class="si">{</span><span class="n">overwrite</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-315"><a href="#TramDagModel.from_config-315"><span class="linenos">315</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.from_config-316"><a href="#TramDagModel.from_config-316"><span class="linenos">316</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel.from_config-317"><a href="#TramDagModel.from_config-317"><span class="linenos">317</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Skipped saving initial model for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; (already exists at </span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-318"><a href="#TramDagModel.from_config-318"><span class="linenos">318</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel.from_config-319"><a href="#TramDagModel.from_config-319"><span class="linenos">319</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] Could not save initial model state for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-320"><a href="#TramDagModel.from_config-320"><span class="linenos">320</span></a>            
</span><span id="TramDagModel.from_config-321"><a href="#TramDagModel.from_config-321"><span class="linenos">321</span></a>            <span class="n">TEMP_DIR</span> <span class="o">=</span> <span class="s2">&quot;temp&quot;</span>
</span><span id="TramDagModel.from_config-322"><a href="#TramDagModel.from_config-322"><span class="linenos">322</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">TEMP_DIR</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">TEMP_DIR</span><span class="p">):</span>
</span><span id="TramDagModel.from_config-323"><a href="#TramDagModel.from_config-323"><span class="linenos">323</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">TEMP_DIR</span><span class="p">)</span>
</span><span id="TramDagModel.from_config-324"><a href="#TramDagModel.from_config-324"><span class="linenos">324</span></a>                            
</span><span id="TramDagModel.from_config-325"><a href="#TramDagModel.from_config-325"><span class="linenos">325</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Construct a TramDagModel from a TramDagConfig object.</p>

<p>This builds one TRAM model per node in the DAG and optionally writes
the initial model parameters to disk.</p>

<h2 id="parameters">Parameters</h2>

<p>cfg : TramDagConfig
    Configuration wrapper holding the underlying configuration dictionary,
    including at least:
    - <code>conf_dict["nodes"]</code>: mapping of node names to node configs.
    - <code>conf_dict["PATHS"]["EXPERIMENT_DIR"]</code>: experiment directory.
**kwargs
    Node-level construction options. Each key must be present in
    <code><a href="#TramDagModel.DEFAULTS_CONFIG">DEFAULTS_CONFIG</a></code>. Values can be:
    - scalar: applied to all nodes.
    - dict: mapping <code>{node_name: value}</code> for per-node overrides.</p>

<pre><code>Common keys include:
device : {"auto", "cpu", "cuda"}, default "auto"
    Device selection (CUDA if available when "auto").
debug : bool, default False
    If True, print debug messages.
verbose : bool, default False
    If True, print informational messages.
set_initial_weights : bool
    Passed to underlying TRAM model constructors.
overwrite_initial_weights : bool, default True
    If True, overwrite any existing ``initial_model.pt`` files per node.
initial_data : Any
    Optional object passed down to node constructors.
</code></pre>

<h2 id="returns">Returns</h2>

<p>TramDagModel
    Fully initialized instance with:
    - <code>cfg</code>
    - <code>nodes_dict</code>
    - <code>models</code> (per-node TRAMs)
    - <code>settings</code> (resolved per-node config)</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If any dict-valued kwarg does not provide values for exactly the set
    of nodes in <code>cfg.conf_dict["nodes"]</code>.</p>
</div>


                            </div>
                            <div id="TramDagModel.from_directory" class="classattr">
                                        <input id="TramDagModel.from_directory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_directory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">EXPERIMENT_DIR</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.from_directory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.from_directory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.from_directory-327"><a href="#TramDagModel.from_directory-327"><span class="linenos">327</span></a>    <span class="nd">@classmethod</span>
</span><span id="TramDagModel.from_directory-328"><a href="#TramDagModel.from_directory-328"><span class="linenos">328</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_directory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">EXPERIMENT_DIR</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel.from_directory-329"><a href="#TramDagModel.from_directory-329"><span class="linenos">329</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.from_directory-330"><a href="#TramDagModel.from_directory-330"><span class="linenos">330</span></a><span class="sd">        Reconstruct a TramDagModel from an experiment directory on disk.</span>
</span><span id="TramDagModel.from_directory-331"><a href="#TramDagModel.from_directory-331"><span class="linenos">331</span></a>
</span><span id="TramDagModel.from_directory-332"><a href="#TramDagModel.from_directory-332"><span class="linenos">332</span></a><span class="sd">        This method:</span>
</span><span id="TramDagModel.from_directory-333"><a href="#TramDagModel.from_directory-333"><span class="linenos">333</span></a><span class="sd">        1. Loads the configuration JSON.</span>
</span><span id="TramDagModel.from_directory-334"><a href="#TramDagModel.from_directory-334"><span class="linenos">334</span></a><span class="sd">        2. Wraps it in a TramDagConfig.</span>
</span><span id="TramDagModel.from_directory-335"><a href="#TramDagModel.from_directory-335"><span class="linenos">335</span></a><span class="sd">        3. Builds all node models via `from_config`.</span>
</span><span id="TramDagModel.from_directory-336"><a href="#TramDagModel.from_directory-336"><span class="linenos">336</span></a><span class="sd">        4. Loads the minmax scaling dictionary.</span>
</span><span id="TramDagModel.from_directory-337"><a href="#TramDagModel.from_directory-337"><span class="linenos">337</span></a>
</span><span id="TramDagModel.from_directory-338"><a href="#TramDagModel.from_directory-338"><span class="linenos">338</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.from_directory-339"><a href="#TramDagModel.from_directory-339"><span class="linenos">339</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.from_directory-340"><a href="#TramDagModel.from_directory-340"><span class="linenos">340</span></a><span class="sd">        EXPERIMENT_DIR : str</span>
</span><span id="TramDagModel.from_directory-341"><a href="#TramDagModel.from_directory-341"><span class="linenos">341</span></a><span class="sd">            Path to an experiment directory containing:</span>
</span><span id="TramDagModel.from_directory-342"><a href="#TramDagModel.from_directory-342"><span class="linenos">342</span></a><span class="sd">            - ``configuration.json``</span>
</span><span id="TramDagModel.from_directory-343"><a href="#TramDagModel.from_directory-343"><span class="linenos">343</span></a><span class="sd">            - ``min_max_scaling.json``.</span>
</span><span id="TramDagModel.from_directory-344"><a href="#TramDagModel.from_directory-344"><span class="linenos">344</span></a><span class="sd">        device : {&quot;auto&quot;, &quot;cpu&quot;, &quot;cuda&quot;}, optional</span>
</span><span id="TramDagModel.from_directory-345"><a href="#TramDagModel.from_directory-345"><span class="linenos">345</span></a><span class="sd">            Device selection. Default is &quot;auto&quot;.</span>
</span><span id="TramDagModel.from_directory-346"><a href="#TramDagModel.from_directory-346"><span class="linenos">346</span></a><span class="sd">        debug : bool, optional</span>
</span><span id="TramDagModel.from_directory-347"><a href="#TramDagModel.from_directory-347"><span class="linenos">347</span></a><span class="sd">            If True, enable debug messages. Default is False.</span>
</span><span id="TramDagModel.from_directory-348"><a href="#TramDagModel.from_directory-348"><span class="linenos">348</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="TramDagModel.from_directory-349"><a href="#TramDagModel.from_directory-349"><span class="linenos">349</span></a><span class="sd">            If True, enable informational messages. Default is False.</span>
</span><span id="TramDagModel.from_directory-350"><a href="#TramDagModel.from_directory-350"><span class="linenos">350</span></a>
</span><span id="TramDagModel.from_directory-351"><a href="#TramDagModel.from_directory-351"><span class="linenos">351</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.from_directory-352"><a href="#TramDagModel.from_directory-352"><span class="linenos">352</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.from_directory-353"><a href="#TramDagModel.from_directory-353"><span class="linenos">353</span></a><span class="sd">        TramDagModel</span>
</span><span id="TramDagModel.from_directory-354"><a href="#TramDagModel.from_directory-354"><span class="linenos">354</span></a><span class="sd">            A TramDagModel instance with models, config, and scaling loaded.</span>
</span><span id="TramDagModel.from_directory-355"><a href="#TramDagModel.from_directory-355"><span class="linenos">355</span></a>
</span><span id="TramDagModel.from_directory-356"><a href="#TramDagModel.from_directory-356"><span class="linenos">356</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel.from_directory-357"><a href="#TramDagModel.from_directory-357"><span class="linenos">357</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel.from_directory-358"><a href="#TramDagModel.from_directory-358"><span class="linenos">358</span></a><span class="sd">        FileNotFoundError</span>
</span><span id="TramDagModel.from_directory-359"><a href="#TramDagModel.from_directory-359"><span class="linenos">359</span></a><span class="sd">            If configuration or minmax files cannot be found.</span>
</span><span id="TramDagModel.from_directory-360"><a href="#TramDagModel.from_directory-360"><span class="linenos">360</span></a><span class="sd">        RuntimeError</span>
</span><span id="TramDagModel.from_directory-361"><a href="#TramDagModel.from_directory-361"><span class="linenos">361</span></a><span class="sd">            If the minmax file cannot be read or parsed.</span>
</span><span id="TramDagModel.from_directory-362"><a href="#TramDagModel.from_directory-362"><span class="linenos">362</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.from_directory-363"><a href="#TramDagModel.from_directory-363"><span class="linenos">363</span></a>
</span><span id="TramDagModel.from_directory-364"><a href="#TramDagModel.from_directory-364"><span class="linenos">364</span></a>        <span class="c1"># --- load config file ---</span>
</span><span id="TramDagModel.from_directory-365"><a href="#TramDagModel.from_directory-365"><span class="linenos">365</span></a>        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="s2">&quot;configuration.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_directory-366"><a href="#TramDagModel.from_directory-366"><span class="linenos">366</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_path</span><span class="p">):</span>
</span><span id="TramDagModel.from_directory-367"><a href="#TramDagModel.from_directory-367"><span class="linenos">367</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] Config file not found at </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_directory-368"><a href="#TramDagModel.from_directory-368"><span class="linenos">368</span></a>
</span><span id="TramDagModel.from_directory-369"><a href="#TramDagModel.from_directory-369"><span class="linenos">369</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel.from_directory-370"><a href="#TramDagModel.from_directory-370"><span class="linenos">370</span></a>            <span class="n">cfg_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TramDagModel.from_directory-371"><a href="#TramDagModel.from_directory-371"><span class="linenos">371</span></a>
</span><span id="TramDagModel.from_directory-372"><a href="#TramDagModel.from_directory-372"><span class="linenos">372</span></a>        <span class="c1"># Create TramConfig wrapper </span>
</span><span id="TramDagModel.from_directory-373"><a href="#TramDagModel.from_directory-373"><span class="linenos">373</span></a>        <span class="n">cfg</span> <span class="o">=</span> <span class="n">TramDagConfig</span><span class="p">(</span><span class="n">cfg_dict</span><span class="p">,</span> <span class="n">CONF_DICT_PATH</span><span class="o">=</span><span class="n">config_path</span><span class="p">)</span>
</span><span id="TramDagModel.from_directory-374"><a href="#TramDagModel.from_directory-374"><span class="linenos">374</span></a>
</span><span id="TramDagModel.from_directory-375"><a href="#TramDagModel.from_directory-375"><span class="linenos">375</span></a>        <span class="c1"># --- build model from config ---</span>
</span><span id="TramDagModel.from_directory-376"><a href="#TramDagModel.from_directory-376"><span class="linenos">376</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">overwrite_initial_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="TramDagModel.from_directory-377"><a href="#TramDagModel.from_directory-377"><span class="linenos">377</span></a>
</span><span id="TramDagModel.from_directory-378"><a href="#TramDagModel.from_directory-378"><span class="linenos">378</span></a>        <span class="c1"># --- load minmax scaling ---</span>
</span><span id="TramDagModel.from_directory-379"><a href="#TramDagModel.from_directory-379"><span class="linenos">379</span></a>        <span class="n">minmax_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="s2">&quot;min_max_scaling.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_directory-380"><a href="#TramDagModel.from_directory-380"><span class="linenos">380</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">minmax_path</span><span class="p">):</span>
</span><span id="TramDagModel.from_directory-381"><a href="#TramDagModel.from_directory-381"><span class="linenos">381</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] MinMax file not found at </span><span class="si">{</span><span class="n">minmax_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_directory-382"><a href="#TramDagModel.from_directory-382"><span class="linenos">382</span></a>
</span><span id="TramDagModel.from_directory-383"><a href="#TramDagModel.from_directory-383"><span class="linenos">383</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">minmax_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel.from_directory-384"><a href="#TramDagModel.from_directory-384"><span class="linenos">384</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TramDagModel.from_directory-385"><a href="#TramDagModel.from_directory-385"><span class="linenos">385</span></a>
</span><span id="TramDagModel.from_directory-386"><a href="#TramDagModel.from_directory-386"><span class="linenos">386</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel.from_directory-387"><a href="#TramDagModel.from_directory-387"><span class="linenos">387</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Loaded TramDagModel from </span><span class="si">{</span><span class="n">EXPERIMENT_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_directory-388"><a href="#TramDagModel.from_directory-388"><span class="linenos">388</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Config loaded from </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_directory-389"><a href="#TramDagModel.from_directory-389"><span class="linenos">389</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] MinMax scaling loaded from </span><span class="si">{</span><span class="n">minmax_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.from_directory-390"><a href="#TramDagModel.from_directory-390"><span class="linenos">390</span></a>
</span><span id="TramDagModel.from_directory-391"><a href="#TramDagModel.from_directory-391"><span class="linenos">391</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Reconstruct a TramDagModel from an experiment directory on disk.</p>

<p>This method:</p>

<ol>
<li>Loads the configuration JSON.</li>
<li>Wraps it in a TramDagConfig.</li>
<li>Builds all node models via <code><a href="#TramDagModel.from_config">from_config</a></code>.</li>
<li>Loads the minmax scaling dictionary.</li>
</ol>

<h2 id="parameters">Parameters</h2>

<p>EXPERIMENT_DIR : str
    Path to an experiment directory containing:
    - <code>configuration.json</code>
    - <code>min_max_scaling.json</code>.
device : {"auto", "cpu", "cuda"}, optional
    Device selection. Default is "auto".
debug : bool, optional
    If True, enable debug messages. Default is False.
verbose : bool, optional
    If True, enable informational messages. Default is False.</p>

<h2 id="returns">Returns</h2>

<p>TramDagModel
    A TramDagModel instance with models, config, and scaling loaded.</p>

<h2 id="raises">Raises</h2>

<p>FileNotFoundError
    If configuration or minmax files cannot be found.
RuntimeError
    If the minmax file cannot be read or parsed.</p>
</div>


                            </div>
                            <div id="TramDagModel.load_or_compute_minmax" class="classattr">
                                        <input id="TramDagModel.load_or_compute_minmax-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_or_compute_minmax</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">td_train_data</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">use_existing</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">write</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.load_or_compute_minmax-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.load_or_compute_minmax"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.load_or_compute_minmax-431"><a href="#TramDagModel.load_or_compute_minmax-431"><span class="linenos">431</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_or_compute_minmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">td_train_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">use_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="TramDagModel.load_or_compute_minmax-432"><a href="#TramDagModel.load_or_compute_minmax-432"><span class="linenos">432</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.load_or_compute_minmax-433"><a href="#TramDagModel.load_or_compute_minmax-433"><span class="linenos">433</span></a><span class="sd">        Load an existing MinMax scaling dictionary from disk or compute a new one </span>
</span><span id="TramDagModel.load_or_compute_minmax-434"><a href="#TramDagModel.load_or_compute_minmax-434"><span class="linenos">434</span></a><span class="sd">        from the provided training dataset.</span>
</span><span id="TramDagModel.load_or_compute_minmax-435"><a href="#TramDagModel.load_or_compute_minmax-435"><span class="linenos">435</span></a>
</span><span id="TramDagModel.load_or_compute_minmax-436"><a href="#TramDagModel.load_or_compute_minmax-436"><span class="linenos">436</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.load_or_compute_minmax-437"><a href="#TramDagModel.load_or_compute_minmax-437"><span class="linenos">437</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.load_or_compute_minmax-438"><a href="#TramDagModel.load_or_compute_minmax-438"><span class="linenos">438</span></a><span class="sd">        use_existing : bool, optional (default=False)</span>
</span><span id="TramDagModel.load_or_compute_minmax-439"><a href="#TramDagModel.load_or_compute_minmax-439"><span class="linenos">439</span></a><span class="sd">            If True, attempts to load an existing `min_max_scaling.json` file </span>
</span><span id="TramDagModel.load_or_compute_minmax-440"><a href="#TramDagModel.load_or_compute_minmax-440"><span class="linenos">440</span></a><span class="sd">            from the experiment directory. Raises an error if the file is missing </span>
</span><span id="TramDagModel.load_or_compute_minmax-441"><a href="#TramDagModel.load_or_compute_minmax-441"><span class="linenos">441</span></a><span class="sd">            or unreadable.</span>
</span><span id="TramDagModel.load_or_compute_minmax-442"><a href="#TramDagModel.load_or_compute_minmax-442"><span class="linenos">442</span></a>
</span><span id="TramDagModel.load_or_compute_minmax-443"><a href="#TramDagModel.load_or_compute_minmax-443"><span class="linenos">443</span></a><span class="sd">        write : bool, optional (default=True)</span>
</span><span id="TramDagModel.load_or_compute_minmax-444"><a href="#TramDagModel.load_or_compute_minmax-444"><span class="linenos">444</span></a><span class="sd">            If True, writes the computed MinMax scaling dictionary to </span>
</span><span id="TramDagModel.load_or_compute_minmax-445"><a href="#TramDagModel.load_or_compute_minmax-445"><span class="linenos">445</span></a><span class="sd">            `&lt;EXPERIMENT_DIR&gt;/min_max_scaling.json`.</span>
</span><span id="TramDagModel.load_or_compute_minmax-446"><a href="#TramDagModel.load_or_compute_minmax-446"><span class="linenos">446</span></a>
</span><span id="TramDagModel.load_or_compute_minmax-447"><a href="#TramDagModel.load_or_compute_minmax-447"><span class="linenos">447</span></a><span class="sd">        td_train_data : object, optional</span>
</span><span id="TramDagModel.load_or_compute_minmax-448"><a href="#TramDagModel.load_or_compute_minmax-448"><span class="linenos">448</span></a><span class="sd">            Training dataset used to compute scaling statistics. If not provided,</span>
</span><span id="TramDagModel.load_or_compute_minmax-449"><a href="#TramDagModel.load_or_compute_minmax-449"><span class="linenos">449</span></a><span class="sd">            the method will ensure or construct it via `_ensure_dataset(data=..., is_val=False)`.</span>
</span><span id="TramDagModel.load_or_compute_minmax-450"><a href="#TramDagModel.load_or_compute_minmax-450"><span class="linenos">450</span></a>
</span><span id="TramDagModel.load_or_compute_minmax-451"><a href="#TramDagModel.load_or_compute_minmax-451"><span class="linenos">451</span></a><span class="sd">        Behavior</span>
</span><span id="TramDagModel.load_or_compute_minmax-452"><a href="#TramDagModel.load_or_compute_minmax-452"><span class="linenos">452</span></a><span class="sd">        --------</span>
</span><span id="TramDagModel.load_or_compute_minmax-453"><a href="#TramDagModel.load_or_compute_minmax-453"><span class="linenos">453</span></a><span class="sd">        - If `use_existing=True`, loads the JSON file containing previously saved </span>
</span><span id="TramDagModel.load_or_compute_minmax-454"><a href="#TramDagModel.load_or_compute_minmax-454"><span class="linenos">454</span></a><span class="sd">          minmax values and stores it in `self.minmax_dict`.</span>
</span><span id="TramDagModel.load_or_compute_minmax-455"><a href="#TramDagModel.load_or_compute_minmax-455"><span class="linenos">455</span></a><span class="sd">        - If `use_existing=False`, computes a new scaling dictionary using </span>
</span><span id="TramDagModel.load_or_compute_minmax-456"><a href="#TramDagModel.load_or_compute_minmax-456"><span class="linenos">456</span></a><span class="sd">          `td_train_data.compute_scaling()` and stores the result in </span>
</span><span id="TramDagModel.load_or_compute_minmax-457"><a href="#TramDagModel.load_or_compute_minmax-457"><span class="linenos">457</span></a><span class="sd">          `self.minmax_dict`.</span>
</span><span id="TramDagModel.load_or_compute_minmax-458"><a href="#TramDagModel.load_or_compute_minmax-458"><span class="linenos">458</span></a><span class="sd">        - Optionally writes the computed dictionary to disk.</span>
</span><span id="TramDagModel.load_or_compute_minmax-459"><a href="#TramDagModel.load_or_compute_minmax-459"><span class="linenos">459</span></a>
</span><span id="TramDagModel.load_or_compute_minmax-460"><a href="#TramDagModel.load_or_compute_minmax-460"><span class="linenos">460</span></a><span class="sd">        Side Effects</span>
</span><span id="TramDagModel.load_or_compute_minmax-461"><a href="#TramDagModel.load_or_compute_minmax-461"><span class="linenos">461</span></a><span class="sd">        -------------</span>
</span><span id="TramDagModel.load_or_compute_minmax-462"><a href="#TramDagModel.load_or_compute_minmax-462"><span class="linenos">462</span></a><span class="sd">        - Populates `self.minmax_dict` with scaling values.</span>
</span><span id="TramDagModel.load_or_compute_minmax-463"><a href="#TramDagModel.load_or_compute_minmax-463"><span class="linenos">463</span></a><span class="sd">        - Writes or loads the file `min_max_scaling.json` under </span>
</span><span id="TramDagModel.load_or_compute_minmax-464"><a href="#TramDagModel.load_or_compute_minmax-464"><span class="linenos">464</span></a><span class="sd">          `&lt;EXPERIMENT_DIR&gt;`.</span>
</span><span id="TramDagModel.load_or_compute_minmax-465"><a href="#TramDagModel.load_or_compute_minmax-465"><span class="linenos">465</span></a><span class="sd">        - Prints diagnostic output if `self.debug` or `self.verbose` is True.</span>
</span><span id="TramDagModel.load_or_compute_minmax-466"><a href="#TramDagModel.load_or_compute_minmax-466"><span class="linenos">466</span></a>
</span><span id="TramDagModel.load_or_compute_minmax-467"><a href="#TramDagModel.load_or_compute_minmax-467"><span class="linenos">467</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel.load_or_compute_minmax-468"><a href="#TramDagModel.load_or_compute_minmax-468"><span class="linenos">468</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel.load_or_compute_minmax-469"><a href="#TramDagModel.load_or_compute_minmax-469"><span class="linenos">469</span></a><span class="sd">        FileNotFoundError</span>
</span><span id="TramDagModel.load_or_compute_minmax-470"><a href="#TramDagModel.load_or_compute_minmax-470"><span class="linenos">470</span></a><span class="sd">            If `use_existing=True` but the minmax file does not exist.</span>
</span><span id="TramDagModel.load_or_compute_minmax-471"><a href="#TramDagModel.load_or_compute_minmax-471"><span class="linenos">471</span></a>
</span><span id="TramDagModel.load_or_compute_minmax-472"><a href="#TramDagModel.load_or_compute_minmax-472"><span class="linenos">472</span></a><span class="sd">        RuntimeError</span>
</span><span id="TramDagModel.load_or_compute_minmax-473"><a href="#TramDagModel.load_or_compute_minmax-473"><span class="linenos">473</span></a><span class="sd">            If an existing minmax file cannot be read or parsed.</span>
</span><span id="TramDagModel.load_or_compute_minmax-474"><a href="#TramDagModel.load_or_compute_minmax-474"><span class="linenos">474</span></a>
</span><span id="TramDagModel.load_or_compute_minmax-475"><a href="#TramDagModel.load_or_compute_minmax-475"><span class="linenos">475</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.load_or_compute_minmax-476"><a href="#TramDagModel.load_or_compute_minmax-476"><span class="linenos">476</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.load_or_compute_minmax-477"><a href="#TramDagModel.load_or_compute_minmax-477"><span class="linenos">477</span></a><span class="sd">        The computed minmax dictionary is expected to contain scaling statistics </span>
</span><span id="TramDagModel.load_or_compute_minmax-478"><a href="#TramDagModel.load_or_compute_minmax-478"><span class="linenos">478</span></a><span class="sd">        per feature, typically in the form:</span>
</span><span id="TramDagModel.load_or_compute_minmax-479"><a href="#TramDagModel.load_or_compute_minmax-479"><span class="linenos">479</span></a><span class="sd">            {</span>
</span><span id="TramDagModel.load_or_compute_minmax-480"><a href="#TramDagModel.load_or_compute_minmax-480"><span class="linenos">480</span></a><span class="sd">                &quot;node&quot;: {&quot;min&quot;: float, &quot;max&quot;: float},</span>
</span><span id="TramDagModel.load_or_compute_minmax-481"><a href="#TramDagModel.load_or_compute_minmax-481"><span class="linenos">481</span></a><span class="sd">                ...</span>
</span><span id="TramDagModel.load_or_compute_minmax-482"><a href="#TramDagModel.load_or_compute_minmax-482"><span class="linenos">482</span></a><span class="sd">            }</span>
</span><span id="TramDagModel.load_or_compute_minmax-483"><a href="#TramDagModel.load_or_compute_minmax-483"><span class="linenos">483</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.load_or_compute_minmax-484"><a href="#TramDagModel.load_or_compute_minmax-484"><span class="linenos">484</span></a>        <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.load_or_compute_minmax-485"><a href="#TramDagModel.load_or_compute_minmax-485"><span class="linenos">485</span></a>        <span class="n">minmax_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="s2">&quot;min_max_scaling.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.load_or_compute_minmax-486"><a href="#TramDagModel.load_or_compute_minmax-486"><span class="linenos">486</span></a>
</span><span id="TramDagModel.load_or_compute_minmax-487"><a href="#TramDagModel.load_or_compute_minmax-487"><span class="linenos">487</span></a>        <span class="c1"># laod exisitng if possible</span>
</span><span id="TramDagModel.load_or_compute_minmax-488"><a href="#TramDagModel.load_or_compute_minmax-488"><span class="linenos">488</span></a>        <span class="k">if</span> <span class="n">use_existing</span><span class="p">:</span>
</span><span id="TramDagModel.load_or_compute_minmax-489"><a href="#TramDagModel.load_or_compute_minmax-489"><span class="linenos">489</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">minmax_path</span><span class="p">):</span>
</span><span id="TramDagModel.load_or_compute_minmax-490"><a href="#TramDagModel.load_or_compute_minmax-490"><span class="linenos">490</span></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MinMax file not found: </span><span class="si">{</span><span class="n">minmax_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.load_or_compute_minmax-491"><a href="#TramDagModel.load_or_compute_minmax-491"><span class="linenos">491</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.load_or_compute_minmax-492"><a href="#TramDagModel.load_or_compute_minmax-492"><span class="linenos">492</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">minmax_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel.load_or_compute_minmax-493"><a href="#TramDagModel.load_or_compute_minmax-493"><span class="linenos">493</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TramDagModel.load_or_compute_minmax-494"><a href="#TramDagModel.load_or_compute_minmax-494"><span class="linenos">494</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="TramDagModel.load_or_compute_minmax-495"><a href="#TramDagModel.load_or_compute_minmax-495"><span class="linenos">495</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Loaded existing minmax dict from </span><span class="si">{</span><span class="n">minmax_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.load_or_compute_minmax-496"><a href="#TramDagModel.load_or_compute_minmax-496"><span class="linenos">496</span></a>                <span class="k">return</span>
</span><span id="TramDagModel.load_or_compute_minmax-497"><a href="#TramDagModel.load_or_compute_minmax-497"><span class="linenos">497</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel.load_or_compute_minmax-498"><a href="#TramDagModel.load_or_compute_minmax-498"><span class="linenos">498</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not load existing minmax dict: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.load_or_compute_minmax-499"><a href="#TramDagModel.load_or_compute_minmax-499"><span class="linenos">499</span></a>
</span><span id="TramDagModel.load_or_compute_minmax-500"><a href="#TramDagModel.load_or_compute_minmax-500"><span class="linenos">500</span></a>        <span class="c1"># </span>
</span><span id="TramDagModel.load_or_compute_minmax-501"><a href="#TramDagModel.load_or_compute_minmax-501"><span class="linenos">501</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="TramDagModel.load_or_compute_minmax-502"><a href="#TramDagModel.load_or_compute_minmax-502"><span class="linenos">502</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[INFO] Computing new minmax dict from training data...&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.load_or_compute_minmax-503"><a href="#TramDagModel.load_or_compute_minmax-503"><span class="linenos">503</span></a>            
</span><span id="TramDagModel.load_or_compute_minmax-504"><a href="#TramDagModel.load_or_compute_minmax-504"><span class="linenos">504</span></a>        <span class="n">td_train_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ensure_dataset</span><span class="p">(</span> <span class="n">data</span><span class="o">=</span><span class="n">td_train_data</span><span class="p">,</span> <span class="n">is_val</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>    
</span><span id="TramDagModel.load_or_compute_minmax-505"><a href="#TramDagModel.load_or_compute_minmax-505"><span class="linenos">505</span></a>            
</span><span id="TramDagModel.load_or_compute_minmax-506"><a href="#TramDagModel.load_or_compute_minmax-506"><span class="linenos">506</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span> <span class="o">=</span> <span class="n">td_train_data</span><span class="o">.</span><span class="n">compute_scaling</span><span class="p">()</span>
</span><span id="TramDagModel.load_or_compute_minmax-507"><a href="#TramDagModel.load_or_compute_minmax-507"><span class="linenos">507</span></a>
</span><span id="TramDagModel.load_or_compute_minmax-508"><a href="#TramDagModel.load_or_compute_minmax-508"><span class="linenos">508</span></a>        <span class="k">if</span> <span class="n">write</span><span class="p">:</span>
</span><span id="TramDagModel.load_or_compute_minmax-509"><a href="#TramDagModel.load_or_compute_minmax-509"><span class="linenos">509</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TramDagModel.load_or_compute_minmax-510"><a href="#TramDagModel.load_or_compute_minmax-510"><span class="linenos">510</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">minmax_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel.load_or_compute_minmax-511"><a href="#TramDagModel.load_or_compute_minmax-511"><span class="linenos">511</span></a>                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="TramDagModel.load_or_compute_minmax-512"><a href="#TramDagModel.load_or_compute_minmax-512"><span class="linenos">512</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="TramDagModel.load_or_compute_minmax-513"><a href="#TramDagModel.load_or_compute_minmax-513"><span class="linenos">513</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Saved new minmax dict to </span><span class="si">{</span><span class="n">minmax_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Load an existing MinMax scaling dictionary from disk or compute a new one 
from the provided training dataset.</p>

<h2 id="parameters">Parameters</h2>

<p>use_existing : bool, optional (default=False)
    If True, attempts to load an existing <code>min_max_scaling.json</code> file 
    from the experiment directory. Raises an error if the file is missing 
    or unreadable.</p>

<p>write : bool, optional (default=True)
    If True, writes the computed MinMax scaling dictionary to 
    <code>&lt;EXPERIMENT_DIR&gt;/min_max_scaling.json</code>.</p>

<p>td_train_data : object, optional
    Training dataset used to compute scaling statistics. If not provided,
    the method will ensure or construct it via <code>_ensure_dataset(data=..., is_val=False)</code>.</p>

<h2 id="behavior">Behavior</h2>

<ul>
<li>If <code>use_existing=True</code>, loads the JSON file containing previously saved 
minmax values and stores it in <code>self.minmax_dict</code>.</li>
<li>If <code>use_existing=False</code>, computes a new scaling dictionary using 
<code>td_train_data.compute_scaling()</code> and stores the result in 
<code>self.minmax_dict</code>.</li>
<li>Optionally writes the computed dictionary to disk.</li>
</ul>

<h2 id="side-effects">Side Effects</h2>

<ul>
<li>Populates <code>self.minmax_dict</code> with scaling values.</li>
<li>Writes or loads the file <code>min_max_scaling.json</code> under 
<code>&lt;EXPERIMENT_DIR&gt;</code>.</li>
<li>Prints diagnostic output if <code>self.debug</code> or <code>self.verbose</code> is True.</li>
</ul>

<h2 id="raises">Raises</h2>

<p>FileNotFoundError
    If <code>use_existing=True</code> but the minmax file does not exist.</p>

<p>RuntimeError
    If an existing minmax file cannot be read or parsed.</p>

<h2 id="notes">Notes</h2>

<p>The computed minmax dictionary is expected to contain scaling statistics 
per feature, typically in the form:
    {
        "node": {"min": float, "max": float},
        ...
    }</p>
</div>


                            </div>
                            <div id="TramDagModel.fit" class="classattr">
                                        <input id="TramDagModel.fit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fit</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">train_data</span>, </span><span class="param"><span class="n">val_data</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.fit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.fit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.fit-614"><a href="#TramDagModel.fit-614"><span class="linenos">614</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">val_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TramDagModel.fit-615"><a href="#TramDagModel.fit-615"><span class="linenos">615</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.fit-616"><a href="#TramDagModel.fit-616"><span class="linenos">616</span></a><span class="sd">        Train TRAM models for all nodes in the DAG.</span>
</span><span id="TramDagModel.fit-617"><a href="#TramDagModel.fit-617"><span class="linenos">617</span></a>
</span><span id="TramDagModel.fit-618"><a href="#TramDagModel.fit-618"><span class="linenos">618</span></a><span class="sd">        Coordinates dataset preparation, minmax scaling, and per-node training,</span>
</span><span id="TramDagModel.fit-619"><a href="#TramDagModel.fit-619"><span class="linenos">619</span></a><span class="sd">        optionally in parallel on CPU.</span>
</span><span id="TramDagModel.fit-620"><a href="#TramDagModel.fit-620"><span class="linenos">620</span></a>
</span><span id="TramDagModel.fit-621"><a href="#TramDagModel.fit-621"><span class="linenos">621</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.fit-622"><a href="#TramDagModel.fit-622"><span class="linenos">622</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.fit-623"><a href="#TramDagModel.fit-623"><span class="linenos">623</span></a><span class="sd">        train_data : pandas.DataFrame or TramDagDataset</span>
</span><span id="TramDagModel.fit-624"><a href="#TramDagModel.fit-624"><span class="linenos">624</span></a><span class="sd">            Training data. If a DataFrame is given, it is converted into a</span>
</span><span id="TramDagModel.fit-625"><a href="#TramDagModel.fit-625"><span class="linenos">625</span></a><span class="sd">            TramDagDataset using `_ensure_dataset`.</span>
</span><span id="TramDagModel.fit-626"><a href="#TramDagModel.fit-626"><span class="linenos">626</span></a><span class="sd">        val_data : pandas.DataFrame or TramDagDataset or None, optional</span>
</span><span id="TramDagModel.fit-627"><a href="#TramDagModel.fit-627"><span class="linenos">627</span></a><span class="sd">            Validation data. If a DataFrame is given, it is converted into a</span>
</span><span id="TramDagModel.fit-628"><a href="#TramDagModel.fit-628"><span class="linenos">628</span></a><span class="sd">            TramDagDataset. If None, no validation loss is computed.</span>
</span><span id="TramDagModel.fit-629"><a href="#TramDagModel.fit-629"><span class="linenos">629</span></a><span class="sd">        **kwargs</span>
</span><span id="TramDagModel.fit-630"><a href="#TramDagModel.fit-630"><span class="linenos">630</span></a><span class="sd">            Overrides for ``DEFAULTS_FIT``. All keys must exist in</span>
</span><span id="TramDagModel.fit-631"><a href="#TramDagModel.fit-631"><span class="linenos">631</span></a><span class="sd">            ``DEFAULTS_FIT``. Common options:</span>
</span><span id="TramDagModel.fit-632"><a href="#TramDagModel.fit-632"><span class="linenos">632</span></a>
</span><span id="TramDagModel.fit-633"><a href="#TramDagModel.fit-633"><span class="linenos">633</span></a><span class="sd">            epochs : int, default 100</span>
</span><span id="TramDagModel.fit-634"><a href="#TramDagModel.fit-634"><span class="linenos">634</span></a><span class="sd">                Number of training epochs per node.</span>
</span><span id="TramDagModel.fit-635"><a href="#TramDagModel.fit-635"><span class="linenos">635</span></a><span class="sd">            learning_rate : float, default 0.01</span>
</span><span id="TramDagModel.fit-636"><a href="#TramDagModel.fit-636"><span class="linenos">636</span></a><span class="sd">                Learning rate for the default Adam optimizer.</span>
</span><span id="TramDagModel.fit-637"><a href="#TramDagModel.fit-637"><span class="linenos">637</span></a><span class="sd">            train_list : list of str or None, optional</span>
</span><span id="TramDagModel.fit-638"><a href="#TramDagModel.fit-638"><span class="linenos">638</span></a><span class="sd">                List of node names to train. If None, all nodes are trained.</span>
</span><span id="TramDagModel.fit-639"><a href="#TramDagModel.fit-639"><span class="linenos">639</span></a><span class="sd">            train_mode : {&quot;sequential&quot;, &quot;parallel&quot;}, default &quot;sequential&quot;</span>
</span><span id="TramDagModel.fit-640"><a href="#TramDagModel.fit-640"><span class="linenos">640</span></a><span class="sd">                Training mode. &quot;parallel&quot; uses joblib-based CPU multiprocessing.</span>
</span><span id="TramDagModel.fit-641"><a href="#TramDagModel.fit-641"><span class="linenos">641</span></a><span class="sd">                GPU forces sequential mode.</span>
</span><span id="TramDagModel.fit-642"><a href="#TramDagModel.fit-642"><span class="linenos">642</span></a><span class="sd">            device : {&quot;auto&quot;, &quot;cpu&quot;, &quot;cuda&quot;}, default &quot;auto&quot;</span>
</span><span id="TramDagModel.fit-643"><a href="#TramDagModel.fit-643"><span class="linenos">643</span></a><span class="sd">                Device selection.</span>
</span><span id="TramDagModel.fit-644"><a href="#TramDagModel.fit-644"><span class="linenos">644</span></a><span class="sd">            optimizers : dict or None</span>
</span><span id="TramDagModel.fit-645"><a href="#TramDagModel.fit-645"><span class="linenos">645</span></a><span class="sd">                Optional mapping ``{node_name: optimizer}``. If provided for a</span>
</span><span id="TramDagModel.fit-646"><a href="#TramDagModel.fit-646"><span class="linenos">646</span></a><span class="sd">                node, that optimizer is used instead of creating a new Adam.</span>
</span><span id="TramDagModel.fit-647"><a href="#TramDagModel.fit-647"><span class="linenos">647</span></a><span class="sd">            schedulers : dict or None</span>
</span><span id="TramDagModel.fit-648"><a href="#TramDagModel.fit-648"><span class="linenos">648</span></a><span class="sd">                Optional mapping ``{node_name: scheduler}``.</span>
</span><span id="TramDagModel.fit-649"><a href="#TramDagModel.fit-649"><span class="linenos">649</span></a><span class="sd">            use_scheduler : bool</span>
</span><span id="TramDagModel.fit-650"><a href="#TramDagModel.fit-650"><span class="linenos">650</span></a><span class="sd">                If True, enable scheduler usage in the training loop.</span>
</span><span id="TramDagModel.fit-651"><a href="#TramDagModel.fit-651"><span class="linenos">651</span></a><span class="sd">            num_workers : int</span>
</span><span id="TramDagModel.fit-652"><a href="#TramDagModel.fit-652"><span class="linenos">652</span></a><span class="sd">                DataLoader workers in sequential mode (ignored in parallel).</span>
</span><span id="TramDagModel.fit-653"><a href="#TramDagModel.fit-653"><span class="linenos">653</span></a><span class="sd">            persistent_workers : bool</span>
</span><span id="TramDagModel.fit-654"><a href="#TramDagModel.fit-654"><span class="linenos">654</span></a><span class="sd">                DataLoader persistence in sequential mode (ignored in parallel).</span>
</span><span id="TramDagModel.fit-655"><a href="#TramDagModel.fit-655"><span class="linenos">655</span></a><span class="sd">            prefetch_factor : int</span>
</span><span id="TramDagModel.fit-656"><a href="#TramDagModel.fit-656"><span class="linenos">656</span></a><span class="sd">                DataLoader prefetch factor (ignored in parallel).</span>
</span><span id="TramDagModel.fit-657"><a href="#TramDagModel.fit-657"><span class="linenos">657</span></a><span class="sd">            batch_size : int</span>
</span><span id="TramDagModel.fit-658"><a href="#TramDagModel.fit-658"><span class="linenos">658</span></a><span class="sd">                Batch size for all node DataLoaders.</span>
</span><span id="TramDagModel.fit-659"><a href="#TramDagModel.fit-659"><span class="linenos">659</span></a><span class="sd">            debug : bool</span>
</span><span id="TramDagModel.fit-660"><a href="#TramDagModel.fit-660"><span class="linenos">660</span></a><span class="sd">                Enable debug output.</span>
</span><span id="TramDagModel.fit-661"><a href="#TramDagModel.fit-661"><span class="linenos">661</span></a><span class="sd">            verbose : bool</span>
</span><span id="TramDagModel.fit-662"><a href="#TramDagModel.fit-662"><span class="linenos">662</span></a><span class="sd">                Enable informational logging.</span>
</span><span id="TramDagModel.fit-663"><a href="#TramDagModel.fit-663"><span class="linenos">663</span></a><span class="sd">            return_history : bool</span>
</span><span id="TramDagModel.fit-664"><a href="#TramDagModel.fit-664"><span class="linenos">664</span></a><span class="sd">                If True, return a history dict.</span>
</span><span id="TramDagModel.fit-665"><a href="#TramDagModel.fit-665"><span class="linenos">665</span></a>
</span><span id="TramDagModel.fit-666"><a href="#TramDagModel.fit-666"><span class="linenos">666</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.fit-667"><a href="#TramDagModel.fit-667"><span class="linenos">667</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.fit-668"><a href="#TramDagModel.fit-668"><span class="linenos">668</span></a><span class="sd">        dict or None</span>
</span><span id="TramDagModel.fit-669"><a href="#TramDagModel.fit-669"><span class="linenos">669</span></a><span class="sd">            If ``return_history=True``, a dictionary mapping each node name</span>
</span><span id="TramDagModel.fit-670"><a href="#TramDagModel.fit-670"><span class="linenos">670</span></a><span class="sd">            to its training history. Otherwise, returns None.</span>
</span><span id="TramDagModel.fit-671"><a href="#TramDagModel.fit-671"><span class="linenos">671</span></a>
</span><span id="TramDagModel.fit-672"><a href="#TramDagModel.fit-672"><span class="linenos">672</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel.fit-673"><a href="#TramDagModel.fit-673"><span class="linenos">673</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel.fit-674"><a href="#TramDagModel.fit-674"><span class="linenos">674</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel.fit-675"><a href="#TramDagModel.fit-675"><span class="linenos">675</span></a><span class="sd">            If ``train_mode`` is not &quot;sequential&quot; or &quot;parallel&quot;.</span>
</span><span id="TramDagModel.fit-676"><a href="#TramDagModel.fit-676"><span class="linenos">676</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.fit-677"><a href="#TramDagModel.fit-677"><span class="linenos">677</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">defaults_attr</span><span class="o">=</span><span class="s1">&#39;DEFAULTS_FIT&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.fit-678"><a href="#TramDagModel.fit-678"><span class="linenos">678</span></a>        
</span><span id="TramDagModel.fit-679"><a href="#TramDagModel.fit-679"><span class="linenos">679</span></a>        <span class="c1"># --- merge defaults ---</span>
</span><span id="TramDagModel.fit-680"><a href="#TramDagModel.fit-680"><span class="linenos">680</span></a>        <span class="n">settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULTS_FIT</span><span class="p">)</span>
</span><span id="TramDagModel.fit-681"><a href="#TramDagModel.fit-681"><span class="linenos">681</span></a>        <span class="n">settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TramDagModel.fit-682"><a href="#TramDagModel.fit-682"><span class="linenos">682</span></a>        
</span><span id="TramDagModel.fit-683"><a href="#TramDagModel.fit-683"><span class="linenos">683</span></a>        
</span><span id="TramDagModel.fit-684"><a href="#TramDagModel.fit-684"><span class="linenos">684</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="TramDagModel.fit-685"><a href="#TramDagModel.fit-685"><span class="linenos">685</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="TramDagModel.fit-686"><a href="#TramDagModel.fit-686"><span class="linenos">686</span></a>
</span><span id="TramDagModel.fit-687"><a href="#TramDagModel.fit-687"><span class="linenos">687</span></a>        <span class="c1"># --- resolve device ---</span>
</span><span id="TramDagModel.fit-688"><a href="#TramDagModel.fit-688"><span class="linenos">688</span></a>        <span class="n">device_str</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_device</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="TramDagModel.fit-689"><a href="#TramDagModel.fit-689"><span class="linenos">689</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device_str</span><span class="p">)</span>
</span><span id="TramDagModel.fit-690"><a href="#TramDagModel.fit-690"><span class="linenos">690</span></a>
</span><span id="TramDagModel.fit-691"><a href="#TramDagModel.fit-691"><span class="linenos">691</span></a>        <span class="c1"># --- training mode ---</span>
</span><span id="TramDagModel.fit-692"><a href="#TramDagModel.fit-692"><span class="linenos">692</span></a>        <span class="n">train_mode</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train_mode&quot;</span><span class="p">,</span> <span class="s2">&quot;sequential&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="TramDagModel.fit-693"><a href="#TramDagModel.fit-693"><span class="linenos">693</span></a>        <span class="k">if</span> <span class="n">train_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;sequential&quot;</span><span class="p">,</span> <span class="s2">&quot;parallel&quot;</span><span class="p">):</span>
</span><span id="TramDagModel.fit-694"><a href="#TramDagModel.fit-694"><span class="linenos">694</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;train_mode must be &#39;sequential&#39; or &#39;parallel&#39;&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.fit-695"><a href="#TramDagModel.fit-695"><span class="linenos">695</span></a>
</span><span id="TramDagModel.fit-696"><a href="#TramDagModel.fit-696"><span class="linenos">696</span></a>        <span class="c1"># --- DataLoader safety logic ---</span>
</span><span id="TramDagModel.fit-697"><a href="#TramDagModel.fit-697"><span class="linenos">697</span></a>        <span class="k">if</span> <span class="n">train_mode</span> <span class="o">==</span> <span class="s2">&quot;parallel&quot;</span><span class="p">:</span>
</span><span id="TramDagModel.fit-698"><a href="#TramDagModel.fit-698"><span class="linenos">698</span></a>            <span class="c1"># if user passed loader paralleling params, warn and override</span>
</span><span id="TramDagModel.fit-699"><a href="#TramDagModel.fit-699"><span class="linenos">699</span></a>            <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;num_workers&quot;</span><span class="p">,</span> <span class="s2">&quot;persistent_workers&quot;</span><span class="p">,</span> <span class="s2">&quot;prefetch_factor&quot;</span><span class="p">):</span>
</span><span id="TramDagModel.fit-700"><a href="#TramDagModel.fit-700"><span class="linenos">700</span></a>                <span class="k">if</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="TramDagModel.fit-701"><a href="#TramDagModel.fit-701"><span class="linenos">701</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] &#39;</span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s2">&#39; is ignored in parallel mode &quot;</span>
</span><span id="TramDagModel.fit-702"><a href="#TramDagModel.fit-702"><span class="linenos">702</span></a>                        <span class="sa">f</span><span class="s2">&quot;(disabled to prevent nested multiprocessing).&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.fit-703"><a href="#TramDagModel.fit-703"><span class="linenos">703</span></a>            <span class="c1"># disable unsafe loader multiprocessing options</span>
</span><span id="TramDagModel.fit-704"><a href="#TramDagModel.fit-704"><span class="linenos">704</span></a>            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;num_workers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TramDagModel.fit-705"><a href="#TramDagModel.fit-705"><span class="linenos">705</span></a>            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;persistent_workers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="TramDagModel.fit-706"><a href="#TramDagModel.fit-706"><span class="linenos">706</span></a>            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;prefetch_factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagModel.fit-707"><a href="#TramDagModel.fit-707"><span class="linenos">707</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.fit-708"><a href="#TramDagModel.fit-708"><span class="linenos">708</span></a>            <span class="c1"># sequential mode  respect user DataLoader settings</span>
</span><span id="TramDagModel.fit-709"><a href="#TramDagModel.fit-709"><span class="linenos">709</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel.fit-710"><a href="#TramDagModel.fit-710"><span class="linenos">710</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Sequential mode: using DataLoader kwargs as provided.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.fit-711"><a href="#TramDagModel.fit-711"><span class="linenos">711</span></a>
</span><span id="TramDagModel.fit-712"><a href="#TramDagModel.fit-712"><span class="linenos">712</span></a>        <span class="c1"># --- which nodes to train ---</span>
</span><span id="TramDagModel.fit-713"><a href="#TramDagModel.fit-713"><span class="linenos">713</span></a>        <span class="n">train_list</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train_list&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel.fit-714"><a href="#TramDagModel.fit-714"><span class="linenos">714</span></a>
</span><span id="TramDagModel.fit-715"><a href="#TramDagModel.fit-715"><span class="linenos">715</span></a>
</span><span id="TramDagModel.fit-716"><a href="#TramDagModel.fit-716"><span class="linenos">716</span></a>        <span class="c1"># --- dataset prep (receives adjusted settings) ---</span>
</span><span id="TramDagModel.fit-717"><a href="#TramDagModel.fit-717"><span class="linenos">717</span></a>        <span class="n">td_train_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_dataset</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">is_val</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
</span><span id="TramDagModel.fit-718"><a href="#TramDagModel.fit-718"><span class="linenos">718</span></a>        <span class="n">td_val_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_dataset</span><span class="p">(</span><span class="n">val_data</span><span class="p">,</span> <span class="n">is_val</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
</span><span id="TramDagModel.fit-719"><a href="#TramDagModel.fit-719"><span class="linenos">719</span></a>
</span><span id="TramDagModel.fit-720"><a href="#TramDagModel.fit-720"><span class="linenos">720</span></a>        <span class="c1"># --- normalization ---</span>
</span><span id="TramDagModel.fit-721"><a href="#TramDagModel.fit-721"><span class="linenos">721</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_or_compute_minmax</span><span class="p">(</span><span class="n">use_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">td_train_data</span><span class="o">=</span><span class="n">td_train_data</span><span class="p">)</span>
</span><span id="TramDagModel.fit-722"><a href="#TramDagModel.fit-722"><span class="linenos">722</span></a>
</span><span id="TramDagModel.fit-723"><a href="#TramDagModel.fit-723"><span class="linenos">723</span></a>        <span class="c1"># --- print header ---</span>
</span><span id="TramDagModel.fit-724"><a href="#TramDagModel.fit-724"><span class="linenos">724</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel.fit-725"><a href="#TramDagModel.fit-725"><span class="linenos">725</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Training </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes (</span><span class="si">{</span><span class="n">train_mode</span><span class="si">}</span><span class="s2">) on </span><span class="si">{</span><span class="n">device_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.fit-726"><a href="#TramDagModel.fit-726"><span class="linenos">726</span></a>
</span><span id="TramDagModel.fit-727"><a href="#TramDagModel.fit-727"><span class="linenos">727</span></a>        <span class="c1"># ======================================================================</span>
</span><span id="TramDagModel.fit-728"><a href="#TramDagModel.fit-728"><span class="linenos">728</span></a>        <span class="c1"># Sequential mode  safe for GPU or debugging)</span>
</span><span id="TramDagModel.fit-729"><a href="#TramDagModel.fit-729"><span class="linenos">729</span></a>        <span class="c1"># ======================================================================</span>
</span><span id="TramDagModel.fit-730"><a href="#TramDagModel.fit-730"><span class="linenos">730</span></a>        <span class="k">if</span> <span class="n">train_mode</span> <span class="o">==</span> <span class="s2">&quot;sequential&quot;</span> <span class="ow">or</span> <span class="s2">&quot;cuda&quot;</span> <span class="ow">in</span> <span class="n">device_str</span><span class="p">:</span>
</span><span id="TramDagModel.fit-731"><a href="#TramDagModel.fit-731"><span class="linenos">731</span></a>            <span class="k">if</span> <span class="s2">&quot;cuda&quot;</span> <span class="ow">in</span> <span class="n">device_str</span> <span class="ow">and</span> <span class="n">train_mode</span> <span class="o">==</span> <span class="s2">&quot;parallel&quot;</span><span class="p">:</span>
</span><span id="TramDagModel.fit-732"><a href="#TramDagModel.fit-732"><span class="linenos">732</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] GPU device detected  forcing sequential mode.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.fit-733"><a href="#TramDagModel.fit-733"><span class="linenos">733</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel.fit-734"><a href="#TramDagModel.fit-734"><span class="linenos">734</span></a>            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">train_list</span><span class="p">:</span>
</span><span id="TramDagModel.fit-735"><a href="#TramDagModel.fit-735"><span class="linenos">735</span></a>                <span class="n">node</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_single_node</span><span class="p">(</span>
</span><span id="TramDagModel.fit-736"><a href="#TramDagModel.fit-736"><span class="linenos">736</span></a>                    <span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">td_train_data</span><span class="p">,</span> <span class="n">td_val_data</span><span class="p">,</span> <span class="n">device_str</span>
</span><span id="TramDagModel.fit-737"><a href="#TramDagModel.fit-737"><span class="linenos">737</span></a>                <span class="p">)</span>
</span><span id="TramDagModel.fit-738"><a href="#TramDagModel.fit-738"><span class="linenos">738</span></a>                <span class="n">results</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">history</span>
</span><span id="TramDagModel.fit-739"><a href="#TramDagModel.fit-739"><span class="linenos">739</span></a>        
</span><span id="TramDagModel.fit-740"><a href="#TramDagModel.fit-740"><span class="linenos">740</span></a>
</span><span id="TramDagModel.fit-741"><a href="#TramDagModel.fit-741"><span class="linenos">741</span></a>        <span class="c1"># ======================================================================</span>
</span><span id="TramDagModel.fit-742"><a href="#TramDagModel.fit-742"><span class="linenos">742</span></a>        <span class="c1"># parallel mode (CPU only)</span>
</span><span id="TramDagModel.fit-743"><a href="#TramDagModel.fit-743"><span class="linenos">743</span></a>        <span class="c1"># ======================================================================</span>
</span><span id="TramDagModel.fit-744"><a href="#TramDagModel.fit-744"><span class="linenos">744</span></a>        <span class="k">if</span> <span class="n">train_mode</span> <span class="o">==</span> <span class="s2">&quot;parallel&quot;</span><span class="p">:</span>
</span><span id="TramDagModel.fit-745"><a href="#TramDagModel.fit-745"><span class="linenos">745</span></a>
</span><span id="TramDagModel.fit-746"><a href="#TramDagModel.fit-746"><span class="linenos">746</span></a>            <span class="n">n_jobs</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_list</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel.fit-747"><a href="#TramDagModel.fit-747"><span class="linenos">747</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel.fit-748"><a href="#TramDagModel.fit-748"><span class="linenos">748</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Using </span><span class="si">{</span><span class="n">n_jobs</span><span class="si">}</span><span class="s2"> CPU workers for parallel node training&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.fit-749"><a href="#TramDagModel.fit-749"><span class="linenos">749</span></a>            <span class="n">parallel_outputs</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span>
</span><span id="TramDagModel.fit-750"><a href="#TramDagModel.fit-750"><span class="linenos">750</span></a>                <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
</span><span id="TramDagModel.fit-751"><a href="#TramDagModel.fit-751"><span class="linenos">751</span></a>                <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;loky&quot;</span><span class="p">,</span><span class="c1">#loky, multiprocessing</span>
</span><span id="TramDagModel.fit-752"><a href="#TramDagModel.fit-752"><span class="linenos">752</span></a>                <span class="n">verbose</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span id="TramDagModel.fit-753"><a href="#TramDagModel.fit-753"><span class="linenos">753</span></a>                <span class="n">prefer</span><span class="o">=</span><span class="s2">&quot;processes&quot;</span>
</span><span id="TramDagModel.fit-754"><a href="#TramDagModel.fit-754"><span class="linenos">754</span></a>            <span class="p">)(</span><span class="n">delayed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_single_node</span><span class="p">)(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">td_train_data</span><span class="p">,</span> <span class="n">td_val_data</span><span class="p">,</span> <span class="n">device_str</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">train_list</span> <span class="p">)</span>
</span><span id="TramDagModel.fit-755"><a href="#TramDagModel.fit-755"><span class="linenos">755</span></a>
</span><span id="TramDagModel.fit-756"><a href="#TramDagModel.fit-756"><span class="linenos">756</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="n">hist</span> <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">hist</span> <span class="ow">in</span> <span class="n">parallel_outputs</span><span class="p">}</span>
</span><span id="TramDagModel.fit-757"><a href="#TramDagModel.fit-757"><span class="linenos">757</span></a>        
</span><span id="TramDagModel.fit-758"><a href="#TramDagModel.fit-758"><span class="linenos">758</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;return_history&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel.fit-759"><a href="#TramDagModel.fit-759"><span class="linenos">759</span></a>            <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Train TRAM models for all nodes in the DAG.</p>

<p>Coordinates dataset preparation, minmax scaling, and per-node training,
optionally in parallel on CPU.</p>

<h2 id="parameters">Parameters</h2>

<p>train_data : pandas.DataFrame or TramDagDataset
    Training data. If a DataFrame is given, it is converted into a
    TramDagDataset using <code>_ensure_dataset</code>.
val_data : pandas.DataFrame or TramDagDataset or None, optional
    Validation data. If a DataFrame is given, it is converted into a
    TramDagDataset. If None, no validation loss is computed.
**kwargs
    Overrides for <code><a href="#TramDagModel.DEFAULTS_FIT">DEFAULTS_FIT</a></code>. All keys must exist in
    <code><a href="#TramDagModel.DEFAULTS_FIT">DEFAULTS_FIT</a></code>. Common options:</p>

<pre><code>epochs : int, default 100
    Number of training epochs per node.
learning_rate : float, default 0.01
    Learning rate for the default Adam optimizer.
train_list : list of str or None, optional
    List of node names to train. If None, all nodes are trained.
train_mode : {"sequential", "parallel"}, default "sequential"
    Training mode. "parallel" uses joblib-based CPU multiprocessing.
    GPU forces sequential mode.
device : {"auto", "cpu", "cuda"}, default "auto"
    Device selection.
optimizers : dict or None
    Optional mapping ``{node_name: optimizer}``. If provided for a
    node, that optimizer is used instead of creating a new Adam.
schedulers : dict or None
    Optional mapping ``{node_name: scheduler}``.
use_scheduler : bool
    If True, enable scheduler usage in the training loop.
num_workers : int
    DataLoader workers in sequential mode (ignored in parallel).
persistent_workers : bool
    DataLoader persistence in sequential mode (ignored in parallel).
prefetch_factor : int
    DataLoader prefetch factor (ignored in parallel).
batch_size : int
    Batch size for all node DataLoaders.
debug : bool
    Enable debug output.
verbose : bool
    Enable informational logging.
return_history : bool
    If True, return a history dict.
</code></pre>

<h2 id="returns">Returns</h2>

<p>dict or None
    If <code>return_history=True</code>, a dictionary mapping each node name
    to its training history. Otherwise, returns None.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If <code>train_mode</code> is not "sequential" or "parallel".</p>
</div>


                            </div>
                            <div id="TramDagModel.loss_history" class="classattr">
                                        <input id="TramDagModel.loss_history-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">loss_history</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.loss_history-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.loss_history"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.loss_history-762"><a href="#TramDagModel.loss_history-762"><span class="linenos">762</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">loss_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagModel.loss_history-763"><a href="#TramDagModel.loss_history-763"><span class="linenos">763</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.loss_history-764"><a href="#TramDagModel.loss_history-764"><span class="linenos">764</span></a><span class="sd">        Load training and validation loss history for all nodes.</span>
</span><span id="TramDagModel.loss_history-765"><a href="#TramDagModel.loss_history-765"><span class="linenos">765</span></a>
</span><span id="TramDagModel.loss_history-766"><a href="#TramDagModel.loss_history-766"><span class="linenos">766</span></a><span class="sd">        Looks for per-node JSON files:</span>
</span><span id="TramDagModel.loss_history-767"><a href="#TramDagModel.loss_history-767"><span class="linenos">767</span></a>
</span><span id="TramDagModel.loss_history-768"><a href="#TramDagModel.loss_history-768"><span class="linenos">768</span></a><span class="sd">        - ``EXPERIMENT_DIR/{node}/train_loss_hist.json``</span>
</span><span id="TramDagModel.loss_history-769"><a href="#TramDagModel.loss_history-769"><span class="linenos">769</span></a><span class="sd">        - ``EXPERIMENT_DIR/{node}/val_loss_hist.json``</span>
</span><span id="TramDagModel.loss_history-770"><a href="#TramDagModel.loss_history-770"><span class="linenos">770</span></a>
</span><span id="TramDagModel.loss_history-771"><a href="#TramDagModel.loss_history-771"><span class="linenos">771</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.loss_history-772"><a href="#TramDagModel.loss_history-772"><span class="linenos">772</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.loss_history-773"><a href="#TramDagModel.loss_history-773"><span class="linenos">773</span></a><span class="sd">        dict</span>
</span><span id="TramDagModel.loss_history-774"><a href="#TramDagModel.loss_history-774"><span class="linenos">774</span></a><span class="sd">            A dictionary mapping node names to:</span>
</span><span id="TramDagModel.loss_history-775"><a href="#TramDagModel.loss_history-775"><span class="linenos">775</span></a>
</span><span id="TramDagModel.loss_history-776"><a href="#TramDagModel.loss_history-776"><span class="linenos">776</span></a><span class="sd">            .. code-block:: python</span>
</span><span id="TramDagModel.loss_history-777"><a href="#TramDagModel.loss_history-777"><span class="linenos">777</span></a>
</span><span id="TramDagModel.loss_history-778"><a href="#TramDagModel.loss_history-778"><span class="linenos">778</span></a><span class="sd">                {</span>
</span><span id="TramDagModel.loss_history-779"><a href="#TramDagModel.loss_history-779"><span class="linenos">779</span></a><span class="sd">                    &quot;train&quot;: list or None,</span>
</span><span id="TramDagModel.loss_history-780"><a href="#TramDagModel.loss_history-780"><span class="linenos">780</span></a><span class="sd">                    &quot;validation&quot;: list or None</span>
</span><span id="TramDagModel.loss_history-781"><a href="#TramDagModel.loss_history-781"><span class="linenos">781</span></a><span class="sd">                }</span>
</span><span id="TramDagModel.loss_history-782"><a href="#TramDagModel.loss_history-782"><span class="linenos">782</span></a>
</span><span id="TramDagModel.loss_history-783"><a href="#TramDagModel.loss_history-783"><span class="linenos">783</span></a><span class="sd">            where each list contains NLL values per epoch, or None if not found.</span>
</span><span id="TramDagModel.loss_history-784"><a href="#TramDagModel.loss_history-784"><span class="linenos">784</span></a>
</span><span id="TramDagModel.loss_history-785"><a href="#TramDagModel.loss_history-785"><span class="linenos">785</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel.loss_history-786"><a href="#TramDagModel.loss_history-786"><span class="linenos">786</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel.loss_history-787"><a href="#TramDagModel.loss_history-787"><span class="linenos">787</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel.loss_history-788"><a href="#TramDagModel.loss_history-788"><span class="linenos">788</span></a><span class="sd">            If the experiment directory cannot be resolved from the configuration.</span>
</span><span id="TramDagModel.loss_history-789"><a href="#TramDagModel.loss_history-789"><span class="linenos">789</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.loss_history-790"><a href="#TramDagModel.loss_history-790"><span class="linenos">790</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.loss_history-791"><a href="#TramDagModel.loss_history-791"><span class="linenos">791</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.loss_history-792"><a href="#TramDagModel.loss_history-792"><span class="linenos">792</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="TramDagModel.loss_history-793"><a href="#TramDagModel.loss_history-793"><span class="linenos">793</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel.loss_history-794"><a href="#TramDagModel.loss_history-794"><span class="linenos">794</span></a>                <span class="s2">&quot;[ERROR] Missing &#39;EXPERIMENT_DIR&#39; in cfg.conf_dict[&#39;PATHS&#39;]. &quot;</span>
</span><span id="TramDagModel.loss_history-795"><a href="#TramDagModel.loss_history-795"><span class="linenos">795</span></a>                <span class="s2">&quot;History retrieval requires experiment logs.&quot;</span>
</span><span id="TramDagModel.loss_history-796"><a href="#TramDagModel.loss_history-796"><span class="linenos">796</span></a>            <span class="p">)</span>
</span><span id="TramDagModel.loss_history-797"><a href="#TramDagModel.loss_history-797"><span class="linenos">797</span></a>
</span><span id="TramDagModel.loss_history-798"><a href="#TramDagModel.loss_history-798"><span class="linenos">798</span></a>        <span class="n">all_histories</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel.loss_history-799"><a href="#TramDagModel.loss_history-799"><span class="linenos">799</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TramDagModel.loss_history-800"><a href="#TramDagModel.loss_history-800"><span class="linenos">800</span></a>            <span class="n">node_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
</span><span id="TramDagModel.loss_history-801"><a href="#TramDagModel.loss_history-801"><span class="linenos">801</span></a>            <span class="n">train_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="s2">&quot;train_loss_hist.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.loss_history-802"><a href="#TramDagModel.loss_history-802"><span class="linenos">802</span></a>            <span class="n">val_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="s2">&quot;val_loss_hist.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.loss_history-803"><a href="#TramDagModel.loss_history-803"><span class="linenos">803</span></a>
</span><span id="TramDagModel.loss_history-804"><a href="#TramDagModel.loss_history-804"><span class="linenos">804</span></a>            <span class="n">node_hist</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel.loss_history-805"><a href="#TramDagModel.loss_history-805"><span class="linenos">805</span></a>
</span><span id="TramDagModel.loss_history-806"><a href="#TramDagModel.loss_history-806"><span class="linenos">806</span></a>            <span class="c1"># --- load train history ---</span>
</span><span id="TramDagModel.loss_history-807"><a href="#TramDagModel.loss_history-807"><span class="linenos">807</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">train_path</span><span class="p">):</span>
</span><span id="TramDagModel.loss_history-808"><a href="#TramDagModel.loss_history-808"><span class="linenos">808</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.loss_history-809"><a href="#TramDagModel.loss_history-809"><span class="linenos">809</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">train_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel.loss_history-810"><a href="#TramDagModel.loss_history-810"><span class="linenos">810</span></a>                        <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TramDagModel.loss_history-811"><a href="#TramDagModel.loss_history-811"><span class="linenos">811</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel.loss_history-812"><a href="#TramDagModel.loss_history-812"><span class="linenos">812</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Could not load </span><span class="si">{</span><span class="n">train_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.loss_history-813"><a href="#TramDagModel.loss_history-813"><span class="linenos">813</span></a>                    <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagModel.loss_history-814"><a href="#TramDagModel.loss_history-814"><span class="linenos">814</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.loss_history-815"><a href="#TramDagModel.loss_history-815"><span class="linenos">815</span></a>                <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagModel.loss_history-816"><a href="#TramDagModel.loss_history-816"><span class="linenos">816</span></a>
</span><span id="TramDagModel.loss_history-817"><a href="#TramDagModel.loss_history-817"><span class="linenos">817</span></a>            <span class="c1"># --- load val history ---</span>
</span><span id="TramDagModel.loss_history-818"><a href="#TramDagModel.loss_history-818"><span class="linenos">818</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">val_path</span><span class="p">):</span>
</span><span id="TramDagModel.loss_history-819"><a href="#TramDagModel.loss_history-819"><span class="linenos">819</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.loss_history-820"><a href="#TramDagModel.loss_history-820"><span class="linenos">820</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">val_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel.loss_history-821"><a href="#TramDagModel.loss_history-821"><span class="linenos">821</span></a>                        <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;validation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TramDagModel.loss_history-822"><a href="#TramDagModel.loss_history-822"><span class="linenos">822</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel.loss_history-823"><a href="#TramDagModel.loss_history-823"><span class="linenos">823</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Could not load </span><span class="si">{</span><span class="n">val_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.loss_history-824"><a href="#TramDagModel.loss_history-824"><span class="linenos">824</span></a>                    <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;validation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagModel.loss_history-825"><a href="#TramDagModel.loss_history-825"><span class="linenos">825</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.loss_history-826"><a href="#TramDagModel.loss_history-826"><span class="linenos">826</span></a>                <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;validation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagModel.loss_history-827"><a href="#TramDagModel.loss_history-827"><span class="linenos">827</span></a>
</span><span id="TramDagModel.loss_history-828"><a href="#TramDagModel.loss_history-828"><span class="linenos">828</span></a>            <span class="n">all_histories</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_hist</span>
</span><span id="TramDagModel.loss_history-829"><a href="#TramDagModel.loss_history-829"><span class="linenos">829</span></a>
</span><span id="TramDagModel.loss_history-830"><a href="#TramDagModel.loss_history-830"><span class="linenos">830</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel.loss_history-831"><a href="#TramDagModel.loss_history-831"><span class="linenos">831</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Loaded training/validation histories for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_histories</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.loss_history-832"><a href="#TramDagModel.loss_history-832"><span class="linenos">832</span></a>
</span><span id="TramDagModel.loss_history-833"><a href="#TramDagModel.loss_history-833"><span class="linenos">833</span></a>        <span class="k">return</span> <span class="n">all_histories</span>
</span></pre></div>


            <div class="docstring"><p>Load training and validation loss history for all nodes.</p>

<p>Looks for per-node JSON files:</p>

<ul>
<li><code>EXPERIMENT_DIR/{node}/train_loss_hist.json</code></li>
<li><code>EXPERIMENT_DIR/{node}/val_loss_hist.json</code></li>
</ul>

<h2 id="returns">Returns</h2>

<p>dict
    A dictionary mapping node names to:</p>

<pre><code>```python
</code></pre>

<p>{
    "train": list or None,
    "validation": list or None
}
```</p>

<pre><code>where each list contains NLL values per epoch, or None if not found.
</code></pre>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the experiment directory cannot be resolved from the configuration.</p>
</div>


                            </div>
                            <div id="TramDagModel.linear_shift_history" class="classattr">
                                        <input id="TramDagModel.linear_shift_history-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">linear_shift_history</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.linear_shift_history-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.linear_shift_history"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.linear_shift_history-835"><a href="#TramDagModel.linear_shift_history-835"><span class="linenos">835</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">linear_shift_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagModel.linear_shift_history-836"><a href="#TramDagModel.linear_shift_history-836"><span class="linenos">836</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.linear_shift_history-837"><a href="#TramDagModel.linear_shift_history-837"><span class="linenos">837</span></a><span class="sd">        Load linear shift term histories for all nodes.</span>
</span><span id="TramDagModel.linear_shift_history-838"><a href="#TramDagModel.linear_shift_history-838"><span class="linenos">838</span></a>
</span><span id="TramDagModel.linear_shift_history-839"><a href="#TramDagModel.linear_shift_history-839"><span class="linenos">839</span></a><span class="sd">        Each node history is expected in a JSON file named</span>
</span><span id="TramDagModel.linear_shift_history-840"><a href="#TramDagModel.linear_shift_history-840"><span class="linenos">840</span></a><span class="sd">        ``linear_shifts_all_epochs.json`` under the node directory.</span>
</span><span id="TramDagModel.linear_shift_history-841"><a href="#TramDagModel.linear_shift_history-841"><span class="linenos">841</span></a>
</span><span id="TramDagModel.linear_shift_history-842"><a href="#TramDagModel.linear_shift_history-842"><span class="linenos">842</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.linear_shift_history-843"><a href="#TramDagModel.linear_shift_history-843"><span class="linenos">843</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.linear_shift_history-844"><a href="#TramDagModel.linear_shift_history-844"><span class="linenos">844</span></a><span class="sd">        dict</span>
</span><span id="TramDagModel.linear_shift_history-845"><a href="#TramDagModel.linear_shift_history-845"><span class="linenos">845</span></a><span class="sd">            A mapping ``{node_name: pandas.DataFrame}``, where each DataFrame</span>
</span><span id="TramDagModel.linear_shift_history-846"><a href="#TramDagModel.linear_shift_history-846"><span class="linenos">846</span></a><span class="sd">            contains linear shift weights across epochs.</span>
</span><span id="TramDagModel.linear_shift_history-847"><a href="#TramDagModel.linear_shift_history-847"><span class="linenos">847</span></a>
</span><span id="TramDagModel.linear_shift_history-848"><a href="#TramDagModel.linear_shift_history-848"><span class="linenos">848</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel.linear_shift_history-849"><a href="#TramDagModel.linear_shift_history-849"><span class="linenos">849</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel.linear_shift_history-850"><a href="#TramDagModel.linear_shift_history-850"><span class="linenos">850</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel.linear_shift_history-851"><a href="#TramDagModel.linear_shift_history-851"><span class="linenos">851</span></a><span class="sd">            If the experiment directory cannot be resolved from the configuration.</span>
</span><span id="TramDagModel.linear_shift_history-852"><a href="#TramDagModel.linear_shift_history-852"><span class="linenos">852</span></a>
</span><span id="TramDagModel.linear_shift_history-853"><a href="#TramDagModel.linear_shift_history-853"><span class="linenos">853</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.linear_shift_history-854"><a href="#TramDagModel.linear_shift_history-854"><span class="linenos">854</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.linear_shift_history-855"><a href="#TramDagModel.linear_shift_history-855"><span class="linenos">855</span></a><span class="sd">        If a history file is missing for a node, a warning is printed and the</span>
</span><span id="TramDagModel.linear_shift_history-856"><a href="#TramDagModel.linear_shift_history-856"><span class="linenos">856</span></a><span class="sd">        node is omitted from the returned dictionary.</span>
</span><span id="TramDagModel.linear_shift_history-857"><a href="#TramDagModel.linear_shift_history-857"><span class="linenos">857</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.linear_shift_history-858"><a href="#TramDagModel.linear_shift_history-858"><span class="linenos">858</span></a>        <span class="n">histories</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel.linear_shift_history-859"><a href="#TramDagModel.linear_shift_history-859"><span class="linenos">859</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.linear_shift_history-860"><a href="#TramDagModel.linear_shift_history-860"><span class="linenos">860</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.linear_shift_history-861"><a href="#TramDagModel.linear_shift_history-861"><span class="linenos">861</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="TramDagModel.linear_shift_history-862"><a href="#TramDagModel.linear_shift_history-862"><span class="linenos">862</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel.linear_shift_history-863"><a href="#TramDagModel.linear_shift_history-863"><span class="linenos">863</span></a>                <span class="s2">&quot;[ERROR] Missing &#39;EXPERIMENT_DIR&#39; in cfg.conf_dict[&#39;PATHS&#39;]. &quot;</span>
</span><span id="TramDagModel.linear_shift_history-864"><a href="#TramDagModel.linear_shift_history-864"><span class="linenos">864</span></a>                <span class="s2">&quot;Cannot load histories without experiment directory.&quot;</span>
</span><span id="TramDagModel.linear_shift_history-865"><a href="#TramDagModel.linear_shift_history-865"><span class="linenos">865</span></a>            <span class="p">)</span>
</span><span id="TramDagModel.linear_shift_history-866"><a href="#TramDagModel.linear_shift_history-866"><span class="linenos">866</span></a>
</span><span id="TramDagModel.linear_shift_history-867"><a href="#TramDagModel.linear_shift_history-867"><span class="linenos">867</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TramDagModel.linear_shift_history-868"><a href="#TramDagModel.linear_shift_history-868"><span class="linenos">868</span></a>            <span class="n">node_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
</span><span id="TramDagModel.linear_shift_history-869"><a href="#TramDagModel.linear_shift_history-869"><span class="linenos">869</span></a>            <span class="n">history_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="s2">&quot;linear_shifts_all_epochs.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.linear_shift_history-870"><a href="#TramDagModel.linear_shift_history-870"><span class="linenos">870</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">history_path</span><span class="p">):</span>
</span><span id="TramDagModel.linear_shift_history-871"><a href="#TramDagModel.linear_shift_history-871"><span class="linenos">871</span></a>                <span class="n">histories</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">history_path</span><span class="p">)</span>
</span><span id="TramDagModel.linear_shift_history-872"><a href="#TramDagModel.linear_shift_history-872"><span class="linenos">872</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.linear_shift_history-873"><a href="#TramDagModel.linear_shift_history-873"><span class="linenos">873</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] No linear shift history found for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; at </span><span class="si">{</span><span class="n">history_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.linear_shift_history-874"><a href="#TramDagModel.linear_shift_history-874"><span class="linenos">874</span></a>        <span class="k">return</span> <span class="n">histories</span>
</span></pre></div>


            <div class="docstring"><p>Load linear shift term histories for all nodes.</p>

<p>Each node history is expected in a JSON file named
<code>linear_shifts_all_epochs.json</code> under the node directory.</p>

<h2 id="returns">Returns</h2>

<p>dict
    A mapping <code>{node_name: pandas.DataFrame}</code>, where each DataFrame
    contains linear shift weights across epochs.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the experiment directory cannot be resolved from the configuration.</p>

<h2 id="notes">Notes</h2>

<p>If a history file is missing for a node, a warning is printed and the
node is omitted from the returned dictionary.</p>
</div>


                            </div>
                            <div id="TramDagModel.simple_intercept_history" class="classattr">
                                        <input id="TramDagModel.simple_intercept_history-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">simple_intercept_history</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.simple_intercept_history-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.simple_intercept_history"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.simple_intercept_history-876"><a href="#TramDagModel.simple_intercept_history-876"><span class="linenos">876</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">simple_intercept_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagModel.simple_intercept_history-877"><a href="#TramDagModel.simple_intercept_history-877"><span class="linenos">877</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.simple_intercept_history-878"><a href="#TramDagModel.simple_intercept_history-878"><span class="linenos">878</span></a><span class="sd">        Load simple intercept histories for all nodes.</span>
</span><span id="TramDagModel.simple_intercept_history-879"><a href="#TramDagModel.simple_intercept_history-879"><span class="linenos">879</span></a>
</span><span id="TramDagModel.simple_intercept_history-880"><a href="#TramDagModel.simple_intercept_history-880"><span class="linenos">880</span></a><span class="sd">        Each node history is expected in a JSON file named</span>
</span><span id="TramDagModel.simple_intercept_history-881"><a href="#TramDagModel.simple_intercept_history-881"><span class="linenos">881</span></a><span class="sd">        ``simple_intercepts_all_epochs.json`` under the node directory.</span>
</span><span id="TramDagModel.simple_intercept_history-882"><a href="#TramDagModel.simple_intercept_history-882"><span class="linenos">882</span></a>
</span><span id="TramDagModel.simple_intercept_history-883"><a href="#TramDagModel.simple_intercept_history-883"><span class="linenos">883</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.simple_intercept_history-884"><a href="#TramDagModel.simple_intercept_history-884"><span class="linenos">884</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.simple_intercept_history-885"><a href="#TramDagModel.simple_intercept_history-885"><span class="linenos">885</span></a><span class="sd">        dict</span>
</span><span id="TramDagModel.simple_intercept_history-886"><a href="#TramDagModel.simple_intercept_history-886"><span class="linenos">886</span></a><span class="sd">            A mapping ``{node_name: pandas.DataFrame}``, where each DataFrame</span>
</span><span id="TramDagModel.simple_intercept_history-887"><a href="#TramDagModel.simple_intercept_history-887"><span class="linenos">887</span></a><span class="sd">            contains intercept weights across epochs.</span>
</span><span id="TramDagModel.simple_intercept_history-888"><a href="#TramDagModel.simple_intercept_history-888"><span class="linenos">888</span></a>
</span><span id="TramDagModel.simple_intercept_history-889"><a href="#TramDagModel.simple_intercept_history-889"><span class="linenos">889</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel.simple_intercept_history-890"><a href="#TramDagModel.simple_intercept_history-890"><span class="linenos">890</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel.simple_intercept_history-891"><a href="#TramDagModel.simple_intercept_history-891"><span class="linenos">891</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel.simple_intercept_history-892"><a href="#TramDagModel.simple_intercept_history-892"><span class="linenos">892</span></a><span class="sd">            If the experiment directory cannot be resolved from the configuration.</span>
</span><span id="TramDagModel.simple_intercept_history-893"><a href="#TramDagModel.simple_intercept_history-893"><span class="linenos">893</span></a>
</span><span id="TramDagModel.simple_intercept_history-894"><a href="#TramDagModel.simple_intercept_history-894"><span class="linenos">894</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.simple_intercept_history-895"><a href="#TramDagModel.simple_intercept_history-895"><span class="linenos">895</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.simple_intercept_history-896"><a href="#TramDagModel.simple_intercept_history-896"><span class="linenos">896</span></a><span class="sd">        If a history file is missing for a node, a warning is printed and the</span>
</span><span id="TramDagModel.simple_intercept_history-897"><a href="#TramDagModel.simple_intercept_history-897"><span class="linenos">897</span></a><span class="sd">        node is omitted from the returned dictionary.</span>
</span><span id="TramDagModel.simple_intercept_history-898"><a href="#TramDagModel.simple_intercept_history-898"><span class="linenos">898</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.simple_intercept_history-899"><a href="#TramDagModel.simple_intercept_history-899"><span class="linenos">899</span></a>        <span class="n">histories</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel.simple_intercept_history-900"><a href="#TramDagModel.simple_intercept_history-900"><span class="linenos">900</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.simple_intercept_history-901"><a href="#TramDagModel.simple_intercept_history-901"><span class="linenos">901</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.simple_intercept_history-902"><a href="#TramDagModel.simple_intercept_history-902"><span class="linenos">902</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="TramDagModel.simple_intercept_history-903"><a href="#TramDagModel.simple_intercept_history-903"><span class="linenos">903</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel.simple_intercept_history-904"><a href="#TramDagModel.simple_intercept_history-904"><span class="linenos">904</span></a>                <span class="s2">&quot;[ERROR] Missing &#39;EXPERIMENT_DIR&#39; in cfg.conf_dict[&#39;PATHS&#39;]. &quot;</span>
</span><span id="TramDagModel.simple_intercept_history-905"><a href="#TramDagModel.simple_intercept_history-905"><span class="linenos">905</span></a>                <span class="s2">&quot;Cannot load histories without experiment directory.&quot;</span>
</span><span id="TramDagModel.simple_intercept_history-906"><a href="#TramDagModel.simple_intercept_history-906"><span class="linenos">906</span></a>            <span class="p">)</span>
</span><span id="TramDagModel.simple_intercept_history-907"><a href="#TramDagModel.simple_intercept_history-907"><span class="linenos">907</span></a>
</span><span id="TramDagModel.simple_intercept_history-908"><a href="#TramDagModel.simple_intercept_history-908"><span class="linenos">908</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TramDagModel.simple_intercept_history-909"><a href="#TramDagModel.simple_intercept_history-909"><span class="linenos">909</span></a>            <span class="n">node_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
</span><span id="TramDagModel.simple_intercept_history-910"><a href="#TramDagModel.simple_intercept_history-910"><span class="linenos">910</span></a>            <span class="n">history_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="s2">&quot;simple_intercepts_all_epochs.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.simple_intercept_history-911"><a href="#TramDagModel.simple_intercept_history-911"><span class="linenos">911</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">history_path</span><span class="p">):</span>
</span><span id="TramDagModel.simple_intercept_history-912"><a href="#TramDagModel.simple_intercept_history-912"><span class="linenos">912</span></a>                <span class="n">histories</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">history_path</span><span class="p">)</span>
</span><span id="TramDagModel.simple_intercept_history-913"><a href="#TramDagModel.simple_intercept_history-913"><span class="linenos">913</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.simple_intercept_history-914"><a href="#TramDagModel.simple_intercept_history-914"><span class="linenos">914</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] No simple intercept history found for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; at </span><span class="si">{</span><span class="n">history_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.simple_intercept_history-915"><a href="#TramDagModel.simple_intercept_history-915"><span class="linenos">915</span></a>        <span class="k">return</span> <span class="n">histories</span>
</span></pre></div>


            <div class="docstring"><p>Load simple intercept histories for all nodes.</p>

<p>Each node history is expected in a JSON file named
<code>simple_intercepts_all_epochs.json</code> under the node directory.</p>

<h2 id="returns">Returns</h2>

<p>dict
    A mapping <code>{node_name: pandas.DataFrame}</code>, where each DataFrame
    contains intercept weights across epochs.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the experiment directory cannot be resolved from the configuration.</p>

<h2 id="notes">Notes</h2>

<p>If a history file is missing for a node, a warning is printed and the
node is omitted from the returned dictionary.</p>
</div>


                            </div>
                            <div id="TramDagModel.get_latent" class="classattr">
                                        <input id="TramDagModel.get_latent-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_latent</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.get_latent-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.get_latent"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.get_latent-917"><a href="#TramDagModel.get_latent-917"><span class="linenos">917</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_latent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel.get_latent-918"><a href="#TramDagModel.get_latent-918"><span class="linenos">918</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.get_latent-919"><a href="#TramDagModel.get_latent-919"><span class="linenos">919</span></a><span class="sd">        Compute latent representations for all nodes in the DAG.</span>
</span><span id="TramDagModel.get_latent-920"><a href="#TramDagModel.get_latent-920"><span class="linenos">920</span></a>
</span><span id="TramDagModel.get_latent-921"><a href="#TramDagModel.get_latent-921"><span class="linenos">921</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.get_latent-922"><a href="#TramDagModel.get_latent-922"><span class="linenos">922</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.get_latent-923"><a href="#TramDagModel.get_latent-923"><span class="linenos">923</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="TramDagModel.get_latent-924"><a href="#TramDagModel.get_latent-924"><span class="linenos">924</span></a><span class="sd">            Input data frame with columns corresponding to nodes in the DAG.</span>
</span><span id="TramDagModel.get_latent-925"><a href="#TramDagModel.get_latent-925"><span class="linenos">925</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="TramDagModel.get_latent-926"><a href="#TramDagModel.get_latent-926"><span class="linenos">926</span></a><span class="sd">            If True, print informational messages during latent computation.</span>
</span><span id="TramDagModel.get_latent-927"><a href="#TramDagModel.get_latent-927"><span class="linenos">927</span></a><span class="sd">            Default is False.</span>
</span><span id="TramDagModel.get_latent-928"><a href="#TramDagModel.get_latent-928"><span class="linenos">928</span></a>
</span><span id="TramDagModel.get_latent-929"><a href="#TramDagModel.get_latent-929"><span class="linenos">929</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.get_latent-930"><a href="#TramDagModel.get_latent-930"><span class="linenos">930</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.get_latent-931"><a href="#TramDagModel.get_latent-931"><span class="linenos">931</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="TramDagModel.get_latent-932"><a href="#TramDagModel.get_latent-932"><span class="linenos">932</span></a><span class="sd">            DataFrame containing the original columns plus latent variables</span>
</span><span id="TramDagModel.get_latent-933"><a href="#TramDagModel.get_latent-933"><span class="linenos">933</span></a><span class="sd">            for each node (e.g. columns named ``f&quot;{node}_U&quot;``).</span>
</span><span id="TramDagModel.get_latent-934"><a href="#TramDagModel.get_latent-934"><span class="linenos">934</span></a>
</span><span id="TramDagModel.get_latent-935"><a href="#TramDagModel.get_latent-935"><span class="linenos">935</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel.get_latent-936"><a href="#TramDagModel.get_latent-936"><span class="linenos">936</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel.get_latent-937"><a href="#TramDagModel.get_latent-937"><span class="linenos">937</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel.get_latent-938"><a href="#TramDagModel.get_latent-938"><span class="linenos">938</span></a><span class="sd">            If the experiment directory is missing from the configuration or</span>
</span><span id="TramDagModel.get_latent-939"><a href="#TramDagModel.get_latent-939"><span class="linenos">939</span></a><span class="sd">            if ``self.minmax_dict`` has not been set.</span>
</span><span id="TramDagModel.get_latent-940"><a href="#TramDagModel.get_latent-940"><span class="linenos">940</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.get_latent-941"><a href="#TramDagModel.get_latent-941"><span class="linenos">941</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.get_latent-942"><a href="#TramDagModel.get_latent-942"><span class="linenos">942</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.get_latent-943"><a href="#TramDagModel.get_latent-943"><span class="linenos">943</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="TramDagModel.get_latent-944"><a href="#TramDagModel.get_latent-944"><span class="linenos">944</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel.get_latent-945"><a href="#TramDagModel.get_latent-945"><span class="linenos">945</span></a>                <span class="s2">&quot;[ERROR] Missing &#39;EXPERIMENT_DIR&#39; in cfg.conf_dict[&#39;PATHS&#39;]. &quot;</span>
</span><span id="TramDagModel.get_latent-946"><a href="#TramDagModel.get_latent-946"><span class="linenos">946</span></a>                <span class="s2">&quot;Latent extraction requires trained model checkpoints.&quot;</span>
</span><span id="TramDagModel.get_latent-947"><a href="#TramDagModel.get_latent-947"><span class="linenos">947</span></a>            <span class="p">)</span>
</span><span id="TramDagModel.get_latent-948"><a href="#TramDagModel.get_latent-948"><span class="linenos">948</span></a>
</span><span id="TramDagModel.get_latent-949"><a href="#TramDagModel.get_latent-949"><span class="linenos">949</span></a>        <span class="c1"># ensure minmax_dict is available</span>
</span><span id="TramDagModel.get_latent-950"><a href="#TramDagModel.get_latent-950"><span class="linenos">950</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;minmax_dict&quot;</span><span class="p">):</span>
</span><span id="TramDagModel.get_latent-951"><a href="#TramDagModel.get_latent-951"><span class="linenos">951</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel.get_latent-952"><a href="#TramDagModel.get_latent-952"><span class="linenos">952</span></a>                <span class="s2">&quot;[ERROR] minmax_dict not found in the TramDagModel instance. &quot;</span>
</span><span id="TramDagModel.get_latent-953"><a href="#TramDagModel.get_latent-953"><span class="linenos">953</span></a>                <span class="s2">&quot;Either call .load_or_compute_minmax(td_train_data=train_df) or .fit() first.&quot;</span>
</span><span id="TramDagModel.get_latent-954"><a href="#TramDagModel.get_latent-954"><span class="linenos">954</span></a>            <span class="p">)</span>
</span><span id="TramDagModel.get_latent-955"><a href="#TramDagModel.get_latent-955"><span class="linenos">955</span></a>
</span><span id="TramDagModel.get_latent-956"><a href="#TramDagModel.get_latent-956"><span class="linenos">956</span></a>        <span class="n">all_latents_df</span> <span class="o">=</span> <span class="n">create_latent_df_for_full_dag</span><span class="p">(</span>
</span><span id="TramDagModel.get_latent-957"><a href="#TramDagModel.get_latent-957"><span class="linenos">957</span></a>            <span class="n">configuration_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">,</span>
</span><span id="TramDagModel.get_latent-958"><a href="#TramDagModel.get_latent-958"><span class="linenos">958</span></a>            <span class="n">EXPERIMENT_DIR</span><span class="o">=</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span>
</span><span id="TramDagModel.get_latent-959"><a href="#TramDagModel.get_latent-959"><span class="linenos">959</span></a>            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
</span><span id="TramDagModel.get_latent-960"><a href="#TramDagModel.get_latent-960"><span class="linenos">960</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="TramDagModel.get_latent-961"><a href="#TramDagModel.get_latent-961"><span class="linenos">961</span></a>            <span class="n">min_max_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span><span class="p">,</span>
</span><span id="TramDagModel.get_latent-962"><a href="#TramDagModel.get_latent-962"><span class="linenos">962</span></a>        <span class="p">)</span>
</span><span id="TramDagModel.get_latent-963"><a href="#TramDagModel.get_latent-963"><span class="linenos">963</span></a>
</span><span id="TramDagModel.get_latent-964"><a href="#TramDagModel.get_latent-964"><span class="linenos">964</span></a>        <span class="k">return</span> <span class="n">all_latents_df</span>
</span></pre></div>


            <div class="docstring"><p>Compute latent representations for all nodes in the DAG.</p>

<h2 id="parameters">Parameters</h2>

<p>df : pandas.DataFrame
    Input data frame with columns corresponding to nodes in the DAG.
verbose : bool, optional
    If True, print informational messages during latent computation.
    Default is False.</p>

<h2 id="returns">Returns</h2>

<p>pandas.DataFrame
    DataFrame containing the original columns plus latent variables
    for each node (e.g. columns named <code>f"{node}_U"</code>).</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the experiment directory is missing from the configuration or
    if <code>self.minmax_dict</code> has not been set.</p>
</div>


                            </div>
                            <div id="TramDagModel.plot_loss_history" class="classattr">
                                        <input id="TramDagModel.plot_loss_history-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_loss_history</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">variable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.plot_loss_history-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.plot_loss_history"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.plot_loss_history-969"><a href="#TramDagModel.plot_loss_history-969"><span class="linenos"> 969</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_loss_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagModel.plot_loss_history-970"><a href="#TramDagModel.plot_loss_history-970"><span class="linenos"> 970</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.plot_loss_history-971"><a href="#TramDagModel.plot_loss_history-971"><span class="linenos"> 971</span></a><span class="sd">        Plot training and validation loss evolution per node.</span>
</span><span id="TramDagModel.plot_loss_history-972"><a href="#TramDagModel.plot_loss_history-972"><span class="linenos"> 972</span></a>
</span><span id="TramDagModel.plot_loss_history-973"><a href="#TramDagModel.plot_loss_history-973"><span class="linenos"> 973</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.plot_loss_history-974"><a href="#TramDagModel.plot_loss_history-974"><span class="linenos"> 974</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.plot_loss_history-975"><a href="#TramDagModel.plot_loss_history-975"><span class="linenos"> 975</span></a><span class="sd">        variable : str or None, optional</span>
</span><span id="TramDagModel.plot_loss_history-976"><a href="#TramDagModel.plot_loss_history-976"><span class="linenos"> 976</span></a><span class="sd">            If provided, plot loss history for this node only. If None, plot</span>
</span><span id="TramDagModel.plot_loss_history-977"><a href="#TramDagModel.plot_loss_history-977"><span class="linenos"> 977</span></a><span class="sd">            histories for all nodes that have both train and validation logs.</span>
</span><span id="TramDagModel.plot_loss_history-978"><a href="#TramDagModel.plot_loss_history-978"><span class="linenos"> 978</span></a>
</span><span id="TramDagModel.plot_loss_history-979"><a href="#TramDagModel.plot_loss_history-979"><span class="linenos"> 979</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.plot_loss_history-980"><a href="#TramDagModel.plot_loss_history-980"><span class="linenos"> 980</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.plot_loss_history-981"><a href="#TramDagModel.plot_loss_history-981"><span class="linenos"> 981</span></a><span class="sd">        None</span>
</span><span id="TramDagModel.plot_loss_history-982"><a href="#TramDagModel.plot_loss_history-982"><span class="linenos"> 982</span></a>
</span><span id="TramDagModel.plot_loss_history-983"><a href="#TramDagModel.plot_loss_history-983"><span class="linenos"> 983</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.plot_loss_history-984"><a href="#TramDagModel.plot_loss_history-984"><span class="linenos"> 984</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.plot_loss_history-985"><a href="#TramDagModel.plot_loss_history-985"><span class="linenos"> 985</span></a><span class="sd">        Two subplots are produced:</span>
</span><span id="TramDagModel.plot_loss_history-986"><a href="#TramDagModel.plot_loss_history-986"><span class="linenos"> 986</span></a><span class="sd">        - Full epoch history.</span>
</span><span id="TramDagModel.plot_loss_history-987"><a href="#TramDagModel.plot_loss_history-987"><span class="linenos"> 987</span></a><span class="sd">        - Last 10% of epochs (or only the last epoch if fewer than 5 epochs).</span>
</span><span id="TramDagModel.plot_loss_history-988"><a href="#TramDagModel.plot_loss_history-988"><span class="linenos"> 988</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.plot_loss_history-989"><a href="#TramDagModel.plot_loss_history-989"><span class="linenos"> 989</span></a>
</span><span id="TramDagModel.plot_loss_history-990"><a href="#TramDagModel.plot_loss_history-990"><span class="linenos"> 990</span></a>        <span class="n">histories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_history</span><span class="p">()</span>
</span><span id="TramDagModel.plot_loss_history-991"><a href="#TramDagModel.plot_loss_history-991"><span class="linenos"> 991</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">histories</span><span class="p">:</span>
</span><span id="TramDagModel.plot_loss_history-992"><a href="#TramDagModel.plot_loss_history-992"><span class="linenos"> 992</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] No loss histories found.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-993"><a href="#TramDagModel.plot_loss_history-993"><span class="linenos"> 993</span></a>            <span class="k">return</span>
</span><span id="TramDagModel.plot_loss_history-994"><a href="#TramDagModel.plot_loss_history-994"><span class="linenos"> 994</span></a>
</span><span id="TramDagModel.plot_loss_history-995"><a href="#TramDagModel.plot_loss_history-995"><span class="linenos"> 995</span></a>        <span class="c1"># Select which nodes to plot</span>
</span><span id="TramDagModel.plot_loss_history-996"><a href="#TramDagModel.plot_loss_history-996"><span class="linenos"> 996</span></a>        <span class="k">if</span> <span class="n">variable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel.plot_loss_history-997"><a href="#TramDagModel.plot_loss_history-997"><span class="linenos"> 997</span></a>            <span class="k">if</span> <span class="n">variable</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">histories</span><span class="p">:</span>
</span><span id="TramDagModel.plot_loss_history-998"><a href="#TramDagModel.plot_loss_history-998"><span class="linenos"> 998</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] Node &#39;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&#39; not found in histories.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-999"><a href="#TramDagModel.plot_loss_history-999"><span class="linenos"> 999</span></a>            <span class="n">nodes_to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">variable</span><span class="p">]</span>
</span><span id="TramDagModel.plot_loss_history-1000"><a href="#TramDagModel.plot_loss_history-1000"><span class="linenos">1000</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.plot_loss_history-1001"><a href="#TramDagModel.plot_loss_history-1001"><span class="linenos">1001</span></a>            <span class="n">nodes_to_plot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">histories</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel.plot_loss_history-1002"><a href="#TramDagModel.plot_loss_history-1002"><span class="linenos">1002</span></a>
</span><span id="TramDagModel.plot_loss_history-1003"><a href="#TramDagModel.plot_loss_history-1003"><span class="linenos">1003</span></a>        <span class="c1"># Filter out nodes with no valid history</span>
</span><span id="TramDagModel.plot_loss_history-1004"><a href="#TramDagModel.plot_loss_history-1004"><span class="linenos">1004</span></a>        <span class="n">nodes_to_plot</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="TramDagModel.plot_loss_history-1005"><a href="#TramDagModel.plot_loss_history-1005"><span class="linenos">1005</span></a>            <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes_to_plot</span>
</span><span id="TramDagModel.plot_loss_history-1006"><a href="#TramDagModel.plot_loss_history-1006"><span class="linenos">1006</span></a>            <span class="k">if</span> <span class="n">histories</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">histories</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;train&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="TramDagModel.plot_loss_history-1007"><a href="#TramDagModel.plot_loss_history-1007"><span class="linenos">1007</span></a>            <span class="ow">and</span> <span class="n">histories</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;validation&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">histories</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;validation&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="TramDagModel.plot_loss_history-1008"><a href="#TramDagModel.plot_loss_history-1008"><span class="linenos">1008</span></a>        <span class="p">]</span>
</span><span id="TramDagModel.plot_loss_history-1009"><a href="#TramDagModel.plot_loss_history-1009"><span class="linenos">1009</span></a>
</span><span id="TramDagModel.plot_loss_history-1010"><a href="#TramDagModel.plot_loss_history-1010"><span class="linenos">1010</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">nodes_to_plot</span><span class="p">:</span>
</span><span id="TramDagModel.plot_loss_history-1011"><a href="#TramDagModel.plot_loss_history-1011"><span class="linenos">1011</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] No valid histories found to plot.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1012"><a href="#TramDagModel.plot_loss_history-1012"><span class="linenos">1012</span></a>            <span class="k">return</span>
</span><span id="TramDagModel.plot_loss_history-1013"><a href="#TramDagModel.plot_loss_history-1013"><span class="linenos">1013</span></a>
</span><span id="TramDagModel.plot_loss_history-1014"><a href="#TramDagModel.plot_loss_history-1014"><span class="linenos">1014</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
</span><span id="TramDagModel.plot_loss_history-1015"><a href="#TramDagModel.plot_loss_history-1015"><span class="linenos">1015</span></a>
</span><span id="TramDagModel.plot_loss_history-1016"><a href="#TramDagModel.plot_loss_history-1016"><span class="linenos">1016</span></a>        <span class="c1"># --- Full history (top plot) ---</span>
</span><span id="TramDagModel.plot_loss_history-1017"><a href="#TramDagModel.plot_loss_history-1017"><span class="linenos">1017</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1018"><a href="#TramDagModel.plot_loss_history-1018"><span class="linenos">1018</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes_to_plot</span><span class="p">:</span>
</span><span id="TramDagModel.plot_loss_history-1019"><a href="#TramDagModel.plot_loss_history-1019"><span class="linenos">1019</span></a>            <span class="n">node_hist</span> <span class="o">=</span> <span class="n">histories</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel.plot_loss_history-1020"><a href="#TramDagModel.plot_loss_history-1020"><span class="linenos">1020</span></a>            <span class="n">train_hist</span><span class="p">,</span> <span class="n">val_hist</span> <span class="o">=</span> <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">],</span> <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;validation&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.plot_loss_history-1021"><a href="#TramDagModel.plot_loss_history-1021"><span class="linenos">1021</span></a>
</span><span id="TramDagModel.plot_loss_history-1022"><a href="#TramDagModel.plot_loss_history-1022"><span class="linenos">1022</span></a>            <span class="n">epochs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_hist</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1023"><a href="#TramDagModel.plot_loss_history-1023"><span class="linenos">1023</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">train_hist</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2"> - train&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1024"><a href="#TramDagModel.plot_loss_history-1024"><span class="linenos">1024</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">val_hist</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2"> - val&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1025"><a href="#TramDagModel.plot_loss_history-1025"><span class="linenos">1025</span></a>
</span><span id="TramDagModel.plot_loss_history-1026"><a href="#TramDagModel.plot_loss_history-1026"><span class="linenos">1026</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Training and Validation NLL - Full History&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1027"><a href="#TramDagModel.plot_loss_history-1027"><span class="linenos">1027</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1028"><a href="#TramDagModel.plot_loss_history-1028"><span class="linenos">1028</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;NLL&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1029"><a href="#TramDagModel.plot_loss_history-1029"><span class="linenos">1029</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="TramDagModel.plot_loss_history-1030"><a href="#TramDagModel.plot_loss_history-1030"><span class="linenos">1030</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1031"><a href="#TramDagModel.plot_loss_history-1031"><span class="linenos">1031</span></a>
</span><span id="TramDagModel.plot_loss_history-1032"><a href="#TramDagModel.plot_loss_history-1032"><span class="linenos">1032</span></a>        <span class="c1"># --- Last 10% of epochs (bottom plot) ---</span>
</span><span id="TramDagModel.plot_loss_history-1033"><a href="#TramDagModel.plot_loss_history-1033"><span class="linenos">1033</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1034"><a href="#TramDagModel.plot_loss_history-1034"><span class="linenos">1034</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes_to_plot</span><span class="p">:</span>
</span><span id="TramDagModel.plot_loss_history-1035"><a href="#TramDagModel.plot_loss_history-1035"><span class="linenos">1035</span></a>            <span class="n">node_hist</span> <span class="o">=</span> <span class="n">histories</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel.plot_loss_history-1036"><a href="#TramDagModel.plot_loss_history-1036"><span class="linenos">1036</span></a>            <span class="n">train_hist</span><span class="p">,</span> <span class="n">val_hist</span> <span class="o">=</span> <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">],</span> <span class="n">node_hist</span><span class="p">[</span><span class="s2">&quot;validation&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.plot_loss_history-1037"><a href="#TramDagModel.plot_loss_history-1037"><span class="linenos">1037</span></a>
</span><span id="TramDagModel.plot_loss_history-1038"><a href="#TramDagModel.plot_loss_history-1038"><span class="linenos">1038</span></a>            <span class="n">total_epochs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_hist</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1039"><a href="#TramDagModel.plot_loss_history-1039"><span class="linenos">1039</span></a>            <span class="n">start_idx</span> <span class="o">=</span> <span class="n">total_epochs</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">total_epochs</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_epochs</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1040"><a href="#TramDagModel.plot_loss_history-1040"><span class="linenos">1040</span></a>
</span><span id="TramDagModel.plot_loss_history-1041"><a href="#TramDagModel.plot_loss_history-1041"><span class="linenos">1041</span></a>            <span class="n">epochs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total_epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1042"><a href="#TramDagModel.plot_loss_history-1042"><span class="linenos">1042</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">train_hist</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2"> - train&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1043"><a href="#TramDagModel.plot_loss_history-1043"><span class="linenos">1043</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">val_hist</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2"> - val&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1044"><a href="#TramDagModel.plot_loss_history-1044"><span class="linenos">1044</span></a>
</span><span id="TramDagModel.plot_loss_history-1045"><a href="#TramDagModel.plot_loss_history-1045"><span class="linenos">1045</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Training and Validation NLL - Last 10</span><span class="si">% o</span><span class="s2">f Epochs (or Last Epoch if &lt;5)&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1046"><a href="#TramDagModel.plot_loss_history-1046"><span class="linenos">1046</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1047"><a href="#TramDagModel.plot_loss_history-1047"><span class="linenos">1047</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;NLL&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1048"><a href="#TramDagModel.plot_loss_history-1048"><span class="linenos">1048</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="TramDagModel.plot_loss_history-1049"><a href="#TramDagModel.plot_loss_history-1049"><span class="linenos">1049</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="TramDagModel.plot_loss_history-1050"><a href="#TramDagModel.plot_loss_history-1050"><span class="linenos">1050</span></a>
</span><span id="TramDagModel.plot_loss_history-1051"><a href="#TramDagModel.plot_loss_history-1051"><span class="linenos">1051</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="TramDagModel.plot_loss_history-1052"><a href="#TramDagModel.plot_loss_history-1052"><span class="linenos">1052</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Plot training and validation loss evolution per node.</p>

<h2 id="parameters">Parameters</h2>

<p>variable : str or None, optional
    If provided, plot loss history for this node only. If None, plot
    histories for all nodes that have both train and validation logs.</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="notes">Notes</h2>

<p>Two subplots are produced:</p>

<ul>
<li>Full epoch history.</li>
<li>Last 10% of epochs (or only the last epoch if fewer than 5 epochs).</li>
</ul>
</div>


                            </div>
                            <div id="TramDagModel.plot_linear_shift_history" class="classattr">
                                        <input id="TramDagModel.plot_linear_shift_history-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_linear_shift_history</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data_dict</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">node</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">ref_lines</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.plot_linear_shift_history-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.plot_linear_shift_history"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.plot_linear_shift_history-1054"><a href="#TramDagModel.plot_linear_shift_history-1054"><span class="linenos">1054</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_linear_shift_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref_lines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagModel.plot_linear_shift_history-1055"><a href="#TramDagModel.plot_linear_shift_history-1055"><span class="linenos">1055</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.plot_linear_shift_history-1056"><a href="#TramDagModel.plot_linear_shift_history-1056"><span class="linenos">1056</span></a><span class="sd">        Plot the evolution of linear shift terms over epochs.</span>
</span><span id="TramDagModel.plot_linear_shift_history-1057"><a href="#TramDagModel.plot_linear_shift_history-1057"><span class="linenos">1057</span></a>
</span><span id="TramDagModel.plot_linear_shift_history-1058"><a href="#TramDagModel.plot_linear_shift_history-1058"><span class="linenos">1058</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.plot_linear_shift_history-1059"><a href="#TramDagModel.plot_linear_shift_history-1059"><span class="linenos">1059</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.plot_linear_shift_history-1060"><a href="#TramDagModel.plot_linear_shift_history-1060"><span class="linenos">1060</span></a><span class="sd">        data_dict : dict or None, optional</span>
</span><span id="TramDagModel.plot_linear_shift_history-1061"><a href="#TramDagModel.plot_linear_shift_history-1061"><span class="linenos">1061</span></a><span class="sd">            Pre-loaded mapping ``{node_name: pandas.DataFrame}`` containing shift</span>
</span><span id="TramDagModel.plot_linear_shift_history-1062"><a href="#TramDagModel.plot_linear_shift_history-1062"><span class="linenos">1062</span></a><span class="sd">            weights across epochs. If None, `linear_shift_history()` is called.</span>
</span><span id="TramDagModel.plot_linear_shift_history-1063"><a href="#TramDagModel.plot_linear_shift_history-1063"><span class="linenos">1063</span></a><span class="sd">        node : str or None, optional</span>
</span><span id="TramDagModel.plot_linear_shift_history-1064"><a href="#TramDagModel.plot_linear_shift_history-1064"><span class="linenos">1064</span></a><span class="sd">            If provided, plot only this node. Otherwise, plot all nodes</span>
</span><span id="TramDagModel.plot_linear_shift_history-1065"><a href="#TramDagModel.plot_linear_shift_history-1065"><span class="linenos">1065</span></a><span class="sd">            present in ``data_dict``.</span>
</span><span id="TramDagModel.plot_linear_shift_history-1066"><a href="#TramDagModel.plot_linear_shift_history-1066"><span class="linenos">1066</span></a><span class="sd">        ref_lines : dict or None, optional</span>
</span><span id="TramDagModel.plot_linear_shift_history-1067"><a href="#TramDagModel.plot_linear_shift_history-1067"><span class="linenos">1067</span></a><span class="sd">            Optional mapping ``{node_name: list of float}``. For each specified</span>
</span><span id="TramDagModel.plot_linear_shift_history-1068"><a href="#TramDagModel.plot_linear_shift_history-1068"><span class="linenos">1068</span></a><span class="sd">            node, horizontal reference lines are drawn at the given values.</span>
</span><span id="TramDagModel.plot_linear_shift_history-1069"><a href="#TramDagModel.plot_linear_shift_history-1069"><span class="linenos">1069</span></a>
</span><span id="TramDagModel.plot_linear_shift_history-1070"><a href="#TramDagModel.plot_linear_shift_history-1070"><span class="linenos">1070</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.plot_linear_shift_history-1071"><a href="#TramDagModel.plot_linear_shift_history-1071"><span class="linenos">1071</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.plot_linear_shift_history-1072"><a href="#TramDagModel.plot_linear_shift_history-1072"><span class="linenos">1072</span></a><span class="sd">        None</span>
</span><span id="TramDagModel.plot_linear_shift_history-1073"><a href="#TramDagModel.plot_linear_shift_history-1073"><span class="linenos">1073</span></a>
</span><span id="TramDagModel.plot_linear_shift_history-1074"><a href="#TramDagModel.plot_linear_shift_history-1074"><span class="linenos">1074</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.plot_linear_shift_history-1075"><a href="#TramDagModel.plot_linear_shift_history-1075"><span class="linenos">1075</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.plot_linear_shift_history-1076"><a href="#TramDagModel.plot_linear_shift_history-1076"><span class="linenos">1076</span></a><span class="sd">        The function flattens nested list-like entries in the DataFrames to scalars,</span>
</span><span id="TramDagModel.plot_linear_shift_history-1077"><a href="#TramDagModel.plot_linear_shift_history-1077"><span class="linenos">1077</span></a><span class="sd">        converts epoch labels to numeric, and then draws one line per shift term.</span>
</span><span id="TramDagModel.plot_linear_shift_history-1078"><a href="#TramDagModel.plot_linear_shift_history-1078"><span class="linenos">1078</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.plot_linear_shift_history-1079"><a href="#TramDagModel.plot_linear_shift_history-1079"><span class="linenos">1079</span></a>
</span><span id="TramDagModel.plot_linear_shift_history-1080"><a href="#TramDagModel.plot_linear_shift_history-1080"><span class="linenos">1080</span></a>        <span class="k">if</span> <span class="n">data_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel.plot_linear_shift_history-1081"><a href="#TramDagModel.plot_linear_shift_history-1081"><span class="linenos">1081</span></a>            <span class="n">data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_shift_history</span><span class="p">()</span>
</span><span id="TramDagModel.plot_linear_shift_history-1082"><a href="#TramDagModel.plot_linear_shift_history-1082"><span class="linenos">1082</span></a>            <span class="k">if</span> <span class="n">data_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel.plot_linear_shift_history-1083"><a href="#TramDagModel.plot_linear_shift_history-1083"><span class="linenos">1083</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No shift history data provided or stored in the class.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_linear_shift_history-1084"><a href="#TramDagModel.plot_linear_shift_history-1084"><span class="linenos">1084</span></a>
</span><span id="TramDagModel.plot_linear_shift_history-1085"><a href="#TramDagModel.plot_linear_shift_history-1085"><span class="linenos">1085</span></a>        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="n">node</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel.plot_linear_shift_history-1086"><a href="#TramDagModel.plot_linear_shift_history-1086"><span class="linenos">1086</span></a>
</span><span id="TramDagModel.plot_linear_shift_history-1087"><a href="#TramDagModel.plot_linear_shift_history-1087"><span class="linenos">1087</span></a>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
</span><span id="TramDagModel.plot_linear_shift_history-1088"><a href="#TramDagModel.plot_linear_shift_history-1088"><span class="linenos">1088</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TramDagModel.plot_linear_shift_history-1089"><a href="#TramDagModel.plot_linear_shift_history-1089"><span class="linenos">1089</span></a>
</span><span id="TramDagModel.plot_linear_shift_history-1090"><a href="#TramDagModel.plot_linear_shift_history-1090"><span class="linenos">1090</span></a>            <span class="c1"># Flatten nested lists or list-like cells</span>
</span><span id="TramDagModel.plot_linear_shift_history-1091"><a href="#TramDagModel.plot_linear_shift_history-1091"><span class="linenos">1091</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">flatten</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="TramDagModel.plot_linear_shift_history-1092"><a href="#TramDagModel.plot_linear_shift_history-1092"><span class="linenos">1092</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="TramDagModel.plot_linear_shift_history-1093"><a href="#TramDagModel.plot_linear_shift_history-1093"><span class="linenos">1093</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TramDagModel.plot_linear_shift_history-1094"><a href="#TramDagModel.plot_linear_shift_history-1094"><span class="linenos">1094</span></a>                        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="TramDagModel.plot_linear_shift_history-1095"><a href="#TramDagModel.plot_linear_shift_history-1095"><span class="linenos">1095</span></a>                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">):</span>
</span><span id="TramDagModel.plot_linear_shift_history-1096"><a href="#TramDagModel.plot_linear_shift_history-1096"><span class="linenos">1096</span></a>                        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># average simple list</span>
</span><span id="TramDagModel.plot_linear_shift_history-1097"><a href="#TramDagModel.plot_linear_shift_history-1097"><span class="linenos">1097</span></a>                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">):</span>
</span><span id="TramDagModel.plot_linear_shift_history-1098"><a href="#TramDagModel.plot_linear_shift_history-1098"><span class="linenos">1098</span></a>                        <span class="c1"># nested list -&gt; flatten inner and average</span>
</span><span id="TramDagModel.plot_linear_shift_history-1099"><a href="#TramDagModel.plot_linear_shift_history-1099"><span class="linenos">1099</span></a>                        <span class="n">flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="n">sub</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">sub</span><span class="p">])]</span>
</span><span id="TramDagModel.plot_linear_shift_history-1100"><a href="#TramDagModel.plot_linear_shift_history-1100"><span class="linenos">1100</span></a>                        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">flat</span><span class="p">)</span> <span class="k">if</span> <span class="n">flat</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="TramDagModel.plot_linear_shift_history-1101"><a href="#TramDagModel.plot_linear_shift_history-1101"><span class="linenos">1101</span></a>                    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="TramDagModel.plot_linear_shift_history-1102"><a href="#TramDagModel.plot_linear_shift_history-1102"><span class="linenos">1102</span></a>                <span class="k">return</span> <span class="n">x</span>
</span><span id="TramDagModel.plot_linear_shift_history-1103"><a href="#TramDagModel.plot_linear_shift_history-1103"><span class="linenos">1103</span></a>
</span><span id="TramDagModel.plot_linear_shift_history-1104"><a href="#TramDagModel.plot_linear_shift_history-1104"><span class="linenos">1104</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="n">flatten</span><span class="p">)</span>
</span><span id="TramDagModel.plot_linear_shift_history-1105"><a href="#TramDagModel.plot_linear_shift_history-1105"><span class="linenos">1105</span></a>
</span><span id="TramDagModel.plot_linear_shift_history-1106"><a href="#TramDagModel.plot_linear_shift_history-1106"><span class="linenos">1106</span></a>            <span class="c1"># Ensure numeric columns</span>
</span><span id="TramDagModel.plot_linear_shift_history-1107"><a href="#TramDagModel.plot_linear_shift_history-1107"><span class="linenos">1107</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_linear_shift_history-1108"><a href="#TramDagModel.plot_linear_shift_history-1108"><span class="linenos">1108</span></a>
</span><span id="TramDagModel.plot_linear_shift_history-1109"><a href="#TramDagModel.plot_linear_shift_history-1109"><span class="linenos">1109</span></a>            <span class="c1"># Convert epoch labels to numeric</span>
</span><span id="TramDagModel.plot_linear_shift_history-1110"><a href="#TramDagModel.plot_linear_shift_history-1110"><span class="linenos">1110</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="TramDagModel.plot_linear_shift_history-1111"><a href="#TramDagModel.plot_linear_shift_history-1111"><span class="linenos">1111</span></a>                <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;epoch_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;epoch_&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">c</span>
</span><span id="TramDagModel.plot_linear_shift_history-1112"><a href="#TramDagModel.plot_linear_shift_history-1112"><span class="linenos">1112</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</span><span id="TramDagModel.plot_linear_shift_history-1113"><a href="#TramDagModel.plot_linear_shift_history-1113"><span class="linenos">1113</span></a>            <span class="p">]</span>
</span><span id="TramDagModel.plot_linear_shift_history-1114"><a href="#TramDagModel.plot_linear_shift_history-1114"><span class="linenos">1114</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel.plot_linear_shift_history-1115"><a href="#TramDagModel.plot_linear_shift_history-1115"><span class="linenos">1115</span></a>
</span><span id="TramDagModel.plot_linear_shift_history-1116"><a href="#TramDagModel.plot_linear_shift_history-1116"><span class="linenos">1116</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="TramDagModel.plot_linear_shift_history-1117"><a href="#TramDagModel.plot_linear_shift_history-1117"><span class="linenos">1117</span></a>            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="TramDagModel.plot_linear_shift_history-1118"><a href="#TramDagModel.plot_linear_shift_history-1118"><span class="linenos">1118</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;shift_</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_linear_shift_history-1119"><a href="#TramDagModel.plot_linear_shift_history-1119"><span class="linenos">1119</span></a>
</span><span id="TramDagModel.plot_linear_shift_history-1120"><a href="#TramDagModel.plot_linear_shift_history-1120"><span class="linenos">1120</span></a>            <span class="k">if</span> <span class="n">ref_lines</span> <span class="ow">and</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ref_lines</span><span class="p">:</span>
</span><span id="TramDagModel.plot_linear_shift_history-1121"><a href="#TramDagModel.plot_linear_shift_history-1121"><span class="linenos">1121</span></a>                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ref_lines</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span>
</span><span id="TramDagModel.plot_linear_shift_history-1122"><a href="#TramDagModel.plot_linear_shift_history-1122"><span class="linenos">1122</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="TramDagModel.plot_linear_shift_history-1123"><a href="#TramDagModel.plot_linear_shift_history-1123"><span class="linenos">1123</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span><span id="TramDagModel.plot_linear_shift_history-1124"><a href="#TramDagModel.plot_linear_shift_history-1124"><span class="linenos">1124</span></a>
</span><span id="TramDagModel.plot_linear_shift_history-1125"><a href="#TramDagModel.plot_linear_shift_history-1125"><span class="linenos">1125</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_linear_shift_history-1126"><a href="#TramDagModel.plot_linear_shift_history-1126"><span class="linenos">1126</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Shift Value&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_linear_shift_history-1127"><a href="#TramDagModel.plot_linear_shift_history-1127"><span class="linenos">1127</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shift Term History  Node: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_linear_shift_history-1128"><a href="#TramDagModel.plot_linear_shift_history-1128"><span class="linenos">1128</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_linear_shift_history-1129"><a href="#TramDagModel.plot_linear_shift_history-1129"><span class="linenos">1129</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="TramDagModel.plot_linear_shift_history-1130"><a href="#TramDagModel.plot_linear_shift_history-1130"><span class="linenos">1130</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Plot the evolution of linear shift terms over epochs.</p>

<h2 id="parameters">Parameters</h2>

<p>data_dict : dict or None, optional
    Pre-loaded mapping <code>{node_name: pandas.DataFrame}</code> containing shift
    weights across epochs. If None, <code><a href="#TramDagModel.linear_shift_history">linear_shift_history()</a></code> is called.
node : str or None, optional
    If provided, plot only this node. Otherwise, plot all nodes
    present in <code>data_dict</code>.
ref_lines : dict or None, optional
    Optional mapping <code>{node_name: list of float}</code>. For each specified
    node, horizontal reference lines are drawn at the given values.</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="notes">Notes</h2>

<p>The function flattens nested list-like entries in the DataFrames to scalars,
converts epoch labels to numeric, and then draws one line per shift term.</p>
</div>


                            </div>
                            <div id="TramDagModel.plot_simple_intercepts_history" class="classattr">
                                        <input id="TramDagModel.plot_simple_intercepts_history-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_simple_intercepts_history</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data_dict</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">node</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">ref_lines</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.plot_simple_intercepts_history-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.plot_simple_intercepts_history"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.plot_simple_intercepts_history-1132"><a href="#TramDagModel.plot_simple_intercepts_history-1132"><span class="linenos">1132</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_simple_intercepts_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ref_lines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1133"><a href="#TramDagModel.plot_simple_intercepts_history-1133"><span class="linenos">1133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1134"><a href="#TramDagModel.plot_simple_intercepts_history-1134"><span class="linenos">1134</span></a><span class="sd">        Plot the evolution of simple intercept weights over epochs.</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1135"><a href="#TramDagModel.plot_simple_intercepts_history-1135"><span class="linenos">1135</span></a>
</span><span id="TramDagModel.plot_simple_intercepts_history-1136"><a href="#TramDagModel.plot_simple_intercepts_history-1136"><span class="linenos">1136</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1137"><a href="#TramDagModel.plot_simple_intercepts_history-1137"><span class="linenos">1137</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1138"><a href="#TramDagModel.plot_simple_intercepts_history-1138"><span class="linenos">1138</span></a><span class="sd">        data_dict : dict or None, optional</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1139"><a href="#TramDagModel.plot_simple_intercepts_history-1139"><span class="linenos">1139</span></a><span class="sd">            Pre-loaded mapping ``{node_name: pandas.DataFrame}`` containing intercept</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1140"><a href="#TramDagModel.plot_simple_intercepts_history-1140"><span class="linenos">1140</span></a><span class="sd">            weights across epochs. If None, `simple_intercept_history()` is called.</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1141"><a href="#TramDagModel.plot_simple_intercepts_history-1141"><span class="linenos">1141</span></a><span class="sd">        node : str or None, optional</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1142"><a href="#TramDagModel.plot_simple_intercepts_history-1142"><span class="linenos">1142</span></a><span class="sd">            If provided, plot only this node. Otherwise, plot all nodes present</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1143"><a href="#TramDagModel.plot_simple_intercepts_history-1143"><span class="linenos">1143</span></a><span class="sd">            in ``data_dict``.</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1144"><a href="#TramDagModel.plot_simple_intercepts_history-1144"><span class="linenos">1144</span></a><span class="sd">        ref_lines : dict or None, optional</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1145"><a href="#TramDagModel.plot_simple_intercepts_history-1145"><span class="linenos">1145</span></a><span class="sd">            Optional mapping ``{node_name: list of float}``. For each specified</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1146"><a href="#TramDagModel.plot_simple_intercepts_history-1146"><span class="linenos">1146</span></a><span class="sd">            node, horizontal reference lines are drawn at the given values.</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1147"><a href="#TramDagModel.plot_simple_intercepts_history-1147"><span class="linenos">1147</span></a>
</span><span id="TramDagModel.plot_simple_intercepts_history-1148"><a href="#TramDagModel.plot_simple_intercepts_history-1148"><span class="linenos">1148</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1149"><a href="#TramDagModel.plot_simple_intercepts_history-1149"><span class="linenos">1149</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1150"><a href="#TramDagModel.plot_simple_intercepts_history-1150"><span class="linenos">1150</span></a><span class="sd">        None</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1151"><a href="#TramDagModel.plot_simple_intercepts_history-1151"><span class="linenos">1151</span></a>
</span><span id="TramDagModel.plot_simple_intercepts_history-1152"><a href="#TramDagModel.plot_simple_intercepts_history-1152"><span class="linenos">1152</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1153"><a href="#TramDagModel.plot_simple_intercepts_history-1153"><span class="linenos">1153</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1154"><a href="#TramDagModel.plot_simple_intercepts_history-1154"><span class="linenos">1154</span></a><span class="sd">        Nested list-like entries in the DataFrames are reduced to scalars before</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1155"><a href="#TramDagModel.plot_simple_intercepts_history-1155"><span class="linenos">1155</span></a><span class="sd">        plotting. One line is drawn per intercept parameter.</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1156"><a href="#TramDagModel.plot_simple_intercepts_history-1156"><span class="linenos">1156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1157"><a href="#TramDagModel.plot_simple_intercepts_history-1157"><span class="linenos">1157</span></a>        <span class="k">if</span> <span class="n">data_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1158"><a href="#TramDagModel.plot_simple_intercepts_history-1158"><span class="linenos">1158</span></a>            <span class="n">data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_intercept_history</span><span class="p">()</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1159"><a href="#TramDagModel.plot_simple_intercepts_history-1159"><span class="linenos">1159</span></a>            <span class="k">if</span> <span class="n">data_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1160"><a href="#TramDagModel.plot_simple_intercepts_history-1160"><span class="linenos">1160</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No intercept history data provided or stored in the class.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1161"><a href="#TramDagModel.plot_simple_intercepts_history-1161"><span class="linenos">1161</span></a>
</span><span id="TramDagModel.plot_simple_intercepts_history-1162"><a href="#TramDagModel.plot_simple_intercepts_history-1162"><span class="linenos">1162</span></a>        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="n">node</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1163"><a href="#TramDagModel.plot_simple_intercepts_history-1163"><span class="linenos">1163</span></a>
</span><span id="TramDagModel.plot_simple_intercepts_history-1164"><a href="#TramDagModel.plot_simple_intercepts_history-1164"><span class="linenos">1164</span></a>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1165"><a href="#TramDagModel.plot_simple_intercepts_history-1165"><span class="linenos">1165</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1166"><a href="#TramDagModel.plot_simple_intercepts_history-1166"><span class="linenos">1166</span></a>
</span><span id="TramDagModel.plot_simple_intercepts_history-1167"><a href="#TramDagModel.plot_simple_intercepts_history-1167"><span class="linenos">1167</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">extract_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1168"><a href="#TramDagModel.plot_simple_intercepts_history-1168"><span class="linenos">1168</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1169"><a href="#TramDagModel.plot_simple_intercepts_history-1169"><span class="linenos">1169</span></a>                    <span class="k">while</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1170"><a href="#TramDagModel.plot_simple_intercepts_history-1170"><span class="linenos">1170</span></a>                        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1171"><a href="#TramDagModel.plot_simple_intercepts_history-1171"><span class="linenos">1171</span></a>                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">))</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1172"><a href="#TramDagModel.plot_simple_intercepts_history-1172"><span class="linenos">1172</span></a>
</span><span id="TramDagModel.plot_simple_intercepts_history-1173"><a href="#TramDagModel.plot_simple_intercepts_history-1173"><span class="linenos">1173</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="n">extract_scalar</span><span class="p">)</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1174"><a href="#TramDagModel.plot_simple_intercepts_history-1174"><span class="linenos">1174</span></a>
</span><span id="TramDagModel.plot_simple_intercepts_history-1175"><a href="#TramDagModel.plot_simple_intercepts_history-1175"><span class="linenos">1175</span></a>            <span class="c1"># Convert epoch labels  numeric</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1176"><a href="#TramDagModel.plot_simple_intercepts_history-1176"><span class="linenos">1176</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1177"><a href="#TramDagModel.plot_simple_intercepts_history-1177"><span class="linenos">1177</span></a>                <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;epoch_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;epoch_&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">c</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1178"><a href="#TramDagModel.plot_simple_intercepts_history-1178"><span class="linenos">1178</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1179"><a href="#TramDagModel.plot_simple_intercepts_history-1179"><span class="linenos">1179</span></a>            <span class="p">]</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1180"><a href="#TramDagModel.plot_simple_intercepts_history-1180"><span class="linenos">1180</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1181"><a href="#TramDagModel.plot_simple_intercepts_history-1181"><span class="linenos">1181</span></a>
</span><span id="TramDagModel.plot_simple_intercepts_history-1182"><a href="#TramDagModel.plot_simple_intercepts_history-1182"><span class="linenos">1182</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1183"><a href="#TramDagModel.plot_simple_intercepts_history-1183"><span class="linenos">1183</span></a>            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1184"><a href="#TramDagModel.plot_simple_intercepts_history-1184"><span class="linenos">1184</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;theta_</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1185"><a href="#TramDagModel.plot_simple_intercepts_history-1185"><span class="linenos">1185</span></a>            
</span><span id="TramDagModel.plot_simple_intercepts_history-1186"><a href="#TramDagModel.plot_simple_intercepts_history-1186"><span class="linenos">1186</span></a>            <span class="k">if</span> <span class="n">ref_lines</span> <span class="ow">and</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ref_lines</span><span class="p">:</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1187"><a href="#TramDagModel.plot_simple_intercepts_history-1187"><span class="linenos">1187</span></a>                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ref_lines</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1188"><a href="#TramDagModel.plot_simple_intercepts_history-1188"><span class="linenos">1188</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1189"><a href="#TramDagModel.plot_simple_intercepts_history-1189"><span class="linenos">1189</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1190"><a href="#TramDagModel.plot_simple_intercepts_history-1190"><span class="linenos">1190</span></a>                
</span><span id="TramDagModel.plot_simple_intercepts_history-1191"><a href="#TramDagModel.plot_simple_intercepts_history-1191"><span class="linenos">1191</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1192"><a href="#TramDagModel.plot_simple_intercepts_history-1192"><span class="linenos">1192</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intercept Weight&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1193"><a href="#TramDagModel.plot_simple_intercepts_history-1193"><span class="linenos">1193</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simple Intercept Evolution  Node: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1194"><a href="#TramDagModel.plot_simple_intercepts_history-1194"><span class="linenos">1194</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1195"><a href="#TramDagModel.plot_simple_intercepts_history-1195"><span class="linenos">1195</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="TramDagModel.plot_simple_intercepts_history-1196"><a href="#TramDagModel.plot_simple_intercepts_history-1196"><span class="linenos">1196</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Plot the evolution of simple intercept weights over epochs.</p>

<h2 id="parameters">Parameters</h2>

<p>data_dict : dict or None, optional
    Pre-loaded mapping <code>{node_name: pandas.DataFrame}</code> containing intercept
    weights across epochs. If None, <code><a href="#TramDagModel.simple_intercept_history">simple_intercept_history()</a></code> is called.
node : str or None, optional
    If provided, plot only this node. Otherwise, plot all nodes present
    in <code>data_dict</code>.
ref_lines : dict or None, optional
    Optional mapping <code>{node_name: list of float}</code>. For each specified
    node, horizontal reference lines are drawn at the given values.</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="notes">Notes</h2>

<p>Nested list-like entries in the DataFrames are reduced to scalars before
plotting. One line is drawn per intercept parameter.</p>
</div>


                            </div>
                            <div id="TramDagModel.plot_latents" class="classattr">
                                        <input id="TramDagModel.plot_latents-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_latents</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">df</span>,</span><span class="param">	<span class="n">variable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span>,</span><span class="param">	<span class="n">simulations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.plot_latents-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.plot_latents"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.plot_latents-1198"><a href="#TramDagModel.plot_latents-1198"><span class="linenos">1198</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_latents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">simulations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">):</span>
</span><span id="TramDagModel.plot_latents-1199"><a href="#TramDagModel.plot_latents-1199"><span class="linenos">1199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.plot_latents-1200"><a href="#TramDagModel.plot_latents-1200"><span class="linenos">1200</span></a><span class="sd">        Visualize latent U distributions for one or all nodes.</span>
</span><span id="TramDagModel.plot_latents-1201"><a href="#TramDagModel.plot_latents-1201"><span class="linenos">1201</span></a>
</span><span id="TramDagModel.plot_latents-1202"><a href="#TramDagModel.plot_latents-1202"><span class="linenos">1202</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.plot_latents-1203"><a href="#TramDagModel.plot_latents-1203"><span class="linenos">1203</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.plot_latents-1204"><a href="#TramDagModel.plot_latents-1204"><span class="linenos">1204</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="TramDagModel.plot_latents-1205"><a href="#TramDagModel.plot_latents-1205"><span class="linenos">1205</span></a><span class="sd">            Input data frame with raw node values.</span>
</span><span id="TramDagModel.plot_latents-1206"><a href="#TramDagModel.plot_latents-1206"><span class="linenos">1206</span></a><span class="sd">        variable : str or None, optional</span>
</span><span id="TramDagModel.plot_latents-1207"><a href="#TramDagModel.plot_latents-1207"><span class="linenos">1207</span></a><span class="sd">            If provided, only this node&#39;s latents are plotted. If None, all</span>
</span><span id="TramDagModel.plot_latents-1208"><a href="#TramDagModel.plot_latents-1208"><span class="linenos">1208</span></a><span class="sd">            nodes with latent columns are processed.</span>
</span><span id="TramDagModel.plot_latents-1209"><a href="#TramDagModel.plot_latents-1209"><span class="linenos">1209</span></a><span class="sd">        confidence : float, optional</span>
</span><span id="TramDagModel.plot_latents-1210"><a href="#TramDagModel.plot_latents-1210"><span class="linenos">1210</span></a><span class="sd">            Confidence level for QQ-plot bands (0 &lt; confidence &lt; 1).</span>
</span><span id="TramDagModel.plot_latents-1211"><a href="#TramDagModel.plot_latents-1211"><span class="linenos">1211</span></a><span class="sd">            Default is 0.95.</span>
</span><span id="TramDagModel.plot_latents-1212"><a href="#TramDagModel.plot_latents-1212"><span class="linenos">1212</span></a><span class="sd">        simulations : int, optional</span>
</span><span id="TramDagModel.plot_latents-1213"><a href="#TramDagModel.plot_latents-1213"><span class="linenos">1213</span></a><span class="sd">            Number of Monte Carlo simulations for QQ-plot bands. Default is 1000.</span>
</span><span id="TramDagModel.plot_latents-1214"><a href="#TramDagModel.plot_latents-1214"><span class="linenos">1214</span></a>
</span><span id="TramDagModel.plot_latents-1215"><a href="#TramDagModel.plot_latents-1215"><span class="linenos">1215</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.plot_latents-1216"><a href="#TramDagModel.plot_latents-1216"><span class="linenos">1216</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.plot_latents-1217"><a href="#TramDagModel.plot_latents-1217"><span class="linenos">1217</span></a><span class="sd">        None</span>
</span><span id="TramDagModel.plot_latents-1218"><a href="#TramDagModel.plot_latents-1218"><span class="linenos">1218</span></a>
</span><span id="TramDagModel.plot_latents-1219"><a href="#TramDagModel.plot_latents-1219"><span class="linenos">1219</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.plot_latents-1220"><a href="#TramDagModel.plot_latents-1220"><span class="linenos">1220</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.plot_latents-1221"><a href="#TramDagModel.plot_latents-1221"><span class="linenos">1221</span></a><span class="sd">        For each node, two plots are produced:</span>
</span><span id="TramDagModel.plot_latents-1222"><a href="#TramDagModel.plot_latents-1222"><span class="linenos">1222</span></a><span class="sd">        - Histogram of the latent U values.</span>
</span><span id="TramDagModel.plot_latents-1223"><a href="#TramDagModel.plot_latents-1223"><span class="linenos">1223</span></a><span class="sd">        - QQ-plot with simulation-based confidence bands under a logistic reference.</span>
</span><span id="TramDagModel.plot_latents-1224"><a href="#TramDagModel.plot_latents-1224"><span class="linenos">1224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.plot_latents-1225"><a href="#TramDagModel.plot_latents-1225"><span class="linenos">1225</span></a>        <span class="c1"># Compute latent representations</span>
</span><span id="TramDagModel.plot_latents-1226"><a href="#TramDagModel.plot_latents-1226"><span class="linenos">1226</span></a>        <span class="n">latents_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latent</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="TramDagModel.plot_latents-1227"><a href="#TramDagModel.plot_latents-1227"><span class="linenos">1227</span></a>
</span><span id="TramDagModel.plot_latents-1228"><a href="#TramDagModel.plot_latents-1228"><span class="linenos">1228</span></a>        <span class="c1"># Select nodes</span>
</span><span id="TramDagModel.plot_latents-1229"><a href="#TramDagModel.plot_latents-1229"><span class="linenos">1229</span></a>        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="k">if</span> <span class="n">variable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="TramDagModel.plot_latents-1230"><a href="#TramDagModel.plot_latents-1230"><span class="linenos">1230</span></a>
</span><span id="TramDagModel.plot_latents-1231"><a href="#TramDagModel.plot_latents-1231"><span class="linenos">1231</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
</span><span id="TramDagModel.plot_latents-1232"><a href="#TramDagModel.plot_latents-1232"><span class="linenos">1232</span></a>            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">_U&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">latents_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="TramDagModel.plot_latents-1233"><a href="#TramDagModel.plot_latents-1233"><span class="linenos">1233</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] No latent found for node </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">, skipping.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_latents-1234"><a href="#TramDagModel.plot_latents-1234"><span class="linenos">1234</span></a>                <span class="k">continue</span>
</span><span id="TramDagModel.plot_latents-1235"><a href="#TramDagModel.plot_latents-1235"><span class="linenos">1235</span></a>
</span><span id="TramDagModel.plot_latents-1236"><a href="#TramDagModel.plot_latents-1236"><span class="linenos">1236</span></a>            <span class="n">sample</span> <span class="o">=</span> <span class="n">latents_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">_U&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="TramDagModel.plot_latents-1237"><a href="#TramDagModel.plot_latents-1237"><span class="linenos">1237</span></a>
</span><span id="TramDagModel.plot_latents-1238"><a href="#TramDagModel.plot_latents-1238"><span class="linenos">1238</span></a>            <span class="c1"># --- Create plots ---</span>
</span><span id="TramDagModel.plot_latents-1239"><a href="#TramDagModel.plot_latents-1239"><span class="linenos">1239</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="TramDagModel.plot_latents-1240"><a href="#TramDagModel.plot_latents-1240"><span class="linenos">1240</span></a>
</span><span id="TramDagModel.plot_latents-1241"><a href="#TramDagModel.plot_latents-1241"><span class="linenos">1241</span></a>            <span class="c1"># Histogram</span>
</span><span id="TramDagModel.plot_latents-1242"><a href="#TramDagModel.plot_latents-1242"><span class="linenos">1242</span></a>            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;steelblue&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span><span id="TramDagModel.plot_latents-1243"><a href="#TramDagModel.plot_latents-1243"><span class="linenos">1243</span></a>            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Latent Histogram (</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_latents-1244"><a href="#TramDagModel.plot_latents-1244"><span class="linenos">1244</span></a>            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_latents-1245"><a href="#TramDagModel.plot_latents-1245"><span class="linenos">1245</span></a>            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_latents-1246"><a href="#TramDagModel.plot_latents-1246"><span class="linenos">1246</span></a>
</span><span id="TramDagModel.plot_latents-1247"><a href="#TramDagModel.plot_latents-1247"><span class="linenos">1247</span></a>            <span class="c1"># QQ Plot with confidence bands</span>
</span><span id="TramDagModel.plot_latents-1248"><a href="#TramDagModel.plot_latents-1248"><span class="linenos">1248</span></a>            <span class="n">probplot</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&quot;logistic&quot;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="TramDagModel.plot_latents-1249"><a href="#TramDagModel.plot_latents-1249"><span class="linenos">1249</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_r_style_confidence_bands</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sample</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">logistic</span><span class="p">,</span><span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span> <span class="n">simulations</span><span class="o">=</span><span class="n">simulations</span><span class="p">)</span>
</span><span id="TramDagModel.plot_latents-1250"><a href="#TramDagModel.plot_latents-1250"><span class="linenos">1250</span></a>            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Latent QQ Plot (</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_latents-1251"><a href="#TramDagModel.plot_latents-1251"><span class="linenos">1251</span></a>
</span><span id="TramDagModel.plot_latents-1252"><a href="#TramDagModel.plot_latents-1252"><span class="linenos">1252</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Latent Diagnostics for Node: </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="TramDagModel.plot_latents-1253"><a href="#TramDagModel.plot_latents-1253"><span class="linenos">1253</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>
</span><span id="TramDagModel.plot_latents-1254"><a href="#TramDagModel.plot_latents-1254"><span class="linenos">1254</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Visualize latent U distributions for one or all nodes.</p>

<h2 id="parameters">Parameters</h2>

<p>df : pandas.DataFrame
    Input data frame with raw node values.
variable : str or None, optional
    If provided, only this node's latents are plotted. If None, all
    nodes with latent columns are processed.
confidence : float, optional
    Confidence level for QQ-plot bands (0 &lt; confidence &lt; 1).
    Default is 0.95.
simulations : int, optional
    Number of Monte Carlo simulations for QQ-plot bands. Default is 1000.</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="notes">Notes</h2>

<p>For each node, two plots are produced:</p>

<ul>
<li>Histogram of the latent U values.</li>
<li>QQ-plot with simulation-based confidence bands under a logistic reference.</li>
</ul>
</div>


                            </div>
                            <div id="TramDagModel.plot_hdag" class="classattr">
                                        <input id="TramDagModel.plot_hdag-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_hdag</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span>, </span><span class="param"><span class="n">variables</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">plot_n_rows</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.plot_hdag-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.plot_hdag"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.plot_hdag-1256"><a href="#TramDagModel.plot_hdag-1256"><span class="linenos">1256</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_hdag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_n_rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TramDagModel.plot_hdag-1257"><a href="#TramDagModel.plot_hdag-1257"><span class="linenos">1257</span></a><span class="w">        </span>
</span><span id="TramDagModel.plot_hdag-1258"><a href="#TramDagModel.plot_hdag-1258"><span class="linenos">1258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.plot_hdag-1259"><a href="#TramDagModel.plot_hdag-1259"><span class="linenos">1259</span></a><span class="sd">        Visualize the transformation function h() for selected DAG nodes.</span>
</span><span id="TramDagModel.plot_hdag-1260"><a href="#TramDagModel.plot_hdag-1260"><span class="linenos">1260</span></a>
</span><span id="TramDagModel.plot_hdag-1261"><a href="#TramDagModel.plot_hdag-1261"><span class="linenos">1261</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.plot_hdag-1262"><a href="#TramDagModel.plot_hdag-1262"><span class="linenos">1262</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.plot_hdag-1263"><a href="#TramDagModel.plot_hdag-1263"><span class="linenos">1263</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="TramDagModel.plot_hdag-1264"><a href="#TramDagModel.plot_hdag-1264"><span class="linenos">1264</span></a><span class="sd">            Input data containing node values or model predictions.</span>
</span><span id="TramDagModel.plot_hdag-1265"><a href="#TramDagModel.plot_hdag-1265"><span class="linenos">1265</span></a><span class="sd">        variables : list of str or None, optional</span>
</span><span id="TramDagModel.plot_hdag-1266"><a href="#TramDagModel.plot_hdag-1266"><span class="linenos">1266</span></a><span class="sd">            Names of nodes to visualize. If None, all nodes in ``self.models``</span>
</span><span id="TramDagModel.plot_hdag-1267"><a href="#TramDagModel.plot_hdag-1267"><span class="linenos">1267</span></a><span class="sd">            are considered.</span>
</span><span id="TramDagModel.plot_hdag-1268"><a href="#TramDagModel.plot_hdag-1268"><span class="linenos">1268</span></a><span class="sd">        plot_n_rows : int, optional</span>
</span><span id="TramDagModel.plot_hdag-1269"><a href="#TramDagModel.plot_hdag-1269"><span class="linenos">1269</span></a><span class="sd">            Maximum number of rows from ``df`` to visualize. Default is 1.</span>
</span><span id="TramDagModel.plot_hdag-1270"><a href="#TramDagModel.plot_hdag-1270"><span class="linenos">1270</span></a><span class="sd">        **kwargs</span>
</span><span id="TramDagModel.plot_hdag-1271"><a href="#TramDagModel.plot_hdag-1271"><span class="linenos">1271</span></a><span class="sd">            Additional keyword arguments forwarded to the underlying plotting</span>
</span><span id="TramDagModel.plot_hdag-1272"><a href="#TramDagModel.plot_hdag-1272"><span class="linenos">1272</span></a><span class="sd">            helpers (`show_hdag_continous` / `show_hdag_ordinal`).</span>
</span><span id="TramDagModel.plot_hdag-1273"><a href="#TramDagModel.plot_hdag-1273"><span class="linenos">1273</span></a>
</span><span id="TramDagModel.plot_hdag-1274"><a href="#TramDagModel.plot_hdag-1274"><span class="linenos">1274</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.plot_hdag-1275"><a href="#TramDagModel.plot_hdag-1275"><span class="linenos">1275</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.plot_hdag-1276"><a href="#TramDagModel.plot_hdag-1276"><span class="linenos">1276</span></a><span class="sd">        None</span>
</span><span id="TramDagModel.plot_hdag-1277"><a href="#TramDagModel.plot_hdag-1277"><span class="linenos">1277</span></a>
</span><span id="TramDagModel.plot_hdag-1278"><a href="#TramDagModel.plot_hdag-1278"><span class="linenos">1278</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.plot_hdag-1279"><a href="#TramDagModel.plot_hdag-1279"><span class="linenos">1279</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.plot_hdag-1280"><a href="#TramDagModel.plot_hdag-1280"><span class="linenos">1280</span></a><span class="sd">        - For continuous outcomes, `show_hdag_continous` is called.</span>
</span><span id="TramDagModel.plot_hdag-1281"><a href="#TramDagModel.plot_hdag-1281"><span class="linenos">1281</span></a><span class="sd">        - For ordinal outcomes, `show_hdag_ordinal` is called.</span>
</span><span id="TramDagModel.plot_hdag-1282"><a href="#TramDagModel.plot_hdag-1282"><span class="linenos">1282</span></a><span class="sd">        - Nodes that are neither continuous nor ordinal are skipped with a warning.</span>
</span><span id="TramDagModel.plot_hdag-1283"><a href="#TramDagModel.plot_hdag-1283"><span class="linenos">1283</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.plot_hdag-1284"><a href="#TramDagModel.plot_hdag-1284"><span class="linenos">1284</span></a>                
</span><span id="TramDagModel.plot_hdag-1285"><a href="#TramDagModel.plot_hdag-1285"><span class="linenos">1285</span></a>
</span><span id="TramDagModel.plot_hdag-1286"><a href="#TramDagModel.plot_hdag-1286"><span class="linenos">1286</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="TramDagModel.plot_hdag-1287"><a href="#TramDagModel.plot_hdag-1287"><span class="linenos">1287</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] len(df)&gt;1, set: plot_n_rows accordingly&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_hdag-1288"><a href="#TramDagModel.plot_hdag-1288"><span class="linenos">1288</span></a>        
</span><span id="TramDagModel.plot_hdag-1289"><a href="#TramDagModel.plot_hdag-1289"><span class="linenos">1289</span></a>        <span class="n">variables_list</span><span class="o">=</span><span class="n">variables</span> <span class="k">if</span> <span class="n">variables</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel.plot_hdag-1290"><a href="#TramDagModel.plot_hdag-1290"><span class="linenos">1290</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">variables_list</span><span class="p">:</span>
</span><span id="TramDagModel.plot_hdag-1291"><a href="#TramDagModel.plot_hdag-1291"><span class="linenos">1291</span></a>            <span class="k">if</span> <span class="n">is_outcome_modelled_continous</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">):</span>
</span><span id="TramDagModel.plot_hdag-1292"><a href="#TramDagModel.plot_hdag-1292"><span class="linenos">1292</span></a>                <span class="n">show_hdag_continous</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span><span class="n">configuration_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">,</span><span class="n">minmax_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span><span class="p">,</span><span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span><span class="n">plot_n_rows</span><span class="o">=</span><span class="n">plot_n_rows</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TramDagModel.plot_hdag-1293"><a href="#TramDagModel.plot_hdag-1293"><span class="linenos">1293</span></a>            
</span><span id="TramDagModel.plot_hdag-1294"><a href="#TramDagModel.plot_hdag-1294"><span class="linenos">1294</span></a>            <span class="k">elif</span> <span class="n">is_outcome_modelled_ordinal</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">):</span>
</span><span id="TramDagModel.plot_hdag-1295"><a href="#TramDagModel.plot_hdag-1295"><span class="linenos">1295</span></a>                <span class="n">show_hdag_ordinal</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span><span class="n">configuration_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">,</span><span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span><span class="n">plot_n_rows</span><span class="o">=</span><span class="n">plot_n_rows</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TramDagModel.plot_hdag-1296"><a href="#TramDagModel.plot_hdag-1296"><span class="linenos">1296</span></a>                <span class="c1"># plot_cutpoints_with_logistic(df,node=node,configuration_dict=self.cfg.conf_dict,device=self.device,plot_n_rows=plot_n_rows,**kwargs)</span>
</span><span id="TramDagModel.plot_hdag-1297"><a href="#TramDagModel.plot_hdag-1297"><span class="linenos">1297</span></a>                <span class="c1"># save_cutpoints_with_logistic(df,node=node,configuration_dict=self.cfg.conf_dict,device=self.device,**kwargs)</span>
</span><span id="TramDagModel.plot_hdag-1298"><a href="#TramDagModel.plot_hdag-1298"><span class="linenos">1298</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.plot_hdag-1299"><a href="#TramDagModel.plot_hdag-1299"><span class="linenos">1299</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Node </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2"> is wheter ordinal nor continous, not implemented yet&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Visualize the transformation function h() for selected DAG nodes.</p>

<h2 id="parameters">Parameters</h2>

<p>df : pandas.DataFrame
    Input data containing node values or model predictions.
variables : list of str or None, optional
    Names of nodes to visualize. If None, all nodes in <code>self.models</code>
    are considered.
plot_n_rows : int, optional
    Maximum number of rows from <code>df</code> to visualize. Default is 1.
**kwargs
    Additional keyword arguments forwarded to the underlying plotting
    helpers (<code>show_hdag_continous</code> / <code>show_hdag_ordinal</code>).</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="notes">Notes</h2>

<ul>
<li>For continuous outcomes, <code>show_hdag_continous</code> is called.</li>
<li>For ordinal outcomes, <code>show_hdag_ordinal</code> is called.</li>
<li>Nodes that are neither continuous nor ordinal are skipped with a warning.</li>
</ul>
</div>


                            </div>
                            <div id="TramDagModel.sample" class="classattr">
                                        <input id="TramDagModel.sample-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sample</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">do_interventions</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">predefined_latent_samples_df</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.sample-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.sample"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.sample-1358"><a href="#TramDagModel.sample-1358"><span class="linenos">1358</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span>
</span><span id="TramDagModel.sample-1359"><a href="#TramDagModel.sample-1359"><span class="linenos">1359</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TramDagModel.sample-1360"><a href="#TramDagModel.sample-1360"><span class="linenos">1360</span></a>        <span class="n">do_interventions</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagModel.sample-1361"><a href="#TramDagModel.sample-1361"><span class="linenos">1361</span></a>        <span class="n">predefined_latent_samples_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagModel.sample-1362"><a href="#TramDagModel.sample-1362"><span class="linenos">1362</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="TramDagModel.sample-1363"><a href="#TramDagModel.sample-1363"><span class="linenos">1363</span></a>    <span class="p">):</span>
</span><span id="TramDagModel.sample-1364"><a href="#TramDagModel.sample-1364"><span class="linenos">1364</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.sample-1365"><a href="#TramDagModel.sample-1365"><span class="linenos">1365</span></a><span class="sd">        Sample from the joint DAG using the trained TRAM models.</span>
</span><span id="TramDagModel.sample-1366"><a href="#TramDagModel.sample-1366"><span class="linenos">1366</span></a>
</span><span id="TramDagModel.sample-1367"><a href="#TramDagModel.sample-1367"><span class="linenos">1367</span></a><span class="sd">        Allows for:</span>
</span><span id="TramDagModel.sample-1368"><a href="#TramDagModel.sample-1368"><span class="linenos">1368</span></a><span class="sd">        </span>
</span><span id="TramDagModel.sample-1369"><a href="#TramDagModel.sample-1369"><span class="linenos">1369</span></a><span class="sd">        Oberservational sampling</span>
</span><span id="TramDagModel.sample-1370"><a href="#TramDagModel.sample-1370"><span class="linenos">1370</span></a><span class="sd">        Interventional sampling via ``do()`` operations</span>
</span><span id="TramDagModel.sample-1371"><a href="#TramDagModel.sample-1371"><span class="linenos">1371</span></a><span class="sd">        Counterfactial sampling using predefined latent draws and do()</span>
</span><span id="TramDagModel.sample-1372"><a href="#TramDagModel.sample-1372"><span class="linenos">1372</span></a><span class="sd">        </span>
</span><span id="TramDagModel.sample-1373"><a href="#TramDagModel.sample-1373"><span class="linenos">1373</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.sample-1374"><a href="#TramDagModel.sample-1374"><span class="linenos">1374</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.sample-1375"><a href="#TramDagModel.sample-1375"><span class="linenos">1375</span></a><span class="sd">        do_interventions : dict or None, optional</span>
</span><span id="TramDagModel.sample-1376"><a href="#TramDagModel.sample-1376"><span class="linenos">1376</span></a><span class="sd">            Mapping of node names to intervened (fixed) values. For example:</span>
</span><span id="TramDagModel.sample-1377"><a href="#TramDagModel.sample-1377"><span class="linenos">1377</span></a><span class="sd">            ``{&quot;x1&quot;: 1.0}`` represents ``do(x1 = 1.0)``. Default is None.</span>
</span><span id="TramDagModel.sample-1378"><a href="#TramDagModel.sample-1378"><span class="linenos">1378</span></a><span class="sd">        predefined_latent_samples_df : pandas.DataFrame or None, optional</span>
</span><span id="TramDagModel.sample-1379"><a href="#TramDagModel.sample-1379"><span class="linenos">1379</span></a><span class="sd">            DataFrame containing columns ``&quot;{node}_U&quot;`` with predefined latent</span>
</span><span id="TramDagModel.sample-1380"><a href="#TramDagModel.sample-1380"><span class="linenos">1380</span></a><span class="sd">            draws to be used instead of sampling from the prior. Default is None.</span>
</span><span id="TramDagModel.sample-1381"><a href="#TramDagModel.sample-1381"><span class="linenos">1381</span></a><span class="sd">        **kwargs</span>
</span><span id="TramDagModel.sample-1382"><a href="#TramDagModel.sample-1382"><span class="linenos">1382</span></a><span class="sd">            Sampling options overriding internal defaults:</span>
</span><span id="TramDagModel.sample-1383"><a href="#TramDagModel.sample-1383"><span class="linenos">1383</span></a>
</span><span id="TramDagModel.sample-1384"><a href="#TramDagModel.sample-1384"><span class="linenos">1384</span></a><span class="sd">            number_of_samples : int, default 10000</span>
</span><span id="TramDagModel.sample-1385"><a href="#TramDagModel.sample-1385"><span class="linenos">1385</span></a><span class="sd">                Total number of samples to draw.</span>
</span><span id="TramDagModel.sample-1386"><a href="#TramDagModel.sample-1386"><span class="linenos">1386</span></a><span class="sd">            batch_size : int, default 32</span>
</span><span id="TramDagModel.sample-1387"><a href="#TramDagModel.sample-1387"><span class="linenos">1387</span></a><span class="sd">                Batch size for internal sampling loops.</span>
</span><span id="TramDagModel.sample-1388"><a href="#TramDagModel.sample-1388"><span class="linenos">1388</span></a><span class="sd">            delete_all_previously_sampled : bool, default True</span>
</span><span id="TramDagModel.sample-1389"><a href="#TramDagModel.sample-1389"><span class="linenos">1389</span></a><span class="sd">                If True, delete old sampling files in node-specific sampling</span>
</span><span id="TramDagModel.sample-1390"><a href="#TramDagModel.sample-1390"><span class="linenos">1390</span></a><span class="sd">                directories before writing new ones.</span>
</span><span id="TramDagModel.sample-1391"><a href="#TramDagModel.sample-1391"><span class="linenos">1391</span></a><span class="sd">            verbose : bool</span>
</span><span id="TramDagModel.sample-1392"><a href="#TramDagModel.sample-1392"><span class="linenos">1392</span></a><span class="sd">                If True, print informational messages.</span>
</span><span id="TramDagModel.sample-1393"><a href="#TramDagModel.sample-1393"><span class="linenos">1393</span></a><span class="sd">            debug : bool</span>
</span><span id="TramDagModel.sample-1394"><a href="#TramDagModel.sample-1394"><span class="linenos">1394</span></a><span class="sd">                If True, print debug output.</span>
</span><span id="TramDagModel.sample-1395"><a href="#TramDagModel.sample-1395"><span class="linenos">1395</span></a><span class="sd">            device : {&quot;auto&quot;, &quot;cpu&quot;, &quot;cuda&quot;}</span>
</span><span id="TramDagModel.sample-1396"><a href="#TramDagModel.sample-1396"><span class="linenos">1396</span></a><span class="sd">                Device selection for sampling.</span>
</span><span id="TramDagModel.sample-1397"><a href="#TramDagModel.sample-1397"><span class="linenos">1397</span></a><span class="sd">            use_initial_weights_for_sampling : bool, default False</span>
</span><span id="TramDagModel.sample-1398"><a href="#TramDagModel.sample-1398"><span class="linenos">1398</span></a><span class="sd">                If True, sample from initial (untrained) model parameters.</span>
</span><span id="TramDagModel.sample-1399"><a href="#TramDagModel.sample-1399"><span class="linenos">1399</span></a>
</span><span id="TramDagModel.sample-1400"><a href="#TramDagModel.sample-1400"><span class="linenos">1400</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.sample-1401"><a href="#TramDagModel.sample-1401"><span class="linenos">1401</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.sample-1402"><a href="#TramDagModel.sample-1402"><span class="linenos">1402</span></a><span class="sd">        tuple</span>
</span><span id="TramDagModel.sample-1403"><a href="#TramDagModel.sample-1403"><span class="linenos">1403</span></a><span class="sd">            A tuple ``(sampled_by_node, latents_by_node)``:</span>
</span><span id="TramDagModel.sample-1404"><a href="#TramDagModel.sample-1404"><span class="linenos">1404</span></a>
</span><span id="TramDagModel.sample-1405"><a href="#TramDagModel.sample-1405"><span class="linenos">1405</span></a><span class="sd">            sampled_by_node : dict</span>
</span><span id="TramDagModel.sample-1406"><a href="#TramDagModel.sample-1406"><span class="linenos">1406</span></a><span class="sd">                Mapping ``{node_name: torch.Tensor}`` of sampled node values.</span>
</span><span id="TramDagModel.sample-1407"><a href="#TramDagModel.sample-1407"><span class="linenos">1407</span></a><span class="sd">            latents_by_node : dict</span>
</span><span id="TramDagModel.sample-1408"><a href="#TramDagModel.sample-1408"><span class="linenos">1408</span></a><span class="sd">                Mapping ``{node_name: torch.Tensor}`` of latent U values used.</span>
</span><span id="TramDagModel.sample-1409"><a href="#TramDagModel.sample-1409"><span class="linenos">1409</span></a>
</span><span id="TramDagModel.sample-1410"><a href="#TramDagModel.sample-1410"><span class="linenos">1410</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel.sample-1411"><a href="#TramDagModel.sample-1411"><span class="linenos">1411</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel.sample-1412"><a href="#TramDagModel.sample-1412"><span class="linenos">1412</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel.sample-1413"><a href="#TramDagModel.sample-1413"><span class="linenos">1413</span></a><span class="sd">            If the experiment directory cannot be resolved or if scaling</span>
</span><span id="TramDagModel.sample-1414"><a href="#TramDagModel.sample-1414"><span class="linenos">1414</span></a><span class="sd">            information (``self.minmax_dict``) is missing.</span>
</span><span id="TramDagModel.sample-1415"><a href="#TramDagModel.sample-1415"><span class="linenos">1415</span></a><span class="sd">        RuntimeError</span>
</span><span id="TramDagModel.sample-1416"><a href="#TramDagModel.sample-1416"><span class="linenos">1416</span></a><span class="sd">            If minmax scaling has not been computed before calling `sample`.</span>
</span><span id="TramDagModel.sample-1417"><a href="#TramDagModel.sample-1417"><span class="linenos">1417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.sample-1418"><a href="#TramDagModel.sample-1418"><span class="linenos">1418</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.sample-1419"><a href="#TramDagModel.sample-1419"><span class="linenos">1419</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.sample-1420"><a href="#TramDagModel.sample-1420"><span class="linenos">1420</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="TramDagModel.sample-1421"><a href="#TramDagModel.sample-1421"><span class="linenos">1421</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel.sample-1422"><a href="#TramDagModel.sample-1422"><span class="linenos">1422</span></a>                <span class="s2">&quot;[ERROR] Missing &#39;EXPERIMENT_DIR&#39; in cfg.conf_dict[&#39;PATHS&#39;]. &quot;</span>
</span><span id="TramDagModel.sample-1423"><a href="#TramDagModel.sample-1423"><span class="linenos">1423</span></a>                <span class="s2">&quot;Sampling requires trained model checkpoints.&quot;</span>
</span><span id="TramDagModel.sample-1424"><a href="#TramDagModel.sample-1424"><span class="linenos">1424</span></a>            <span class="p">)</span>
</span><span id="TramDagModel.sample-1425"><a href="#TramDagModel.sample-1425"><span class="linenos">1425</span></a>
</span><span id="TramDagModel.sample-1426"><a href="#TramDagModel.sample-1426"><span class="linenos">1426</span></a>        <span class="c1"># ---- defaults ----</span>
</span><span id="TramDagModel.sample-1427"><a href="#TramDagModel.sample-1427"><span class="linenos">1427</span></a>        <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TramDagModel.sample-1428"><a href="#TramDagModel.sample-1428"><span class="linenos">1428</span></a>            <span class="s2">&quot;number_of_samples&quot;</span><span class="p">:</span> <span class="mi">10_000</span><span class="p">,</span>
</span><span id="TramDagModel.sample-1429"><a href="#TramDagModel.sample-1429"><span class="linenos">1429</span></a>            <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
</span><span id="TramDagModel.sample-1430"><a href="#TramDagModel.sample-1430"><span class="linenos">1430</span></a>            <span class="s2">&quot;delete_all_previously_sampled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TramDagModel.sample-1431"><a href="#TramDagModel.sample-1431"><span class="linenos">1431</span></a>            <span class="s2">&quot;verbose&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TramDagModel.sample-1432"><a href="#TramDagModel.sample-1432"><span class="linenos">1432</span></a>            <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TramDagModel.sample-1433"><a href="#TramDagModel.sample-1433"><span class="linenos">1433</span></a>            <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">type</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;device&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span id="TramDagModel.sample-1434"><a href="#TramDagModel.sample-1434"><span class="linenos">1434</span></a>            <span class="s2">&quot;use_initial_weights_for_sampling&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="TramDagModel.sample-1435"><a href="#TramDagModel.sample-1435"><span class="linenos">1435</span></a>            
</span><span id="TramDagModel.sample-1436"><a href="#TramDagModel.sample-1436"><span class="linenos">1436</span></a>        <span class="p">}</span>
</span><span id="TramDagModel.sample-1437"><a href="#TramDagModel.sample-1437"><span class="linenos">1437</span></a>        
</span><span id="TramDagModel.sample-1438"><a href="#TramDagModel.sample-1438"><span class="linenos">1438</span></a>        <span class="c1"># TODO adjust validation</span>
</span><span id="TramDagModel.sample-1439"><a href="#TramDagModel.sample-1439"><span class="linenos">1439</span></a>        <span class="c1"># self._validate_kwargs( kwargs, defaults_attr= &quot;settings&quot;, context=&quot;sample&quot;)</span>
</span><span id="TramDagModel.sample-1440"><a href="#TramDagModel.sample-1440"><span class="linenos">1440</span></a>        
</span><span id="TramDagModel.sample-1441"><a href="#TramDagModel.sample-1441"><span class="linenos">1441</span></a>        <span class="n">settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TramDagModel.sample-1442"><a href="#TramDagModel.sample-1442"><span class="linenos">1442</span></a>
</span><span id="TramDagModel.sample-1443"><a href="#TramDagModel.sample-1443"><span class="linenos">1443</span></a>        
</span><span id="TramDagModel.sample-1444"><a href="#TramDagModel.sample-1444"><span class="linenos">1444</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;minmax_dict&quot;</span><span class="p">):</span>
</span><span id="TramDagModel.sample-1445"><a href="#TramDagModel.sample-1445"><span class="linenos">1445</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="TramDagModel.sample-1446"><a href="#TramDagModel.sample-1446"><span class="linenos">1446</span></a>                <span class="s2">&quot;[ERROR] minmax_dict not found. You must call .fit() or .load_or_compute_minmax() &quot;</span>
</span><span id="TramDagModel.sample-1447"><a href="#TramDagModel.sample-1447"><span class="linenos">1447</span></a>                <span class="s2">&quot;before sampling, so scaling info is available.&quot;</span>
</span><span id="TramDagModel.sample-1448"><a href="#TramDagModel.sample-1448"><span class="linenos">1448</span></a>                <span class="p">)</span>
</span><span id="TramDagModel.sample-1449"><a href="#TramDagModel.sample-1449"><span class="linenos">1449</span></a>            
</span><span id="TramDagModel.sample-1450"><a href="#TramDagModel.sample-1450"><span class="linenos">1450</span></a>        <span class="c1"># ---- resolve device ----</span>
</span><span id="TramDagModel.sample-1451"><a href="#TramDagModel.sample-1451"><span class="linenos">1451</span></a>        <span class="n">device_str</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_device</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="TramDagModel.sample-1452"><a href="#TramDagModel.sample-1452"><span class="linenos">1452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device_str</span><span class="p">)</span>
</span><span id="TramDagModel.sample-1453"><a href="#TramDagModel.sample-1453"><span class="linenos">1453</span></a>
</span><span id="TramDagModel.sample-1454"><a href="#TramDagModel.sample-1454"><span class="linenos">1454</span></a>
</span><span id="TramDagModel.sample-1455"><a href="#TramDagModel.sample-1455"><span class="linenos">1455</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">or</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">]:</span>
</span><span id="TramDagModel.sample-1456"><a href="#TramDagModel.sample-1456"><span class="linenos">1456</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] sample(): device: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.sample-1457"><a href="#TramDagModel.sample-1457"><span class="linenos">1457</span></a>
</span><span id="TramDagModel.sample-1458"><a href="#TramDagModel.sample-1458"><span class="linenos">1458</span></a>        <span class="c1"># ---- perform sampling ----</span>
</span><span id="TramDagModel.sample-1459"><a href="#TramDagModel.sample-1459"><span class="linenos">1459</span></a>        <span class="n">sampled_by_node</span><span class="p">,</span> <span class="n">latents_by_node</span> <span class="o">=</span> <span class="n">sample_full_dag</span><span class="p">(</span>
</span><span id="TramDagModel.sample-1460"><a href="#TramDagModel.sample-1460"><span class="linenos">1460</span></a>            <span class="n">configuration_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">,</span>
</span><span id="TramDagModel.sample-1461"><a href="#TramDagModel.sample-1461"><span class="linenos">1461</span></a>            <span class="n">EXPERIMENT_DIR</span><span class="o">=</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span>
</span><span id="TramDagModel.sample-1462"><a href="#TramDagModel.sample-1462"><span class="linenos">1462</span></a>            <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
</span><span id="TramDagModel.sample-1463"><a href="#TramDagModel.sample-1463"><span class="linenos">1463</span></a>            <span class="n">do_interventions</span><span class="o">=</span><span class="n">do_interventions</span> <span class="ow">or</span> <span class="p">{},</span>
</span><span id="TramDagModel.sample-1464"><a href="#TramDagModel.sample-1464"><span class="linenos">1464</span></a>            <span class="n">predefined_latent_samples_df</span><span class="o">=</span><span class="n">predefined_latent_samples_df</span><span class="p">,</span>
</span><span id="TramDagModel.sample-1465"><a href="#TramDagModel.sample-1465"><span class="linenos">1465</span></a>            <span class="n">number_of_samples</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;number_of_samples&quot;</span><span class="p">],</span>
</span><span id="TramDagModel.sample-1466"><a href="#TramDagModel.sample-1466"><span class="linenos">1466</span></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;batch_size&quot;</span><span class="p">],</span>
</span><span id="TramDagModel.sample-1467"><a href="#TramDagModel.sample-1467"><span class="linenos">1467</span></a>            <span class="n">delete_all_previously_sampled</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;delete_all_previously_sampled&quot;</span><span class="p">],</span>
</span><span id="TramDagModel.sample-1468"><a href="#TramDagModel.sample-1468"><span class="linenos">1468</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">],</span>
</span><span id="TramDagModel.sample-1469"><a href="#TramDagModel.sample-1469"><span class="linenos">1469</span></a>            <span class="n">debug</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">],</span>
</span><span id="TramDagModel.sample-1470"><a href="#TramDagModel.sample-1470"><span class="linenos">1470</span></a>            <span class="n">minmax_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span><span class="p">,</span>
</span><span id="TramDagModel.sample-1471"><a href="#TramDagModel.sample-1471"><span class="linenos">1471</span></a>            <span class="n">use_initial_weights_for_sampling</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;use_initial_weights_for_sampling&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.sample-1472"><a href="#TramDagModel.sample-1472"><span class="linenos">1472</span></a>        <span class="p">)</span>
</span><span id="TramDagModel.sample-1473"><a href="#TramDagModel.sample-1473"><span class="linenos">1473</span></a>
</span><span id="TramDagModel.sample-1474"><a href="#TramDagModel.sample-1474"><span class="linenos">1474</span></a>        <span class="k">return</span> <span class="n">sampled_by_node</span><span class="p">,</span> <span class="n">latents_by_node</span>
</span></pre></div>


            <div class="docstring"><p>Sample from the joint DAG using the trained TRAM models.</p>

<p>Allows for:</p>

<p>Oberservational sampling
Interventional sampling via <code>do()</code> operations
Counterfactial sampling using predefined latent draws and do()</p>

<h2 id="parameters">Parameters</h2>

<p>do_interventions : dict or None, optional
    Mapping of node names to intervened (fixed) values. For example:
    <code>{"x1": 1.0}</code> represents <code>do(x1 = 1.0)</code>. Default is None.
predefined_latent_samples_df : pandas.DataFrame or None, optional
    DataFrame containing columns <code>"{node}_U"</code> with predefined latent
    draws to be used instead of sampling from the prior. Default is None.
**kwargs
    Sampling options overriding internal defaults:</p>

<pre><code>number_of_samples : int, default 10000
    Total number of samples to draw.
batch_size : int, default 32
    Batch size for internal sampling loops.
delete_all_previously_sampled : bool, default True
    If True, delete old sampling files in node-specific sampling
    directories before writing new ones.
verbose : bool
    If True, print informational messages.
debug : bool
    If True, print debug output.
device : {"auto", "cpu", "cuda"}
    Device selection for sampling.
use_initial_weights_for_sampling : bool, default False
    If True, sample from initial (untrained) model parameters.
</code></pre>

<h2 id="returns">Returns</h2>

<p>tuple
    A tuple <code>(sampled_by_node, latents_by_node)</code>:</p>

<pre><code>sampled_by_node : dict
    Mapping ``{node_name: torch.Tensor}`` of sampled node values.
latents_by_node : dict
    Mapping ``{node_name: torch.Tensor}`` of latent U values used.
</code></pre>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the experiment directory cannot be resolved or if scaling
    information (<code>self.minmax_dict</code>) is missing.
RuntimeError
    If minmax scaling has not been computed before calling <code><a href="#TramDagModel.sample">sample</a></code>.</p>
</div>


                            </div>
                            <div id="TramDagModel.load_sampled_and_latents" class="classattr">
                                        <input id="TramDagModel.load_sampled_and_latents-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_sampled_and_latents</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">EXPERIMENT_DIR</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">nodes</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.load_sampled_and_latents-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.load_sampled_and_latents"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.load_sampled_and_latents-1476"><a href="#TramDagModel.load_sampled_and_latents-1476"><span class="linenos">1476</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_sampled_and_latents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">EXPERIMENT_DIR</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagModel.load_sampled_and_latents-1477"><a href="#TramDagModel.load_sampled_and_latents-1477"><span class="linenos">1477</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.load_sampled_and_latents-1478"><a href="#TramDagModel.load_sampled_and_latents-1478"><span class="linenos">1478</span></a><span class="sd">        Load previously stored sampled values and latents for each node.</span>
</span><span id="TramDagModel.load_sampled_and_latents-1479"><a href="#TramDagModel.load_sampled_and_latents-1479"><span class="linenos">1479</span></a>
</span><span id="TramDagModel.load_sampled_and_latents-1480"><a href="#TramDagModel.load_sampled_and_latents-1480"><span class="linenos">1480</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.load_sampled_and_latents-1481"><a href="#TramDagModel.load_sampled_and_latents-1481"><span class="linenos">1481</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.load_sampled_and_latents-1482"><a href="#TramDagModel.load_sampled_and_latents-1482"><span class="linenos">1482</span></a><span class="sd">        EXPERIMENT_DIR : str or None, optional</span>
</span><span id="TramDagModel.load_sampled_and_latents-1483"><a href="#TramDagModel.load_sampled_and_latents-1483"><span class="linenos">1483</span></a><span class="sd">            Experiment directory path. If None, it is taken from</span>
</span><span id="TramDagModel.load_sampled_and_latents-1484"><a href="#TramDagModel.load_sampled_and_latents-1484"><span class="linenos">1484</span></a><span class="sd">            ``self.cfg.conf_dict[&quot;PATHS&quot;][&quot;EXPERIMENT_DIR&quot;]``.</span>
</span><span id="TramDagModel.load_sampled_and_latents-1485"><a href="#TramDagModel.load_sampled_and_latents-1485"><span class="linenos">1485</span></a><span class="sd">        nodes : list of str or None, optional</span>
</span><span id="TramDagModel.load_sampled_and_latents-1486"><a href="#TramDagModel.load_sampled_and_latents-1486"><span class="linenos">1486</span></a><span class="sd">            Nodes for which to load samples. If None, use all nodes from</span>
</span><span id="TramDagModel.load_sampled_and_latents-1487"><a href="#TramDagModel.load_sampled_and_latents-1487"><span class="linenos">1487</span></a><span class="sd">            ``self.nodes_dict``.</span>
</span><span id="TramDagModel.load_sampled_and_latents-1488"><a href="#TramDagModel.load_sampled_and_latents-1488"><span class="linenos">1488</span></a>
</span><span id="TramDagModel.load_sampled_and_latents-1489"><a href="#TramDagModel.load_sampled_and_latents-1489"><span class="linenos">1489</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.load_sampled_and_latents-1490"><a href="#TramDagModel.load_sampled_and_latents-1490"><span class="linenos">1490</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.load_sampled_and_latents-1491"><a href="#TramDagModel.load_sampled_and_latents-1491"><span class="linenos">1491</span></a><span class="sd">        tuple</span>
</span><span id="TramDagModel.load_sampled_and_latents-1492"><a href="#TramDagModel.load_sampled_and_latents-1492"><span class="linenos">1492</span></a><span class="sd">            A tuple ``(sampled_by_node, latents_by_node)``:</span>
</span><span id="TramDagModel.load_sampled_and_latents-1493"><a href="#TramDagModel.load_sampled_and_latents-1493"><span class="linenos">1493</span></a>
</span><span id="TramDagModel.load_sampled_and_latents-1494"><a href="#TramDagModel.load_sampled_and_latents-1494"><span class="linenos">1494</span></a><span class="sd">            sampled_by_node : dict</span>
</span><span id="TramDagModel.load_sampled_and_latents-1495"><a href="#TramDagModel.load_sampled_and_latents-1495"><span class="linenos">1495</span></a><span class="sd">                Mapping ``{node_name: torch.Tensor}`` of sampled values (on CPU).</span>
</span><span id="TramDagModel.load_sampled_and_latents-1496"><a href="#TramDagModel.load_sampled_and_latents-1496"><span class="linenos">1496</span></a><span class="sd">            latents_by_node : dict</span>
</span><span id="TramDagModel.load_sampled_and_latents-1497"><a href="#TramDagModel.load_sampled_and_latents-1497"><span class="linenos">1497</span></a><span class="sd">                Mapping ``{node_name: torch.Tensor}`` of latent values (on CPU).</span>
</span><span id="TramDagModel.load_sampled_and_latents-1498"><a href="#TramDagModel.load_sampled_and_latents-1498"><span class="linenos">1498</span></a>
</span><span id="TramDagModel.load_sampled_and_latents-1499"><a href="#TramDagModel.load_sampled_and_latents-1499"><span class="linenos">1499</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel.load_sampled_and_latents-1500"><a href="#TramDagModel.load_sampled_and_latents-1500"><span class="linenos">1500</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel.load_sampled_and_latents-1501"><a href="#TramDagModel.load_sampled_and_latents-1501"><span class="linenos">1501</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel.load_sampled_and_latents-1502"><a href="#TramDagModel.load_sampled_and_latents-1502"><span class="linenos">1502</span></a><span class="sd">            If the experiment directory cannot be resolved or if no node list</span>
</span><span id="TramDagModel.load_sampled_and_latents-1503"><a href="#TramDagModel.load_sampled_and_latents-1503"><span class="linenos">1503</span></a><span class="sd">            is available and ``nodes`` is None.</span>
</span><span id="TramDagModel.load_sampled_and_latents-1504"><a href="#TramDagModel.load_sampled_and_latents-1504"><span class="linenos">1504</span></a>
</span><span id="TramDagModel.load_sampled_and_latents-1505"><a href="#TramDagModel.load_sampled_and_latents-1505"><span class="linenos">1505</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.load_sampled_and_latents-1506"><a href="#TramDagModel.load_sampled_and_latents-1506"><span class="linenos">1506</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.load_sampled_and_latents-1507"><a href="#TramDagModel.load_sampled_and_latents-1507"><span class="linenos">1507</span></a><span class="sd">        Nodes without both ``sampled.pt`` and ``latents.pt`` files are skipped</span>
</span><span id="TramDagModel.load_sampled_and_latents-1508"><a href="#TramDagModel.load_sampled_and_latents-1508"><span class="linenos">1508</span></a><span class="sd">        with a warning.</span>
</span><span id="TramDagModel.load_sampled_and_latents-1509"><a href="#TramDagModel.load_sampled_and_latents-1509"><span class="linenos">1509</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.load_sampled_and_latents-1510"><a href="#TramDagModel.load_sampled_and_latents-1510"><span class="linenos">1510</span></a>        <span class="c1"># --- resolve paths and node list ---</span>
</span><span id="TramDagModel.load_sampled_and_latents-1511"><a href="#TramDagModel.load_sampled_and_latents-1511"><span class="linenos">1511</span></a>        <span class="k">if</span> <span class="n">EXPERIMENT_DIR</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel.load_sampled_and_latents-1512"><a href="#TramDagModel.load_sampled_and_latents-1512"><span class="linenos">1512</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.load_sampled_and_latents-1513"><a href="#TramDagModel.load_sampled_and_latents-1513"><span class="linenos">1513</span></a>                <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.load_sampled_and_latents-1514"><a href="#TramDagModel.load_sampled_and_latents-1514"><span class="linenos">1514</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
</span><span id="TramDagModel.load_sampled_and_latents-1515"><a href="#TramDagModel.load_sampled_and_latents-1515"><span class="linenos">1515</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel.load_sampled_and_latents-1516"><a href="#TramDagModel.load_sampled_and_latents-1516"><span class="linenos">1516</span></a>                    <span class="s2">&quot;[ERROR] Could not resolve EXPERIMENT_DIR from cfg.conf_dict[&#39;PATHS&#39;]. &quot;</span>
</span><span id="TramDagModel.load_sampled_and_latents-1517"><a href="#TramDagModel.load_sampled_and_latents-1517"><span class="linenos">1517</span></a>                    <span class="s2">&quot;Please provide EXPERIMENT_DIR explicitly.&quot;</span>
</span><span id="TramDagModel.load_sampled_and_latents-1518"><a href="#TramDagModel.load_sampled_and_latents-1518"><span class="linenos">1518</span></a>                <span class="p">)</span>
</span><span id="TramDagModel.load_sampled_and_latents-1519"><a href="#TramDagModel.load_sampled_and_latents-1519"><span class="linenos">1519</span></a>
</span><span id="TramDagModel.load_sampled_and_latents-1520"><a href="#TramDagModel.load_sampled_and_latents-1520"><span class="linenos">1520</span></a>        <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel.load_sampled_and_latents-1521"><a href="#TramDagModel.load_sampled_and_latents-1521"><span class="linenos">1521</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;nodes_dict&quot;</span><span class="p">):</span>
</span><span id="TramDagModel.load_sampled_and_latents-1522"><a href="#TramDagModel.load_sampled_and_latents-1522"><span class="linenos">1522</span></a>                <span class="n">nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel.load_sampled_and_latents-1523"><a href="#TramDagModel.load_sampled_and_latents-1523"><span class="linenos">1523</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.load_sampled_and_latents-1524"><a href="#TramDagModel.load_sampled_and_latents-1524"><span class="linenos">1524</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TramDagModel.load_sampled_and_latents-1525"><a href="#TramDagModel.load_sampled_and_latents-1525"><span class="linenos">1525</span></a>                    <span class="s2">&quot;[ERROR] No node list found. Please provide `nodes` or initialize model with a config.&quot;</span>
</span><span id="TramDagModel.load_sampled_and_latents-1526"><a href="#TramDagModel.load_sampled_and_latents-1526"><span class="linenos">1526</span></a>                <span class="p">)</span>
</span><span id="TramDagModel.load_sampled_and_latents-1527"><a href="#TramDagModel.load_sampled_and_latents-1527"><span class="linenos">1527</span></a>
</span><span id="TramDagModel.load_sampled_and_latents-1528"><a href="#TramDagModel.load_sampled_and_latents-1528"><span class="linenos">1528</span></a>        <span class="c1"># --- load tensors ---</span>
</span><span id="TramDagModel.load_sampled_and_latents-1529"><a href="#TramDagModel.load_sampled_and_latents-1529"><span class="linenos">1529</span></a>        <span class="n">sampled_by_node</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel.load_sampled_and_latents-1530"><a href="#TramDagModel.load_sampled_and_latents-1530"><span class="linenos">1530</span></a>        <span class="n">latents_by_node</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel.load_sampled_and_latents-1531"><a href="#TramDagModel.load_sampled_and_latents-1531"><span class="linenos">1531</span></a>
</span><span id="TramDagModel.load_sampled_and_latents-1532"><a href="#TramDagModel.load_sampled_and_latents-1532"><span class="linenos">1532</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
</span><span id="TramDagModel.load_sampled_and_latents-1533"><a href="#TramDagModel.load_sampled_and_latents-1533"><span class="linenos">1533</span></a>            <span class="n">node_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.load_sampled_and_latents-1534"><a href="#TramDagModel.load_sampled_and_latents-1534"><span class="linenos">1534</span></a>            <span class="n">sampling_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="s2">&quot;sampling&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.load_sampled_and_latents-1535"><a href="#TramDagModel.load_sampled_and_latents-1535"><span class="linenos">1535</span></a>
</span><span id="TramDagModel.load_sampled_and_latents-1536"><a href="#TramDagModel.load_sampled_and_latents-1536"><span class="linenos">1536</span></a>            <span class="n">sampled_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sampling_dir</span><span class="p">,</span> <span class="s2">&quot;sampled.pt&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.load_sampled_and_latents-1537"><a href="#TramDagModel.load_sampled_and_latents-1537"><span class="linenos">1537</span></a>            <span class="n">latents_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sampling_dir</span><span class="p">,</span> <span class="s2">&quot;latents.pt&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.load_sampled_and_latents-1538"><a href="#TramDagModel.load_sampled_and_latents-1538"><span class="linenos">1538</span></a>
</span><span id="TramDagModel.load_sampled_and_latents-1539"><a href="#TramDagModel.load_sampled_and_latents-1539"><span class="linenos">1539</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">sampled_path</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">latents_path</span><span class="p">):</span>
</span><span id="TramDagModel.load_sampled_and_latents-1540"><a href="#TramDagModel.load_sampled_and_latents-1540"><span class="linenos">1540</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] Missing files for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;  skipping.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.load_sampled_and_latents-1541"><a href="#TramDagModel.load_sampled_and_latents-1541"><span class="linenos">1541</span></a>                <span class="k">continue</span>
</span><span id="TramDagModel.load_sampled_and_latents-1542"><a href="#TramDagModel.load_sampled_and_latents-1542"><span class="linenos">1542</span></a>
</span><span id="TramDagModel.load_sampled_and_latents-1543"><a href="#TramDagModel.load_sampled_and_latents-1543"><span class="linenos">1543</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.load_sampled_and_latents-1544"><a href="#TramDagModel.load_sampled_and_latents-1544"><span class="linenos">1544</span></a>                <span class="n">sampled</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">sampled_path</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.load_sampled_and_latents-1545"><a href="#TramDagModel.load_sampled_and_latents-1545"><span class="linenos">1545</span></a>                <span class="n">latent_sample</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">latents_path</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.load_sampled_and_latents-1546"><a href="#TramDagModel.load_sampled_and_latents-1546"><span class="linenos">1546</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel.load_sampled_and_latents-1547"><a href="#TramDagModel.load_sampled_and_latents-1547"><span class="linenos">1547</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] Could not load sampling files for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.load_sampled_and_latents-1548"><a href="#TramDagModel.load_sampled_and_latents-1548"><span class="linenos">1548</span></a>                <span class="k">continue</span>
</span><span id="TramDagModel.load_sampled_and_latents-1549"><a href="#TramDagModel.load_sampled_and_latents-1549"><span class="linenos">1549</span></a>
</span><span id="TramDagModel.load_sampled_and_latents-1550"><a href="#TramDagModel.load_sampled_and_latents-1550"><span class="linenos">1550</span></a>            <span class="n">sampled_by_node</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">sampled</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
</span><span id="TramDagModel.load_sampled_and_latents-1551"><a href="#TramDagModel.load_sampled_and_latents-1551"><span class="linenos">1551</span></a>            <span class="n">latents_by_node</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">latent_sample</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
</span><span id="TramDagModel.load_sampled_and_latents-1552"><a href="#TramDagModel.load_sampled_and_latents-1552"><span class="linenos">1552</span></a>
</span><span id="TramDagModel.load_sampled_and_latents-1553"><a href="#TramDagModel.load_sampled_and_latents-1553"><span class="linenos">1553</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel.load_sampled_and_latents-1554"><a href="#TramDagModel.load_sampled_and_latents-1554"><span class="linenos">1554</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Loaded sampled and latent tensors for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sampled_by_node</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes from </span><span class="si">{</span><span class="n">EXPERIMENT_DIR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.load_sampled_and_latents-1555"><a href="#TramDagModel.load_sampled_and_latents-1555"><span class="linenos">1555</span></a>
</span><span id="TramDagModel.load_sampled_and_latents-1556"><a href="#TramDagModel.load_sampled_and_latents-1556"><span class="linenos">1556</span></a>        <span class="k">return</span> <span class="n">sampled_by_node</span><span class="p">,</span> <span class="n">latents_by_node</span>
</span></pre></div>


            <div class="docstring"><p>Load previously stored sampled values and latents for each node.</p>

<h2 id="parameters">Parameters</h2>

<p>EXPERIMENT_DIR : str or None, optional
    Experiment directory path. If None, it is taken from
    <code>self.cfg.conf_dict["PATHS"]["EXPERIMENT_DIR"]</code>.
nodes : list of str or None, optional
    Nodes for which to load samples. If None, use all nodes from
    <code>self.nodes_dict</code>.</p>

<h2 id="returns">Returns</h2>

<p>tuple
    A tuple <code>(sampled_by_node, latents_by_node)</code>:</p>

<pre><code>sampled_by_node : dict
    Mapping ``{node_name: torch.Tensor}`` of sampled values (on CPU).
latents_by_node : dict
    Mapping ``{node_name: torch.Tensor}`` of latent values (on CPU).
</code></pre>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the experiment directory cannot be resolved or if no node list
    is available and <code>nodes</code> is None.</p>

<h2 id="notes">Notes</h2>

<p>Nodes without both <code>sampled.pt</code> and <code>latents.pt</code> files are skipped
with a warning.</p>
</div>


                            </div>
                            <div id="TramDagModel.plot_samples_vs_true" class="classattr">
                                        <input id="TramDagModel.plot_samples_vs_true-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_samples_vs_true</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">df</span>,</span><span class="param">	<span class="n">sampled</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">variable</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>,</span><span class="param">	<span class="n">hist_true_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>,</span><span class="param">	<span class="n">hist_est_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span>,</span><span class="param">	<span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.plot_samples_vs_true-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.plot_samples_vs_true"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.plot_samples_vs_true-1558"><a href="#TramDagModel.plot_samples_vs_true-1558"><span class="linenos">1558</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_samples_vs_true</span><span class="p">(</span>
</span><span id="TramDagModel.plot_samples_vs_true-1559"><a href="#TramDagModel.plot_samples_vs_true-1559"><span class="linenos">1559</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TramDagModel.plot_samples_vs_true-1560"><a href="#TramDagModel.plot_samples_vs_true-1560"><span class="linenos">1560</span></a>        <span class="n">df</span><span class="p">,</span>
</span><span id="TramDagModel.plot_samples_vs_true-1561"><a href="#TramDagModel.plot_samples_vs_true-1561"><span class="linenos">1561</span></a>        <span class="n">sampled</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagModel.plot_samples_vs_true-1562"><a href="#TramDagModel.plot_samples_vs_true-1562"><span class="linenos">1562</span></a>        <span class="n">variable</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TramDagModel.plot_samples_vs_true-1563"><a href="#TramDagModel.plot_samples_vs_true-1563"><span class="linenos">1563</span></a>        <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="TramDagModel.plot_samples_vs_true-1564"><a href="#TramDagModel.plot_samples_vs_true-1564"><span class="linenos">1564</span></a>        <span class="n">hist_true_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="TramDagModel.plot_samples_vs_true-1565"><a href="#TramDagModel.plot_samples_vs_true-1565"><span class="linenos">1565</span></a>        <span class="n">hist_est_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span>
</span><span id="TramDagModel.plot_samples_vs_true-1566"><a href="#TramDagModel.plot_samples_vs_true-1566"><span class="linenos">1566</span></a>        <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
</span><span id="TramDagModel.plot_samples_vs_true-1567"><a href="#TramDagModel.plot_samples_vs_true-1567"><span class="linenos">1567</span></a>    <span class="p">):</span>
</span><span id="TramDagModel.plot_samples_vs_true-1568"><a href="#TramDagModel.plot_samples_vs_true-1568"><span class="linenos">1568</span></a><span class="w">        </span>
</span><span id="TramDagModel.plot_samples_vs_true-1569"><a href="#TramDagModel.plot_samples_vs_true-1569"><span class="linenos">1569</span></a><span class="w">        </span>
</span><span id="TramDagModel.plot_samples_vs_true-1570"><a href="#TramDagModel.plot_samples_vs_true-1570"><span class="linenos">1570</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.plot_samples_vs_true-1571"><a href="#TramDagModel.plot_samples_vs_true-1571"><span class="linenos">1571</span></a><span class="sd">        Compare sampled vs. observed distributions for selected nodes.</span>
</span><span id="TramDagModel.plot_samples_vs_true-1572"><a href="#TramDagModel.plot_samples_vs_true-1572"><span class="linenos">1572</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1573"><a href="#TramDagModel.plot_samples_vs_true-1573"><span class="linenos">1573</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.plot_samples_vs_true-1574"><a href="#TramDagModel.plot_samples_vs_true-1574"><span class="linenos">1574</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.plot_samples_vs_true-1575"><a href="#TramDagModel.plot_samples_vs_true-1575"><span class="linenos">1575</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="TramDagModel.plot_samples_vs_true-1576"><a href="#TramDagModel.plot_samples_vs_true-1576"><span class="linenos">1576</span></a><span class="sd">            Data frame containing the observed node values.</span>
</span><span id="TramDagModel.plot_samples_vs_true-1577"><a href="#TramDagModel.plot_samples_vs_true-1577"><span class="linenos">1577</span></a><span class="sd">        sampled : dict or None, optional</span>
</span><span id="TramDagModel.plot_samples_vs_true-1578"><a href="#TramDagModel.plot_samples_vs_true-1578"><span class="linenos">1578</span></a><span class="sd">            Optional mapping ``{node_name: array-like or torch.Tensor}`` of sampled</span>
</span><span id="TramDagModel.plot_samples_vs_true-1579"><a href="#TramDagModel.plot_samples_vs_true-1579"><span class="linenos">1579</span></a><span class="sd">            values. If None or if a node is missing, samples are loaded from</span>
</span><span id="TramDagModel.plot_samples_vs_true-1580"><a href="#TramDagModel.plot_samples_vs_true-1580"><span class="linenos">1580</span></a><span class="sd">            ``EXPERIMENT_DIR/{node}/sampling/sampled.pt``.</span>
</span><span id="TramDagModel.plot_samples_vs_true-1581"><a href="#TramDagModel.plot_samples_vs_true-1581"><span class="linenos">1581</span></a><span class="sd">        variable : list of str or None, optional</span>
</span><span id="TramDagModel.plot_samples_vs_true-1582"><a href="#TramDagModel.plot_samples_vs_true-1582"><span class="linenos">1582</span></a><span class="sd">            Subset of nodes to plot. If None, all nodes in the configuration</span>
</span><span id="TramDagModel.plot_samples_vs_true-1583"><a href="#TramDagModel.plot_samples_vs_true-1583"><span class="linenos">1583</span></a><span class="sd">            are considered.</span>
</span><span id="TramDagModel.plot_samples_vs_true-1584"><a href="#TramDagModel.plot_samples_vs_true-1584"><span class="linenos">1584</span></a><span class="sd">        bins : int, optional</span>
</span><span id="TramDagModel.plot_samples_vs_true-1585"><a href="#TramDagModel.plot_samples_vs_true-1585"><span class="linenos">1585</span></a><span class="sd">            Number of histogram bins for continuous variables. Default is 100.</span>
</span><span id="TramDagModel.plot_samples_vs_true-1586"><a href="#TramDagModel.plot_samples_vs_true-1586"><span class="linenos">1586</span></a><span class="sd">        hist_true_color : str, optional</span>
</span><span id="TramDagModel.plot_samples_vs_true-1587"><a href="#TramDagModel.plot_samples_vs_true-1587"><span class="linenos">1587</span></a><span class="sd">            Color name for the histogram of true values. Default is &quot;blue&quot;.</span>
</span><span id="TramDagModel.plot_samples_vs_true-1588"><a href="#TramDagModel.plot_samples_vs_true-1588"><span class="linenos">1588</span></a><span class="sd">        hist_est_color : str, optional</span>
</span><span id="TramDagModel.plot_samples_vs_true-1589"><a href="#TramDagModel.plot_samples_vs_true-1589"><span class="linenos">1589</span></a><span class="sd">            Color name for the histogram of sampled values. Default is &quot;orange&quot;.</span>
</span><span id="TramDagModel.plot_samples_vs_true-1590"><a href="#TramDagModel.plot_samples_vs_true-1590"><span class="linenos">1590</span></a><span class="sd">        figsize : tuple, optional</span>
</span><span id="TramDagModel.plot_samples_vs_true-1591"><a href="#TramDagModel.plot_samples_vs_true-1591"><span class="linenos">1591</span></a><span class="sd">            Figure size for the matplotlib plots. Default is (14, 5).</span>
</span><span id="TramDagModel.plot_samples_vs_true-1592"><a href="#TramDagModel.plot_samples_vs_true-1592"><span class="linenos">1592</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1593"><a href="#TramDagModel.plot_samples_vs_true-1593"><span class="linenos">1593</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.plot_samples_vs_true-1594"><a href="#TramDagModel.plot_samples_vs_true-1594"><span class="linenos">1594</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.plot_samples_vs_true-1595"><a href="#TramDagModel.plot_samples_vs_true-1595"><span class="linenos">1595</span></a><span class="sd">        None</span>
</span><span id="TramDagModel.plot_samples_vs_true-1596"><a href="#TramDagModel.plot_samples_vs_true-1596"><span class="linenos">1596</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1597"><a href="#TramDagModel.plot_samples_vs_true-1597"><span class="linenos">1597</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.plot_samples_vs_true-1598"><a href="#TramDagModel.plot_samples_vs_true-1598"><span class="linenos">1598</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.plot_samples_vs_true-1599"><a href="#TramDagModel.plot_samples_vs_true-1599"><span class="linenos">1599</span></a><span class="sd">        - Continuous outcomes: histogram overlay + QQ-plot.</span>
</span><span id="TramDagModel.plot_samples_vs_true-1600"><a href="#TramDagModel.plot_samples_vs_true-1600"><span class="linenos">1600</span></a><span class="sd">        - Ordinal outcomes: side-by-side bar plot of relative frequencies.</span>
</span><span id="TramDagModel.plot_samples_vs_true-1601"><a href="#TramDagModel.plot_samples_vs_true-1601"><span class="linenos">1601</span></a><span class="sd">        - Other categorical outcomes: side-by-side bar plot with category labels.</span>
</span><span id="TramDagModel.plot_samples_vs_true-1602"><a href="#TramDagModel.plot_samples_vs_true-1602"><span class="linenos">1602</span></a><span class="sd">        - If samples are probabilistic (2D tensor), the argmax across classes is used.</span>
</span><span id="TramDagModel.plot_samples_vs_true-1603"><a href="#TramDagModel.plot_samples_vs_true-1603"><span class="linenos">1603</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.plot_samples_vs_true-1604"><a href="#TramDagModel.plot_samples_vs_true-1604"><span class="linenos">1604</span></a>        
</span><span id="TramDagModel.plot_samples_vs_true-1605"><a href="#TramDagModel.plot_samples_vs_true-1605"><span class="linenos">1605</span></a>        <span class="n">target_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.plot_samples_vs_true-1606"><a href="#TramDagModel.plot_samples_vs_true-1606"><span class="linenos">1606</span></a>        <span class="n">experiment_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.plot_samples_vs_true-1607"><a href="#TramDagModel.plot_samples_vs_true-1607"><span class="linenos">1607</span></a>        <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1608"><a href="#TramDagModel.plot_samples_vs_true-1608"><span class="linenos">1608</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1609"><a href="#TramDagModel.plot_samples_vs_true-1609"><span class="linenos">1609</span></a>        <span class="n">plot_list</span> <span class="o">=</span> <span class="n">variable</span> <span class="k">if</span> <span class="n">variable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">target_nodes</span>
</span><span id="TramDagModel.plot_samples_vs_true-1610"><a href="#TramDagModel.plot_samples_vs_true-1610"><span class="linenos">1610</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1611"><a href="#TramDagModel.plot_samples_vs_true-1611"><span class="linenos">1611</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">plot_list</span><span class="p">:</span>
</span><span id="TramDagModel.plot_samples_vs_true-1612"><a href="#TramDagModel.plot_samples_vs_true-1612"><span class="linenos">1612</span></a>            <span class="c1"># Load sampled data</span>
</span><span id="TramDagModel.plot_samples_vs_true-1613"><a href="#TramDagModel.plot_samples_vs_true-1613"><span class="linenos">1613</span></a>            <span class="k">if</span> <span class="n">sampled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">sampled</span><span class="p">:</span>
</span><span id="TramDagModel.plot_samples_vs_true-1614"><a href="#TramDagModel.plot_samples_vs_true-1614"><span class="linenos">1614</span></a>                <span class="n">sdata</span> <span class="o">=</span> <span class="n">sampled</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel.plot_samples_vs_true-1615"><a href="#TramDagModel.plot_samples_vs_true-1615"><span class="linenos">1615</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sdata</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
</span><span id="TramDagModel.plot_samples_vs_true-1616"><a href="#TramDagModel.plot_samples_vs_true-1616"><span class="linenos">1616</span></a>                    <span class="n">sampled_vals</span> <span class="o">=</span> <span class="n">sdata</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="TramDagModel.plot_samples_vs_true-1617"><a href="#TramDagModel.plot_samples_vs_true-1617"><span class="linenos">1617</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.plot_samples_vs_true-1618"><a href="#TramDagModel.plot_samples_vs_true-1618"><span class="linenos">1618</span></a>                    <span class="n">sampled_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sdata</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1619"><a href="#TramDagModel.plot_samples_vs_true-1619"><span class="linenos">1619</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.plot_samples_vs_true-1620"><a href="#TramDagModel.plot_samples_vs_true-1620"><span class="linenos">1620</span></a>                <span class="n">sample_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">experiment_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">/sampling/sampled.pt&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1621"><a href="#TramDagModel.plot_samples_vs_true-1621"><span class="linenos">1621</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">sample_path</span><span class="p">):</span>
</span><span id="TramDagModel.plot_samples_vs_true-1622"><a href="#TramDagModel.plot_samples_vs_true-1622"><span class="linenos">1622</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] skip </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">sample_path</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1623"><a href="#TramDagModel.plot_samples_vs_true-1623"><span class="linenos">1623</span></a>                    <span class="k">continue</span>
</span><span id="TramDagModel.plot_samples_vs_true-1624"><a href="#TramDagModel.plot_samples_vs_true-1624"><span class="linenos">1624</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1625"><a href="#TramDagModel.plot_samples_vs_true-1625"><span class="linenos">1625</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.plot_samples_vs_true-1626"><a href="#TramDagModel.plot_samples_vs_true-1626"><span class="linenos">1626</span></a>                    <span class="n">sampled_vals</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">sample_path</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="TramDagModel.plot_samples_vs_true-1627"><a href="#TramDagModel.plot_samples_vs_true-1627"><span class="linenos">1627</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel.plot_samples_vs_true-1628"><a href="#TramDagModel.plot_samples_vs_true-1628"><span class="linenos">1628</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] Could not load </span><span class="si">{</span><span class="n">sample_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1629"><a href="#TramDagModel.plot_samples_vs_true-1629"><span class="linenos">1629</span></a>                    <span class="k">continue</span>
</span><span id="TramDagModel.plot_samples_vs_true-1630"><a href="#TramDagModel.plot_samples_vs_true-1630"><span class="linenos">1630</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1631"><a href="#TramDagModel.plot_samples_vs_true-1631"><span class="linenos">1631</span></a>            <span class="c1"># If logits/probabilities per sample, take argmax</span>
</span><span id="TramDagModel.plot_samples_vs_true-1632"><a href="#TramDagModel.plot_samples_vs_true-1632"><span class="linenos">1632</span></a>            <span class="k">if</span> <span class="n">sampled_vals</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="TramDagModel.plot_samples_vs_true-1633"><a href="#TramDagModel.plot_samples_vs_true-1633"><span class="linenos">1633</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] CAUTION! </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">: samples are probabilistic  each sample follows a probability &quot;</span>
</span><span id="TramDagModel.plot_samples_vs_true-1634"><a href="#TramDagModel.plot_samples_vs_true-1634"><span class="linenos">1634</span></a>                    <span class="sa">f</span><span class="s2">&quot;distribution based on the valid latent range. &quot;</span>
</span><span id="TramDagModel.plot_samples_vs_true-1635"><a href="#TramDagModel.plot_samples_vs_true-1635"><span class="linenos">1635</span></a>                    <span class="sa">f</span><span class="s2">&quot;Note that this frequency plot reflects only the distribution of the most probable &quot;</span>
</span><span id="TramDagModel.plot_samples_vs_true-1636"><a href="#TramDagModel.plot_samples_vs_true-1636"><span class="linenos">1636</span></a>                    <span class="sa">f</span><span class="s2">&quot;class per sample.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1637"><a href="#TramDagModel.plot_samples_vs_true-1637"><span class="linenos">1637</span></a>                    <span class="n">sampled_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sampled_vals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1638"><a href="#TramDagModel.plot_samples_vs_true-1638"><span class="linenos">1638</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1639"><a href="#TramDagModel.plot_samples_vs_true-1639"><span class="linenos">1639</span></a>            <span class="n">sampled_vals</span> <span class="o">=</span> <span class="n">sampled_vals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">sampled_vals</span><span class="p">)]</span>
</span><span id="TramDagModel.plot_samples_vs_true-1640"><a href="#TramDagModel.plot_samples_vs_true-1640"><span class="linenos">1640</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1641"><a href="#TramDagModel.plot_samples_vs_true-1641"><span class="linenos">1641</span></a>            <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="TramDagModel.plot_samples_vs_true-1642"><a href="#TramDagModel.plot_samples_vs_true-1642"><span class="linenos">1642</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] skip </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">: column not found in DataFrame.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1643"><a href="#TramDagModel.plot_samples_vs_true-1643"><span class="linenos">1643</span></a>                <span class="k">continue</span>
</span><span id="TramDagModel.plot_samples_vs_true-1644"><a href="#TramDagModel.plot_samples_vs_true-1644"><span class="linenos">1644</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1645"><a href="#TramDagModel.plot_samples_vs_true-1645"><span class="linenos">1645</span></a>            <span class="n">true_vals</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
</span><span id="TramDagModel.plot_samples_vs_true-1646"><a href="#TramDagModel.plot_samples_vs_true-1646"><span class="linenos">1646</span></a>            <span class="n">true_vals</span> <span class="o">=</span> <span class="n">true_vals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">true_vals</span><span class="p">)]</span>
</span><span id="TramDagModel.plot_samples_vs_true-1647"><a href="#TramDagModel.plot_samples_vs_true-1647"><span class="linenos">1647</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1648"><a href="#TramDagModel.plot_samples_vs_true-1648"><span class="linenos">1648</span></a>            <span class="k">if</span> <span class="n">sampled_vals</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">true_vals</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="TramDagModel.plot_samples_vs_true-1649"><a href="#TramDagModel.plot_samples_vs_true-1649"><span class="linenos">1649</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] skip </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">: empty array after NaN/Inf removal.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1650"><a href="#TramDagModel.plot_samples_vs_true-1650"><span class="linenos">1650</span></a>                <span class="k">continue</span>
</span><span id="TramDagModel.plot_samples_vs_true-1651"><a href="#TramDagModel.plot_samples_vs_true-1651"><span class="linenos">1651</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1652"><a href="#TramDagModel.plot_samples_vs_true-1652"><span class="linenos">1652</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1653"><a href="#TramDagModel.plot_samples_vs_true-1653"><span class="linenos">1653</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1654"><a href="#TramDagModel.plot_samples_vs_true-1654"><span class="linenos">1654</span></a>            <span class="k">if</span> <span class="n">is_outcome_modelled_continous</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">target_nodes</span><span class="p">):</span>
</span><span id="TramDagModel.plot_samples_vs_true-1655"><a href="#TramDagModel.plot_samples_vs_true-1655"><span class="linenos">1655</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">true_vals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
</span><span id="TramDagModel.plot_samples_vs_true-1656"><a href="#TramDagModel.plot_samples_vs_true-1656"><span class="linenos">1656</span></a>                            <span class="n">color</span><span class="o">=</span><span class="n">hist_true_color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;True </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1657"><a href="#TramDagModel.plot_samples_vs_true-1657"><span class="linenos">1657</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sampled_vals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
</span><span id="TramDagModel.plot_samples_vs_true-1658"><a href="#TramDagModel.plot_samples_vs_true-1658"><span class="linenos">1658</span></a>                            <span class="n">color</span><span class="o">=</span><span class="n">hist_est_color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sampled&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1659"><a href="#TramDagModel.plot_samples_vs_true-1659"><span class="linenos">1659</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1660"><a href="#TramDagModel.plot_samples_vs_true-1660"><span class="linenos">1660</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1661"><a href="#TramDagModel.plot_samples_vs_true-1661"><span class="linenos">1661</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Histogram overlay for </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1662"><a href="#TramDagModel.plot_samples_vs_true-1662"><span class="linenos">1662</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="TramDagModel.plot_samples_vs_true-1663"><a href="#TramDagModel.plot_samples_vs_true-1663"><span class="linenos">1663</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1664"><a href="#TramDagModel.plot_samples_vs_true-1664"><span class="linenos">1664</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1665"><a href="#TramDagModel.plot_samples_vs_true-1665"><span class="linenos">1665</span></a>                <span class="n">qqplot_2samples</span><span class="p">(</span><span class="n">true_vals</span><span class="p">,</span> <span class="n">sampled_vals</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="s2">&quot;45&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="TramDagModel.plot_samples_vs_true-1666"><a href="#TramDagModel.plot_samples_vs_true-1666"><span class="linenos">1666</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;True quantiles&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1667"><a href="#TramDagModel.plot_samples_vs_true-1667"><span class="linenos">1667</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Sampled quantiles&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1668"><a href="#TramDagModel.plot_samples_vs_true-1668"><span class="linenos">1668</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;QQ plot for </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1669"><a href="#TramDagModel.plot_samples_vs_true-1669"><span class="linenos">1669</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1670"><a href="#TramDagModel.plot_samples_vs_true-1670"><span class="linenos">1670</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1671"><a href="#TramDagModel.plot_samples_vs_true-1671"><span class="linenos">1671</span></a>            <span class="k">elif</span> <span class="n">is_outcome_modelled_ordinal</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">target_nodes</span><span class="p">):</span>
</span><span id="TramDagModel.plot_samples_vs_true-1672"><a href="#TramDagModel.plot_samples_vs_true-1672"><span class="linenos">1672</span></a>                <span class="n">unique_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">union1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">true_vals</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">sampled_vals</span><span class="p">))</span>
</span><span id="TramDagModel.plot_samples_vs_true-1673"><a href="#TramDagModel.plot_samples_vs_true-1673"><span class="linenos">1673</span></a>                <span class="n">unique_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1674"><a href="#TramDagModel.plot_samples_vs_true-1674"><span class="linenos">1674</span></a>                <span class="n">true_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">true_vals</span> <span class="o">==</span> <span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">unique_vals</span><span class="p">])</span>
</span><span id="TramDagModel.plot_samples_vs_true-1675"><a href="#TramDagModel.plot_samples_vs_true-1675"><span class="linenos">1675</span></a>                <span class="n">sampled_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">sampled_vals</span> <span class="o">==</span> <span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">unique_vals</span><span class="p">])</span>
</span><span id="TramDagModel.plot_samples_vs_true-1676"><a href="#TramDagModel.plot_samples_vs_true-1676"><span class="linenos">1676</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1677"><a href="#TramDagModel.plot_samples_vs_true-1677"><span class="linenos">1677</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">unique_vals</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">true_counts</span> <span class="o">/</span> <span class="n">true_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
</span><span id="TramDagModel.plot_samples_vs_true-1678"><a href="#TramDagModel.plot_samples_vs_true-1678"><span class="linenos">1678</span></a>                        <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">hist_true_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1679"><a href="#TramDagModel.plot_samples_vs_true-1679"><span class="linenos">1679</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">unique_vals</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">sampled_counts</span> <span class="o">/</span> <span class="n">sampled_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
</span><span id="TramDagModel.plot_samples_vs_true-1680"><a href="#TramDagModel.plot_samples_vs_true-1680"><span class="linenos">1680</span></a>                        <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">hist_est_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sampled&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1681"><a href="#TramDagModel.plot_samples_vs_true-1681"><span class="linenos">1681</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1682"><a href="#TramDagModel.plot_samples_vs_true-1682"><span class="linenos">1682</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Ordinal Level&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1683"><a href="#TramDagModel.plot_samples_vs_true-1683"><span class="linenos">1683</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Relative Frequency&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1684"><a href="#TramDagModel.plot_samples_vs_true-1684"><span class="linenos">1684</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ordinal bar plot for </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1685"><a href="#TramDagModel.plot_samples_vs_true-1685"><span class="linenos">1685</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="TramDagModel.plot_samples_vs_true-1686"><a href="#TramDagModel.plot_samples_vs_true-1686"><span class="linenos">1686</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1687"><a href="#TramDagModel.plot_samples_vs_true-1687"><span class="linenos">1687</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1688"><a href="#TramDagModel.plot_samples_vs_true-1688"><span class="linenos">1688</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1689"><a href="#TramDagModel.plot_samples_vs_true-1689"><span class="linenos">1689</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.plot_samples_vs_true-1690"><a href="#TramDagModel.plot_samples_vs_true-1690"><span class="linenos">1690</span></a>                <span class="n">unique_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">union1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">true_vals</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">sampled_vals</span><span class="p">))</span>
</span><span id="TramDagModel.plot_samples_vs_true-1691"><a href="#TramDagModel.plot_samples_vs_true-1691"><span class="linenos">1691</span></a>                <span class="n">unique_vals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1692"><a href="#TramDagModel.plot_samples_vs_true-1692"><span class="linenos">1692</span></a>                <span class="n">true_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">true_vals</span> <span class="o">==</span> <span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">unique_vals</span><span class="p">])</span>
</span><span id="TramDagModel.plot_samples_vs_true-1693"><a href="#TramDagModel.plot_samples_vs_true-1693"><span class="linenos">1693</span></a>                <span class="n">sampled_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">sampled_vals</span> <span class="o">==</span> <span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">unique_vals</span><span class="p">])</span>
</span><span id="TramDagModel.plot_samples_vs_true-1694"><a href="#TramDagModel.plot_samples_vs_true-1694"><span class="linenos">1694</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1695"><a href="#TramDagModel.plot_samples_vs_true-1695"><span class="linenos">1695</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">true_counts</span> <span class="o">/</span> <span class="n">true_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
</span><span id="TramDagModel.plot_samples_vs_true-1696"><a href="#TramDagModel.plot_samples_vs_true-1696"><span class="linenos">1696</span></a>                        <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">hist_true_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1697"><a href="#TramDagModel.plot_samples_vs_true-1697"><span class="linenos">1697</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">sampled_counts</span> <span class="o">/</span> <span class="n">sampled_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
</span><span id="TramDagModel.plot_samples_vs_true-1698"><a href="#TramDagModel.plot_samples_vs_true-1698"><span class="linenos">1698</span></a>                        <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">hist_est_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sampled&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1699"><a href="#TramDagModel.plot_samples_vs_true-1699"><span class="linenos">1699</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">)))</span>
</span><span id="TramDagModel.plot_samples_vs_true-1700"><a href="#TramDagModel.plot_samples_vs_true-1700"><span class="linenos">1700</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1701"><a href="#TramDagModel.plot_samples_vs_true-1701"><span class="linenos">1701</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Category&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1702"><a href="#TramDagModel.plot_samples_vs_true-1702"><span class="linenos">1702</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Relative Frequency&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1703"><a href="#TramDagModel.plot_samples_vs_true-1703"><span class="linenos">1703</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Categorical bar plot for </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1704"><a href="#TramDagModel.plot_samples_vs_true-1704"><span class="linenos">1704</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="TramDagModel.plot_samples_vs_true-1705"><a href="#TramDagModel.plot_samples_vs_true-1705"><span class="linenos">1705</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1706"><a href="#TramDagModel.plot_samples_vs_true-1706"><span class="linenos">1706</span></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.plot_samples_vs_true-1707"><a href="#TramDagModel.plot_samples_vs_true-1707"><span class="linenos">1707</span></a>
</span><span id="TramDagModel.plot_samples_vs_true-1708"><a href="#TramDagModel.plot_samples_vs_true-1708"><span class="linenos">1708</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="TramDagModel.plot_samples_vs_true-1709"><a href="#TramDagModel.plot_samples_vs_true-1709"><span class="linenos">1709</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Compare sampled vs. observed distributions for selected nodes.</p>

<h2 id="parameters">Parameters</h2>

<p>df : pandas.DataFrame
    Data frame containing the observed node values.
sampled : dict or None, optional
    Optional mapping <code>{node_name: array-like or torch.Tensor}</code> of sampled
    values. If None or if a node is missing, samples are loaded from
    <code>EXPERIMENT_DIR/{node}/sampling/sampled.pt</code>.
variable : list of str or None, optional
    Subset of nodes to plot. If None, all nodes in the configuration
    are considered.
bins : int, optional
    Number of histogram bins for continuous variables. Default is 100.
hist_true_color : str, optional
    Color name for the histogram of true values. Default is "blue".
hist_est_color : str, optional
    Color name for the histogram of sampled values. Default is "orange".
figsize : tuple, optional
    Figure size for the matplotlib plots. Default is (14, 5).</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="notes">Notes</h2>

<ul>
<li>Continuous outcomes: histogram overlay + QQ-plot.</li>
<li>Ordinal outcomes: side-by-side bar plot of relative frequencies.</li>
<li>Other categorical outcomes: side-by-side bar plot with category labels.</li>
<li>If samples are probabilistic (2D tensor), the argmax across classes is used.</li>
</ul>
</div>


                            </div>
                            <div id="TramDagModel.nll" class="classattr">
                                        <input id="TramDagModel.nll-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nll</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">variables</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.nll-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.nll"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.nll-1712"><a href="#TramDagModel.nll-1712"><span class="linenos">1712</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="TramDagModel.nll-1713"><a href="#TramDagModel.nll-1713"><span class="linenos">1713</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.nll-1714"><a href="#TramDagModel.nll-1714"><span class="linenos">1714</span></a><span class="sd">        Compute the Negative Log-Likelihood (NLL) for all or selected TRAM nodes.</span>
</span><span id="TramDagModel.nll-1715"><a href="#TramDagModel.nll-1715"><span class="linenos">1715</span></a>
</span><span id="TramDagModel.nll-1716"><a href="#TramDagModel.nll-1716"><span class="linenos">1716</span></a><span class="sd">        This function evaluates trained TRAM models for each specified variable (node) </span>
</span><span id="TramDagModel.nll-1717"><a href="#TramDagModel.nll-1717"><span class="linenos">1717</span></a><span class="sd">        on the provided dataset. It performs forward passes onlyno training, no weight </span>
</span><span id="TramDagModel.nll-1718"><a href="#TramDagModel.nll-1718"><span class="linenos">1718</span></a><span class="sd">        updatesand returns the mean NLL per node.</span>
</span><span id="TramDagModel.nll-1719"><a href="#TramDagModel.nll-1719"><span class="linenos">1719</span></a>
</span><span id="TramDagModel.nll-1720"><a href="#TramDagModel.nll-1720"><span class="linenos">1720</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.nll-1721"><a href="#TramDagModel.nll-1721"><span class="linenos">1721</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.nll-1722"><a href="#TramDagModel.nll-1722"><span class="linenos">1722</span></a><span class="sd">        data : object</span>
</span><span id="TramDagModel.nll-1723"><a href="#TramDagModel.nll-1723"><span class="linenos">1723</span></a><span class="sd">            Input dataset or data source compatible with `_ensure_dataset`, containing </span>
</span><span id="TramDagModel.nll-1724"><a href="#TramDagModel.nll-1724"><span class="linenos">1724</span></a><span class="sd">            both inputs and targets for each node.</span>
</span><span id="TramDagModel.nll-1725"><a href="#TramDagModel.nll-1725"><span class="linenos">1725</span></a><span class="sd">        variables : list[str], optional</span>
</span><span id="TramDagModel.nll-1726"><a href="#TramDagModel.nll-1726"><span class="linenos">1726</span></a><span class="sd">            List of variable (node) names to evaluate. If None, all nodes in </span>
</span><span id="TramDagModel.nll-1727"><a href="#TramDagModel.nll-1727"><span class="linenos">1727</span></a><span class="sd">            `self.models` are evaluated.</span>
</span><span id="TramDagModel.nll-1728"><a href="#TramDagModel.nll-1728"><span class="linenos">1728</span></a>
</span><span id="TramDagModel.nll-1729"><a href="#TramDagModel.nll-1729"><span class="linenos">1729</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.nll-1730"><a href="#TramDagModel.nll-1730"><span class="linenos">1730</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.nll-1731"><a href="#TramDagModel.nll-1731"><span class="linenos">1731</span></a><span class="sd">        dict[str, float]</span>
</span><span id="TramDagModel.nll-1732"><a href="#TramDagModel.nll-1732"><span class="linenos">1732</span></a><span class="sd">            Dictionary mapping each node name to its average NLL value.</span>
</span><span id="TramDagModel.nll-1733"><a href="#TramDagModel.nll-1733"><span class="linenos">1733</span></a>
</span><span id="TramDagModel.nll-1734"><a href="#TramDagModel.nll-1734"><span class="linenos">1734</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.nll-1735"><a href="#TramDagModel.nll-1735"><span class="linenos">1735</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.nll-1736"><a href="#TramDagModel.nll-1736"><span class="linenos">1736</span></a><span class="sd">        - Each model is evaluated independently on its respective DataLoader.</span>
</span><span id="TramDagModel.nll-1737"><a href="#TramDagModel.nll-1737"><span class="linenos">1737</span></a><span class="sd">        - The normalization values (`min_max`) for each node are retrieved from </span>
</span><span id="TramDagModel.nll-1738"><a href="#TramDagModel.nll-1738"><span class="linenos">1738</span></a><span class="sd">          `self.minmax_dict[node]`.</span>
</span><span id="TramDagModel.nll-1739"><a href="#TramDagModel.nll-1739"><span class="linenos">1739</span></a><span class="sd">        - The function uses `evaluate_tramdag_model()` for per-node evaluation.</span>
</span><span id="TramDagModel.nll-1740"><a href="#TramDagModel.nll-1740"><span class="linenos">1740</span></a><span class="sd">        - Expected directory structure:</span>
</span><span id="TramDagModel.nll-1741"><a href="#TramDagModel.nll-1741"><span class="linenos">1741</span></a><span class="sd">              `&lt;EXPERIMENT_DIR&gt;/&lt;node&gt;/`</span>
</span><span id="TramDagModel.nll-1742"><a href="#TramDagModel.nll-1742"><span class="linenos">1742</span></a><span class="sd">          where each node directory contains the trained model.</span>
</span><span id="TramDagModel.nll-1743"><a href="#TramDagModel.nll-1743"><span class="linenos">1743</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.nll-1744"><a href="#TramDagModel.nll-1744"><span class="linenos">1744</span></a>
</span><span id="TramDagModel.nll-1745"><a href="#TramDagModel.nll-1745"><span class="linenos">1745</span></a>        <span class="n">td_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_dataset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">is_val</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
</span><span id="TramDagModel.nll-1746"><a href="#TramDagModel.nll-1746"><span class="linenos">1746</span></a>        <span class="n">variables_list</span> <span class="o">=</span> <span class="n">variables</span> <span class="k">if</span> <span class="n">variables</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel.nll-1747"><a href="#TramDagModel.nll-1747"><span class="linenos">1747</span></a>        <span class="n">nll_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel.nll-1748"><a href="#TramDagModel.nll-1748"><span class="linenos">1748</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">variables_list</span><span class="p">:</span>  
</span><span id="TramDagModel.nll-1749"><a href="#TramDagModel.nll-1749"><span class="linenos">1749</span></a>                <span class="n">min_vals</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="TramDagModel.nll-1750"><a href="#TramDagModel.nll-1750"><span class="linenos">1750</span></a>                <span class="n">max_vals</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minmax_dict</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="TramDagModel.nll-1751"><a href="#TramDagModel.nll-1751"><span class="linenos">1751</span></a>                <span class="n">min_max</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">min_vals</span><span class="p">,</span> <span class="n">max_vals</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="TramDagModel.nll-1752"><a href="#TramDagModel.nll-1752"><span class="linenos">1752</span></a>                <span class="n">data_loader</span> <span class="o">=</span> <span class="n">td_data</span><span class="o">.</span><span class="n">loaders</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel.nll-1753"><a href="#TramDagModel.nll-1753"><span class="linenos">1753</span></a>                <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel.nll-1754"><a href="#TramDagModel.nll-1754"><span class="linenos">1754</span></a>                <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.nll-1755"><a href="#TramDagModel.nll-1755"><span class="linenos">1755</span></a>                <span class="n">NODE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.nll-1756"><a href="#TramDagModel.nll-1756"><span class="linenos">1756</span></a>                <span class="n">nll</span><span class="o">=</span> <span class="n">evaluate_tramdag_model</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
</span><span id="TramDagModel.nll-1757"><a href="#TramDagModel.nll-1757"><span class="linenos">1757</span></a>                                            <span class="n">target_nodes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">,</span>
</span><span id="TramDagModel.nll-1758"><a href="#TramDagModel.nll-1758"><span class="linenos">1758</span></a>                                            <span class="n">NODE_DIR</span><span class="o">=</span><span class="n">NODE_DIR</span><span class="p">,</span>
</span><span id="TramDagModel.nll-1759"><a href="#TramDagModel.nll-1759"><span class="linenos">1759</span></a>                                            <span class="n">tram_model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
</span><span id="TramDagModel.nll-1760"><a href="#TramDagModel.nll-1760"><span class="linenos">1760</span></a>                                            <span class="n">data_loader</span><span class="o">=</span><span class="n">data_loader</span><span class="p">,</span>
</span><span id="TramDagModel.nll-1761"><a href="#TramDagModel.nll-1761"><span class="linenos">1761</span></a>                                            <span class="n">min_max</span><span class="o">=</span><span class="n">min_max</span><span class="p">)</span>
</span><span id="TramDagModel.nll-1762"><a href="#TramDagModel.nll-1762"><span class="linenos">1762</span></a>                <span class="n">nll_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">=</span><span class="n">nll</span>
</span><span id="TramDagModel.nll-1763"><a href="#TramDagModel.nll-1763"><span class="linenos">1763</span></a>        <span class="k">return</span> <span class="n">nll_dict</span>
</span></pre></div>


            <div class="docstring"><p>Compute the Negative Log-Likelihood (NLL) for all or selected TRAM nodes.</p>

<p>This function evaluates trained TRAM models for each specified variable (node) 
on the provided dataset. It performs forward passes onlyno training, no weight 
updatesand returns the mean NLL per node.</p>

<h2 id="parameters">Parameters</h2>

<p>data : object
    Input dataset or data source compatible with <code>_ensure_dataset</code>, containing 
    both inputs and targets for each node.
variables : list[str], optional
    List of variable (node) names to evaluate. If None, all nodes in 
    <code>self.models</code> are evaluated.</p>

<h2 id="returns">Returns</h2>

<p>dict[str, float]
    Dictionary mapping each node name to its average NLL value.</p>

<h2 id="notes">Notes</h2>

<ul>
<li>Each model is evaluated independently on its respective DataLoader.</li>
<li>The normalization values (<code>min_max</code>) for each node are retrieved from 
<code>self.minmax_dict[node]</code>.</li>
<li>The function uses <code>evaluate_tramdag_model()</code> for per-node evaluation.</li>
<li>Expected directory structure:
    <code>&lt;EXPERIMENT_DIR&gt;/&lt;node&gt;/</code>
where each node directory contains the trained model.</li>
</ul>
</div>


                            </div>
                            <div id="TramDagModel.get_train_val_nll" class="classattr">
                                        <input id="TramDagModel.get_train_val_nll-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_train_val_nll</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">node</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">mode</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="TramDagModel.get_train_val_nll-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.get_train_val_nll"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.get_train_val_nll-1765"><a href="#TramDagModel.get_train_val_nll-1765"><span class="linenos">1765</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_train_val_nll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="TramDagModel.get_train_val_nll-1766"><a href="#TramDagModel.get_train_val_nll-1766"><span class="linenos">1766</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.get_train_val_nll-1767"><a href="#TramDagModel.get_train_val_nll-1767"><span class="linenos">1767</span></a><span class="sd">        Retrieve training and validation NLL for a node and a given model state.</span>
</span><span id="TramDagModel.get_train_val_nll-1768"><a href="#TramDagModel.get_train_val_nll-1768"><span class="linenos">1768</span></a>
</span><span id="TramDagModel.get_train_val_nll-1769"><a href="#TramDagModel.get_train_val_nll-1769"><span class="linenos">1769</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.get_train_val_nll-1770"><a href="#TramDagModel.get_train_val_nll-1770"><span class="linenos">1770</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.get_train_val_nll-1771"><a href="#TramDagModel.get_train_val_nll-1771"><span class="linenos">1771</span></a><span class="sd">        node : str</span>
</span><span id="TramDagModel.get_train_val_nll-1772"><a href="#TramDagModel.get_train_val_nll-1772"><span class="linenos">1772</span></a><span class="sd">            Node name.</span>
</span><span id="TramDagModel.get_train_val_nll-1773"><a href="#TramDagModel.get_train_val_nll-1773"><span class="linenos">1773</span></a><span class="sd">        mode : {&quot;best&quot;, &quot;last&quot;, &quot;init&quot;}</span>
</span><span id="TramDagModel.get_train_val_nll-1774"><a href="#TramDagModel.get_train_val_nll-1774"><span class="linenos">1774</span></a><span class="sd">            State of interest:</span>
</span><span id="TramDagModel.get_train_val_nll-1775"><a href="#TramDagModel.get_train_val_nll-1775"><span class="linenos">1775</span></a><span class="sd">            - &quot;best&quot;: epoch with lowest validation NLL.</span>
</span><span id="TramDagModel.get_train_val_nll-1776"><a href="#TramDagModel.get_train_val_nll-1776"><span class="linenos">1776</span></a><span class="sd">            - &quot;last&quot;: final epoch.</span>
</span><span id="TramDagModel.get_train_val_nll-1777"><a href="#TramDagModel.get_train_val_nll-1777"><span class="linenos">1777</span></a><span class="sd">            - &quot;init&quot;: first epoch (index 0).</span>
</span><span id="TramDagModel.get_train_val_nll-1778"><a href="#TramDagModel.get_train_val_nll-1778"><span class="linenos">1778</span></a>
</span><span id="TramDagModel.get_train_val_nll-1779"><a href="#TramDagModel.get_train_val_nll-1779"><span class="linenos">1779</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.get_train_val_nll-1780"><a href="#TramDagModel.get_train_val_nll-1780"><span class="linenos">1780</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.get_train_val_nll-1781"><a href="#TramDagModel.get_train_val_nll-1781"><span class="linenos">1781</span></a><span class="sd">        tuple of (float or None, float or None)</span>
</span><span id="TramDagModel.get_train_val_nll-1782"><a href="#TramDagModel.get_train_val_nll-1782"><span class="linenos">1782</span></a><span class="sd">            A tuple ``(train_nll, val_nll)`` for the requested mode.</span>
</span><span id="TramDagModel.get_train_val_nll-1783"><a href="#TramDagModel.get_train_val_nll-1783"><span class="linenos">1783</span></a><span class="sd">            Returns ``(None, None)`` if loss files are missing or cannot be read.</span>
</span><span id="TramDagModel.get_train_val_nll-1784"><a href="#TramDagModel.get_train_val_nll-1784"><span class="linenos">1784</span></a>
</span><span id="TramDagModel.get_train_val_nll-1785"><a href="#TramDagModel.get_train_val_nll-1785"><span class="linenos">1785</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.get_train_val_nll-1786"><a href="#TramDagModel.get_train_val_nll-1786"><span class="linenos">1786</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.get_train_val_nll-1787"><a href="#TramDagModel.get_train_val_nll-1787"><span class="linenos">1787</span></a><span class="sd">        This method expects per-node JSON files:</span>
</span><span id="TramDagModel.get_train_val_nll-1788"><a href="#TramDagModel.get_train_val_nll-1788"><span class="linenos">1788</span></a>
</span><span id="TramDagModel.get_train_val_nll-1789"><a href="#TramDagModel.get_train_val_nll-1789"><span class="linenos">1789</span></a><span class="sd">        - ``train_loss_hist.json``</span>
</span><span id="TramDagModel.get_train_val_nll-1790"><a href="#TramDagModel.get_train_val_nll-1790"><span class="linenos">1790</span></a><span class="sd">        - ``val_loss_hist.json``</span>
</span><span id="TramDagModel.get_train_val_nll-1791"><a href="#TramDagModel.get_train_val_nll-1791"><span class="linenos">1791</span></a>
</span><span id="TramDagModel.get_train_val_nll-1792"><a href="#TramDagModel.get_train_val_nll-1792"><span class="linenos">1792</span></a><span class="sd">        in the node directory.</span>
</span><span id="TramDagModel.get_train_val_nll-1793"><a href="#TramDagModel.get_train_val_nll-1793"><span class="linenos">1793</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.get_train_val_nll-1794"><a href="#TramDagModel.get_train_val_nll-1794"><span class="linenos">1794</span></a>        <span class="n">NODE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">],</span> <span class="n">node</span><span class="p">)</span>
</span><span id="TramDagModel.get_train_val_nll-1795"><a href="#TramDagModel.get_train_val_nll-1795"><span class="linenos">1795</span></a>        <span class="n">train_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">,</span> <span class="s2">&quot;train_loss_hist.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_train_val_nll-1796"><a href="#TramDagModel.get_train_val_nll-1796"><span class="linenos">1796</span></a>        <span class="n">val_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">,</span> <span class="s2">&quot;val_loss_hist.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_train_val_nll-1797"><a href="#TramDagModel.get_train_val_nll-1797"><span class="linenos">1797</span></a>
</span><span id="TramDagModel.get_train_val_nll-1798"><a href="#TramDagModel.get_train_val_nll-1798"><span class="linenos">1798</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">train_path</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">val_path</span><span class="p">):</span>
</span><span id="TramDagModel.get_train_val_nll-1799"><a href="#TramDagModel.get_train_val_nll-1799"><span class="linenos">1799</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel.get_train_val_nll-1800"><a href="#TramDagModel.get_train_val_nll-1800"><span class="linenos">1800</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Missing loss files for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;. Returning None.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_train_val_nll-1801"><a href="#TramDagModel.get_train_val_nll-1801"><span class="linenos">1801</span></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="TramDagModel.get_train_val_nll-1802"><a href="#TramDagModel.get_train_val_nll-1802"><span class="linenos">1802</span></a>
</span><span id="TramDagModel.get_train_val_nll-1803"><a href="#TramDagModel.get_train_val_nll-1803"><span class="linenos">1803</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.get_train_val_nll-1804"><a href="#TramDagModel.get_train_val_nll-1804"><span class="linenos">1804</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">train_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel.get_train_val_nll-1805"><a href="#TramDagModel.get_train_val_nll-1805"><span class="linenos">1805</span></a>                <span class="n">train_hist</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TramDagModel.get_train_val_nll-1806"><a href="#TramDagModel.get_train_val_nll-1806"><span class="linenos">1806</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">val_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel.get_train_val_nll-1807"><a href="#TramDagModel.get_train_val_nll-1807"><span class="linenos">1807</span></a>                <span class="n">val_hist</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TramDagModel.get_train_val_nll-1808"><a href="#TramDagModel.get_train_val_nll-1808"><span class="linenos">1808</span></a>
</span><span id="TramDagModel.get_train_val_nll-1809"><a href="#TramDagModel.get_train_val_nll-1809"><span class="linenos">1809</span></a>            <span class="n">train_nlls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_hist</span><span class="p">)</span>
</span><span id="TramDagModel.get_train_val_nll-1810"><a href="#TramDagModel.get_train_val_nll-1810"><span class="linenos">1810</span></a>            <span class="n">val_nlls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val_hist</span><span class="p">)</span>
</span><span id="TramDagModel.get_train_val_nll-1811"><a href="#TramDagModel.get_train_val_nll-1811"><span class="linenos">1811</span></a>
</span><span id="TramDagModel.get_train_val_nll-1812"><a href="#TramDagModel.get_train_val_nll-1812"><span class="linenos">1812</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;init&quot;</span><span class="p">:</span>
</span><span id="TramDagModel.get_train_val_nll-1813"><a href="#TramDagModel.get_train_val_nll-1813"><span class="linenos">1813</span></a>                <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TramDagModel.get_train_val_nll-1814"><a href="#TramDagModel.get_train_val_nll-1814"><span class="linenos">1814</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span>
</span><span id="TramDagModel.get_train_val_nll-1815"><a href="#TramDagModel.get_train_val_nll-1815"><span class="linenos">1815</span></a>                <span class="n">idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_nlls</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="TramDagModel.get_train_val_nll-1816"><a href="#TramDagModel.get_train_val_nll-1816"><span class="linenos">1816</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;best&quot;</span><span class="p">:</span>
</span><span id="TramDagModel.get_train_val_nll-1817"><a href="#TramDagModel.get_train_val_nll-1817"><span class="linenos">1817</span></a>                <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">val_nlls</span><span class="p">))</span>
</span><span id="TramDagModel.get_train_val_nll-1818"><a href="#TramDagModel.get_train_val_nll-1818"><span class="linenos">1818</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.get_train_val_nll-1819"><a href="#TramDagModel.get_train_val_nll-1819"><span class="linenos">1819</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid mode &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39;  must be one of &#39;best&#39;, &#39;last&#39;, &#39;init&#39;.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_train_val_nll-1820"><a href="#TramDagModel.get_train_val_nll-1820"><span class="linenos">1820</span></a>
</span><span id="TramDagModel.get_train_val_nll-1821"><a href="#TramDagModel.get_train_val_nll-1821"><span class="linenos">1821</span></a>            <span class="n">train_nll</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">train_nlls</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span><span id="TramDagModel.get_train_val_nll-1822"><a href="#TramDagModel.get_train_val_nll-1822"><span class="linenos">1822</span></a>            <span class="n">val_nll</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val_nlls</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span><span id="TramDagModel.get_train_val_nll-1823"><a href="#TramDagModel.get_train_val_nll-1823"><span class="linenos">1823</span></a>            <span class="k">return</span> <span class="n">train_nll</span><span class="p">,</span> <span class="n">val_nll</span>
</span><span id="TramDagModel.get_train_val_nll-1824"><a href="#TramDagModel.get_train_val_nll-1824"><span class="linenos">1824</span></a>
</span><span id="TramDagModel.get_train_val_nll-1825"><a href="#TramDagModel.get_train_val_nll-1825"><span class="linenos">1825</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel.get_train_val_nll-1826"><a href="#TramDagModel.get_train_val_nll-1826"><span class="linenos">1826</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] Failed to load NLLs for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_train_val_nll-1827"><a href="#TramDagModel.get_train_val_nll-1827"><span class="linenos">1827</span></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve training and validation NLL for a node and a given model state.</p>

<h2 id="parameters">Parameters</h2>

<p>node : str
    Node name.
mode : {"best", "last", "init"}
    State of interest:
    - "best": epoch with lowest validation NLL.
    - "last": final epoch.
    - "init": first epoch (index 0).</p>

<h2 id="returns">Returns</h2>

<p>tuple of (float or None, float or None)
    A tuple <code>(train_nll, val_nll)</code> for the requested mode.
    Returns <code>(None, None)</code> if loss files are missing or cannot be read.</p>

<h2 id="notes">Notes</h2>

<p>This method expects per-node JSON files:</p>

<ul>
<li><code>train_loss_hist.json</code></li>
<li><code>val_loss_hist.json</code></li>
</ul>

<p>in the node directory.</p>
</div>


                            </div>
                            <div id="TramDagModel.get_thetas" class="classattr">
                                        <input id="TramDagModel.get_thetas-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_thetas</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">node</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">state</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;best&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.get_thetas-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.get_thetas"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.get_thetas-1829"><a href="#TramDagModel.get_thetas-1829"><span class="linenos">1829</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_thetas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;best&quot;</span><span class="p">):</span>
</span><span id="TramDagModel.get_thetas-1830"><a href="#TramDagModel.get_thetas-1830"><span class="linenos">1830</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.get_thetas-1831"><a href="#TramDagModel.get_thetas-1831"><span class="linenos">1831</span></a><span class="sd">        Return transformed intercept (theta) parameters for a node and state.</span>
</span><span id="TramDagModel.get_thetas-1832"><a href="#TramDagModel.get_thetas-1832"><span class="linenos">1832</span></a>
</span><span id="TramDagModel.get_thetas-1833"><a href="#TramDagModel.get_thetas-1833"><span class="linenos">1833</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.get_thetas-1834"><a href="#TramDagModel.get_thetas-1834"><span class="linenos">1834</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.get_thetas-1835"><a href="#TramDagModel.get_thetas-1835"><span class="linenos">1835</span></a><span class="sd">        node : str</span>
</span><span id="TramDagModel.get_thetas-1836"><a href="#TramDagModel.get_thetas-1836"><span class="linenos">1836</span></a><span class="sd">            Node name.</span>
</span><span id="TramDagModel.get_thetas-1837"><a href="#TramDagModel.get_thetas-1837"><span class="linenos">1837</span></a><span class="sd">        state : {&quot;best&quot;, &quot;last&quot;, &quot;init&quot;}, optional</span>
</span><span id="TramDagModel.get_thetas-1838"><a href="#TramDagModel.get_thetas-1838"><span class="linenos">1838</span></a><span class="sd">            Model state for which to return parameters. Default is &quot;best&quot;.</span>
</span><span id="TramDagModel.get_thetas-1839"><a href="#TramDagModel.get_thetas-1839"><span class="linenos">1839</span></a>
</span><span id="TramDagModel.get_thetas-1840"><a href="#TramDagModel.get_thetas-1840"><span class="linenos">1840</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.get_thetas-1841"><a href="#TramDagModel.get_thetas-1841"><span class="linenos">1841</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.get_thetas-1842"><a href="#TramDagModel.get_thetas-1842"><span class="linenos">1842</span></a><span class="sd">        Any or None</span>
</span><span id="TramDagModel.get_thetas-1843"><a href="#TramDagModel.get_thetas-1843"><span class="linenos">1843</span></a><span class="sd">            Transformed theta parameters for the requested node and state.</span>
</span><span id="TramDagModel.get_thetas-1844"><a href="#TramDagModel.get_thetas-1844"><span class="linenos">1844</span></a><span class="sd">            The exact structure (scalar, list, or other) depends on the model.</span>
</span><span id="TramDagModel.get_thetas-1845"><a href="#TramDagModel.get_thetas-1845"><span class="linenos">1845</span></a>
</span><span id="TramDagModel.get_thetas-1846"><a href="#TramDagModel.get_thetas-1846"><span class="linenos">1846</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel.get_thetas-1847"><a href="#TramDagModel.get_thetas-1847"><span class="linenos">1847</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel.get_thetas-1848"><a href="#TramDagModel.get_thetas-1848"><span class="linenos">1848</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel.get_thetas-1849"><a href="#TramDagModel.get_thetas-1849"><span class="linenos">1849</span></a><span class="sd">            If an invalid state is given (not in {&quot;best&quot;, &quot;last&quot;, &quot;init&quot;}).</span>
</span><span id="TramDagModel.get_thetas-1850"><a href="#TramDagModel.get_thetas-1850"><span class="linenos">1850</span></a>
</span><span id="TramDagModel.get_thetas-1851"><a href="#TramDagModel.get_thetas-1851"><span class="linenos">1851</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.get_thetas-1852"><a href="#TramDagModel.get_thetas-1852"><span class="linenos">1852</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.get_thetas-1853"><a href="#TramDagModel.get_thetas-1853"><span class="linenos">1853</span></a><span class="sd">        Intercept dictionaries are cached on the instance under the attribute</span>
</span><span id="TramDagModel.get_thetas-1854"><a href="#TramDagModel.get_thetas-1854"><span class="linenos">1854</span></a><span class="sd">        ``intercept_dicts``. If missing or incomplete, they are recomputed using</span>
</span><span id="TramDagModel.get_thetas-1855"><a href="#TramDagModel.get_thetas-1855"><span class="linenos">1855</span></a><span class="sd">        `get_simple_intercepts_dict`.</span>
</span><span id="TramDagModel.get_thetas-1856"><a href="#TramDagModel.get_thetas-1856"><span class="linenos">1856</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.get_thetas-1857"><a href="#TramDagModel.get_thetas-1857"><span class="linenos">1857</span></a>
</span><span id="TramDagModel.get_thetas-1858"><a href="#TramDagModel.get_thetas-1858"><span class="linenos">1858</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="TramDagModel.get_thetas-1859"><a href="#TramDagModel.get_thetas-1859"><span class="linenos">1859</span></a>        <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;init&quot;</span><span class="p">]:</span>
</span><span id="TramDagModel.get_thetas-1860"><a href="#TramDagModel.get_thetas-1860"><span class="linenos">1860</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] Invalid state &#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&#39;. Must be one of [&#39;best&#39;, &#39;last&#39;, &#39;init&#39;].&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_thetas-1861"><a href="#TramDagModel.get_thetas-1861"><span class="linenos">1861</span></a>
</span><span id="TramDagModel.get_thetas-1862"><a href="#TramDagModel.get_thetas-1862"><span class="linenos">1862</span></a>        <span class="n">dict_attr</span> <span class="o">=</span> <span class="s2">&quot;intercept_dicts&quot;</span>
</span><span id="TramDagModel.get_thetas-1863"><a href="#TramDagModel.get_thetas-1863"><span class="linenos">1863</span></a>
</span><span id="TramDagModel.get_thetas-1864"><a href="#TramDagModel.get_thetas-1864"><span class="linenos">1864</span></a>        <span class="c1"># If no cached intercepts exist, compute them</span>
</span><span id="TramDagModel.get_thetas-1865"><a href="#TramDagModel.get_thetas-1865"><span class="linenos">1865</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">):</span>
</span><span id="TramDagModel.get_thetas-1866"><a href="#TramDagModel.get_thetas-1866"><span class="linenos">1866</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel.get_thetas-1867"><a href="#TramDagModel.get_thetas-1867"><span class="linenos">1867</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] &#39;</span><span class="si">{</span><span class="n">dict_attr</span><span class="si">}</span><span class="s2">&#39; not found, computing via get_simple_intercepts_dict().&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_thetas-1868"><a href="#TramDagModel.get_thetas-1868"><span class="linenos">1868</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_simple_intercepts_dict</span><span class="p">())</span>
</span><span id="TramDagModel.get_thetas-1869"><a href="#TramDagModel.get_thetas-1869"><span class="linenos">1869</span></a>
</span><span id="TramDagModel.get_thetas-1870"><a href="#TramDagModel.get_thetas-1870"><span class="linenos">1870</span></a>        <span class="n">all_dicts</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">)</span>
</span><span id="TramDagModel.get_thetas-1871"><a href="#TramDagModel.get_thetas-1871"><span class="linenos">1871</span></a>
</span><span id="TramDagModel.get_thetas-1872"><a href="#TramDagModel.get_thetas-1872"><span class="linenos">1872</span></a>        <span class="c1"># If the requested state isnt cached, recompute</span>
</span><span id="TramDagModel.get_thetas-1873"><a href="#TramDagModel.get_thetas-1873"><span class="linenos">1873</span></a>        <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_dicts</span><span class="p">:</span>
</span><span id="TramDagModel.get_thetas-1874"><a href="#TramDagModel.get_thetas-1874"><span class="linenos">1874</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel.get_thetas-1875"><a href="#TramDagModel.get_thetas-1875"><span class="linenos">1875</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] State &#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&#39; not found in cached intercepts, recomputing full dict.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_thetas-1876"><a href="#TramDagModel.get_thetas-1876"><span class="linenos">1876</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_simple_intercepts_dict</span><span class="p">())</span>
</span><span id="TramDagModel.get_thetas-1877"><a href="#TramDagModel.get_thetas-1877"><span class="linenos">1877</span></a>            <span class="n">all_dicts</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">)</span>
</span><span id="TramDagModel.get_thetas-1878"><a href="#TramDagModel.get_thetas-1878"><span class="linenos">1878</span></a>
</span><span id="TramDagModel.get_thetas-1879"><a href="#TramDagModel.get_thetas-1879"><span class="linenos">1879</span></a>        <span class="n">state_dict</span> <span class="o">=</span> <span class="n">all_dicts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="TramDagModel.get_thetas-1880"><a href="#TramDagModel.get_thetas-1880"><span class="linenos">1880</span></a>
</span><span id="TramDagModel.get_thetas-1881"><a href="#TramDagModel.get_thetas-1881"><span class="linenos">1881</span></a>        <span class="c1"># Return cached node intercept if present</span>
</span><span id="TramDagModel.get_thetas-1882"><a href="#TramDagModel.get_thetas-1882"><span class="linenos">1882</span></a>        <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="p">:</span>
</span><span id="TramDagModel.get_thetas-1883"><a href="#TramDagModel.get_thetas-1883"><span class="linenos">1883</span></a>            <span class="k">return</span> <span class="n">state_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel.get_thetas-1884"><a href="#TramDagModel.get_thetas-1884"><span class="linenos">1884</span></a>
</span><span id="TramDagModel.get_thetas-1885"><a href="#TramDagModel.get_thetas-1885"><span class="linenos">1885</span></a>        <span class="c1"># If not found, recompute full dict as fallback</span>
</span><span id="TramDagModel.get_thetas-1886"><a href="#TramDagModel.get_thetas-1886"><span class="linenos">1886</span></a>        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel.get_thetas-1887"><a href="#TramDagModel.get_thetas-1887"><span class="linenos">1887</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; not found in state &#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&#39;, recomputing full dict.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_thetas-1888"><a href="#TramDagModel.get_thetas-1888"><span class="linenos">1888</span></a>        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_simple_intercepts_dict</span><span class="p">())</span>
</span><span id="TramDagModel.get_thetas-1889"><a href="#TramDagModel.get_thetas-1889"><span class="linenos">1889</span></a>        <span class="n">all_dicts</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">)</span>
</span><span id="TramDagModel.get_thetas-1890"><a href="#TramDagModel.get_thetas-1890"><span class="linenos">1890</span></a>        <span class="k">return</span> <span class="n">all_dicts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return transformed intercept (theta) parameters for a node and state.</p>

<h2 id="parameters">Parameters</h2>

<p>node : str
    Node name.
state : {"best", "last", "init"}, optional
    Model state for which to return parameters. Default is "best".</p>

<h2 id="returns">Returns</h2>

<p>Any or None
    Transformed theta parameters for the requested node and state.
    The exact structure (scalar, list, or other) depends on the model.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If an invalid state is given (not in {"best", "last", "init"}).</p>

<h2 id="notes">Notes</h2>

<p>Intercept dictionaries are cached on the instance under the attribute
<code>intercept_dicts</code>. If missing or incomplete, they are recomputed using
<code><a href="#TramDagModel.get_simple_intercepts_dict">get_simple_intercepts_dict</a></code>.</p>
</div>


                            </div>
                            <div id="TramDagModel.get_linear_shifts" class="classattr">
                                        <input id="TramDagModel.get_linear_shifts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_linear_shifts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">node</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">state</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;best&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.get_linear_shifts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.get_linear_shifts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.get_linear_shifts-1892"><a href="#TramDagModel.get_linear_shifts-1892"><span class="linenos">1892</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_linear_shifts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;best&quot;</span><span class="p">):</span>
</span><span id="TramDagModel.get_linear_shifts-1893"><a href="#TramDagModel.get_linear_shifts-1893"><span class="linenos">1893</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.get_linear_shifts-1894"><a href="#TramDagModel.get_linear_shifts-1894"><span class="linenos">1894</span></a><span class="sd">        Return learned linear shift terms for a node and a given state.</span>
</span><span id="TramDagModel.get_linear_shifts-1895"><a href="#TramDagModel.get_linear_shifts-1895"><span class="linenos">1895</span></a>
</span><span id="TramDagModel.get_linear_shifts-1896"><a href="#TramDagModel.get_linear_shifts-1896"><span class="linenos">1896</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.get_linear_shifts-1897"><a href="#TramDagModel.get_linear_shifts-1897"><span class="linenos">1897</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.get_linear_shifts-1898"><a href="#TramDagModel.get_linear_shifts-1898"><span class="linenos">1898</span></a><span class="sd">        node : str</span>
</span><span id="TramDagModel.get_linear_shifts-1899"><a href="#TramDagModel.get_linear_shifts-1899"><span class="linenos">1899</span></a><span class="sd">            Node name.</span>
</span><span id="TramDagModel.get_linear_shifts-1900"><a href="#TramDagModel.get_linear_shifts-1900"><span class="linenos">1900</span></a><span class="sd">        state : {&quot;best&quot;, &quot;last&quot;, &quot;init&quot;}, optional</span>
</span><span id="TramDagModel.get_linear_shifts-1901"><a href="#TramDagModel.get_linear_shifts-1901"><span class="linenos">1901</span></a><span class="sd">            Model state for which to return linear shift terms. Default is &quot;best&quot;.</span>
</span><span id="TramDagModel.get_linear_shifts-1902"><a href="#TramDagModel.get_linear_shifts-1902"><span class="linenos">1902</span></a>
</span><span id="TramDagModel.get_linear_shifts-1903"><a href="#TramDagModel.get_linear_shifts-1903"><span class="linenos">1903</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.get_linear_shifts-1904"><a href="#TramDagModel.get_linear_shifts-1904"><span class="linenos">1904</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.get_linear_shifts-1905"><a href="#TramDagModel.get_linear_shifts-1905"><span class="linenos">1905</span></a><span class="sd">        dict or Any or None</span>
</span><span id="TramDagModel.get_linear_shifts-1906"><a href="#TramDagModel.get_linear_shifts-1906"><span class="linenos">1906</span></a><span class="sd">            Linear shift terms for the given node and state. Usually a dict</span>
</span><span id="TramDagModel.get_linear_shifts-1907"><a href="#TramDagModel.get_linear_shifts-1907"><span class="linenos">1907</span></a><span class="sd">            mapping term names to weights.</span>
</span><span id="TramDagModel.get_linear_shifts-1908"><a href="#TramDagModel.get_linear_shifts-1908"><span class="linenos">1908</span></a>
</span><span id="TramDagModel.get_linear_shifts-1909"><a href="#TramDagModel.get_linear_shifts-1909"><span class="linenos">1909</span></a><span class="sd">        Raises</span>
</span><span id="TramDagModel.get_linear_shifts-1910"><a href="#TramDagModel.get_linear_shifts-1910"><span class="linenos">1910</span></a><span class="sd">        ------</span>
</span><span id="TramDagModel.get_linear_shifts-1911"><a href="#TramDagModel.get_linear_shifts-1911"><span class="linenos">1911</span></a><span class="sd">        ValueError</span>
</span><span id="TramDagModel.get_linear_shifts-1912"><a href="#TramDagModel.get_linear_shifts-1912"><span class="linenos">1912</span></a><span class="sd">            If an invalid state is given (not in {&quot;best&quot;, &quot;last&quot;, &quot;init&quot;}).</span>
</span><span id="TramDagModel.get_linear_shifts-1913"><a href="#TramDagModel.get_linear_shifts-1913"><span class="linenos">1913</span></a>
</span><span id="TramDagModel.get_linear_shifts-1914"><a href="#TramDagModel.get_linear_shifts-1914"><span class="linenos">1914</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.get_linear_shifts-1915"><a href="#TramDagModel.get_linear_shifts-1915"><span class="linenos">1915</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.get_linear_shifts-1916"><a href="#TramDagModel.get_linear_shifts-1916"><span class="linenos">1916</span></a><span class="sd">        Linear shift dictionaries are cached on the instance under the attribute</span>
</span><span id="TramDagModel.get_linear_shifts-1917"><a href="#TramDagModel.get_linear_shifts-1917"><span class="linenos">1917</span></a><span class="sd">        ``linear_shift_dicts``. If missing or incomplete, they are recomputed using</span>
</span><span id="TramDagModel.get_linear_shifts-1918"><a href="#TramDagModel.get_linear_shifts-1918"><span class="linenos">1918</span></a><span class="sd">        `get_linear_shifts_dict`.</span>
</span><span id="TramDagModel.get_linear_shifts-1919"><a href="#TramDagModel.get_linear_shifts-1919"><span class="linenos">1919</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.get_linear_shifts-1920"><a href="#TramDagModel.get_linear_shifts-1920"><span class="linenos">1920</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="TramDagModel.get_linear_shifts-1921"><a href="#TramDagModel.get_linear_shifts-1921"><span class="linenos">1921</span></a>        <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;init&quot;</span><span class="p">]:</span>
</span><span id="TramDagModel.get_linear_shifts-1922"><a href="#TramDagModel.get_linear_shifts-1922"><span class="linenos">1922</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] Invalid state &#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&#39;. Must be one of [&#39;best&#39;, &#39;last&#39;, &#39;init&#39;].&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts-1923"><a href="#TramDagModel.get_linear_shifts-1923"><span class="linenos">1923</span></a>
</span><span id="TramDagModel.get_linear_shifts-1924"><a href="#TramDagModel.get_linear_shifts-1924"><span class="linenos">1924</span></a>        <span class="n">dict_attr</span> <span class="o">=</span> <span class="s2">&quot;linear_shift_dicts&quot;</span>
</span><span id="TramDagModel.get_linear_shifts-1925"><a href="#TramDagModel.get_linear_shifts-1925"><span class="linenos">1925</span></a>
</span><span id="TramDagModel.get_linear_shifts-1926"><a href="#TramDagModel.get_linear_shifts-1926"><span class="linenos">1926</span></a>        <span class="c1"># If no global dicts cached, compute once</span>
</span><span id="TramDagModel.get_linear_shifts-1927"><a href="#TramDagModel.get_linear_shifts-1927"><span class="linenos">1927</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">):</span>
</span><span id="TramDagModel.get_linear_shifts-1928"><a href="#TramDagModel.get_linear_shifts-1928"><span class="linenos">1928</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel.get_linear_shifts-1929"><a href="#TramDagModel.get_linear_shifts-1929"><span class="linenos">1929</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] &#39;</span><span class="si">{</span><span class="n">dict_attr</span><span class="si">}</span><span class="s2">&#39; not found, computing via get_linear_shifts_dict().&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts-1930"><a href="#TramDagModel.get_linear_shifts-1930"><span class="linenos">1930</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_linear_shifts_dict</span><span class="p">())</span>
</span><span id="TramDagModel.get_linear_shifts-1931"><a href="#TramDagModel.get_linear_shifts-1931"><span class="linenos">1931</span></a>
</span><span id="TramDagModel.get_linear_shifts-1932"><a href="#TramDagModel.get_linear_shifts-1932"><span class="linenos">1932</span></a>        <span class="n">all_dicts</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts-1933"><a href="#TramDagModel.get_linear_shifts-1933"><span class="linenos">1933</span></a>
</span><span id="TramDagModel.get_linear_shifts-1934"><a href="#TramDagModel.get_linear_shifts-1934"><span class="linenos">1934</span></a>        <span class="c1"># If the requested state isn&#39;t cached, compute all again (covers fresh runs)</span>
</span><span id="TramDagModel.get_linear_shifts-1935"><a href="#TramDagModel.get_linear_shifts-1935"><span class="linenos">1935</span></a>        <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_dicts</span><span class="p">:</span>
</span><span id="TramDagModel.get_linear_shifts-1936"><a href="#TramDagModel.get_linear_shifts-1936"><span class="linenos">1936</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel.get_linear_shifts-1937"><a href="#TramDagModel.get_linear_shifts-1937"><span class="linenos">1937</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] State &#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&#39; not found in cached linear shifts, recomputing full dict.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts-1938"><a href="#TramDagModel.get_linear_shifts-1938"><span class="linenos">1938</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_linear_shifts_dict</span><span class="p">())</span>
</span><span id="TramDagModel.get_linear_shifts-1939"><a href="#TramDagModel.get_linear_shifts-1939"><span class="linenos">1939</span></a>            <span class="n">all_dicts</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts-1940"><a href="#TramDagModel.get_linear_shifts-1940"><span class="linenos">1940</span></a>
</span><span id="TramDagModel.get_linear_shifts-1941"><a href="#TramDagModel.get_linear_shifts-1941"><span class="linenos">1941</span></a>        <span class="c1"># Now fetch the dictionary for this state</span>
</span><span id="TramDagModel.get_linear_shifts-1942"><a href="#TramDagModel.get_linear_shifts-1942"><span class="linenos">1942</span></a>        <span class="n">state_dict</span> <span class="o">=</span> <span class="n">all_dicts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="TramDagModel.get_linear_shifts-1943"><a href="#TramDagModel.get_linear_shifts-1943"><span class="linenos">1943</span></a>
</span><span id="TramDagModel.get_linear_shifts-1944"><a href="#TramDagModel.get_linear_shifts-1944"><span class="linenos">1944</span></a>        <span class="c1"># If the node is available, return its entry</span>
</span><span id="TramDagModel.get_linear_shifts-1945"><a href="#TramDagModel.get_linear_shifts-1945"><span class="linenos">1945</span></a>        <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="p">:</span>
</span><span id="TramDagModel.get_linear_shifts-1946"><a href="#TramDagModel.get_linear_shifts-1946"><span class="linenos">1946</span></a>            <span class="k">return</span> <span class="n">state_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel.get_linear_shifts-1947"><a href="#TramDagModel.get_linear_shifts-1947"><span class="linenos">1947</span></a>
</span><span id="TramDagModel.get_linear_shifts-1948"><a href="#TramDagModel.get_linear_shifts-1948"><span class="linenos">1948</span></a>        <span class="c1"># If missing, try recomputing (fallback)</span>
</span><span id="TramDagModel.get_linear_shifts-1949"><a href="#TramDagModel.get_linear_shifts-1949"><span class="linenos">1949</span></a>        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel.get_linear_shifts-1950"><a href="#TramDagModel.get_linear_shifts-1950"><span class="linenos">1950</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; not found in state &#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&#39;, recomputing full dict.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts-1951"><a href="#TramDagModel.get_linear_shifts-1951"><span class="linenos">1951</span></a>        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_linear_shifts_dict</span><span class="p">())</span>
</span><span id="TramDagModel.get_linear_shifts-1952"><a href="#TramDagModel.get_linear_shifts-1952"><span class="linenos">1952</span></a>        <span class="n">all_dicts</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_attr</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts-1953"><a href="#TramDagModel.get_linear_shifts-1953"><span class="linenos">1953</span></a>        <span class="k">return</span> <span class="n">all_dicts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return learned linear shift terms for a node and a given state.</p>

<h2 id="parameters">Parameters</h2>

<p>node : str
    Node name.
state : {"best", "last", "init"}, optional
    Model state for which to return linear shift terms. Default is "best".</p>

<h2 id="returns">Returns</h2>

<p>dict or Any or None
    Linear shift terms for the given node and state. Usually a dict
    mapping term names to weights.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If an invalid state is given (not in {"best", "last", "init"}).</p>

<h2 id="notes">Notes</h2>

<p>Linear shift dictionaries are cached on the instance under the attribute
<code>linear_shift_dicts</code>. If missing or incomplete, they are recomputed using
<code><a href="#TramDagModel.get_linear_shifts_dict">get_linear_shifts_dict</a></code>.</p>
</div>


                            </div>
                            <div id="TramDagModel.get_linear_shifts_dict" class="classattr">
                                        <input id="TramDagModel.get_linear_shifts_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_linear_shifts_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.get_linear_shifts_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.get_linear_shifts_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.get_linear_shifts_dict-1955"><a href="#TramDagModel.get_linear_shifts_dict-1955"><span class="linenos">1955</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_linear_shifts_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1956"><a href="#TramDagModel.get_linear_shifts_dict-1956"><span class="linenos">1956</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1957"><a href="#TramDagModel.get_linear_shifts_dict-1957"><span class="linenos">1957</span></a><span class="sd">        Compute linear shift term dictionaries for all nodes and states.</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1958"><a href="#TramDagModel.get_linear_shifts_dict-1958"><span class="linenos">1958</span></a>
</span><span id="TramDagModel.get_linear_shifts_dict-1959"><a href="#TramDagModel.get_linear_shifts_dict-1959"><span class="linenos">1959</span></a><span class="sd">        For each node and each available state (&quot;best&quot;, &quot;last&quot;, &quot;init&quot;), this</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1960"><a href="#TramDagModel.get_linear_shifts_dict-1960"><span class="linenos">1960</span></a><span class="sd">        method loads the corresponding model checkpoint, extracts linear shift</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1961"><a href="#TramDagModel.get_linear_shifts_dict-1961"><span class="linenos">1961</span></a><span class="sd">        weights from the TRAM model, and stores them in a nested dictionary.</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1962"><a href="#TramDagModel.get_linear_shifts_dict-1962"><span class="linenos">1962</span></a>
</span><span id="TramDagModel.get_linear_shifts_dict-1963"><a href="#TramDagModel.get_linear_shifts_dict-1963"><span class="linenos">1963</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1964"><a href="#TramDagModel.get_linear_shifts_dict-1964"><span class="linenos">1964</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1965"><a href="#TramDagModel.get_linear_shifts_dict-1965"><span class="linenos">1965</span></a><span class="sd">        dict</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1966"><a href="#TramDagModel.get_linear_shifts_dict-1966"><span class="linenos">1966</span></a><span class="sd">            Nested dictionary of the form:</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1967"><a href="#TramDagModel.get_linear_shifts_dict-1967"><span class="linenos">1967</span></a>
</span><span id="TramDagModel.get_linear_shifts_dict-1968"><a href="#TramDagModel.get_linear_shifts_dict-1968"><span class="linenos">1968</span></a><span class="sd">            .. code-block:: python</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1969"><a href="#TramDagModel.get_linear_shifts_dict-1969"><span class="linenos">1969</span></a>
</span><span id="TramDagModel.get_linear_shifts_dict-1970"><a href="#TramDagModel.get_linear_shifts_dict-1970"><span class="linenos">1970</span></a><span class="sd">                {</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1971"><a href="#TramDagModel.get_linear_shifts_dict-1971"><span class="linenos">1971</span></a><span class="sd">                    &quot;best&quot;: {node: {...}},</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1972"><a href="#TramDagModel.get_linear_shifts_dict-1972"><span class="linenos">1972</span></a><span class="sd">                    &quot;last&quot;: {node: {...}},</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1973"><a href="#TramDagModel.get_linear_shifts_dict-1973"><span class="linenos">1973</span></a><span class="sd">                    &quot;init&quot;: {node: {...}},</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1974"><a href="#TramDagModel.get_linear_shifts_dict-1974"><span class="linenos">1974</span></a><span class="sd">                }</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1975"><a href="#TramDagModel.get_linear_shifts_dict-1975"><span class="linenos">1975</span></a>
</span><span id="TramDagModel.get_linear_shifts_dict-1976"><a href="#TramDagModel.get_linear_shifts_dict-1976"><span class="linenos">1976</span></a><span class="sd">            where the innermost dict maps term labels (e.g. ``&quot;ls(parent_name)&quot;``)</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1977"><a href="#TramDagModel.get_linear_shifts_dict-1977"><span class="linenos">1977</span></a><span class="sd">            to their weights.</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1978"><a href="#TramDagModel.get_linear_shifts_dict-1978"><span class="linenos">1978</span></a>
</span><span id="TramDagModel.get_linear_shifts_dict-1979"><a href="#TramDagModel.get_linear_shifts_dict-1979"><span class="linenos">1979</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1980"><a href="#TramDagModel.get_linear_shifts_dict-1980"><span class="linenos">1980</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1981"><a href="#TramDagModel.get_linear_shifts_dict-1981"><span class="linenos">1981</span></a><span class="sd">        - If &quot;best&quot; or &quot;last&quot; checkpoints are unavailable for a node, only</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1982"><a href="#TramDagModel.get_linear_shifts_dict-1982"><span class="linenos">1982</span></a><span class="sd">        the &quot;init&quot; entry is populated.</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1983"><a href="#TramDagModel.get_linear_shifts_dict-1983"><span class="linenos">1983</span></a><span class="sd">        - Empty outer states (without any nodes) are removed from the result.</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1984"><a href="#TramDagModel.get_linear_shifts_dict-1984"><span class="linenos">1984</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1985"><a href="#TramDagModel.get_linear_shifts_dict-1985"><span class="linenos">1985</span></a>
</span><span id="TramDagModel.get_linear_shifts_dict-1986"><a href="#TramDagModel.get_linear_shifts_dict-1986"><span class="linenos">1986</span></a>        <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1987"><a href="#TramDagModel.get_linear_shifts_dict-1987"><span class="linenos">1987</span></a>        <span class="n">nodes_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1988"><a href="#TramDagModel.get_linear_shifts_dict-1988"><span class="linenos">1988</span></a>        <span class="n">all_states</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;init&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1989"><a href="#TramDagModel.get_linear_shifts_dict-1989"><span class="linenos">1989</span></a>        <span class="n">all_linear_shift_dicts</span> <span class="o">=</span> <span class="p">{</span><span class="n">state</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">all_states</span><span class="p">}</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1990"><a href="#TramDagModel.get_linear_shifts_dict-1990"><span class="linenos">1990</span></a>
</span><span id="TramDagModel.get_linear_shifts_dict-1991"><a href="#TramDagModel.get_linear_shifts_dict-1991"><span class="linenos">1991</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes_list</span><span class="p">:</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1992"><a href="#TramDagModel.get_linear_shifts_dict-1992"><span class="linenos">1992</span></a>            <span class="n">NODE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1993"><a href="#TramDagModel.get_linear_shifts_dict-1993"><span class="linenos">1993</span></a>            <span class="n">BEST_MODEL_PATH</span><span class="p">,</span> <span class="n">LAST_MODEL_PATH</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model_train_val_paths</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1994"><a href="#TramDagModel.get_linear_shifts_dict-1994"><span class="linenos">1994</span></a>            <span class="n">INIT_MODEL_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">,</span> <span class="s2">&quot;initial_model.pt&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1995"><a href="#TramDagModel.get_linear_shifts_dict-1995"><span class="linenos">1995</span></a>
</span><span id="TramDagModel.get_linear_shifts_dict-1996"><a href="#TramDagModel.get_linear_shifts_dict-1996"><span class="linenos">1996</span></a>            <span class="n">state_paths</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1997"><a href="#TramDagModel.get_linear_shifts_dict-1997"><span class="linenos">1997</span></a>                <span class="s2">&quot;best&quot;</span><span class="p">:</span> <span class="n">BEST_MODEL_PATH</span><span class="p">,</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1998"><a href="#TramDagModel.get_linear_shifts_dict-1998"><span class="linenos">1998</span></a>                <span class="s2">&quot;last&quot;</span><span class="p">:</span> <span class="n">LAST_MODEL_PATH</span><span class="p">,</span>
</span><span id="TramDagModel.get_linear_shifts_dict-1999"><a href="#TramDagModel.get_linear_shifts_dict-1999"><span class="linenos">1999</span></a>                <span class="s2">&quot;init&quot;</span><span class="p">:</span> <span class="n">INIT_MODEL_PATH</span><span class="p">,</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2000"><a href="#TramDagModel.get_linear_shifts_dict-2000"><span class="linenos">2000</span></a>            <span class="p">}</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2001"><a href="#TramDagModel.get_linear_shifts_dict-2001"><span class="linenos">2001</span></a>
</span><span id="TramDagModel.get_linear_shifts_dict-2002"><a href="#TramDagModel.get_linear_shifts_dict-2002"><span class="linenos">2002</span></a>            <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">LOAD_PATH</span> <span class="ow">in</span> <span class="n">state_paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2003"><a href="#TramDagModel.get_linear_shifts_dict-2003"><span class="linenos">2003</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">LOAD_PATH</span><span class="p">):</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2004"><a href="#TramDagModel.get_linear_shifts_dict-2004"><span class="linenos">2004</span></a>                    <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="s2">&quot;init&quot;</span><span class="p">:</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2005"><a href="#TramDagModel.get_linear_shifts_dict-2005"><span class="linenos">2005</span></a>                        <span class="c1"># skip best/last if unavailable</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2006"><a href="#TramDagModel.get_linear_shifts_dict-2006"><span class="linenos">2006</span></a>                        <span class="k">continue</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2007"><a href="#TramDagModel.get_linear_shifts_dict-2007"><span class="linenos">2007</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2008"><a href="#TramDagModel.get_linear_shifts_dict-2008"><span class="linenos">2008</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] No models found for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;. Only initial model will be used.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2009"><a href="#TramDagModel.get_linear_shifts_dict-2009"><span class="linenos">2009</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">LOAD_PATH</span><span class="p">):</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2010"><a href="#TramDagModel.get_linear_shifts_dict-2010"><span class="linenos">2010</span></a>                            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2011"><a href="#TramDagModel.get_linear_shifts_dict-2011"><span class="linenos">2011</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Initial model also missing for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;. Skipping.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2012"><a href="#TramDagModel.get_linear_shifts_dict-2012"><span class="linenos">2012</span></a>                            <span class="k">continue</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2013"><a href="#TramDagModel.get_linear_shifts_dict-2013"><span class="linenos">2013</span></a>
</span><span id="TramDagModel.get_linear_shifts_dict-2014"><a href="#TramDagModel.get_linear_shifts_dict-2014"><span class="linenos">2014</span></a>                <span class="c1"># Load parents and model</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2015"><a href="#TramDagModel.get_linear_shifts_dict-2015"><span class="linenos">2015</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">terms_dict</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ordered_parents</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2016"><a href="#TramDagModel.get_linear_shifts_dict-2016"><span class="linenos">2016</span></a>                <span class="n">state_dict</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">LOAD_PATH</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2017"><a href="#TramDagModel.get_linear_shifts_dict-2017"><span class="linenos">2017</span></a>                <span class="n">tram_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2018"><a href="#TramDagModel.get_linear_shifts_dict-2018"><span class="linenos">2018</span></a>                <span class="n">tram_model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">state_dict</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2019"><a href="#TramDagModel.get_linear_shifts_dict-2019"><span class="linenos">2019</span></a>
</span><span id="TramDagModel.get_linear_shifts_dict-2020"><a href="#TramDagModel.get_linear_shifts_dict-2020"><span class="linenos">2020</span></a>                <span class="n">epoch_weights</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2021"><a href="#TramDagModel.get_linear_shifts_dict-2021"><span class="linenos">2021</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tram_model</span><span class="p">,</span> <span class="s2">&quot;nn_shift&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tram_model</span><span class="o">.</span><span class="n">nn_shift</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2022"><a href="#TramDagModel.get_linear_shifts_dict-2022"><span class="linenos">2022</span></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">shift_layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tram_model</span><span class="o">.</span><span class="n">nn_shift</span><span class="p">):</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2023"><a href="#TramDagModel.get_linear_shifts_dict-2023"><span class="linenos">2023</span></a>                        <span class="n">module_name</span> <span class="o">=</span> <span class="n">shift_layer</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2024"><a href="#TramDagModel.get_linear_shifts_dict-2024"><span class="linenos">2024</span></a>                        <span class="k">if</span> <span class="p">(</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2025"><a href="#TramDagModel.get_linear_shifts_dict-2025"><span class="linenos">2025</span></a>                            <span class="nb">hasattr</span><span class="p">(</span><span class="n">shift_layer</span><span class="p">,</span> <span class="s2">&quot;fc&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2026"><a href="#TramDagModel.get_linear_shifts_dict-2026"><span class="linenos">2026</span></a>                            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">shift_layer</span><span class="o">.</span><span class="n">fc</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2027"><a href="#TramDagModel.get_linear_shifts_dict-2027"><span class="linenos">2027</span></a>                            <span class="ow">and</span> <span class="n">module_name</span> <span class="o">==</span> <span class="s2">&quot;LinearShift&quot;</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2028"><a href="#TramDagModel.get_linear_shifts_dict-2028"><span class="linenos">2028</span></a>                        <span class="p">):</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2029"><a href="#TramDagModel.get_linear_shifts_dict-2029"><span class="linenos">2029</span></a>                            <span class="n">term_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">terms_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2030"><a href="#TramDagModel.get_linear_shifts_dict-2030"><span class="linenos">2030</span></a>                            <span class="n">epoch_weights</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ls(</span><span class="si">{</span><span class="n">term_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2031"><a href="#TramDagModel.get_linear_shifts_dict-2031"><span class="linenos">2031</span></a>                                <span class="n">shift_layer</span><span class="o">.</span><span class="n">fc</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2032"><a href="#TramDagModel.get_linear_shifts_dict-2032"><span class="linenos">2032</span></a>                            <span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2033"><a href="#TramDagModel.get_linear_shifts_dict-2033"><span class="linenos">2033</span></a>                        <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2034"><a href="#TramDagModel.get_linear_shifts_dict-2034"><span class="linenos">2034</span></a>                            <span class="n">term_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">terms_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2035"><a href="#TramDagModel.get_linear_shifts_dict-2035"><span class="linenos">2035</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] ls(</span><span class="si">{</span><span class="n">term_name</span><span class="si">}</span><span class="s2">): missing &#39;fc&#39; or &#39;weight&#39; in LinearShift.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2036"><a href="#TramDagModel.get_linear_shifts_dict-2036"><span class="linenos">2036</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2037"><a href="#TramDagModel.get_linear_shifts_dict-2037"><span class="linenos">2037</span></a>                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2038"><a href="#TramDagModel.get_linear_shifts_dict-2038"><span class="linenos">2038</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Tram model for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; has no nn_shift or it is None.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2039"><a href="#TramDagModel.get_linear_shifts_dict-2039"><span class="linenos">2039</span></a>
</span><span id="TramDagModel.get_linear_shifts_dict-2040"><a href="#TramDagModel.get_linear_shifts_dict-2040"><span class="linenos">2040</span></a>                <span class="n">all_linear_shift_dicts</span><span class="p">[</span><span class="n">state</span><span class="p">][</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoch_weights</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2041"><a href="#TramDagModel.get_linear_shifts_dict-2041"><span class="linenos">2041</span></a>
</span><span id="TramDagModel.get_linear_shifts_dict-2042"><a href="#TramDagModel.get_linear_shifts_dict-2042"><span class="linenos">2042</span></a>        <span class="c1"># Remove empty states (e.g., when best/last not found for all nodes)</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2043"><a href="#TramDagModel.get_linear_shifts_dict-2043"><span class="linenos">2043</span></a>        <span class="n">all_linear_shift_dicts</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_linear_shift_dicts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">}</span>
</span><span id="TramDagModel.get_linear_shifts_dict-2044"><a href="#TramDagModel.get_linear_shifts_dict-2044"><span class="linenos">2044</span></a>
</span><span id="TramDagModel.get_linear_shifts_dict-2045"><a href="#TramDagModel.get_linear_shifts_dict-2045"><span class="linenos">2045</span></a>        <span class="k">return</span> <span class="n">all_linear_shift_dicts</span>
</span></pre></div>


            <div class="docstring"><p>Compute linear shift term dictionaries for all nodes and states.</p>

<p>For each node and each available state ("best", "last", "init"), this
method loads the corresponding model checkpoint, extracts linear shift
weights from the TRAM model, and stores them in a nested dictionary.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Nested dictionary of the form:</p>

<pre><code>```python
</code></pre>

<p>{
    "best": {node: {...}},
    "last": {node: {...}},
    "init": {node: {...}},
}
```</p>

<pre><code>where the innermost dict maps term labels (e.g. ``"ls(parent_name)"``)
to their weights.
</code></pre>

<h2 id="notes">Notes</h2>

<ul>
<li>If "best" or "last" checkpoints are unavailable for a node, only
the "init" entry is populated.</li>
<li>Empty outer states (without any nodes) are removed from the result.</li>
</ul>
</div>


                            </div>
                            <div id="TramDagModel.get_simple_intercepts_dict" class="classattr">
                                        <input id="TramDagModel.get_simple_intercepts_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_simple_intercepts_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.get_simple_intercepts_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.get_simple_intercepts_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.get_simple_intercepts_dict-2047"><a href="#TramDagModel.get_simple_intercepts_dict-2047"><span class="linenos">2047</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_simple_intercepts_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2048"><a href="#TramDagModel.get_simple_intercepts_dict-2048"><span class="linenos">2048</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2049"><a href="#TramDagModel.get_simple_intercepts_dict-2049"><span class="linenos">2049</span></a><span class="sd">        Compute transformed simple intercept dictionaries for all nodes and states.</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2050"><a href="#TramDagModel.get_simple_intercepts_dict-2050"><span class="linenos">2050</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2051"><a href="#TramDagModel.get_simple_intercepts_dict-2051"><span class="linenos">2051</span></a><span class="sd">        For each node and each available state (&quot;best&quot;, &quot;last&quot;, &quot;init&quot;), this</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2052"><a href="#TramDagModel.get_simple_intercepts_dict-2052"><span class="linenos">2052</span></a><span class="sd">        method loads the corresponding model checkpoint, extracts simple intercept</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2053"><a href="#TramDagModel.get_simple_intercepts_dict-2053"><span class="linenos">2053</span></a><span class="sd">        weights, transforms them into interpretable theta parameters, and stores</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2054"><a href="#TramDagModel.get_simple_intercepts_dict-2054"><span class="linenos">2054</span></a><span class="sd">        them in a nested dictionary.</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2055"><a href="#TramDagModel.get_simple_intercepts_dict-2055"><span class="linenos">2055</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2056"><a href="#TramDagModel.get_simple_intercepts_dict-2056"><span class="linenos">2056</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2057"><a href="#TramDagModel.get_simple_intercepts_dict-2057"><span class="linenos">2057</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2058"><a href="#TramDagModel.get_simple_intercepts_dict-2058"><span class="linenos">2058</span></a><span class="sd">        dict</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2059"><a href="#TramDagModel.get_simple_intercepts_dict-2059"><span class="linenos">2059</span></a><span class="sd">            Nested dictionary of the form:</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2060"><a href="#TramDagModel.get_simple_intercepts_dict-2060"><span class="linenos">2060</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2061"><a href="#TramDagModel.get_simple_intercepts_dict-2061"><span class="linenos">2061</span></a><span class="sd">            .. code-block:: python</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2062"><a href="#TramDagModel.get_simple_intercepts_dict-2062"><span class="linenos">2062</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2063"><a href="#TramDagModel.get_simple_intercepts_dict-2063"><span class="linenos">2063</span></a><span class="sd">                {</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2064"><a href="#TramDagModel.get_simple_intercepts_dict-2064"><span class="linenos">2064</span></a><span class="sd">                    &quot;best&quot;: {node: [[theta_1], [theta_2], ...]},</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2065"><a href="#TramDagModel.get_simple_intercepts_dict-2065"><span class="linenos">2065</span></a><span class="sd">                    &quot;last&quot;: {node: [[theta_1], [theta_2], ...]},</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2066"><a href="#TramDagModel.get_simple_intercepts_dict-2066"><span class="linenos">2066</span></a><span class="sd">                    &quot;init&quot;: {node: [[theta_1], [theta_2], ...]},</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2067"><a href="#TramDagModel.get_simple_intercepts_dict-2067"><span class="linenos">2067</span></a><span class="sd">                }</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2068"><a href="#TramDagModel.get_simple_intercepts_dict-2068"><span class="linenos">2068</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2069"><a href="#TramDagModel.get_simple_intercepts_dict-2069"><span class="linenos">2069</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2070"><a href="#TramDagModel.get_simple_intercepts_dict-2070"><span class="linenos">2070</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2071"><a href="#TramDagModel.get_simple_intercepts_dict-2071"><span class="linenos">2071</span></a><span class="sd">        - For ordinal models (``self.is_ontram == True``), `transform_intercepts_ordinal`</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2072"><a href="#TramDagModel.get_simple_intercepts_dict-2072"><span class="linenos">2072</span></a><span class="sd">        is used.</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2073"><a href="#TramDagModel.get_simple_intercepts_dict-2073"><span class="linenos">2073</span></a><span class="sd">        - For continuous models, `transform_intercepts_continous` is used.</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2074"><a href="#TramDagModel.get_simple_intercepts_dict-2074"><span class="linenos">2074</span></a><span class="sd">        - Empty outer states (without any nodes) are removed from the result.</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2075"><a href="#TramDagModel.get_simple_intercepts_dict-2075"><span class="linenos">2075</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2076"><a href="#TramDagModel.get_simple_intercepts_dict-2076"><span class="linenos">2076</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2077"><a href="#TramDagModel.get_simple_intercepts_dict-2077"><span class="linenos">2077</span></a>        <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2078"><a href="#TramDagModel.get_simple_intercepts_dict-2078"><span class="linenos">2078</span></a>        <span class="n">nodes_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2079"><a href="#TramDagModel.get_simple_intercepts_dict-2079"><span class="linenos">2079</span></a>        <span class="n">all_states</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;init&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2080"><a href="#TramDagModel.get_simple_intercepts_dict-2080"><span class="linenos">2080</span></a>        <span class="n">all_si_intercept_dicts</span> <span class="o">=</span> <span class="p">{</span><span class="n">state</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">all_states</span><span class="p">}</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2081"><a href="#TramDagModel.get_simple_intercepts_dict-2081"><span class="linenos">2081</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2082"><a href="#TramDagModel.get_simple_intercepts_dict-2082"><span class="linenos">2082</span></a>        <span class="n">debug</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2083"><a href="#TramDagModel.get_simple_intercepts_dict-2083"><span class="linenos">2083</span></a>        <span class="n">verbose</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2084"><a href="#TramDagModel.get_simple_intercepts_dict-2084"><span class="linenos">2084</span></a>        <span class="n">is_ontram</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;is_ontram&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2085"><a href="#TramDagModel.get_simple_intercepts_dict-2085"><span class="linenos">2085</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2086"><a href="#TramDagModel.get_simple_intercepts_dict-2086"><span class="linenos">2086</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes_list</span><span class="p">:</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2087"><a href="#TramDagModel.get_simple_intercepts_dict-2087"><span class="linenos">2087</span></a>            <span class="n">NODE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2088"><a href="#TramDagModel.get_simple_intercepts_dict-2088"><span class="linenos">2088</span></a>            <span class="n">BEST_MODEL_PATH</span><span class="p">,</span> <span class="n">LAST_MODEL_PATH</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model_train_val_paths</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2089"><a href="#TramDagModel.get_simple_intercepts_dict-2089"><span class="linenos">2089</span></a>            <span class="n">INIT_MODEL_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">NODE_DIR</span><span class="p">,</span> <span class="s2">&quot;initial_model.pt&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2090"><a href="#TramDagModel.get_simple_intercepts_dict-2090"><span class="linenos">2090</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2091"><a href="#TramDagModel.get_simple_intercepts_dict-2091"><span class="linenos">2091</span></a>            <span class="n">state_paths</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2092"><a href="#TramDagModel.get_simple_intercepts_dict-2092"><span class="linenos">2092</span></a>                <span class="s2">&quot;best&quot;</span><span class="p">:</span> <span class="n">BEST_MODEL_PATH</span><span class="p">,</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2093"><a href="#TramDagModel.get_simple_intercepts_dict-2093"><span class="linenos">2093</span></a>                <span class="s2">&quot;last&quot;</span><span class="p">:</span> <span class="n">LAST_MODEL_PATH</span><span class="p">,</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2094"><a href="#TramDagModel.get_simple_intercepts_dict-2094"><span class="linenos">2094</span></a>                <span class="s2">&quot;init&quot;</span><span class="p">:</span> <span class="n">INIT_MODEL_PATH</span><span class="p">,</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2095"><a href="#TramDagModel.get_simple_intercepts_dict-2095"><span class="linenos">2095</span></a>            <span class="p">}</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2096"><a href="#TramDagModel.get_simple_intercepts_dict-2096"><span class="linenos">2096</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2097"><a href="#TramDagModel.get_simple_intercepts_dict-2097"><span class="linenos">2097</span></a>            <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">LOAD_PATH</span> <span class="ow">in</span> <span class="n">state_paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2098"><a href="#TramDagModel.get_simple_intercepts_dict-2098"><span class="linenos">2098</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">LOAD_PATH</span><span class="p">):</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2099"><a href="#TramDagModel.get_simple_intercepts_dict-2099"><span class="linenos">2099</span></a>                    <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="s2">&quot;init&quot;</span><span class="p">:</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2100"><a href="#TramDagModel.get_simple_intercepts_dict-2100"><span class="linenos">2100</span></a>                        <span class="k">continue</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2101"><a href="#TramDagModel.get_simple_intercepts_dict-2101"><span class="linenos">2101</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2102"><a href="#TramDagModel.get_simple_intercepts_dict-2102"><span class="linenos">2102</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING] No models found for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;. Only initial model will be used.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2103"><a href="#TramDagModel.get_simple_intercepts_dict-2103"><span class="linenos">2103</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">LOAD_PATH</span><span class="p">):</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2104"><a href="#TramDagModel.get_simple_intercepts_dict-2104"><span class="linenos">2104</span></a>                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2105"><a href="#TramDagModel.get_simple_intercepts_dict-2105"><span class="linenos">2105</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Initial model also missing for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39;. Skipping.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2106"><a href="#TramDagModel.get_simple_intercepts_dict-2106"><span class="linenos">2106</span></a>                            <span class="k">continue</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2107"><a href="#TramDagModel.get_simple_intercepts_dict-2107"><span class="linenos">2107</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2108"><a href="#TramDagModel.get_simple_intercepts_dict-2108"><span class="linenos">2108</span></a>                <span class="c1"># Load model state</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2109"><a href="#TramDagModel.get_simple_intercepts_dict-2109"><span class="linenos">2109</span></a>                <span class="n">state_dict</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">LOAD_PATH</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2110"><a href="#TramDagModel.get_simple_intercepts_dict-2110"><span class="linenos">2110</span></a>                <span class="n">tram_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2111"><a href="#TramDagModel.get_simple_intercepts_dict-2111"><span class="linenos">2111</span></a>                <span class="n">tram_model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">state_dict</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2112"><a href="#TramDagModel.get_simple_intercepts_dict-2112"><span class="linenos">2112</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2113"><a href="#TramDagModel.get_simple_intercepts_dict-2113"><span class="linenos">2113</span></a>                <span class="c1"># Extract and transform simple intercept weights</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2114"><a href="#TramDagModel.get_simple_intercepts_dict-2114"><span class="linenos">2114</span></a>                <span class="n">si_weights</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2115"><a href="#TramDagModel.get_simple_intercepts_dict-2115"><span class="linenos">2115</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tram_model</span><span class="p">,</span> <span class="s2">&quot;nn_int&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tram_model</span><span class="o">.</span><span class="n">nn_int</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tram_model</span><span class="o">.</span><span class="n">nn_int</span><span class="p">,</span> <span class="n">SimpleIntercept</span><span class="p">):</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2116"><a href="#TramDagModel.get_simple_intercepts_dict-2116"><span class="linenos">2116</span></a>                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tram_model</span><span class="o">.</span><span class="n">nn_int</span><span class="p">,</span> <span class="s2">&quot;fc&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tram_model</span><span class="o">.</span><span class="n">nn_int</span><span class="o">.</span><span class="n">fc</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">):</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2117"><a href="#TramDagModel.get_simple_intercepts_dict-2117"><span class="linenos">2117</span></a>                        <span class="n">weights</span> <span class="o">=</span> <span class="n">tram_model</span><span class="o">.</span><span class="n">nn_int</span><span class="o">.</span><span class="n">fc</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2118"><a href="#TramDagModel.get_simple_intercepts_dict-2118"><span class="linenos">2118</span></a>                        <span class="n">weights_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2119"><a href="#TramDagModel.get_simple_intercepts_dict-2119"><span class="linenos">2119</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2120"><a href="#TramDagModel.get_simple_intercepts_dict-2120"><span class="linenos">2120</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2121"><a href="#TramDagModel.get_simple_intercepts_dict-2121"><span class="linenos">2121</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">) theta tilde shape: </span><span class="si">{</span><span class="n">weights_tensor</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2122"><a href="#TramDagModel.get_simple_intercepts_dict-2122"><span class="linenos">2122</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2123"><a href="#TramDagModel.get_simple_intercepts_dict-2123"><span class="linenos">2123</span></a>                        <span class="k">if</span> <span class="n">is_ontram</span><span class="p">:</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2124"><a href="#TramDagModel.get_simple_intercepts_dict-2124"><span class="linenos">2124</span></a>                            <span class="n">si_weights</span> <span class="o">=</span> <span class="n">transform_intercepts_ordinal</span><span class="p">(</span><span class="n">weights_tensor</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))[:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2125"><a href="#TramDagModel.get_simple_intercepts_dict-2125"><span class="linenos">2125</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2126"><a href="#TramDagModel.get_simple_intercepts_dict-2126"><span class="linenos">2126</span></a>                            <span class="n">si_weights</span> <span class="o">=</span> <span class="n">transform_intercepts_continous</span><span class="p">(</span><span class="n">weights_tensor</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2127"><a href="#TramDagModel.get_simple_intercepts_dict-2127"><span class="linenos">2127</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2128"><a href="#TramDagModel.get_simple_intercepts_dict-2128"><span class="linenos">2128</span></a>                        <span class="n">si_weights</span> <span class="o">=</span> <span class="n">si_weights</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2129"><a href="#TramDagModel.get_simple_intercepts_dict-2129"><span class="linenos">2129</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2130"><a href="#TramDagModel.get_simple_intercepts_dict-2130"><span class="linenos">2130</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2131"><a href="#TramDagModel.get_simple_intercepts_dict-2131"><span class="linenos">2131</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">) theta transformed: </span><span class="si">{</span><span class="n">si_weights</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2132"><a href="#TramDagModel.get_simple_intercepts_dict-2132"><span class="linenos">2132</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2133"><a href="#TramDagModel.get_simple_intercepts_dict-2133"><span class="linenos">2133</span></a>                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2134"><a href="#TramDagModel.get_simple_intercepts_dict-2134"><span class="linenos">2134</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">): missing &#39;fc&#39; or &#39;weight&#39; in SimpleIntercept.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2135"><a href="#TramDagModel.get_simple_intercepts_dict-2135"><span class="linenos">2135</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2136"><a href="#TramDagModel.get_simple_intercepts_dict-2136"><span class="linenos">2136</span></a>                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2137"><a href="#TramDagModel.get_simple_intercepts_dict-2137"><span class="linenos">2137</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG] Tram model for node &#39;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">&#39; has no nn_int or it is None.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2138"><a href="#TramDagModel.get_simple_intercepts_dict-2138"><span class="linenos">2138</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2139"><a href="#TramDagModel.get_simple_intercepts_dict-2139"><span class="linenos">2139</span></a>                <span class="n">all_si_intercept_dicts</span><span class="p">[</span><span class="n">state</span><span class="p">][</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">si_weights</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2140"><a href="#TramDagModel.get_simple_intercepts_dict-2140"><span class="linenos">2140</span></a>
</span><span id="TramDagModel.get_simple_intercepts_dict-2141"><a href="#TramDagModel.get_simple_intercepts_dict-2141"><span class="linenos">2141</span></a>        <span class="c1"># Clean up empty states</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2142"><a href="#TramDagModel.get_simple_intercepts_dict-2142"><span class="linenos">2142</span></a>        <span class="n">all_si_intercept_dicts</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_si_intercept_dicts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">}</span>
</span><span id="TramDagModel.get_simple_intercepts_dict-2143"><a href="#TramDagModel.get_simple_intercepts_dict-2143"><span class="linenos">2143</span></a>        <span class="k">return</span> <span class="n">all_si_intercept_dicts</span>
</span></pre></div>


            <div class="docstring"><p>Compute transformed simple intercept dictionaries for all nodes and states.</p>

<p>For each node and each available state ("best", "last", "init"), this
method loads the corresponding model checkpoint, extracts simple intercept
weights, transforms them into interpretable theta parameters, and stores
them in a nested dictionary.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Nested dictionary of the form:</p>

<pre><code>```python
</code></pre>

<p>{
    "best": {node: [[theta_1], [theta_2], ...]},
    "last": {node: [[theta_1], [theta_2], ...]},
    "init": {node: [[theta_1], [theta_2], ...]},
}
```</p>

<h2 id="notes">Notes</h2>

<ul>
<li>For ordinal models (<code>self.is_ontram == True</code>), <code>transform_intercepts_ordinal</code>
is used.</li>
<li>For continuous models, <code>transform_intercepts_continous</code> is used.</li>
<li>Empty outer states (without any nodes) are removed from the result.</li>
</ul>
</div>


                            </div>
                            <div id="TramDagModel.summary" class="classattr">
                                        <input id="TramDagModel.summary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">summary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TramDagModel.summary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TramDagModel.summary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TramDagModel.summary-2145"><a href="#TramDagModel.summary-2145"><span class="linenos">2145</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="TramDagModel.summary-2146"><a href="#TramDagModel.summary-2146"><span class="linenos">2146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TramDagModel.summary-2147"><a href="#TramDagModel.summary-2147"><span class="linenos">2147</span></a><span class="sd">        Print a multi-part textual summary of the TramDagModel.</span>
</span><span id="TramDagModel.summary-2148"><a href="#TramDagModel.summary-2148"><span class="linenos">2148</span></a>
</span><span id="TramDagModel.summary-2149"><a href="#TramDagModel.summary-2149"><span class="linenos">2149</span></a><span class="sd">        The summary includes:</span>
</span><span id="TramDagModel.summary-2150"><a href="#TramDagModel.summary-2150"><span class="linenos">2150</span></a><span class="sd">        1. Training metrics overview per node (best/last NLL, epochs).</span>
</span><span id="TramDagModel.summary-2151"><a href="#TramDagModel.summary-2151"><span class="linenos">2151</span></a><span class="sd">        2. Node-specific details (thetas, linear shifts, optional architecture).</span>
</span><span id="TramDagModel.summary-2152"><a href="#TramDagModel.summary-2152"><span class="linenos">2152</span></a><span class="sd">        3. Basic information about the attached training DataFrame, if present.</span>
</span><span id="TramDagModel.summary-2153"><a href="#TramDagModel.summary-2153"><span class="linenos">2153</span></a>
</span><span id="TramDagModel.summary-2154"><a href="#TramDagModel.summary-2154"><span class="linenos">2154</span></a><span class="sd">        Parameters</span>
</span><span id="TramDagModel.summary-2155"><a href="#TramDagModel.summary-2155"><span class="linenos">2155</span></a><span class="sd">        ----------</span>
</span><span id="TramDagModel.summary-2156"><a href="#TramDagModel.summary-2156"><span class="linenos">2156</span></a><span class="sd">        verbose : bool, optional</span>
</span><span id="TramDagModel.summary-2157"><a href="#TramDagModel.summary-2157"><span class="linenos">2157</span></a><span class="sd">            If True, include extended per-node details such as the model</span>
</span><span id="TramDagModel.summary-2158"><a href="#TramDagModel.summary-2158"><span class="linenos">2158</span></a><span class="sd">            architecture, parameter count, and availability of checkpoints</span>
</span><span id="TramDagModel.summary-2159"><a href="#TramDagModel.summary-2159"><span class="linenos">2159</span></a><span class="sd">            and sampling results. Default is False.</span>
</span><span id="TramDagModel.summary-2160"><a href="#TramDagModel.summary-2160"><span class="linenos">2160</span></a>
</span><span id="TramDagModel.summary-2161"><a href="#TramDagModel.summary-2161"><span class="linenos">2161</span></a><span class="sd">        Returns</span>
</span><span id="TramDagModel.summary-2162"><a href="#TramDagModel.summary-2162"><span class="linenos">2162</span></a><span class="sd">        -------</span>
</span><span id="TramDagModel.summary-2163"><a href="#TramDagModel.summary-2163"><span class="linenos">2163</span></a><span class="sd">        None</span>
</span><span id="TramDagModel.summary-2164"><a href="#TramDagModel.summary-2164"><span class="linenos">2164</span></a>
</span><span id="TramDagModel.summary-2165"><a href="#TramDagModel.summary-2165"><span class="linenos">2165</span></a><span class="sd">        Notes</span>
</span><span id="TramDagModel.summary-2166"><a href="#TramDagModel.summary-2166"><span class="linenos">2166</span></a><span class="sd">        -----</span>
</span><span id="TramDagModel.summary-2167"><a href="#TramDagModel.summary-2167"><span class="linenos">2167</span></a><span class="sd">        This method prints to stdout and does not return structured data.</span>
</span><span id="TramDagModel.summary-2168"><a href="#TramDagModel.summary-2168"><span class="linenos">2168</span></a><span class="sd">        It is intended for quick, human-readable inspection of the current</span>
</span><span id="TramDagModel.summary-2169"><a href="#TramDagModel.summary-2169"><span class="linenos">2169</span></a><span class="sd">        training and model state.</span>
</span><span id="TramDagModel.summary-2170"><a href="#TramDagModel.summary-2170"><span class="linenos">2170</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TramDagModel.summary-2171"><a href="#TramDagModel.summary-2171"><span class="linenos">2171</span></a>
</span><span id="TramDagModel.summary-2172"><a href="#TramDagModel.summary-2172"><span class="linenos">2172</span></a>        <span class="c1"># ---------- SETUP ----------</span>
</span><span id="TramDagModel.summary-2173"><a href="#TramDagModel.summary-2173"><span class="linenos">2173</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2174"><a href="#TramDagModel.summary-2174"><span class="linenos">2174</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">]</span>
</span><span id="TramDagModel.summary-2175"><a href="#TramDagModel.summary-2175"><span class="linenos">2175</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2176"><a href="#TramDagModel.summary-2176"><span class="linenos">2176</span></a>            <span class="n">EXPERIMENT_DIR</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagModel.summary-2177"><a href="#TramDagModel.summary-2177"><span class="linenos">2177</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] Missing EXPERIMENT_DIR in cfg.conf_dict[&#39;PATHS&#39;].&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2178"><a href="#TramDagModel.summary-2178"><span class="linenos">2178</span></a>
</span><span id="TramDagModel.summary-2179"><a href="#TramDagModel.summary-2179"><span class="linenos">2179</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">120</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2180"><a href="#TramDagModel.summary-2180"><span class="linenos">2180</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;TRAM DAG MODEL SUMMARY&#39;</span><span class="si">:</span><span class="s2">^120</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2181"><a href="#TramDagModel.summary-2181"><span class="linenos">2181</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">120</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2182"><a href="#TramDagModel.summary-2182"><span class="linenos">2182</span></a>
</span><span id="TramDagModel.summary-2183"><a href="#TramDagModel.summary-2183"><span class="linenos">2183</span></a>        <span class="c1"># ---------- METRICS OVERVIEW ----------</span>
</span><span id="TramDagModel.summary-2184"><a href="#TramDagModel.summary-2184"><span class="linenos">2184</span></a>        <span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TramDagModel.summary-2185"><a href="#TramDagModel.summary-2185"><span class="linenos">2185</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TramDagModel.summary-2186"><a href="#TramDagModel.summary-2186"><span class="linenos">2186</span></a>            <span class="n">node_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">conf_dict</span><span class="p">[</span><span class="s2">&quot;PATHS&quot;</span><span class="p">][</span><span class="s2">&quot;EXPERIMENT_DIR&quot;</span><span class="p">],</span> <span class="n">node</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2187"><a href="#TramDagModel.summary-2187"><span class="linenos">2187</span></a>            <span class="n">train_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="s2">&quot;train_loss_hist.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2188"><a href="#TramDagModel.summary-2188"><span class="linenos">2188</span></a>            <span class="n">val_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="s2">&quot;val_loss_hist.json&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2189"><a href="#TramDagModel.summary-2189"><span class="linenos">2189</span></a>
</span><span id="TramDagModel.summary-2190"><a href="#TramDagModel.summary-2190"><span class="linenos">2190</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">train_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">val_path</span><span class="p">):</span>
</span><span id="TramDagModel.summary-2191"><a href="#TramDagModel.summary-2191"><span class="linenos">2191</span></a>                <span class="n">best_train_nll</span><span class="p">,</span> <span class="n">best_val_nll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_train_val_nll</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;best&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2192"><a href="#TramDagModel.summary-2192"><span class="linenos">2192</span></a>                <span class="n">last_train_nll</span><span class="p">,</span> <span class="n">last_val_nll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_train_val_nll</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2193"><a href="#TramDagModel.summary-2193"><span class="linenos">2193</span></a>                <span class="n">n_epochs_total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">train_path</span><span class="p">)))</span>
</span><span id="TramDagModel.summary-2194"><a href="#TramDagModel.summary-2194"><span class="linenos">2194</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2195"><a href="#TramDagModel.summary-2195"><span class="linenos">2195</span></a>                <span class="n">best_train_nll</span> <span class="o">=</span> <span class="n">best_val_nll</span> <span class="o">=</span> <span class="n">last_train_nll</span> <span class="o">=</span> <span class="n">last_val_nll</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TramDagModel.summary-2196"><a href="#TramDagModel.summary-2196"><span class="linenos">2196</span></a>                <span class="n">n_epochs_total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TramDagModel.summary-2197"><a href="#TramDagModel.summary-2197"><span class="linenos">2197</span></a>
</span><span id="TramDagModel.summary-2198"><a href="#TramDagModel.summary-2198"><span class="linenos">2198</span></a>            <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="TramDagModel.summary-2199"><a href="#TramDagModel.summary-2199"><span class="linenos">2199</span></a>                <span class="s2">&quot;Node&quot;</span><span class="p">:</span> <span class="n">node</span><span class="p">,</span>
</span><span id="TramDagModel.summary-2200"><a href="#TramDagModel.summary-2200"><span class="linenos">2200</span></a>                <span class="s2">&quot;Best Train NLL&quot;</span><span class="p">:</span> <span class="n">best_train_nll</span><span class="p">,</span>
</span><span id="TramDagModel.summary-2201"><a href="#TramDagModel.summary-2201"><span class="linenos">2201</span></a>                <span class="s2">&quot;Best Val NLL&quot;</span><span class="p">:</span> <span class="n">best_val_nll</span><span class="p">,</span>
</span><span id="TramDagModel.summary-2202"><a href="#TramDagModel.summary-2202"><span class="linenos">2202</span></a>                <span class="s2">&quot;Last Train NLL&quot;</span><span class="p">:</span> <span class="n">last_train_nll</span><span class="p">,</span>
</span><span id="TramDagModel.summary-2203"><a href="#TramDagModel.summary-2203"><span class="linenos">2203</span></a>                <span class="s2">&quot;Last Val NLL&quot;</span><span class="p">:</span> <span class="n">last_val_nll</span><span class="p">,</span>
</span><span id="TramDagModel.summary-2204"><a href="#TramDagModel.summary-2204"><span class="linenos">2204</span></a>                <span class="s2">&quot;Epochs&quot;</span><span class="p">:</span> <span class="n">n_epochs_total</span><span class="p">,</span>
</span><span id="TramDagModel.summary-2205"><a href="#TramDagModel.summary-2205"><span class="linenos">2205</span></a>            <span class="p">})</span>
</span><span id="TramDagModel.summary-2206"><a href="#TramDagModel.summary-2206"><span class="linenos">2206</span></a>
</span><span id="TramDagModel.summary-2207"><a href="#TramDagModel.summary-2207"><span class="linenos">2207</span></a>        <span class="n">df_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2208"><a href="#TramDagModel.summary-2208"><span class="linenos">2208</span></a>        <span class="n">df_summary</span> <span class="o">=</span> <span class="n">df_summary</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2209"><a href="#TramDagModel.summary-2209"><span class="linenos">2209</span></a>
</span><span id="TramDagModel.summary-2210"><a href="#TramDagModel.summary-2210"><span class="linenos">2210</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[1] TRAINING METRICS OVERVIEW&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2211"><a href="#TramDagModel.summary-2211"><span class="linenos">2211</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">120</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2212"><a href="#TramDagModel.summary-2212"><span class="linenos">2212</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">df_summary</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2213"><a href="#TramDagModel.summary-2213"><span class="linenos">2213</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="TramDagModel.summary-2214"><a href="#TramDagModel.summary-2214"><span class="linenos">2214</span></a>                <span class="n">df_summary</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
</span><span id="TramDagModel.summary-2215"><a href="#TramDagModel.summary-2215"><span class="linenos">2215</span></a>                    <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="TramDagModel.summary-2216"><a href="#TramDagModel.summary-2216"><span class="linenos">2216</span></a>                    <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
</span><span id="TramDagModel.summary-2217"><a href="#TramDagModel.summary-2217"><span class="linenos">2217</span></a>                    <span class="n">col_space</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
</span><span id="TramDagModel.summary-2218"><a href="#TramDagModel.summary-2218"><span class="linenos">2218</span></a>                    <span class="n">float_format</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">7.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="TramDagModel.summary-2219"><a href="#TramDagModel.summary-2219"><span class="linenos">2219</span></a>                <span class="p">)</span>
</span><span id="TramDagModel.summary-2220"><a href="#TramDagModel.summary-2220"><span class="linenos">2220</span></a>            <span class="p">)</span>
</span><span id="TramDagModel.summary-2221"><a href="#TramDagModel.summary-2221"><span class="linenos">2221</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2222"><a href="#TramDagModel.summary-2222"><span class="linenos">2222</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No training history found for any node.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2223"><a href="#TramDagModel.summary-2223"><span class="linenos">2223</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">120</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2224"><a href="#TramDagModel.summary-2224"><span class="linenos">2224</span></a>
</span><span id="TramDagModel.summary-2225"><a href="#TramDagModel.summary-2225"><span class="linenos">2225</span></a>        <span class="c1"># ---------- NODE DETAILS ----------</span>
</span><span id="TramDagModel.summary-2226"><a href="#TramDagModel.summary-2226"><span class="linenos">2226</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[2] NODE-SPECIFIC DETAILS&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2227"><a href="#TramDagModel.summary-2227"><span class="linenos">2227</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">120</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2228"><a href="#TramDagModel.summary-2228"><span class="linenos">2228</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="TramDagModel.summary-2229"><a href="#TramDagModel.summary-2229"><span class="linenos">2229</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="sa">f</span><span class="s1">&#39;NODE: </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s1">&#39;</span><span class="si">:</span><span class="s2">^120</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2230"><a href="#TramDagModel.summary-2230"><span class="linenos">2230</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">120</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2231"><a href="#TramDagModel.summary-2231"><span class="linenos">2231</span></a>
</span><span id="TramDagModel.summary-2232"><a href="#TramDagModel.summary-2232"><span class="linenos">2232</span></a>            <span class="c1"># THETAS &amp; SHIFTS</span>
</span><span id="TramDagModel.summary-2233"><a href="#TramDagModel.summary-2233"><span class="linenos">2233</span></a>            <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;best&quot;</span><span class="p">]:</span>
</span><span id="TramDagModel.summary-2234"><a href="#TramDagModel.summary-2234"><span class="linenos">2234</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  [</span><span class="si">{</span><span class="n">state</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> STATE]&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2235"><a href="#TramDagModel.summary-2235"><span class="linenos">2235</span></a>
</span><span id="TramDagModel.summary-2236"><a href="#TramDagModel.summary-2236"><span class="linenos">2236</span></a>                <span class="c1"># ---- Thetas ----</span>
</span><span id="TramDagModel.summary-2237"><a href="#TramDagModel.summary-2237"><span class="linenos">2237</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2238"><a href="#TramDagModel.summary-2238"><span class="linenos">2238</span></a>                    <span class="n">thetas</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_thetas&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="kc">None</span><span class="p">:</span> <span class="kc">None</span><span class="p">)(</span><span class="n">node</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2239"><a href="#TramDagModel.summary-2239"><span class="linenos">2239</span></a>                    <span class="k">if</span> <span class="n">thetas</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2240"><a href="#TramDagModel.summary-2240"><span class="linenos">2240</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thetas</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
</span><span id="TramDagModel.summary-2241"><a href="#TramDagModel.summary-2241"><span class="linenos">2241</span></a>                            <span class="n">thetas_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">thetas</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="TramDagModel.summary-2242"><a href="#TramDagModel.summary-2242"><span class="linenos">2242</span></a>                            <span class="n">compact</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">thetas_flat</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2243"><a href="#TramDagModel.summary-2243"><span class="linenos">2243</span></a>                            <span class="n">arr_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array2string</span><span class="p">(</span>
</span><span id="TramDagModel.summary-2244"><a href="#TramDagModel.summary-2244"><span class="linenos">2244</span></a>                                <span class="n">compact</span><span class="p">,</span>
</span><span id="TramDagModel.summary-2245"><a href="#TramDagModel.summary-2245"><span class="linenos">2245</span></a>                                <span class="n">max_line_width</span><span class="o">=</span><span class="mi">110</span><span class="p">,</span>
</span><span id="TramDagModel.summary-2246"><a href="#TramDagModel.summary-2246"><span class="linenos">2246</span></a>                                <span class="n">threshold</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
</span><span id="TramDagModel.summary-2247"><a href="#TramDagModel.summary-2247"><span class="linenos">2247</span></a>                                <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;, &quot;</span>
</span><span id="TramDagModel.summary-2248"><a href="#TramDagModel.summary-2248"><span class="linenos">2248</span></a>                            <span class="p">)</span>
</span><span id="TramDagModel.summary-2249"><a href="#TramDagModel.summary-2249"><span class="linenos">2249</span></a>                            <span class="n">lines</span> <span class="o">=</span> <span class="n">arr_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2250"><a href="#TramDagModel.summary-2250"><span class="linenos">2250</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2251"><a href="#TramDagModel.summary-2251"><span class="linenos">2251</span></a>                                <span class="n">arr_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; ...&quot;</span>
</span><span id="TramDagModel.summary-2252"><a href="#TramDagModel.summary-2252"><span class="linenos">2252</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">thetas_flat</span><span class="p">)</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">arr_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2253"><a href="#TramDagModel.summary-2253"><span class="linenos">2253</span></a>                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thetas</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="TramDagModel.summary-2254"><a href="#TramDagModel.summary-2254"><span class="linenos">2254</span></a>                            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">thetas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagModel.summary-2255"><a href="#TramDagModel.summary-2255"><span class="linenos">2255</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     [</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">]: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2256"><a href="#TramDagModel.summary-2256"><span class="linenos">2256</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2257"><a href="#TramDagModel.summary-2257"><span class="linenos">2257</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    : </span><span class="si">{</span><span class="n">thetas</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2258"><a href="#TramDagModel.summary-2258"><span class="linenos">2258</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2259"><a href="#TramDagModel.summary-2259"><span class="linenos">2259</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    : not available&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2260"><a href="#TramDagModel.summary-2260"><span class="linenos">2260</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2261"><a href="#TramDagModel.summary-2261"><span class="linenos">2261</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [Error loading thetas] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2262"><a href="#TramDagModel.summary-2262"><span class="linenos">2262</span></a>
</span><span id="TramDagModel.summary-2263"><a href="#TramDagModel.summary-2263"><span class="linenos">2263</span></a>                <span class="c1"># ---- Linear Shifts ----</span>
</span><span id="TramDagModel.summary-2264"><a href="#TramDagModel.summary-2264"><span class="linenos">2264</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2265"><a href="#TramDagModel.summary-2265"><span class="linenos">2265</span></a>                    <span class="n">linear_shifts</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_linear_shifts&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="kc">None</span><span class="p">:</span> <span class="kc">None</span><span class="p">)(</span><span class="n">node</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2266"><a href="#TramDagModel.summary-2266"><span class="linenos">2266</span></a>                    <span class="k">if</span> <span class="n">linear_shifts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2267"><a href="#TramDagModel.summary-2267"><span class="linenos">2267</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">linear_shifts</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="TramDagModel.summary-2268"><a href="#TramDagModel.summary-2268"><span class="linenos">2268</span></a>                            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">linear_shifts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TramDagModel.summary-2269"><a href="#TramDagModel.summary-2269"><span class="linenos">2269</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2270"><a href="#TramDagModel.summary-2270"><span class="linenos">2270</span></a>                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">linear_shifts</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
</span><span id="TramDagModel.summary-2271"><a href="#TramDagModel.summary-2271"><span class="linenos">2271</span></a>                            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">linear_shifts</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2272"><a href="#TramDagModel.summary-2272"><span class="linenos">2272</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Linear shifts (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">arr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2273"><a href="#TramDagModel.summary-2273"><span class="linenos">2273</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2274"><a href="#TramDagModel.summary-2274"><span class="linenos">2274</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Linear shifts: </span><span class="si">{</span><span class="n">linear_shifts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2275"><a href="#TramDagModel.summary-2275"><span class="linenos">2275</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2276"><a href="#TramDagModel.summary-2276"><span class="linenos">2276</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Linear shifts: not available&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2277"><a href="#TramDagModel.summary-2277"><span class="linenos">2277</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2278"><a href="#TramDagModel.summary-2278"><span class="linenos">2278</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [Error loading linear shifts] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2279"><a href="#TramDagModel.summary-2279"><span class="linenos">2279</span></a>
</span><span id="TramDagModel.summary-2280"><a href="#TramDagModel.summary-2280"><span class="linenos">2280</span></a>            <span class="c1"># ---- Verbose info directly below node ----</span>
</span><span id="TramDagModel.summary-2281"><a href="#TramDagModel.summary-2281"><span class="linenos">2281</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2282"><a href="#TramDagModel.summary-2282"><span class="linenos">2282</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  [DETAILS]&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2283"><a href="#TramDagModel.summary-2283"><span class="linenos">2283</span></a>                <span class="n">node_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">EXPERIMENT_DIR</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="k">if</span> <span class="n">EXPERIMENT_DIR</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="TramDagModel.summary-2284"><a href="#TramDagModel.summary-2284"><span class="linenos">2284</span></a>                <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
</span><span id="TramDagModel.summary-2285"><a href="#TramDagModel.summary-2285"><span class="linenos">2285</span></a>
</span><span id="TramDagModel.summary-2286"><a href="#TramDagModel.summary-2286"><span class="linenos">2286</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Model Architecture:&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2287"><a href="#TramDagModel.summary-2287"><span class="linenos">2287</span></a>                <span class="n">arch_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2288"><a href="#TramDagModel.summary-2288"><span class="linenos">2288</span></a>                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">arch_str</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2289"><a href="#TramDagModel.summary-2289"><span class="linenos">2289</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2290"><a href="#TramDagModel.summary-2290"><span class="linenos">2290</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Parameter count: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2291"><a href="#TramDagModel.summary-2291"><span class="linenos">2291</span></a>
</span><span id="TramDagModel.summary-2292"><a href="#TramDagModel.summary-2292"><span class="linenos">2292</span></a>                <span class="k">if</span> <span class="n">node_dir</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">node_dir</span><span class="p">):</span>
</span><span id="TramDagModel.summary-2293"><a href="#TramDagModel.summary-2293"><span class="linenos">2293</span></a>                    <span class="n">ckpt_exists</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s1">&#39;.pt&#39;</span><span class="p">,</span> <span class="s1">&#39;.pth&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">node_dir</span><span class="p">))</span>
</span><span id="TramDagModel.summary-2294"><a href="#TramDagModel.summary-2294"><span class="linenos">2294</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Checkpoints found: </span><span class="si">{</span><span class="n">ckpt_exists</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2295"><a href="#TramDagModel.summary-2295"><span class="linenos">2295</span></a>
</span><span id="TramDagModel.summary-2296"><a href="#TramDagModel.summary-2296"><span class="linenos">2296</span></a>                    <span class="n">sampling_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="s2">&quot;sampling&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2297"><a href="#TramDagModel.summary-2297"><span class="linenos">2297</span></a>                    <span class="n">sampling_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">sampling_dir</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sampling_dir</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="TramDagModel.summary-2298"><a href="#TramDagModel.summary-2298"><span class="linenos">2298</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Sampling results found: </span><span class="si">{</span><span class="n">sampling_exists</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2299"><a href="#TramDagModel.summary-2299"><span class="linenos">2299</span></a>
</span><span id="TramDagModel.summary-2300"><a href="#TramDagModel.summary-2300"><span class="linenos">2300</span></a>                    <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;Train&quot;</span><span class="p">,</span> <span class="s2">&quot;train_loss_hist.json&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Validation&quot;</span><span class="p">,</span> <span class="s2">&quot;val_loss_hist.json&quot;</span><span class="p">)]:</span>
</span><span id="TramDagModel.summary-2301"><a href="#TramDagModel.summary-2301"><span class="linenos">2301</span></a>                        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2302"><a href="#TramDagModel.summary-2302"><span class="linenos">2302</span></a>                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="TramDagModel.summary-2303"><a href="#TramDagModel.summary-2303"><span class="linenos">2303</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2304"><a href="#TramDagModel.summary-2304"><span class="linenos">2304</span></a>                                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2305"><a href="#TramDagModel.summary-2305"><span class="linenos">2305</span></a>                                    <span class="n">hist</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2306"><a href="#TramDagModel.summary-2306"><span class="linenos">2306</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> history: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span><span class="si">}</span><span class="s2"> epochs&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2307"><a href="#TramDagModel.summary-2307"><span class="linenos">2307</span></a>                            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2308"><a href="#TramDagModel.summary-2308"><span class="linenos">2308</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> history: failed to load (</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2309"><a href="#TramDagModel.summary-2309"><span class="linenos">2309</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2310"><a href="#TramDagModel.summary-2310"><span class="linenos">2310</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> history: not found&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2311"><a href="#TramDagModel.summary-2311"><span class="linenos">2311</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2312"><a href="#TramDagModel.summary-2312"><span class="linenos">2312</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    [INFO] No experiment directory defined or missing for this node.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2313"><a href="#TramDagModel.summary-2313"><span class="linenos">2313</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">120</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2314"><a href="#TramDagModel.summary-2314"><span class="linenos">2314</span></a>
</span><span id="TramDagModel.summary-2315"><a href="#TramDagModel.summary-2315"><span class="linenos">2315</span></a>        <span class="c1"># ---------- TRAINING DATAFRAME ----------</span>
</span><span id="TramDagModel.summary-2316"><a href="#TramDagModel.summary-2316"><span class="linenos">2316</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[3] TRAINING DATAFRAME&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2317"><a href="#TramDagModel.summary-2317"><span class="linenos">2317</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">120</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2318"><a href="#TramDagModel.summary-2318"><span class="linenos">2318</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2319"><a href="#TramDagModel.summary-2319"><span class="linenos">2319</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">train_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</span><span id="TramDagModel.summary-2320"><a href="#TramDagModel.summary-2320"><span class="linenos">2320</span></a>        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="TramDagModel.summary-2321"><a href="#TramDagModel.summary-2321"><span class="linenos">2321</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No training DataFrame attached to this TramDagModel.&quot;</span><span class="p">)</span>
</span><span id="TramDagModel.summary-2322"><a href="#TramDagModel.summary-2322"><span class="linenos">2322</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">120</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Print a multi-part textual summary of the TramDagModel.</p>

<p>The summary includes:</p>

<ol>
<li>Training metrics overview per node (best/last NLL, epochs).</li>
<li>Node-specific details (thetas, linear shifts, optional architecture).</li>
<li>Basic information about the attached training DataFrame, if present.</li>
</ol>

<h2 id="parameters">Parameters</h2>

<p>verbose : bool, optional
    If True, include extended per-node details such as the model
    architecture, parameter count, and availability of checkpoints
    and sampling results. Default is False.</p>

<h2 id="returns">Returns</h2>

<p>None</p>

<h2 id="notes">Notes</h2>

<p>This method prints to stdout and does not return structured data.
It is intended for quick, human-readable inspection of the current
training and model state.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>